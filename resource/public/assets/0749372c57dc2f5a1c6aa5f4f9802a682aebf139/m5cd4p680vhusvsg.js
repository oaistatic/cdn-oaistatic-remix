const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/c1beod5eyw1gwm28.js","assets/lklglvrzltpv3f05.js","assets/ntw4l0fkgqdiln85.js","assets/ltrr4mhf6s4m7a72.js","assets/root-bh5spu2n.css","assets/conversation-small-iybhw0ps.css","assets/m1w997decqdgni3k.js","assets/iuc1m9qjudz4s87e.js","assets/l8mk8hbg0qwp8xdr.js","assets/i6vhcfa9ey9k9tjp.js","assets/k7oseobxn1x5zsjv.js","assets/od0q70ax7x1slg7q.js","assets/mrdowcb525zld97p.js","assets/hzzlkn5ny7a6v61q.js","assets/dz00r7qlzgek59uu.js","assets/bwsmtgh34vk8igjb.js","assets/vyarha3ckzwu9yf1.js","assets/lnovrxcizvfadwta.js","assets/lfbin8ifnu2nwlmw.js","assets/kfqvem3gritae76f.js","assets/na42ifqi6lhxflf7.js","assets/h7pmbb5vmse5tefq.js","assets/mt32v9j55tcm2wdj.js","assets/jqm9hp4q1v7rqazn.js","assets/hzqr5if7i3daaxip.js","assets/c4bxzbp1808foto4.js","assets/heefrlxlra66lmjs.js","assets/gq1oquoigcb35b69.js","assets/d6k0r3pimtfp2dmz.js","assets/lweu58rz02vpanvm.js","assets/i9ntb1zjwbcuz2uj.js","assets/c84k0nbcah46qpzd.js","assets/p8eg3euad9gvin3k.js","assets/gruuolgwd1up46vp.js","assets/geelmq6s950ur7ij.js","assets/nqaclxqlzl9tdbg1.js","assets/bxwx37b57lp5xuaa.js","assets/o18iaccqpxf4wdc1.js","assets/eoh3qcov0jni3wda.js","assets/mzilp3ahgr37psbv.js","assets/kcip35zr0y4jdoqd.js","assets/f0ldvca0aj4bxibi.js","assets/emkuxujigj88nqc7.js","assets/lr2wtvbk3k0uolp8.js","assets/et8bgtraglvdyxgt.js","assets/dmls56e1re49jwsn.js","assets/n6v4rknj9zgtveaq.js","assets/h2wrxznmzvsliwms.js","assets/n56psomdxg8obhd8.js","assets/j2h13udkl1zlckh2.js","assets/f3wqh5wbtzeabanv.js","assets/egqiifu2w883tusr.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/j9pn3dpqp3dnyeg5.js","assets/bygcqg9ufhsq2txx.js","assets/ki1h8sr57t9xokxr.js"])))=>i.map(i=>d[i]);
import{aq as fe,cj as $e,P as K,j as X,bA as xo,aX as Fe,at as ts,bm as It,ao as P,am as zs,an as lt,hr as ra,cq as vo,c as Xr,g as Jr,d3 as Ne,bC as hn,f as Ye,aN as He,aO as Oe,dZ as gn,ak as dt,dg as _t,r as J,h as ke,bq as Qr,ad as qe,a3 as Tt,ba as ss,ew as ns,bl as So,g7 as Zr,g5 as ei,ez as ti,d8 as ia,d$ as Ue,ho as si,cb as ni,bT as Q,f6 as An,L as Gs,y as la,aQ as ca,d6 as oi,ag as ut,em as ai,g3 as En,eJ as ri,W as bo,bo as Is,cn as ii,co as li,b3 as ci,gy as di,bp as Ds,hs as ui,bb as Rn,a2 as kt,ht as mi,S as ue,cg as hi,D as pn,ge as da,ae as ua,dX as ma,ff as gi,I as pi,a0 as yo,dO as Ws,fX as fi,hu as ha,aP as Vs,fW as In,bj as Ie,ah as Pn,gE as Dn,u as qs,V as et,b4 as wo,bS as tt,aj as Ct,fF as xi,N as Nt,ee as Bn,B as jt,$ as ga,e3 as vi,aS as Si,b7 as bi,d9 as pa,d5 as yi,f$ as wi,hv as jo,K as Ln,O as ln,e9 as ji,hw as Mi,dd as Ci,d2 as _i,a1 as Ti,eB as ki,hx as Ni,fb as Ai,bE as Ei,dV as fn,e5 as Ri,o as Ze,cv as Ii,dW as Bs,bu as js,M as Ls,cw as Fn,al as Pi,bd as Di,cx as fa,eW as Bi,ci as Li,b9 as Fi,bc as Hi,dP as Oi,hy as xa,gH as va,as as Ui,gI as zi,hz as Gi,J as Wi,cF as Vi,b6 as qi}from"./ltrr4mhf6s4m7a72.js";import{j as e,r as i,M as L,ac as se,ad as os,c as Ce,au as $i,f as Sa,e as Hn,a as ba,X as Yi,v as Ki,L as xn,R as ya,av as Xi,aw as Ji,ax as Mo}from"./lklglvrzltpv3f05.js";import{aR as mt,hj as Qi,lI as Zi,lJ as el,dg as At,lK as wa,lL as ja,lM as we,dd as $s,bL as Qt,lN as Fs,lO as Ve,im as Ma,lP as tl,jx as Ca,jA as _a,gI as sl,B as Ta,fG as nl,jw as ol,lQ as ka,lR as al,lS as rl,lT as Et,gb as Na,lU as V,lV as Aa,lW as Ea,lX as il,lY as ll,lZ as cl,l_ as dl,l$ as ul,m0 as ml,m1 as hl,gB as gl,m2 as pl,m3 as fl,m4 as xl,m5 as vl,bz as as,a$ as Ra,m6 as Sl,m7 as bl,m8 as yl,m9 as Ia,ma as Pa,mb as wl,mc as jl,md as Ml,me as Cl,mf as _l,bA as Ys,mg as Tl,mh as kl,mi as Nl,mj as Al,mk as Da,ml as Ks,fN as rs,mm as On,id as Un,ie as ct,ig as zn,E as El,mn as Gn,mo as Rl,fP as Rt,du as Il,fj as Pl,mp as Dl,mq as Bl,mr as Ll,ms as Hs,mt as Fl,mu as Ba,mv as Hl,z as Ol,ll as Ul,e1 as La,iA as zl,mw as Gl,mx as Wl,bx as Wn,by as Fa,dU as Vl,dV as Ha,co as Oa,cX as is,my as ql,mz as $l,mA as Co,mB as _o,mC as Yl,mD as Kl,bF as To,bC as Xl,iE as Jl,k2 as ko,mE as Ql,mF as Zl,mG as ec,ht as Ua,mH as tc,mI as sc,bJ as za,lt as No,gP as Ga,ga as Vn,mJ as Ao,i0 as nc,bB as oc,mK as ac,iH as rc,k8 as ic,iI as lc,iF as cc,mL as dc,bD as vn,mM as uc,mN as mc,mO as hc,mP as gc,be as Sn,mQ as pc,cG as qn,U as Os,bZ as $n,d1 as fc,mR as xc,mS as vc,ih as Sc,ky as bc,kz as yc,mT as wc,mU as jc,kA as Mc,mV as Cc,mW as _c,mX as Tc,mY as kc,mZ as Nc,m_ as Ac,dL as Ec,iz as Rc,kK as Ic,m$ as Pc,n0 as Dc,n1 as Bc,cO as Wa,n2 as Lc,n3 as Fc,fO as Hc,n4 as Oc,n5 as Uc,n6 as bn,n7 as zc,n8 as Gc,de as yn,n9 as Wc,na as Vc,nb as qc,nc as Va,iT as Yn,dh as Zt,nd as $c,ne as Yc,nf as Kc,ng as wn,aW as qa,nh as Eo,ni as Xc,nj as Jc,nk as Qc,nl as Zc,jV as $a,dc as ed,nm as td,nn as sd,b_ as Kn,hD as Ps,cW as nd,iX as od,no as ad,aZ as Ro,d7 as rd,dI as id,fc as ld,np as cd,X as Xn,nq as Xs,ip as Ya,iS as dd,d9 as Ka,nr as ud,aJ as md,ns as Qe,b1 as hd,nt as gd,nu as jn,nv as pd,nw as Ms,nx as Xa,ny as fd,fX as xd,cN as vd,nz as Sd,gf as bd,nA as yd,i1 as Cs,nB as wd,dr as jd,nC as Md,fB as Cd,p as _d,nD as Td,nE as kd,cH as Nd,nF as Ad,nG as Ed,ct as Rd,nH as Id,nI as Ja,nJ as Qa,nK as Za,nL as er,nM as Mt,d6 as Jn,nN as Pd,ka as Dd,nO as tr,nP as Bd,gS as Us,nQ as Mn,nR as Ld,nS as Fd,nT as _s,c2 as Io,b$ as Hd,c0 as Od,cm as sr,cn as nr,gj as or,gl as ar,eJ as Ud,nU as zd,hd as Gd,nV as Wd,nW as Vd,nX as qd,nY as $d,nZ as Yd,n_ as Kd,bw as Xd,dK as Jd,gR as Qd,c3 as Zd,n$ as eu,o0 as tu,fZ as Ts,gi as su,gk as nu,h7 as ou,o1 as au,o2 as ru,o3 as iu,o4 as lu,o5 as cu,o6 as du,o7 as uu,o8 as mu,o9 as hu,oa as gu,bH as pu,kr as fu,kq as xu,ob as vu,hq as Su,oc as bu,hu as yu,hw as wu,y as ju,gt as Mu,i8 as Cu,i9 as _u,od as Tu,oe as ku,hv as Nu,bK as Au,hr as Eu,of as Ru,og as Iu,cr as Pu,cs as Du,cq as Bu,cv as Lu,oh as Fu,hx as Po,fD as Hu,c8 as Ou,c9 as Uu,hX as zu,kw as Gu,oi as Wu,ic as Vu}from"./ntw4l0fkgqdiln85.js";import{i as Qn,s as qu,j as $u,k as ks,l as Yu,m as Ku,n as Js,C as rr,u as Zn,o as Xu,g as Ju}from"./hzzlkn5ny7a6v61q.js";import{S as ir,a as Qu,b as Zu,G as em,L as tm,c as sm}from"./dz00r7qlzgek59uu.js";import{B as nm}from"./bwsmtgh34vk8igjb.js";import{C as Cn,g as om}from"./vyarha3ckzwu9yf1.js";const Do=fe.div`m-8 flex flex-col items-center`;function Bo(t){return e.jsx(se.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function am({clientThreadId:t}){const o=$e(t,n=>n?.promptGptRating)?.gizmoId,{data:a}=mt(o);return o==null||a==null||!Qi(a)?null:e.jsx(rm,{gizmoId:o})}function rm({gizmoId:t}){const[s,o]=i.useState(!1),[a,n]=i.useState(!1),r=Zi(t),l=async d=>{o(!0),setTimeout(()=>{n(!0)},5e3),K.logEvent(X.submitInlineRating,{gizmo_id:t,rating:d}),await r.mutateAsync({rating:d})},c=async()=>{n(!0),K.logEvent(X.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{a||K.logEvent(X.showInlineRating,{gizmo_id:t})},[a,t]),a?null:s?e.jsx(Do,{children:e.jsxs(Bo,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(L,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(xo,{onClick:()=>{n(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(L,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Do,{children:e.jsxs(Bo,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(L,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(xo,{onClick:c})]}),e.jsx(el,{rating:void 0,onRating:l})]})})}const Ns={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},im=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((o,a)=>e.jsx(se.div,{initial:Ns.initial,animate:Ns.animate,transition:{delay:(a-1)*Ns.transition.delay},exit:Ns.exit,children:e.jsx(It,{as:"button",color:"secondary",size:"small",onClick:()=>{s(o,t,a)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(cm,{suggestion:o})},a)},a))});function lm({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:o}){const a=t?.length>0;i.useEffect(()=>{a&&At(t,o)},[a,o]);const{isUnauthenticated:n}=Fe();return a?t.every(wa)?e.jsxs(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[n&&e.jsx(ts,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(ir,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(ja)?e.jsx(im,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function cm({suggestion:t}){return ja(t)?e.jsx(e.Fragment,{children:t.text}):wa(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:P("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function dm(){const{store:t}=we(),s=t.useSharedProps();return s?e.jsx(um,{...s}):null}function um({clientThreadId:t,suggestions:s}){const o=$s();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(mm,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(lm,{suggestions:s,onSelectingSuggestedReply:o,clientThreadId:t})})})})}const mm=fe.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,lr=({className:t,children:s})=>e.jsx(se.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function hm({currentLeafId:t,canContinue:s,onContinueGenerating:o}){const a=i.useCallback(()=>{const r=new Qt;o(t,r),Fs()},[o,t]);let n=null;return s&&(n=e.jsx(pm,{onHandleContinueGenerating:a})),n&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:n})}function gm({className:t}){return e.jsx(Ma,{className:P("-rotate-180",t)})}const pm=({onHandleContinueGenerating:t})=>e.jsx(lr,{children:e.jsx(It,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:gm,size:"small",children:e.jsx(L,{...Ve.continueGenerating})})}),fm=({clientThreadId:t})=>{const s=ra(),o=zs(t),a=lt(o);i.useEffect(()=>{a&&vo.dismissBanner()},[a]);const n=s?.is_dismissible?()=>vo.dismissBanner():void 0;return e.jsx(os,{children:s&&e.jsx(se.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(tl,{clientThreadId:t,rateLimitInfo:s,onDismiss:n})})})};function xm(t){const s=zs(t),o=lt(s),a=ra();return!o&&a!=null}const _n=window.sessionStorage,Tn=Xr(Jr(()=>({memoryFullBannerDismissed:!!_n?.getItem(hn.MemoryFullBannerDismissed)}))),cr={dismissBanner(){Tn.setState(t=>{t.memoryFullBannerDismissed=!0}),_n?.setItem(hn.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Tn.setState(t=>{t.memoryFullBannerDismissed=!1}),_n?.removeItem(hn.MemoryFullBannerDismissed)}};function vm(t){const s=Ne(t),o=Ca(),{data:a}=_a(s,!1,o),n=a!=null,r=n&&a.memoryFullPct>=100,[l,c]=i.useState(!1);i.useEffect(()=>{!r&&n&&(c(!0),cr.clearDismissedBanner())},[r,n]);const d=Tn(h=>h.memoryFullBannerDismissed);return r&&l&&!d}function Sm(){const t=Ce(),{openSettings:s}=sl();return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Ta,{title:t.formatMessage(As.memoryFullTitle),content:t.formatMessage(As.memoryFullTooltip,As.memoryFullTooltip.values),primaryCtaText:t.formatMessage(As.memoryManageButton),onPrimaryCtaClick:()=>s(nl.Personalization),onDismiss:()=>cr.dismissBanner()})})}const As=Ye({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:ol,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),bm=()=>{const{shouldShowSkipButton:t}=ka();return t?e.jsx(lr,{className:"flex justify-center",children:e.jsx(It,{as:"button",color:"secondary",onClick:()=>al.skipParagen(),children:e.jsx(L,{...ym.skip})})}):null},ym=Ye({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),wm=He(()=>Oe(()=>import("./c1beod5eyw1gwm28.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.JawboneNotificationsBanner)),dr=i.memo(function({className:s}){const{store:o}=we(),a=o.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:P(s??"absolute bottom-full left-0 right-0",Ea.PromptTextareaHeader),children:e.jsx(rl,{shouldRender:a,contentArea:Et.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(ur,{}),e.jsx(mr,{})]})})})});function ur(){const{store:t}=we(),s=t.useSharedProps(r=>r?.clientThreadId),o=t.useContentAreaId(Et.HeaderTop),a=Na();let n;switch(o){case V.ProjectConversationAutoChangeModel:n=e.jsx(Tm,{});break;case V.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(hl,{clientThreadId:s});break;case V.ParagenControls:n=e.jsx(bm,{});break;case V.ItemActions:n=e.jsx(dm,{});break;case V.BannerSignup:n=e.jsx(Cm,{});break;case V.BannerTermsDisclaimer:n=e.jsx(km,{});break;case V.PromptTextareaAction:n=e.jsx(Nm,{});break;case V.BannersRateLimit:n=e.jsx(Am,{});break;case V.BannerSidekickAnnouncement:n=e.jsx(ml,{});break;case V.SearchBrowserExtensionAnnouncement:n=e.jsx(ul,{});break;case V.MemoryInSearchAnnouncement:n=e.jsx(dl,{});break;case V.MoonshineAnnouncement:n=e.jsx(cl,{});break;case V.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(ll,{});break;case V.BannerMemoryFull:n=e.jsx(Sm,{});break;case V.Box:n=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case V.JawboneAnnouncement:a?n=e.jsx(wm,{}):n=null;break;case V.JawboneMaxActiveAnnouncement:a?n=e.jsx(il,{}):n=null;break;default:n=null;break}return n}function mr(){const{store:t}=we(),s=t.useContentAreaId(Et.HeaderBottom);let o;switch(s){case Aa.DallePromptControls:o=e.jsx(Mm,{});break;default:o=null;break}return o}const jm=He(()=>Oe(()=>import("./l8mk8hbg0qwp8xdr.js"),__vite__mapDeps([8,1,3,4,2,5,9])).then(t=>t.default));function Mm(){const{store:t}=we(),s=t.useSharedProps(o=>o?.composerController);return s?e.jsx(jm,{composerController:s}):null}function Cm(){const{store:t}=we(),s=t.useSharedProps(n=>n?.clientThreadId),o=gl(),a=pl();return s?o?e.jsx(fl,{threadId:s,showSignUp:a}):e.jsx(xl,{threadId:s,showLogin:a}):null}function _m({clientThreadId:t}){const s=as(t);return e.jsx(Ta,{icon:e.jsx(Ra,{}),content:e.jsx(L,{id:"IJzX01",defaultMessage:"The model {modelName} does not support project files or instructions. Your conversation will continue with GPT-4o.",values:{modelName:s?.title}})})}function Tm(){const{store:t}=we(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(_m,{clientThreadId:s}):null}function km(){const{store:t}=we(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(vl,{threadId:s}):null}function Nm(){const{store:t}=we(),s=t.useSharedProps();return s?e.jsx(hm,{...s}):null}function Am(){const{store:t}=we(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(fm,{clientThreadId:s}):null}const Em=i.memo(function(s){return Rm(s),Im(s),Pm(),null});function Rm(t){const{store:s}=we(),o=s.useSetSharedProps();gn(()=>{o(t)},[t,o])}function Im(t){const{clientThreadId:s,canContinue:o}=t,{store:a}=we(),n=i.useRef({top:a.useContentAreaApi(Et.HeaderTop),bottom:a.useContentAreaApi(Et.HeaderBottom)}).current,r=Lm(t),l=Sl(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:d}=Fm(s),h=xm(s),u=bl(t),m=yl(t),g=Ia(),v=Pa(),M=wl(t),p=vm(s),j=jl(),b=Ml(t),_=Cl(s),C=_l(s),w=$e(s,k=>k?.modelId),x=Ys(s);gn(()=>{w&&x?.kind===qe.GizmoInteraction&&x.gizmo&&Al(w,x.gizmo)?n.top.set(V.ProjectConversationAutoChangeModel):b.eligible?n.top.set(V.AdvancedVoiceOnMobileAnnouncement):j?n.top.set(V.ParagenControls):d?n.top.set(V.BannerTermsDisclaimer):h?n.top.set(V.BannersRateLimit):_?n.top.set(V.JawboneAnnouncement):C?n.top.set(V.JawboneMaxActiveAnnouncement):u.eligible?n.top.set(V.BannerSidekickAnnouncement):g?n.top.set(V.MemoryInSearchAnnouncement):v?n.top.set(V.MoonshineAnnouncement):m?n.top.set(V.SearchBrowserExtensionAnnouncement):M?n.top.set(V.SearchBrowserExtensionReactiveAnnouncement):r?n.top.set(V.ItemActions):o?n.top.set(V.PromptTextareaAction):c?n.top.set(V.BannerSignup):p?n.top.set(V.BannerMemoryFull):n.top.set(null)},[n,r,o,d,c,h,u,p,j,b]),gn(()=>{l&&n.bottom.set(Aa.DallePromptControls)},[n,l])}function Pm(){const{store:t}=we();i.useEffect(()=>()=>{t.reset()},[t])}function Dm(t){const s=Da(),o=dt(t),a=J.getTree(t).getLastValidNode(o)?.message?.id;return s?.messageId===a?s.suggestions:[]}function Bm(t){return Dm(t).length>0}function Lm(t){const s=Tl(t.clientThreadId),o=Bm(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||o}function Fm(t){const{isUnauthenticated:s}=Fe(),o=dt(t),{layer:a}=_t("3637408529"),n=a.get("should_show_no_auth_signup_banner",!0),r=kl(g=>g.bannerDisclaimerClientThreadId),l=Nl(),c={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return c;const d=J.getTree(t),h=d.countMessagesByAuthor(ke.User),u=d.getNodeByIdOrMessageId(o),m=u?.message?.author.role===ke.Assistant&&Qr(u.message);return c.shouldShowBannerTermsDisclaimer=m&&s&&h===1&&!l&&(r==null||r===t),c.shouldShowBannerSignup=n&&m&&s&&h>0&&h%5===0,c}function Hm({composerController:t,isDisabled:s,highlightTooltip:o,clientThreadId:a}){const{setThreadSearchMode:n}=Ks(),r=rs(),l=$i(),[c,d]=i.useState(!1),h=Ce(),u={clientThreadId:a};return e.jsx(Um,{highlightTooltip:o,analyticsMetadata:u,isThreadUsingSearchMode:r,isDisabled:s,children:e.jsxs("button",{className:P("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",c&&"transition-all duration-150",r||o?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":s?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":r,"aria-label":h.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>d(!1),onClick:m=>{m.stopPropagation(),m.preventDefault(),d(!0),K.logEventWithStatsig(X.composerSearchButtonClicked,"composer_search_button_clicked",u),n(!r,u,Tt.CONVERSATION_COMPOSER_WEB_ICON),r||(t.trimLeadingText(/^search\b/i),t.removeSystemHints(),t.focus())},children:[e.jsx(On,{}),e.jsx(os,{children:r&&e.jsx(se.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:l?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2",children:e.jsx(L,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function Om(){const t=Ia(),s=Pa(),o=Un(ct.hasSeenComposerSearchButtonTooltip);return!o.isLoading&&o.eligible&&!t&&!s}function Um({children:t,highlightTooltip:s,analyticsMetadata:o,isThreadUsingSearchMode:a,isDisabled:n}){const r=Om()&&!a,l=Un(ct.hasSeenComposerSearchButtonTooltip);return r?e.jsx(zn,{announcementKey:ct.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(L,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:l.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(L,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(El,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(L,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(ss,{sideOffset:0,label:n?e.jsx(L,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(L,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(a?!1:void 0),onOpenChange:c=>{c&&K.logEventWithStatsig(X.composerSearchButtonHovered,"composer_search_button_hovered",o)},children:t})})}function zm({composerController:t,clientThreadId:s}){const o=ns(s),a=rs(),{setThreadSearchMode:n}=Ks(),r=Gn(s),[l,c]=i.useState([]),[d,h]=i.useState(void 0),[u,m]=i.useState(0);i.useEffect(()=>{c(d?r.filter(x=>x.name.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())||x.systemHint.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())):[])},[d]),i.useEffect(()=>{t.view.dispatch(qu(t.view.state.tr,{onHintMatch(x){h(k=>ia(k,x)?k:x)}}))},[t]);const g=!r.length||!l.length||!d;i.useEffect(()=>{g&&m(0)},[g]);const v=l.length,M=i.useCallback(x=>{m(k=>(x(k)%v+v)%v)},[v]),p=l[u],j=({hintToSave:x=p,expectPerfectMatch:k})=>{if(!d||!p||k&&x.name.toLowerCase()!==d.text.toLowerCase())return!1;K.logEvent(X.systemHintSelected,{system_hint:x.systemHint,conversation_id:o??So});const G=d.range.from===1?x.name:d.text+x.name.slice(d.text.length),E={clientThreadId:s};return ks(t.view),x.systemHint===Rt.Search?(n(!0,E,Tt.CONVERSATION_COMPOSER_SLASH_SEARCH),d.range&&t.delete(d.range.from,d.range.to),t.removeSystemHints(),!0):(a&&n(!1,E,Tt.CONVERSATION_COMPOSER_SLASH_SEARCH),t.addSystemHint(x.systemHint,G,d.range.from,d.range.to),!0)},b=i.useRef(j);b.current=j;const _=i.useRef(M);_.current=M;const C=i.useRef(d);C.current=d;const w=t.view;return i.useEffect(()=>(g||$u(w,x=>{if(x==="up")_.current(k=>k-1);else if(x==="down")_.current(k=>k+1);else if(x==="cancel")ks(w),Yu(w);else{if(x==="submit")return ks(w),b.current({expectPerfectMatch:!1});if(x==="checkMatch")return b.current({expectPerfectMatch:!0})}}),()=>ks(w)),[g,w]),i.useEffect(()=>{g||K.logEvent(X.systemHintListOpened,{conversation_id:o??So})},[g]),g?null:e.jsx(Zr,{className:"max-w-60",onMouseDown:x=>{x.preventDefault()},children:l.map((x,k)=>e.jsx("div",{onMouseOver:()=>m(k),onClick:()=>{j({hintToSave:x,expectPerfectMatch:!1}),t.focus()},children:e.jsx(ei,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:k===u,children:e.jsx(hr,{title:x.name,description:x.description,logo:x.logo})})},x.systemHint))})}function hr({title:t,description:s,logo:o,checked:a}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Rl,{svgString:o,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:s})]}),a&&e.jsx(ti,{className:P("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function Gm({composerController:t,clientThreadId:s}){return t instanceof Qn?e.jsx(zm,{composerController:t,clientThreadId:s}):null}function Wm({children:t,className:s,showBackground:o}){return e.jsxs("div",{className:"relative",children:[t,o&&e.jsx(se.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:P("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function Vm({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,getInputProps:r,openFileDialog:l,onOauthRedirect:c,historyDisabled:d,isDisabled:h,highlightTooltip:u}){const m=Il(),{gdriveStatus:g,o365Status:v}=Pl(),M=e.jsx(Ll,{className:d?"text-white":u?"text-brand-blue-800":void 0}),p=g!=="false"||v!=="false"||m;return e.jsx("div",{className:"relative",children:e.jsx(Wm,{showBackground:u,className:"bg-brand-blue-800/20",children:p?e.jsx(Dl,{clientThreadId:t,icon:M,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,onOauthRedirect:c,uploadType:s,openFileDialog:l,getInputProps:r,isDisabled:h,highlightTooltip:u}):e.jsx(Bl,{clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,icon:M,isDisabled:h,highlightTooltip:u})})})}function qm({suggestions:t,composerController:s,onSelect:o,onChange:a}){const n=$s(),r=i.useCallback((u,m,g)=>{o?.(u,m,g),n(u,m,g)},[o,n]),[l,c]=i.useState(-1),[d,h]=i.useState(!1);return i.useEffect(()=>{const u=m=>{if(m.key==="ArrowDown"){const g=l===t.length-1?0:l+1;c(g),a?.(g,!0,t[g])}else if(m.key==="ArrowUp"){m.preventDefault();const g=l<=0?t.length-1:l-1;c(g),a?.(g,!0,t[g])}else m.key==="Enter"&&!m.shiftKey&&t[l]&&r(t[l],t,l)};return s.subscribe("keydown",u)},[t,l,a,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{c(-1),a?.(-1,!1)}),[s,a]),i.useEffect(()=>{if(!d){const u=()=>{h(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[d]),i.useEffect(()=>{c(-1),a?.(-1,!1),h(!1)},[t,a]),e.jsx(se.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((u,m)=>e.jsxs(se.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:m*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[m>0&&e.jsx("div",{className:P("h-[1px] opacity-60 max-lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:P("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===m?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),r(u,t,m)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{d&&(c(m),a?.(m,!1,u))},onMouseLeave:()=>{c(-1),a?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:u.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((g,v)=>e.jsx("span",{className:P(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},v))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:P(u.type===Hs.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),m>0&&e.jsx("div",{className:P("h-[1px] opacity-60 lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},u.id??m))})}function $m(t,s){t=t.toLocaleLowerCase();const o=s;s=s.toLocaleLowerCase();const a=[];let n=0;for(let c=0;c<s.length&&(n<t.length&&t[n]===s[c]&&(a.push(c),n++),n!==t.length);c++);const r=[];let l=0;if(a.forEach(c=>{if(c>l){const d=o.slice(l,c);d&&r.push({text:d,isMatched:!1})}r.push({text:o[c],isMatched:!0}),l=c+1}),l<s.length){const c=o.slice(l);c&&r.push({text:c,isMatched:!1})}return Ym(r)}function Ym(t){if(t.length===0)return t;let s=[t[0]];for(let a=1;a<t.length;a++){const n=s[s.length-1],r=t[a];n.isMatched===r.isMatched?n.text+=r.text:s.push(r)}const o=s.filter(a=>a.isMatched).reduce((a,n)=>a+n.text.trim().length,0);return s.length<=4&&o>=2?s:[{text:s.map(a=>a.text).join(""),isMatched:!1}]}const Km=i.forwardRef(function({type:s,placeholder:o,replyRegions:a,state:n,renderFiles:r,leftSideActions:l,topRightAction:c,onSubmit:d,inputState:h,currentLeafId:u,composerController:m,clientThreadId:g,gizmoId:v,disableReason:M},p){const j=Ue(),b=Fl();let _=null;const{isLoading:C}=b;C||(_=b.modelId),i.useEffect(()=>{C||si()||m.focus()},[_,m,C]);const w=x=>{th({target:x.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||m.focus()};return e.jsxs("div",{id:"composer-background",ref:p,className:P("flex w-full cursor-text flex-col rounded-3xl px-2.5 py-1 transition-colors contain-inline-size",j&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",j&&s!=="temporary"&&"bg-token-composer-surface",!j&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:w,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsx(os,{initial:!1,children:a.length>0&&e.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(Jm,{replyRegions:a})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-2",children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:m instanceof Ba?e.jsx(Xm,{composerController:m,currentLeafId:u,placeholder:o,inputState:h}):e.jsx(Ku,{composerController:m,placeholder:o})}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1",children:l}),e.jsx(Hl,{inputState:h,state:n,onSubmit:d,composerController:m,clientThreadId:g,gizmoId:v,disableReason:M})]})]})]})});function Xm({composerController:t,currentLeafId:s,placeholder:o,inputState:a}){const n=i.useContext(ni);return e.jsxs(e.Fragment,{children:[e.jsx(Ol,{id:Ul,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof Ba))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:o,disabled:a!=="default",className:P("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",a==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function Jm({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,o)=>{switch(s.type){case"text":return e.jsx(Qm,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"object":return e.jsx(Zm,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"mention":case"system_hint":return e.jsx(eh,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},o)}})})}function Qm({value:t,onRemoveRegion:s}){return e.jsxs(to,{className:"text-token-text-secondary",children:[e.jsx(so,{children:e.jsx(La,{className:"icon-lg-heavy"})}),e.jsx(no,{children:`“${t}”`}),e.jsx(eo,{onClick:s})]})}function Zm({value:t,onRemoveRegion:s}){return e.jsxs(to,{className:"text-blue-selection",children:[e.jsx(so,{children:e.jsx(La,{className:"icon-lg-heavy"})}),e.jsx(no,{className:"font-semibold",children:t}),e.jsx(eo,{onClick:s})]})}function eh({value:t,icon:s,onRemoveRegion:o}){return e.jsxs(to,{children:[e.jsx(so,{className:"mt-0",children:s}),e.jsx(no,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(eo,{onClick:o})]})}function eo({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(zl,{className:"icon-lg"})})}const to=fe.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,so=fe.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,no=fe.span`flex-1 line-clamp-3 py-0.5`;function th({target:t,rootId:s,additonalInteractiveIds:o}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||o.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const sh=({composerController:t,disabled:s,clientThreadId:o})=>{const a=rs(),{setThreadSearchMode:n}=Ks(),r=Gn(o),l=t.useState(p=>p.getSystemHints()[0]),c=a?Rt.Search:l,[d,h]=i.useState(!1);if(i.useEffect(()=>{const p=Math.random(),j=setInterval(()=>{const b=new Date,_=b.getHours()+b.getMinutes()/60+b.getSeconds()/3600,C=Math.abs((6+_)%12-6)/6;h(Math.pow(C,15)>p)},1e3);return()=>clearInterval(j)},[]),!(t instanceof Qn))return null;const u=t,m={clientThreadId:o};function g(){K.logEventWithStatsig(X.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",m)}function v(){K.logEventWithStatsig(X.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",m)}function M(p,j){if(p.systemHint===Rt.Search){n(j,m,Tt.CONVERSATION_COMPOSER_TOOL_MENU),u.removeSystemHints(),setTimeout(()=>{u.focus()},0);return}j?(a&&n(!1,m,Tt.CONVERSATION_COMPOSER_TOOL_MENU),u.addSystemHint(p.systemHint,p.name),setTimeout(()=>{u.focus()},0)):u.removeSystemHints()}return e.jsx(nh,{systemHints:r,selectedHint:c,showJack:d,disabled:s,onHover:g,onOpen:v,onSelect:M})},nh=({systemHints:t,selectedHint:s,showJack:o,disabled:a,onHover:n,onOpen:r,onSelect:l})=>{const c=Ce(),[d,h]=i.useState(!1);return e.jsxs(Q.Root,{open:d,onOpenChange:u=>{h(u),u&&r?.()},children:[e.jsx(oh,{disabled:!!a,children:e.jsx(An,{className:P(Gl.toolsButton,"flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold hover:bg-black/10 focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white"),"data-opened":Lo(d),"data-jack":Lo(!!o),"aria-label":c.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:a,onPointerOver:n,onClick:u=>{u.preventDefault()},onFocusCapture:u=>{u.stopPropagation()},children:e.jsx(Wl,{className:"pointer-events-none"})})}),e.jsx(Q.Portal,{children:e.jsx(Q.Content,{alignOffset:-16,onCloseAutoFocus:u=>{u.preventDefault()},children:t.map(u=>e.jsx(Q.Item,{className:"px-1 py-2",onClick:()=>l?.(u,u.systemHint!==s),children:e.jsx(hr,{title:u.name,description:u.description,logo:u.logo,checked:u.systemHint===s})},u.systemHint))})})]})},oh=({disabled:t,children:s})=>{const o=Un(ct.hasSeenComposerSystemHintButtonTooltip);return!t&&!o.isLoading&&o.eligible?e.jsx(zn,{announcementKey:ct.hasSeenComposerSystemHintButtonTooltip,show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(L,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(L,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."}),children:s}):e.jsx(ss,{side:"right",sideOffset:0,label:t?e.jsx(L,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(L,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function Lo(t){return t?"":null}const ah=1,rh=3e3;function ih({files:t,className:s}){const o=Ds(),a=Fa(),n=Nc();return e.jsxs("div",{className:s,children:[n.map(r=>e.jsx(Ac,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(Ec,{borderRadius:"2xl",useV2Style:!0,width:o?"normal":"wide",onRemoveFileClick:()=>vn.remove(a,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===Rc.Uploading?r.progress:void 0},r.tempId))]})}function lh({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:o,currentModelId:a,clientThreadId:n,isNewThread:r,isCompletionInProgress:l,className:c,disabled:d=!1,disabledReason:h,canPause:u=!1,canContinue:m=!1,suggestions:g,isInteractableSharedThread:v,composerContainerRef:M,autocompletions:p,requiresFileUpload:j,onComposerInput:b,onComposerChange:_,onAutocompleteSelect:C,headerClassName:w,hideHeader:x,setComposerBarElement:k,onTaggingDropdownOpen:G,onTaggingDropdownClose:E}){const O=i.useRef(null),I=Ic(O,k),f=Js(),A=Wn(),R=Gs(),{isUnauthenticated:D}=Fe(),W=Ce(),y=la(),z=Fa(),S=dt(n),F=zs(n),[Z]=Sa(),$=Hn(),{gizmoEditorData:q,mode:re,getGizmoId:me}=Vl(),ee=ca(),xe=oi(),he=ut(),Pe=Ha(),ie=ns(n),_e=!!ai(),ve=!!En(),[je,Ae]=i.useState({}),{setThreadSearchMode:De,clearSearchModeTrigger:ze,getSearchModeTrigger:Ke}=Ks(),ne=rs(),[B,N]=i.useState(!1),[U,te]=i.useState(!1),le=Ue(),oe=i.useRef(!1),Se=Oa(),ae=a!==null?Se[a]:void 0,Te=$e(n,T=>T?.overrideModelId);let Y=Ys(n),be=Y&&"gizmo"in Y?Y.gizmo:void 0;const Be=is(be?.gizmo.id),ge=ql(),ht=$l();let Pt;be?.gizmo.id&&(Be?Pt=Co.PROJECT:Pt=Co.GPT);const[pe,Je]=i.useState(null);pe!==null&&(Y={gizmo:pe,gizmo_id:pe.gizmo.id,kind:qe.GizmoInteraction},be=pe);const gt=_o(ae,Y);let Dt=!1;Yl(Y)&&be?.gizmo.id===Kl&&(Dt=!0);const ls=ri(),pt=!d&&!Dt&&gt!==To.None&&!D,st=Xl(ae,Y),Bt=Jl(ae,Y);let Ee=ko(T=>T.files);const[Lt]=i.useState(()=>Ql());re==="magic"?Ee=Ee.filter(T=>T.gizmoId!=null):Ee=Ee.filter(T=>T.gizmoId==null);const cs=Zl(),ft=Ee.length>0||cs,Ft=ko(Pc.hasUploadInProgress),Ht=f.useState(T=>{const de=ec(T);return typeof ae?.maxTokens=="number"&&de>ae.maxTokens}),Ot=f.useState(T=>!T.isEmpty()),Xe=!Ht&&!Ft&&(Ot||ft);Ua(Ee.length>0||Ft||Ot);const Ut=(gt===To.Multimodal?tc:sc)-Ee.length,ds=Ut<=0,Le=Xe&&!d&&!l&&!ve,[us,xt]=i.useState(!1),zt=za(),nt=a||zt.id,Gt=No(n,bo.Search),ms=!d&&!be&&ee?.includes(Is.SearchTool)&&!ee?.includes(Is.SearchToolHoldout)&&(ee?.includes(Is.BrowsingAvailable)||!R?.isEnterprisey()),Wt=ms&&Gt,Qs=Se[nt]?.tags,{targetedContent:Vt,setTargetedContent:vt}=Ga(),ye=Vt?.isFocusedViewContent&&!Pe?void 0:Vt,{rebaseSystemMessageContent:hs}=Vn();i.useEffect(()=>{if(!A?.id)return;const T=Ao.getAndReset(A?.id,ie);T&&f.setText(T.inputText)},[A?.id,ie,f]),i.useEffect(()=>{const T=Z.get("prompt")??"";f.getCurrentText().length===0&&T.length>0&&f.setText(T)},[f,Z]),i.useEffect(()=>{us!==Le&&(xt(Le),Le&&ii(!0).then(T=>{nc.startEnforcement(T),li.startEnforcement(T)}))},[Le,us,Y?.kind,ee]);const St=oc(ae,Y),{handleFileAccepted:ro}=ac(W,_o(ae,Y),st,"mouse",me,St?.attachments),{getInputProps:Zs,open:gs}=rc({disabled:d||!pt||ds,noClick:!0,onDropAccepted:ro,onDropRejected:T=>ic(T,W,y,gt),multiple:!0,maxSize:lc,maxFiles:Ut,...cc(Bt)}),en=ci(Lt),ps=i.useCallback(()=>{f.eraseContent(),en.clearMessages(),f.resize(ah),J.clearOverrideModelId(n),dc();for(const T of Ee)vn.remove(z,T.tempId,"none");uc.markAllAsSent()},[f,en,Ee,z,n]),bt=async(T,de)=>{if(T?.preventDefault(),d||!Xe&&!de||!Y||kt.isLoading(n)!==!1)return;const Re=new Qt({gizmoType:Pt});N(!0),ge?.(),ht?.();const Me=f.getContentToSend(),at=Dc(Me.content),on=`${S}-nextPrompt`,Yt=new Bc(Wa.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:Yr,attachments:mo}=Lc(z,at,ae,Y),ho=[],an=[];hs&&an.push(mi(hs));const rn={...Y};"gizmo"in rn&&delete rn.gizmo;let ws=f.getSystemHints();ne&&(ws=[Rt.Search]);const go=Ke(),Kr=ne?go??Tt.CONVERSATION_COMPOSER_WEB_ICON:void 0,po=Fc(),fo=Hc();let Kt={promptId:on,content:Yr,eventMetadata:{eventSource:T?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:rn,systemHints:ws,searchSource:Kr},messageMetadata:{...mo.length>0&&{attachments:mo},...pe&&{gizmo_id:pe?.gizmo.id},...je,...ws.length>0&&{system_hints:ws},...!!Me.metadata&&{serialization_metadata:Me.metadata},...po.length>0&&{canvas:{user_created_textdocs:po.map(Xt=>({user_created_temp_textdoc_id:Xt.tempTextdocId,type:Xt.type,title:Xt.title,content:Xt.content,create_source:Xt.create_source}))}},...Object.keys(fo).length>0&&{__internal:{search_settings:fo}}},prependMessages:ho.length>0?ho:void 0,appendMessages:an.length>0?an:void 0,turnTracker:Re,profiler:Yt,requestedModelId:Te};Kt=Oc(Kt),ye?.createNewCompletionParams&&(Kt=await ye.createNewCompletionParams(Kt)),Yt.logTiming("request_params_ready"),await s(Kt),ye?.onCreateCompletion?.({serverThreadId:ie,currentLeafId:S}),ye?.shouldPersistAcrossMessages!==!0&&vt(void 0),Os.hideThreadHeader(),ps(),N(!1),Yt.logTiming("prompt_submitted"),g!==void 0&&(ue.logEvent("chatgpt_prompt_ignore_suggestions"),K.logEvent(X.promptIgnoreSuggestions)),ne&&go&&ze()},tn=i.useRef(bt);i.useEffect(()=>{tn.current=bt});const sn=T=>{vt(T.targetedReply),T.targetedReply&&(f.focus(),K.logEvent(X.targetedReplyButtonClicked,{conversationId:ie,sourceMessageId:T.messageId}))},fs=i.useCallback(()=>{ye?.onCleared?.({serverThreadId:ie,currentLeafId:S}),vt(void 0),f.focus()},[S,ie,ye,vt,f]),xs={Enter:{validator:T=>{const de=T.isComposing||T.keyCode===229;return!(U&&oe.current)&&(T.metaKey||(xe||hi)&&!T.shiftKey&&!de)},handler:T=>{if(!Le){Ht&&y.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}T.preventDefault(),bt()}},Escape:{validator:T=>!T.isComposing,handler:T=>{u&&l&&(t("",F),K.logEvent(X.pauseCompletion,{threadId:J.getServerThreadId(n),currentLeafId:J.getTree(n).getMessageId(S),eventSource:"keyboard"})),T.target.value===""&&fs()}}},ot=i.useRef(xs);ot.current=xs;const yt=mc(Qs,Y?.kind),[qt,H]=i.useState(!1),[ce,Ge]=i.useState(!1),We=yt&&qt&&!Be,vs=f.isReady();i.useEffect(()=>f.subscribe("keydown",T=>{f.acceptLegacyKeydown()&&ot.current[T.key]?.validator(T)&&ot.current[T.key].handler(T);const Re=f.getCurrentText();if(T.key==="@"){const Me=f.getSelectionStart(),at=Re.substring(0,Me);(!at||/\s$/.test(at)||Me===0)&&setTimeout(()=>H(!0),10)}else qt&&H(!1);if(T.key==="Escape"&&(Je(null),te(!1)),Wt&&!ne){let Me;T.key==="Backspace"?Me=Re.substring(0,Re.length-1):Me=Re+T.key,/^search\s?$/i.test(Me)?Ge(!0):ce&&Ge(!1)}ne&&T.key==="Escape"&&De(!1,{clientThreadId:n})}),[f,vs,qt,ce,Wt,ne,De,n]),i.useEffect(()=>{const T=Object.fromEntries(Object.keys(ot.current).map(de=>[de,Me=>{const at=ot.current[de];if(!at||f.acceptLegacyKeydown())return!1;const{validator:on,handler:Yt}=at;return on(Me)?(Yt(Me),!0):!1}]));f.registerKeyHandlers(T)},[f,vs]),i.useEffect(()=>f.subscribe("paste",T=>{hc({filePickerStore:z,event:T,intl:W,toaster:y,clientThreadId:n,conversationMode:Y,currentModelConfig:ae,getEditorGizmoId:me,modelSupportedImageMimeTypes:st})}),[W,n,Y,ae,me,st,f,y,z]);const Cr=T=>{_e||Je(T),f.trimLeadingText("@"),Fs(),H(!1)},_r=gc(n,Lt,st,St?.attachments),Tr=i.useCallback(T=>{T?.preventDefault(),t("",F),K.logEvent(X.pauseCompletion,{threadId:J.getServerThreadId(n),currentLeafId:J.getTree(n).getMessageId(S),eventSource:"mouse"}),Fs()},[t,n,F,S]),io=i.useCallback(()=>{Ao.set(A?.id,ie,f.getCurrentText())},[ie,A?.id,f]);i.useEffect(()=>{q||!B&&!di()&&f.focus()},[B,f]),i.useEffect(()=>{q||vn.reset(z)},[a,z,q]),i.useEffect(()=>{(!yt&&pe||_e)&&Je(null)},[yt,pe,_e]);const[lo,kr]=(()=>{switch(h){case"workspaceDisallowsGizmo":return[Ve.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[Ve.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[Ve.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Ve.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Ve.loading,!0];case"noTestGizmoId":return[Ve.noTestGizmoId,!0];default:return v?[Ve.placeholderWithName,!1]:ye?.placeholderTextOverride!=null?[ye.placeholderTextOverride,!1]:[Ve.placeholderWithName,!1]}})(),Nr=Be?r?W.formatMessage(Sn.newChatInProject):W.formatMessage(lo,{name:"ChatGPT"}):W.formatMessage(lo,{name:q!=null?re==="magic"?pc:q.name||"GPT":be?.gizmo.display.name??"ChatGPT"});i.useEffect(()=>f.subscribe("input",()=>{qn.getState().isThreadHeaderVisible&&Os.hideThreadHeader(),te(!0)}),[f]),i.useEffect(()=>{if(b)return f.subscribe("input",()=>{b?.()})},[f,b]),i.useEffect(()=>{if(_)return f.subscribe("change",()=>{_?.()})},[f,_]),i.useEffect(()=>f.subscribe("focus",()=>{te(!0)}),[f]);const Ar=Gn(n).length>0,Er=Y?.kind===qe.PrimaryAssistant||Y?.kind===qe.GizmoInteraction&&Be,Ss=Ar&&Er,Rr=Ds(),Ir=Ss&&!Rr,Pr={clientThreadId:n,uploadType:gt,modelAcceptedMimeTypes:Bt,modelSupportedImageMimeTypes:st,attachmentsProductFeature:St?.attachments,getInputProps:Zs,openFileDialog:gs,historyDisabled:he,onOauthRedirect:io,highlightTooltip:j&&!ft},bs=[],Dr=!d&&!ds&&(pt||ls!=null)&&!ne;bs.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(Vm,{...Pr,isDisabled:!Dr},"file-upload-button")})),Ir&&bs.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(sh,{composerController:f,clientThreadId:n,disabled:!Ss},"system-hint-button")})),ms&&bs.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},children:e.jsx(Hm,{composerController:f,highlightTooltip:ce,clientThreadId:n,isDisabled:!Wt||ft},"search-button")}));const Br=ft&&e.jsxs(e.Fragment,{children:[re==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(L,{...Ve.gizmoKnowledgeWarning})}),e.jsx(ih,{files:Ee,className:"flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),Lr=kr?"disabled":"default",Fr=l&&u,Hr=ui(),Or=!Le||B||Hr,Ur=Uc(Ft,Ot,Ht),ys=Fr?"streaming":Or?"disabled":"idle",$t=i.useRef(null),wt=i.useRef(null),zr=a&&a.startsWith("o1");i.useEffect(()=>{const T=()=>{$t.current!=null&&pn.addAction("composer_state_disabled",{threadId:J.getServerThreadId(n),disabledReason:$t.current})};if(Xe&&ys==="disabled"){let de="unknown";d?de=h??"component_disabled_unknown":l?de="completion_in_progress":ve?de="thread_hard_blocked":B&&(de="starting_new_completion_request"),$t.current!==de&&(wt.current&&clearTimeout(wt.current),wt.current=setTimeout(T,rh)),$t.current=de}else $t.current=null;return()=>{wt.current&&(clearTimeout(wt.current),wt.current=null)}},[n,Xe,ys,d,h,l,ve,B]);const nn=[];if(ye?.label&&nn.push({type:ye.type,value:ye.label,onRemoveRegion:fs}),pe!==null){const T=!!pe.gizmo.tags?.includes($n.FirstParty);nn.push({type:"mention",value:pe.gizmo.display.name,icon:e.jsx(fc,{isFirstParty:T,src:pe.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Je(null),f.focus()}})}i.useEffect(()=>{(!p||p.length===0||!U)&&(oe.current=!1)},[p,U]);const Gr=(T,de,Re)=>{oe.current=T>=0,de&&f.setText(Re?`${Re.title}${Re.body}`:"")},co=U&&p&&p.length>0&&!We&&!f.hasMultipleLines()&&f.canShowAutocompletion();i.useEffect(()=>{We?G?.():E?.()},[We,G,E]);const uo=ys==="streaming"?Tr:bt,Wr=No(n,bo.Canvas),{value:Vr}=Rn("61299031"),qr=Ds(),$r=Wr&&Vr&&!cs&&!qr;return e.jsxs(xc.Provider,{value:Lt,children:[e.jsx(vc,{onOauthRedirect:io,children:e.jsx("form",{className:c,onSubmit:uo,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!x&&!le&&e.jsx(dr,{className:w}),e.jsxs("div",{ref:M,className:"group relative flex w-full items-center",children:[r&&Z.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{$("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Sc,{className:"icon-lg"})}),e.jsxs(bc,{open:We||Ss,children:[e.jsx(yc,{className:"w-full",children:e.jsx(Km,{type:he?"temporary":"default",ref:I,replyRegions:nn,placeholder:Nr,inputState:Lr,composerController:f,leftSideActions:bs,topRightAction:$r&&e.jsx(wc,{composerRef:O,composerController:f,clientThreadId:n}),state:ys,onSubmit:uo,renderFiles:Br,currentLeafId:S,clientThreadId:n,gizmoId:be?.gizmo.id,disableReason:Ur,modelId:nt})}),e.jsx(jc,{children:e.jsxs(Mc,{side:"bottom",align:"start",sideOffset:12,children:[We&&e.jsx(Cc,{onClick:T=>Cr(T),onClose:()=>{H(!1),f.focus()}}),Ss&&e.jsx(Gm,{composerController:f,clientThreadId:n})]})})]}),co&&e.jsx("div",{className:"absolute left-0 z-10 box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(qm,{suggestions:p,composerController:f,onSelect:C,onChange:Gr})})]}),e.jsx(_c,{composerController:f,parsedDocumentHandler:_r})]})})}),e.jsx(Em,{canUseInlineTagging:yt,isDisabled:d,clientThreadId:n,currentLeafId:S,currentRequestId:F,canContinue:m,composerController:f,setPromptInputMetadata:Ae,suggestions:g,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:o,onResetState:ps,conversationMode:Y,isShowingAutocomplete:!!co}),Y!=null&&!zr&&Tc.includes(Y.kind)&&e.jsx(kc,{clientThreadId:n,onTargetedReply:sn})]})}function ch(t){const s=t.message?.author.role===ke.User,o=t.metadata?.err!=null&&t.metadata?.errCode!==wo.ContentPolicy,a=t.metadata?.errCode===wo.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:s||o}function dh(t){return e.jsx(rr,{clientThreadId:t.clientThreadId,children:e.jsx(uh,{...t})})}function uh({clientThreadId:t,isNewThread:s,currentModelId:o,showPromptStarters:a,noWrap:n,onRequestCompletion:r,composerContainerRef:l}){const c=Js(),d=Pn(),h=Dn(),u=qs(g=>{const v=kt.getCurrentNode(t,g);return ch(v)});if(Va(c),!h&&u)return e.jsx(mh,{clientThreadId:t});const m=e.jsx(e.Fragment,{children:e.jsx(gr,{composerContainerRef:l,clientThreadId:t,currentModelId:o,isNewThread:s,showPromptStarters:a,onRequestCompletion:r})});return n?m:e.jsxs(e.Fragment,{children:[e.jsx(am,{clientThreadId:t}),e.jsx(Yn,{clientThreadId:t,isStaticSharedThread:d,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx(Zt,{children:m})})]})}function mh({clientThreadId:t}){const s=$c(t),o=qs(r=>kt.getCurrentNode(t,r).metadata?.errCode===Yc),a=Kc(r=>r.isoDate),n=dt(t);return o&&a!=null&&a!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs","data-has-thread-error":!0,children:e.jsx(L,{...Fo.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(It,{as:"button",color:"primary",onClick:()=>{const r=new Qt;ue.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,et({clientThreadId:t})),s({id:n,eventMetadata:{eventSource:"mouse"},conversationMode:kt.getConversationMode(t),turnTracker:r})},className:"m-auto",icon:Ma,"data-testid":"regenerate-thread-error-button",children:e.jsx(L,{...Fo.regenerateResponse})})})]})}function gr({clientThreadId:t,currentModelId:s,isNewThread:o,onRequestCompletion:a,showPromptStarters:n,composerContainerRef:r,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:h,onAutocompleteSelect:u,headerClassName:m,hideHeader:g,onTaggingDropdownClose:v,onTaggingDropdownOpen:M}){const p=dt(t),j=zs(t),b=bn(),{isUnauthenticated:_}=Fe(),w=da(t)===ua.STREAMING,x=ma({clientThreadId:t,conversationLeafId:p}),k=lt(j),G=gi({clientThreadId:t}),E=!_,O=pi(),{isOpen:I,onClose:f}=zc({type:"just-hit-rate-limit"}),A=i.useCallback((B,N)=>{K.logEvent(X.continueCompletion),a({type:yo.Continue,promptId:B,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:kt.getConversationMode(t)},turnTracker:N})},[a,t]),R=ba(),D=i.useCallback(async(B,N)=>Gc({clientThreadId:t,currentRequestId:N,isHistoryAndTrainingDisabled:O,queryClient:R}),[t,O,R]),W=i.useCallback(async({promptId:B,content:N,eventMetadata:U,completionMetadata:te,messageMetadata:le,prependMessages:oe,appendMessages:Se,turnTracker:ae,profiler:Te,requestedModelId:Y})=>{const be=J.getThreadCurrentLeafId(t);J.updateTree(t,Be=>{Be.addNode(B,N,be,ke.User,void 0,le)}),await a({type:yo.Next,promptId:B,eventMetadata:U,cancelActiveRequests:!0,completionMetadata:te,prependMessages:oe,appendMessages:Se,turnTracker:ae,profiler:Te,...Y?{requestedModelId:Y}:{}})},[t,a]),y=$e(t,B=>B?.tree.getHasErrorFromNode(p)??!1),z=$e(t,B=>B?.tree.isMessageIncomplete(p)??!1),S=!x&&(k||w),F=i.useMemo(()=>S?!1:!y&&z,[y,z,S]),Z=S,$=Ws(t),q=Ne(t),re=mt(q).data,{promptStarters:me,isSuccess:ee}=yn(o&&!$,t,4),xe=Da(),he=(()=>{if(xe?.messageId===J.getTree(t).getLastValidNode(p)?.message?.id)return xe?.suggestions;if(n&&!$&&ee&&!E)return me})(),Pe=Wc(),ie=fi(),_e=(()=>{if(re?.gizmo.tags?.includes($n.WorkspaceDisabled)&&!ie)return"workspaceDisallowsGizmo";if(Pe.size){if(b.displayingSideBySideFeedback&&b.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const N=kt.getConversationMode(t);return N?.kind===qe.GizmoTest&&N.gizmo_id==null?"noTestGizmoId":null})(),ve=ha(t),je=Vs(t),Ae=Rn("15117983")?.value,De=Yi(),ze=In(),Ke=De.action==="moderate",{value:ne}=Ie("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center",children:ze&&Ke&&ne?e.jsx(Vc,{}):null}),I?e.jsx(qc,{onClose:f}):null,Ae&&je&&je.kind===qe.PrimaryAssistant&&je.plugin_ids&&je.plugin_ids.length>0?e.jsx(hh,{}):e.jsx(lh,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:W,onAbortCompletion:D,onContinueGenerating:A,currentModelId:s,isNewThread:o,isCompletionInProgress:G,className:"w-full",canContinue:F,suggestions:he??[],disabled:!!_e,disabledReason:_e??void 0,canPause:Z,isInteractableSharedThread:ve,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:h,onAutocompleteSelect:u,headerClassName:m,hideHeader:g,onTaggingDropdownClose:v,onTaggingDropdownOpen:M},t)]})}function hh(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(L,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(L,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(L,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(L,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const Fo=Ye({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),pr=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${Ea.PromptTextareaHeader}`,children:[e.jsx(ur,{}),e.jsx(mr,{})]})}),Pg=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:pr},Symbol.toStringTag,{value:"Module"})),Ho=He(()=>Oe(()=>import("./k7oseobxn1x5zsjv.js"),__vite__mapDeps([10,1,2,3,4,5,11,12,13,14,15,16,17])).then(t=>t.SnorlaxSplashScreen)),cn=4;function gh(t){const{layer:s}=tt("3533083032"),{layer:o}=_t("3533083032"),{value:a,isLoading:n}=Ie("3006519778");return n||!a?!1:t?s.get("enable_new_homepage_anon",!1):o.get("enable_new_homepage_anon",!1)}function ph(){const{layer:t}=_t("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),o=Wn();return!!o&&o.created*1e3>=new Date(s).getTime()}function fh(t){const{layer:s}=tt("4031588851"),{layer:o}=_t("4031588851"),{value:a,isLoading:n}=Ie("633009675");return n||!a?!1:t?s.get("enable_new_autocomplete_homepage",!1):o.get("enable_new_autocomplete_homepage",!1)}const dn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function xh(t){const s=Ne(t.clientThreadId),o=is(s);return e.jsx(rr,{clientThreadId:t.clientThreadId,children:o&&s&&Ho?e.jsx(Ho,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(wh,{...t})})}function vh({children:t}){const{store:s}=we(),[o,a]=i.useState(!1),n=Js();i.useEffect(()=>n.subscribe("focus",()=>{a(!0)}),[n]),i.useEffect(()=>n.subscribe("blur",()=>{a(!1)}),[n]);const l=!!s.useSharedProps()?.isShowingAutocomplete;return t(l&&o)}function Sh({isUnauthenticated:t,shouldShowLegacyStarterPrompts:s,legacyPromptStarters:o,isSendBlocked:a,clientThreadId:n}){return e.jsxs("div",{className:P(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[e.jsx("div",{className:P(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:e.jsx(ts,{className:"mb-6 h-12 w-12"})}),s&&(o&&o.length>0?e.jsx(_h,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:o,isSendBlocked:a,clientThreadId:n,isSquare:t}):e.jsx(Qu,{}))]})}function bh({isSendBlocked:t,clientThreadId:s,headlineOption:o,enableNewMobileDesign:a,shouldShowStarterPrompts:n,promptChips:r,onSelectStarterPrompt:l,starterPromptExpanded:c,setStarterPromptExpanded:d}){const h=Bn();return e.jsx(vh,{children:u=>e.jsxs(se.div,{initial:{opacity:0},animate:{opacity:u?0:1},exit:{opacity:0},transition:{duration:.1},className:P("justify-center",u?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary",h?"@lg/thread:hidden":"lg:hidden"),children:[o==="CHATGPT_LOGO"?e.jsx(ts,{className:"inline-block h-12 w-12"}):e.jsx(fr,{headlineOption:o}),e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P(!a&&(h?"@lg/thread:hidden":"lg:hidden"),!c&&"h-[116px]"),children:n&&e.jsx(xr,{starterPrompts:r,onSelectStarterPrompt:l,disabled:t,clientThreadId:s,onExpand:()=>d(!0),mobileLayout:!0})})]})})}function yh(t,s,o){const a=Ie("1468311859").value,n=Ie("3664702598").value,{layer:r}=tt("4031588851"),l=ph(),c=t||s,d=c&&a,h=c&&n&&l;let u="HARDCODED";if(c)if(o){const m=r.get("search_autocomplete_mode","");d&&m&&(u=m)}else h&&(u=r.get("autocomplete_mode","HARDCODED"));return u}function wh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,v2HomepageDisclaimer:n}){const r=Js(),l=Ct(t),c=Ws(t),d=En(),[h,u]=i.useState([]),m=i.useCallback(B=>{u(N=>{const U=typeof B=="function"?B(N):B;return ia(U,N)?N:U})},[]),{trendingSuggestions:g,fetchTrendingSuggestions:v}=Th(cn),M=i.useRef(!1),{isUnauthenticated:p}=Fe(),j=xi(),[b,_]=i.useState(!1),C=rs(),w=Ue();Va(r);const x=Ie("589604007").value,{layer:k}=_t("4031588851"),{layer:G}=tt("4031588851"),{layer:E}=_t("3533083032"),{layer:O}=tt("3533083032"),{promptStarters:I,isSuccess:f}=yn(l&&!c&&o,t,8,x,!0,s??void 0),{promptStarters:A,isSuccess:R,isError:D}=yn(l&&!c&&o,t,4,void 0,void 0,s??void 0),W=j&&!!h.find(B=>!!B.requires_file_upload),y=i.useCallback(B=>{const N=r.getCurrentText();return N&&dn(B).startsWith(N.toLocaleLowerCase())},[r]),z=i.useCallback(B=>{const N=r.getCurrentText(),U=B.title+B.body;return y(B)?{...B,title:N,body:U.slice(N.length)}:{...B,title:U,body:""}},[r,y]),S=i.useCallback((B=!1)=>{m(N=>!N.some(y)&&N.length>0?[]:B?N:N.map(z))},[y,z,m]),F=(B,N,U)=>{const te=B.title;m([]),r.focus(),r.setText(te),requestAnimationFrame(()=>{const le=(I?.filter(oe=>oe.theme===B.theme)??[]).map(oe=>{const Se=jt(oe.oneliner),ae=Se.startsWith(oe.title);return{...oe,title:ae?`${oe.title} `:"",body:ae?oe.body:Se,autocompletionChunks:$m(te,Se),type:Hs.Autocomplete}});m(le),le.length>0&&At(le,t),Qc(B,U,t)})};i.useEffect(()=>{const B=h.some(N=>N.theme===wn.Search);C&&r.getCurrentText()===""?g.length>0?m(g):v():B&&!C&&m(N=>N.filter(U=>U.theme!==wn.Search))},[h,C,g,v,r,m]);const Z=I?.reduce((B,N)=>(N.theme&&!B[N.theme]&&(B[N.theme]=N),B),{}),$=[];if(Z)for(const B in Z)$.push(Z[B]);const q=$&&$.length>0,re=!!(f&&q&&o),me=!!((R||D)&&o),ee=cn-h.filter(y).length,xe=p?O.get("enable_new_mobile",!1):G.get("enable_new_mobile",!1),he=yh(xe,j,C),Pe=p?E.get("headline_option","HELP_WITH"):k.get("headline_option","HELP_WITH"),ie=k.get("autocomplete_min_char",4),_e=k.get("autocomplete_fetch_interval",200),ve=i.useRef(null),je=i.useCallback(qa(async B=>{const N=r.getCurrentText();if(!N||N.length<ie||N.length>80||r.hasMultipleLines()){m([]);return}if(!M.current&&!(ve.current&&ve.current.length>ie&&N.startsWith(ve.current)))try{const U=await Nt.generateAutocompletions(N,B,C);if(U.completions.length===0){ve.current=N;return}const te=U.completions.map(le=>({id:Ki(),type:Hs.Autocomplete,title:le.slice(0,N.length),body:le.slice(N.length),oneliner:le,prompt:le,source:he})).filter(y).map(z);m(le=>{const oe=le.filter(y),Se=te.filter(ae=>{const Te=dn(ae);return!oe.some(Y=>{const be=dn(Y);if(Te===be)return!0;const Be=/[\p{P}\p{S}]$/u,ge=Te.replace(Be,""),ht=be.replace(Be,"");return ge===be||Te===ht||ge===ht})}).slice(0,cn-oe.length);return[...oe,...Se]}),te.length>0&&At(te,t)}catch{}},he==="BING"?150:_e),[r,he,z,_e]),Ae=i.useCallback(()=>{S(),ee>0&&je(ee)},[je,S,ee]);i.useEffect(()=>{M.current&&m([])},[M,m]);const De=i.useMemo(()=>he==="HARDCODED"?S:Ae,[he,Ae,S]),ze=i.useCallback(()=>{r instanceof Qn&&S(!0),r.getCurrentText().indexOf(`
`)>0&&m([])},[r,m,S]),Ke=i.useCallback((B,N,U)=>{N.forEach(te=>{te.id===B.id&&(te.userInput=r.getCurrentText())}),m([N[U]])},[r,m]),ne=Bn();return e.jsx(e.Fragment,{children:e.jsx(os,{children:e.jsx("div",{className:P("h-full w-full",ne?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(Yn,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs(Eo,{children:[e.jsx("div",{className:P("mb-7 hidden text-center",ne?"@lg/thread:block":"lg:block"),children:Pe==="CHATGPT_LOGO"?e.jsx(ts,{className:"inline-block h-12 w-12"}):e.jsx(fr,{headlineOption:Pe})}),!xe&&e.jsx(Sh,{isUnauthenticated:p,shouldShowLegacyStarterPrompts:me,legacyPromptStarters:A,isSendBlocked:d,clientThreadId:t}),xe&&e.jsx(bh,{headlineOption:Pe,enableNewMobileDesign:xe,shouldShowStarterPrompts:re,promptChips:$,onSelectStarterPrompt:F,starterPromptExpanded:b,setStarterPromptExpanded:_,isSendBlocked:d,clientThreadId:t}),e.jsx("div",{className:P(ne?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Eo,{children:w?e.jsx(pr,{}):e.jsx(dr,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(gr,{clientThreadId:t,isNewThread:l,currentModelId:s,onRequestCompletion:a,showPromptStarters:!1,autocompletions:h,requiresFileUpload:W,onComposerInput:De,onComposerChange:ze,onAutocompleteSelect:Ke,onTaggingDropdownClose:()=>{M.current=!1},onTaggingDropdownOpen:()=>{M.current=!0},hideHeader:!0})}),e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P("hidden",ne?"@lg/thread:block":"lg:block",n&&p&&b?"":"h-[70px]"),children:re&&e.jsx(xr,{starterPrompts:$,onSelectStarterPrompt:F,disabled:d,clientThreadId:t,onExpand:()=>_(!0)})}),n&&e.jsx("div",{className:P("w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",ne?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:P("min-h-4",w&&"keyboard-open:hidden"),children:n})})]})})})})})}function fr({headlineOption:t}){const o=Ce().formatMessage(kh[t]||Jt.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:o})})}function jh({starterPrompt:t,starterPrompts:s,index:o,disabled:a,onSelectStarterPrompt:n}){const r=t.theme??t.title,l=$s(),{mutate:c}=Zc(),d=t.category==="onboarding"?()=>{c({key:ct.hasUsedConversationalOnboardingStarterPrompt}),l(t,s,o)}:()=>n(t,s,o);return e.jsx($a,{disabled:a,onClick:d,icon:e.jsx(ed,{category:t.category,useV2Colors:!0}),label:r})}function Oo({clientThreadId:t,onClick:s}){i.useEffect(()=>{td(t)},[t]);const o=Ce();return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx($a,{onClick:()=>{sd(t),s()},label:o.formatMessage(Jt.moreStarterPrompts)})})}const Mh=5,Ch=3;function xr({starterPrompts:t,onSelectStarterPrompt:s,disabled:o,clientThreadId:a,onExpand:n,mobileLayout:r=!1}){const l=r?Ch:Mh,[c,d]=i.useState(l),[h,u]=i.useState(!1),m=i.useRef(null),g=t.length<=c;i.useEffect(()=>{At(t.slice(0,l),a)},[a]),i.useEffect(()=>{if(!h&&!g&&m.current){const M=m.current,p=M.getBoundingClientRect(),j=p.width,b=Array.from(M.children);let _=0;for(let C=0;C<b.length&&b[C].getBoundingClientRect().right-p.left<=j;C++)_++;d(_),u(!0)}},[t,g,h]);const v=()=>{const M=t.slice(c,t.length).map(p=>({...p,isAdditional:!0}));M.length>0&&At(M,a),d(t.length),n()};return e.jsxs("div",{className:P("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",h&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:P("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",g||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:m,children:[t.slice(0,c).map((M,p)=>e.jsx(se.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(jh,{starterPrompt:M,starterPrompts:t,index:p,disabled:o,onSelectStarterPrompt:s})},M.id??p)),r&&t.length>c&&e.jsx(Oo,{clientThreadId:a,onClick:v})]}),!r&&t.length>c&&e.jsx(Oo,{clientThreadId:a,onClick:v})]})}function _h({promptStarters:t,isSendBlocked:s,clientThreadId:o,isSquare:a,...n}){i.useEffect(()=>{At(t,o)},[o]);const r=$s(),l=Bn();return e.jsx(e.Fragment,{children:a?e.jsx(se.div,{...n,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:e.jsx(Zt,{children:e.jsx(ir,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s})})}):e.jsx(se.div,{...n,className:"flex-shrink overflow-y-hidden",children:e.jsx(Zu,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s,cssMobileDisplayLimit:2,marginOverride:P("mt-6",l?"@lg/thread:mt-12":"lg:mt-12")})})})}const Th=t=>{const[s,o]=i.useState([]),a=i.useCallback(async()=>{const r=(await Nt.generateTrendingSuggestions(t)).suggestions.map((l,c)=>({type:Hs.Starter,title:Uo(l),body:"",icon:e.jsx(Xc,{}),prompt:Uo(l),id:`starter-${c}`,theme:wn.Search}));o(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:a}};function Uo(t){return t.split(" ").map(Jc).join(" ")}const Jt=Ye({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),kh={HELP_WITH:Jt.whatCanIHelpWith,WHERE_TO_START:Jt.whereShouldWeStart,ASK_CHATGPT:Jt.askChatgptAnything};function vr({clientThreadId:t,currentLeafId:s}){const{currentModelId:o}=Zn(),a=Ys(t),n=ga(t,s),r=Ne(t),l=ut(),c=Kn(o),d=Ct(t)&&!n&&(Ps(a)||a?.kind===qe.GizmoTest),h=is(r);return{showEmptyState:d,canUseNewHomepage:d&&h||d&&!r&&!c&&!l}}const zo=fe.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function Nh({conversation:t,gizmoResource:s,elementRef:o}){const a=wi(t.id)??t.title;return e.jsx(xn,{to:id(t.id,s),children:e.jsx(Q.Item,{icon:ld,children:e.jsx("div",{ref:o,children:a})},t.id)})}function Ah({gizmoId:t,clientThreadId:s,inMobileHeader:o,modelLabel:a,modelPickerContent:n}){const r=Ce(),{data:l}=mt(t),{items:c,hasNextPage:d,fetchNextPage:h,isLoading:u,isFetchingNextPage:m}=nd(t),g=i.useRef(null),v=i.useCallback(A=>{u||A==null||(g.current?.disconnect(),g.current=new IntersectionObserver(R=>{R[0].isIntersecting&&d&&h()}),g.current.observe(A))},[u,d,h]);i.useEffect(()=>()=>{g.current?.disconnect()},[]);const{title:M,titleSource:p}=vi(s),j=Ue(),{conversationLeafId:b}=Zn(),{showEmptyState:_}=vr({clientThreadId:s,currentLeafId:b}),C=Ws(s),w=od(),x=r.formatMessage(Sn.newChatTitle),{resolvedTitle:k,isTypingEffect:G}=ad(s,M??null,!0),{value:E}=Ie("1856506891");if(!l||_)return null;const O=k==null&&(Ct(s)||p===Si.NewChat),I=C?e.jsx(e.Fragment,{}):e.jsxs(zo,{$isScreenArch:j,$shimmer:O,children:[e.jsxs("div",{className:"truncate",children:[G?e.jsx(cd,{text:k??""}):k??x,E&&e.jsx("span",{className:"relative bottom-[1px] mx-1 inline-block rounded-md bg-token-main-surface-secondary px-1 text-xs leading-4 text-token-text-secondary",children:a})]}),e.jsx(Xn,{className:"icon-md text-token-text-tertiary"})]}),f=w&&l.gizmo.display.emoji?e.jsxs(e.Fragment,{children:[l.gizmo.display.emoji," ",l.gizmo.display.name]}):l.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(zo,{$isScreenArch:j,children:e.jsx(xn,{className:"truncate",to:Ro(l),children:f})}),e.jsxs(e.Fragment,{children:[e.jsx(bi,{className:"icon-md text-token-text-tertiary"}),e.jsxs(pa,{contentAlign:o?"center":"start",size:"small",triggerButton:I,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[E&&e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1",children:[e.jsx(L,{id:"ilkdMh",defaultMessage:"Model"}),e.jsx("span",{className:"text-xs font-medium text-token-text-secondary",children:a})]})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{children:n})})]}),e.jsx(xn,{to:Ro(l),children:e.jsx(Q.Item,{icon:rd,children:e.jsx(L,{...Sn.newChatProjectDropdownItem,values:{name:`"${l.gizmo.display.name}"`}})},"new-chat")}),c.filter(A=>A.id!==s).map((A,R)=>{const D=d&&R===c.length-4?v:void 0;return e.jsx(Nh,{elementRef:D,conversation:A,gizmoResource:l},A.id)}),m&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(yi,{})})]})]})]})}const Eh=He(()=>Oe(()=>import("./lfbin8ifnu2nwlmw.js"),__vite__mapDeps([18,3,1,4,2,5,19])).then(t=>t.ThreadHeaderGizmoDropdown)),kn=fe.button`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$isScreenArch:t})=>t?"h-[44px] @lg/screen-composer:pl-3 [line-height:26px] [font-size:17px] px-3":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function Rh({clientThreadId:t}){const s=Ce(),o=ut(),a=ji(t),n=Hn(),[,r]=Sa(),l=()=>{!a&&!o?n({pathname:"/",search:new URLSearchParams({[Cs]:"true"}).toString()}):r(c=>(c.get(Cs)==="true"?c.delete(Cs):c.set(Cs,"true"),c),{replace:a,state:wd()})};return e.jsx(Q.Item,{size:"large",className:"!pr-3",onClick:l,icon:fd,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(L,{...yr.temporaryChat})}),e.jsx(xd,{enabled:o,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function Ih(t){return t.title?t.title:t.shortLabel}function oo(t,s,o){let a=t;if(t===jo.AUTO){const l=s.filter(({defaultModel:c})=>c!==jo.AUTO);l.length===1&&(a=l[0].defaultModel)}const n=s.find(({defaultModel:l})=>l===a);if(n){const{categoryId:l}=n,c=Ih(n);return{selectedCategory:l,modelLabel:c,omitPrefix:!!n.title}}const r=o.find(({modelIds:l})=>l.includes(a));if(r){const{group:l,shortLabel:c}=r;return{selectedCategory:l,modelLabel:c}}return{selectedCategory:null,modelLabel:null}}function Ph({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function Dh({clientThreadId:t,inMobileHeader:s}){const{isLoading:o,categories:a,groups:n}=Xs(),r=Mi(),c=as(t).id,d=Ya(),{modelLabel:h,omitPrefix:u}=oo(c,a,n),m=Sr(t,d),g=Ce(),{isUnauthenticated:v}=Fe(),M=!v&&!r;i.useEffect(()=>{o||vd({namespace:Wa.ChatPageLoad})?.logTiming("render_model_switcher")},[o]);const p=Ue(),j=e.jsxs("div",{className:P(p?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[u?null:`${Ka} `,M?e.jsx("span",{className:"text-token-text-secondary",children:h}):v&&h?e.jsx(Ph,{modelLabel:h}):null]});return m.length?o?null:e.jsx(pa,{sideOffset:8,size:"large",triggerButton:e.jsxs(kn,{$isScreenArch:p,style:{viewTransitionName:"var(--vt-thread-model-switcher)"},"aria-label":h?g.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:h}):"",children:[j,p?e.jsx(Sd,{className:"icon-md text-token-text-tertiary"}):e.jsx(Xn,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:b=>{K.logEvent(X.toggleModelSwitcher,{isOpen:b}),ue.logEvent("toggle_model_switcher",null,{isOpen:String(b)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(br,{sections:m})}):e.jsx(kn,{className:"cursor-default",children:j})}function Bh({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:o,currentModelId:a,omitIcon:n,testId:r}){const{defaultModel:l,label:c,categoryId:d,description:h,isBeta:u}=t,m=bd(o??"");return e.jsx(jn,{value:l,currentModelId:a,modelSwitcherDenialsBySlug:s,renderName:g=>e.jsx(Nn,{categoryId:d,name:c,description:h,isDisabled:g,omitIcon:n,isBeta:u}),isSelected:(!o||m)&&a===l,testId:r},l)}function Sr(t,s){const o=as(t),a=o.id,n=Ne(t),{categories:r,groups:l}=Xs(),{doesUserHaveAnyAccountsWithPlusFeatures:c}=Ln(),d=J.getServerThreadId(t),h=ud({clientThreadId:t}),u=Ce(),m=!d,{isUnauthenticated:g}=Fe(),v=md(),{layer:M}=tt("2723963139"),p=M.get("is_dynamic_model_enabled",!1),j=s.find(({categoryId:y})=>y===Qe.ALPHA),b=s.find(({categoryId:y})=>y===Qe.DATA_CAMPAIGNS),_=s.find(({categoryId:y})=>y===Qe.EXPERIMENTS),C=s.find(({categoryId:y})=>y===Qe.MAINLINE),w=!0,x=!!j?.options?.length,k=!!b?.options?.length,G=!!_?.options?.length,E=!!C?.options?.length,O=Hn(),I=i.useCallback(()=>{K.logEvent(X.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),hd(O,"Thread header dropdown")},[O]),f=()=>{ue.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),K.logEvent(X.modelSwitcherPlusUpgradeButtonClicked),g?v({shouldOpenPaymentModalOnAuth:!0,callback:y=>{K.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:y})}}):I()},A=[],R=e.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(L,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:p?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(Ra,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(g){const y={id:"modelSection",content:[]};y.content.push(e.jsx(gd,{},"noAuthUpsell")),A.push(y)}else if(!c&&!n){const y={id:"modelSection",content:[]};y.content.push(e.jsx(jn,{value:"",currentModelId:a,onClick:f,modelSwitcherDenialsBySlug:h,isUpgradeUpsell:!0,renderName:z=>e.jsx(Nn,{icon:yd,isDisabled:z,name:u.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:u.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"}),omitIcon:!1}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),y.content.push(e.jsx(jn,{value:ln.AUTO,currentModelId:a,modelSwitcherDenialsBySlug:h,renderName:z=>e.jsx(Nn,{icon:pd,name:u.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:u.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:z,omitIcon:!1}),isSelected:!n&&a===ln.AUTO,showNewChatHint:!0},ln.AUTO)),A.push(y)}else{const y={id:"modelSection",content:[]};r.length&&y.content.push(R);const z=new Map;r.forEach(S=>{const F=e.jsx(Bh,{category:S,currentGizmoId:n,currentModelId:a,modelSwitcherDenialsBySlug:h,omitIcon:w,testId:`model-switcher-${S.defaultModel}`},S.categoryId);S.subcategory?(z.has(S.subcategory)||z.set(S.subcategory,[]),z.get(S.subcategory)?.push(F)):y.content.push(F)}),z.forEach((S,F)=>{const Z=r.find($=>$.subcategory===F&&$.defaultModel===o.id);y.content.push(e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{"data-testid":F==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[F,!!Z&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:Z.label})]})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-72",children:S})})]},F))}),A.push(y)}const D={id:"otherOptionsSection",content:[]},{selectedCategory:W}=oo(a,r,l);return m&&(x&&D.content.push(e.jsx(Ms,{isSelected:W===Qe.ALPHA,currentModel:o,option:j,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},j.value)),k&&D.content.push(e.jsx(Ms,{isSelected:W===Qe.DATA_CAMPAIGNS,currentModel:o,option:b,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},b.value)),G&&D.content.push(e.jsx(Ms,{currentModel:o,isSelected:W===Qe.EXPERIMENTS,option:_,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},_.value)),E&&D.content.push(e.jsx(Ms,{isSelected:W===Qe.MAINLINE,currentModel:o,option:C,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},C.value))),D.content.length&&A.push(D),!g&&!n&&A.push({id:"temporaryChatSection",content:[e.jsx(Rh,{clientThreadId:t},"tempChat")]}),A}function Lh(){const t=Ce();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(yr.beta)})}function Nn({isDisabled:t,name:s,icon:o,categoryId:a,description:n,extra:r,omitIcon:l,isBeta:c=!1}){let d=s;return c&&(d=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(Lh,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[!l&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:o?e.jsx(o,{className:"h-4 w-4 text-token-text-primary"}):a&&e.jsx(Xa,{type:"filled",className:P("h-4 w-4",t&&"text-gray-300",!t&&"text-token-text-primary"),categoryId:a})}),e.jsxs("div",{children:[d,e.jsxs("div",{className:P(!t&&"text-token-text-secondary","text-xs"),children:[n,r]})]})]})}function br({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,o)=>e.jsxs(ya.Fragment,{children:[o!==0?e.jsx(Q.Separator,{}):null,s.content]},s.id))})}function Fh({clientThreadId:t,inMobileHeader:s=!1}){const o=Ne(t),a=is(o),{conversationLeafId:n}=Zn(),{showEmptyState:r}=vr({clientThreadId:t,currentLeafId:n}),{value:l}=Ie("408434742"),{value:c}=Ie("3463955812"),{data:d}=mt(o),h=Ue(),{categories:u,groups:m}=Xs(),v=as(t).id,{modelLabel:M}=oo(v,u,m),p=Ya(),j=Sr(t,p),b=e.jsx(Dh,{clientThreadId:t,inMobileHeader:s});return o==null?b:a?r&&l&&d?c||dd(d)?b:e.jsx("div",{className:"inline-block",children:e.jsx(ss,{label:e.jsx(L,{id:"u2Bz6Y",defaultMessage:"When using custom instructions or files, only GPT-4o is available"}),side:"right",children:e.jsxs(kn,{$isScreenArch:h,disabled:!0,children:[Ka," ","4o"]})})}):e.jsx(Ah,{modelLabel:M??"",modelPickerContent:e.jsx(br,{sections:j}),gizmoId:o,clientThreadId:t,inMobileHeader:s}):e.jsx(Eh,{clientThreadId:t,gizmoId:o,inMobileHeader:s})}const yr=Ye({beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Hh=He(()=>Oe(()=>import("./na42ifqi6lhxflf7.js"),__vite__mapDeps([20,1,3,4,21,22,2,5,23,24,25,26,27,28,29,13,30,31,32,33,34,35,14,19,36,37,38,39])).then(t=>t.GizmoUsingAsOwnerNotice)),Oh=({clientThreadId:t})=>{const s=qn(g=>g.activeStageSidebar),o=J.getServerThreadId(t),a=jd(Is.WorkspaceShareLinks),{isUnauthenticated:n}=Fe(),r=ut(),l=Ne(t),c=is(l),d=a&&o&&!n&&!r&&!c,h=Ue(),u=Ci(),m=!s&&!(!n&&h&&u.get("include_account_settings_move",!1));return e.jsx("div",{className:P(!h&&"gap-2",h&&"@lg/screen-composer:gap-2","flex items-center pr-1 leading-[0]"),children:e.jsx(Xu,{showShareButton:d,showProfileDropdown:m,clientThreadId:t})})};function Uh({clientThreadId:t,gizmoId:s}){const o=Md(),{data:a}=mt(s),n=Gs();return e.jsxs(e.Fragment,{children:[e.jsxs(Cd,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&n?.isWorkspaceAccount()&&a.gizmo.tags?.includes($n.WorkspaceDisabled)&&e.jsx(Hh,{gizmo:a}),e.jsx(_d,{gizmoId:s,clientThreadId:t})]}),e.jsx(Td,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Ju,{clientThreadId:t}),e.jsx(Fh,{clientThreadId:t})]})}),e.jsx(Oh,{clientThreadId:t})]}),o&&e.jsx(kd,{})]})}function wr({clientThreadId:t}){const s=Ne(t),o=Pn(),a=Ue();return o||a?null:e.jsx(Uh,{gizmoId:s,clientThreadId:t})}function zh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,enableV2Homepage:n,v2HomepageDisclaimer:r}){const l=ut();let c=e.jsx(tm,{}),d;return l?(d=e.jsx(Gh,{}),c=e.jsx(ts,{className:"mb-6 h-12 w-12"})):t!=null?(d=n?e.jsx(xh,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,v2HomepageDisclaimer:r}):e.jsx(sm,{clientThreadId:t}),c=null):d=e.jsx(Wh,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[c,d]})}function Gh({gizmo:t}){const s=Ad(),o=t?Ed(t.tools):!1,a=Gs();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Rd,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(L,{...it.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(L,{...a?.isWorkspaceAccount()?s?it.temporaryChatBizMemoryAvailable:it.temporaryChatBizMemoryUnavailable:s?it.temporaryChatDescriptionMemoryAvailable:it.temporaryChatDescriptionMemoryUnavailable}),o&&e.jsx("div",{className:"mt-3",children:e.jsx(L,{...it.temporaryChatDescriptionGptActions,values:{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:n})}})})]})]})}function Wh(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(L,{...it.howCanIHelpYouToday})})}function Vh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,enableV2Homepage:n,v2HomepageDisclaimer:r}){const l=Ne(t),c=_i(),d=En(),{data:h}=mt(l),u=Nd(),m=Ti(()=>navigator.windowControlsOverlay);return(c!=null||l!=null)&&h==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:m?.visible?P("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",u?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(wr,{clientThreadId:t})}),h!=null?e.jsx(em,{gizmo:h,showStarterPrompts:!0,disableStarterPrompts:d}):e.jsx(zh,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,enableV2Homepage:n,v2HomepageDisclaimer:r})]})}const it=Ye({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function qh({className:t,clientThreadId:s,message:o,onModelSelect:a,onDropdownChange:n}){const r=Ce(),[l,c]=i.useState(null),[d,h]=i.useState(!1),[u,m]=i.useState(!1),g=Id(),v=Ja(s),M=Ne(s),p=Qa({clientThreadId:s,message:o}),j=o.message.metadata?.model_slug,{modelOptions:b,modelSlug:_,animateModelLabelOnRender:C,nuxProps:w,messageModelEnabledTools:x}=p,k=Za(o.message),G=x.includes(Rt.Search),E=i.useMemo(()=>b.find(y=>y.value==j),[b,j]),{doesUserHaveAnyAccountsWithPlusFeatures:O}=Ln(),I=i.useRef(null),f=y=>{y||setTimeout(()=>{I.current&&I.current.blur()},10)};if(i.useEffect(()=>{f(d)},[d]),!g||M)return null;const A=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:r.formatMessage(Go.search),icon:e.jsx(On,{className:"icon-sm"}),condition:G&&!k,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:r.formatMessage(Go.nosearch),icon:e.jsx(er,{className:"icon-sm"}),condition:G&&k,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let R,D;w.shouldRenderNux?(R=Yh,D={title:e.jsx(L,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:e.jsx(L,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:w.usedModelName,largestModelName:w.largestModelName}}),markAsViewed:w.announcement.markAsViewed}):(R=$h,D={label:v?e.jsx(L,{id:"LBYK9a",defaultMessage:"Change model"}):e.jsx(L,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:w.usedModelName}})});const W=v&&b.some(y=>es(y,O));return e.jsxs(Q.Root,{onOpenChange:y=>{v&&(h(y),n(y),f(y)),y&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:W})},children:[e.jsx(R,{...D,children:e.jsx(An,{ref:I,className:P("cursor-pointer",t),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:e.jsx(jr,{modelSlug:_,animateModelLabelOnRender:C,isDropdownOpen:d,isRegenerateEnabled:v,isHovered:u})})}),v&&e.jsxs(Q.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[b.map(y=>{const z=es(y,O),{value:S,...F}=y;return e.jsx(Mt,{value:S,onSelect:()=>{ue.logEvent("chatgpt_regenerate_switch_model_button_clicked",S,{requestedModelId:S,...et({clientThreadId:s})}),a({requestedModelId:S})},onMouseEnter:()=>c(S),onMouseLeave:()=>c(null),isHovered:l===S,messageModelSlug:o.message.metadata?.model_slug,shouldShowUpsell:z,...F},S)}),!!E&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),A.filter(y=>y.condition).map(y=>e.jsx(Mt,{onSelect:()=>{ue.logEvent(y.eventName,E.value,{requestedModelId:E.value,...et({clientThreadId:s})}),a({requestedModelId:E.value,extraStreamParams:y.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>c(y.key),onMouseLeave:()=>c(null),isHovered:l===y.key,messageModelSlug:j,includeCheck:!1,...E,label:y.label,subtitle:"",icon:y.icon},y.key))]})]})]})}function jr({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:o,isRegenerateEnabled:a,isHovered:n,isRegenLabel:r=!1,animateShortLabel:l,omitIcon:c}){const[d,h]=i.useState("initial"),{categories:u}=Xs({isRegen:!!r});i.useEffect(()=>{if(s){const b=setTimeout(()=>h("show"),500),_=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(b),clearTimeout(_)}}h("initial")},[s]);const m=u.find(({defaultModel:b})=>b===t),g=t===Pd?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:v,shorterLabel:M}=m??g,p={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},j=o?"visible":n?"show":d;return e.jsxs(se.div,{initial:"initial",animate:j,className:"flex items-center pb-0",children:[!c&&(r?e.jsx(Jn,{className:"icon-md"}):v&&e.jsx(Xa,{type:"outline",categoryId:v,className:"icon-md h-4 w-4"})),(a||l)&&e.jsx(se.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:p,transition:{type:"tween",duration:.18},children:M}),a&&e.jsx(Xn,{className:P("icon-sm",{"text-token-text-quaternary":!n&&!r},{"text-token-text-secondary":n&&!r})})]})}function $h({children:t,label:s}){return e.jsx(ss,{label:s,sideOffset:0,children:t})}function Yh({children:t,title:s,description:o,markAsViewed:a}){return e.jsx(zn,{announcementKey:ct.ModelSwitcherAutoDowngrade,show:!0,side:"bottom",sideOffset:-4,title:s,description:o,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function es(t,s){const{modelSwitcherDeny:o,subscriptionLevel:a}=t;return!!o&&o.reason===ki.RATE_LIMIT&&a===Ni.PLUS&&!s}const Go=Ye({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Kh=i.memo(qh),Es="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Xh({className:t,clientThreadId:s,message:o,onModelSelect:a,onDropdownChange:n,canRegenerateResponse:r}){const[c,d]=i.useState(null),[h,u]=i.useState(!1),[m,g]=i.useState(!1),v=Ne(s),M=Qa({clientThreadId:s,message:o}),p=o.message.metadata?.model_slug,j=o.message.id,{modelOptions:b,modelSlug:_,animateModelLabelOnRender:C,messageModelEnabledTools:w}=M,x=Za(o.message),k=w.includes(Rt.Search),G=i.useMemo(()=>b.find(R=>R.value===p),[b,p]),E=i.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:O}=Ln(),I=R=>{R||setTimeout(()=>{E.current&&E.current.blur()},10)};if(i.useEffect(()=>{I(h)},[h]),Ai(s))return null;const A=r&&b.some(R=>es(R,O));return v?null:e.jsxs(Q.Root,{onOpenChange:R=>{r&&(u(R),n(R),I(R)),R&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:A,is_new_regen_dropdown:!0})},children:[r?e.jsx(Qh,{label:e.jsx(L,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(An,{ref:E,className:P("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(jr,{modelSlug:_,animateModelLabelOnRender:C,isDropdownOpen:h,isRegenerateEnabled:r,isHovered:m,isRegenLabel:!0,omitIcon:!1})})}):null,r&&e.jsx(Q.Portal,{children:e.jsxs(Q.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(Q.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(L,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Jh,{clientThreadId:s,messageId:j,onModelSelect:a,messageModelSlug:p,omitModelIcons:!0,modelOptions:b,setHoveredOption:d,hoveredOption:c,retryOption:G,lastResponseUsedSearch:x,modelSupportsSearch:k,doesUserHaveAnyAccountsWithPlusFeatures:O})]})})]})}function Jh({clientThreadId:t,messageId:s,modelOptions:o,messageModelSlug:a,onModelSelect:n,omitModelIcons:r,setHoveredOption:l,hoveredOption:c,retryOption:d,lastResponseUsedSearch:h,modelSupportsSearch:u,doesUserHaveAnyAccountsWithPlusFeatures:m}){const g=Ce(),[v,M]=i.useMemo(()=>Dd(o,C=>C.subcategory),[o]),p=i.useMemo(()=>{const C=new Map;return v.forEach(w=>{const x=w.subcategory;x&&(C.has(x)||C.set(x,[]),C.get(x)?.push(w))}),C},[v]),j=P("icon-sm",r&&"order-10 ml-auto text-token-text-tertiary icon-md"),b=r?"right":"left",_=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:g.formatMessage(un.search),icon:e.jsx(On,{className:j}),condition:u&&!h,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:g.formatMessage(un.nosearch),icon:e.jsx(er,{className:j}),condition:u&&h,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[M.map(C=>{const{value:w,...x}=C;return e.jsx(Mt,{value:w,onSelect:()=>{ue.logEvent("chatgpt_regenerate_switch_model_button_clicked",w,{requestedModelId:w,...et({clientThreadId:t,messageId:s})}),n({requestedModelId:w})},includeRegenerate:!1,onMouseEnter:()=>l(w),onMouseLeave:()=>l(null),isHovered:c===w,messageModelSlug:a,includeCheck:!1,shouldShowUpsell:es(C,m),className:Es,...x,icon:r?e.jsx("span",{className:j}):x.icon,justifyIcon:b,wrapIcon:!r},w)}),[...p.entries()].map(([C,w])=>e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:C})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-fit",children:w.map(x=>{const{value:k,...G}=x;return e.jsx(Mt,{value:k,onSelect:()=>{ue.logEvent("chatgpt_regenerate_switch_model_button_clicked",k,{requestedModelId:k,...et({clientThreadId:t,messageId:s})}),n({requestedModelId:k})},includeRegenerate:!1,onMouseEnter:()=>l(k),onMouseLeave:()=>l(null),isHovered:c===k,messageModelSlug:a,includeCheck:!1,className:Es,...G,icon:null,justifyIcon:b,wrapIcon:!r,shouldShowUpsell:es(x,m)},C+"-"+k)})})})]},C)),!!d&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),e.jsx(Mt,{onSelect:()=>{ue.logEvent("chatgpt_regenerate_try_again_button_clicked",d.value,{requestedModelId:d.value,...et({clientThreadId:t,messageId:s})}),n({requestedModelId:d.value})},includeRegenerate:!0,onMouseEnter:()=>l(d.value),onMouseLeave:()=>l(null),messageModelSlug:a,includeCheck:!1,className:Es,...d,label:g.formatMessage(un.tryAgain),subtitle:d.label,icon:e.jsx(Jn,{className:j}),justifyIcon:b,wrapIcon:!r},d.value),_.filter(C=>C.condition).map(C=>e.jsx(Mt,{onSelect:()=>{ue.logEvent(C.eventName,d.value,{requestedModelId:d.value,...et({clientThreadId:t,messageId:s})}),n({requestedModelId:d.value,extraStreamParams:C.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>l(C.key),onMouseLeave:()=>l(null),isHovered:c===C.key,messageModelSlug:a,includeCheck:!1,className:Es,...d,label:C.label,subtitle:"",icon:C.icon,justifyIcon:b,wrapIcon:!r},C.key))]})]})}function Qh({children:t,label:s}){return e.jsx(ss,{label:s,sideOffset:0,children:t})}const un=Ye({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Zh=i.memo(Xh),Wo=He(()=>Oe(()=>import("./ntw4l0fkgqdiln85.js").then(t=>t.qL),__vite__mapDeps([2,3,1,4,5])).then(t=>t.MemoryActionResult));function Vo(t,s,o){J.updateTree(t,a=>{a.updateNodeMetadata(s,{inlineComparisonRating:o})})}function qo(t){return{is_dark_mode:t,time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const $o=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:o}=s??{};if(o)return o}};function eg(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),o=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(Mr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o,...t}):e.jsx(tg,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o})}function tg(t){const{clientThreadId:s,variantIds:o,variantsInStreamInfo:a,turnIndex:n,firstVisibleTokenTimestampsRef:r}=t;if(o.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const l=ao(),c=ng(),d=Dn(),h=Ei(),[u,m]=i.useMemo(()=>tr(o.join(""))()<.5?[0,1]:[1,0],[o[0],o[1]]),g=u<m?"left":"right",v=g==="left"?"right":"left",M=o[u],p=o[m],j=jt($e(s,I=>I?.tree.getLeafFromNode(M))).id,b=jt($e(s,I=>I?.tree.getLeafFromNode(p))).id,_=jt(fn(s,n,j)),C=jt(fn(s,n,b)),w=g==="left"?_:C,x=g==="left"?C:_,k=a.display_treatment==="unskippable",G=l?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(bn.setState({displayingSideBySideFeedback:!0,unskippable:k}),()=>{bn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[k]),Bd();const E=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>Ri(Ii,{requestCompletion:()=>{const I=Ze(w.messages)?.completionSampleFinishTime,f=Ze(x.messages)?.completionSampleFinishTime,A=J.getServerThreadId(s);if(c){const D=J.getTree(s).getParentPromptNode(j),W=[_,C].map((S,F)=>({messageId:S.messages[S.messages.length-1].message.id,loadFirstTokenTime:F===0?r.current.left:r.current.right,loadEndTime:Ze(S.messages)?.completionSampleFinishTime})),y={},z=D.metadata?.variantsInStreamInfo==null&&D.message.metadata?.paragen_variants_info!=null;for(const S of W)y[S.messageId]=z?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:S.loadFirstTokenTime,load_end_time:S.loadEndTime};Rs({shouldUseNewParagenEndpoint:c,params:{conversation_id:A,displayed_message_ids:W.map(S=>S.messageId),message_metadatas:y,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:D.message.id}})}else Rs({shouldUseNewParagenEndpoint:c,params:{feedback_version:G,original_message_id:w.messages[w.messages.length-1]?.message.id,new_message_id:x.messages[x.messages.length-1]?.message.id,conversation_id:A,completion_comparison_rating:"skip",new_completion_placement:v,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:I??0,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:f??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:qo(h),...E.current}})}}),[_,C,j,s,t.conversationTurnMountTime,G,v,w?.messages,x?.messages,h,c,l,r]);const O=I=>{const A=J.getTree(s).getLeafFromNode(I);J.setThreadCurrentLeafId(s,A.id);const R=I===M,D=R===(g==="left"),W=Ze(w.messages)?.completionSampleFinishTime,y=Ze(x.messages)?.completionSampleFinishTime;w.messages.length>0&&Vo(s,w.messages[w.messages.length-1].nodeId,D?"original":"new"),x.messages.length>0&&Vo(s,x.messages[x.messages.length-1].nodeId,D?"original":"new");let z;W==null||y==null?z=D?"partial_load_comparison_original":"partial_load_comparison_new":z=D?"original":"new";const S=J.getServerThreadId(s);if(c){const F=[_,C].map((ee,xe)=>({messageId:ee.messages[ee.messages.length-1].message.id,loadFirstTokenTime:xe===0?r.current.left:r.current.right,loadEndTime:Ze(ee.messages)?.completionSampleFinishTime})),Z=R?F[0].messageId:F[1].messageId,q=J.getTree(s).getParentPromptNode(j),re={},me=q.metadata?.variantsInStreamInfo==null&&q.message.metadata?.paragen_variants_info!=null;for(const ee of F)re[ee.messageId]=me?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:ee.loadFirstTokenTime,load_end_time:ee.loadEndTime};Rs({shouldUseNewParagenEndpoint:c,params:{conversation_id:S,displayed_message_ids:F.map(ee=>ee.messageId),message_metadatas:re,rating:"selected",selected_message_id:Z,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:q.message.id}})}else Rs({shouldUseNewParagenEndpoint:c,params:{feedback_version:G,original_message_id:w.messages[w.messages.length-1]?.message.id,new_message_id:x.messages[x.messages.length-1]?.message.id,conversation_id:S,completion_comparison_rating:z,new_completion_placement:v,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:W??null,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:y??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:qo(h),...E.current}})};return e.jsx(Mr,{...t,setPreferredFeedback:O,leftVariantId:M,rightVariantId:p,leftTurn:_,rightTurn:C,hasActiveRequest:d,originalTurn:w,visibilityStateRef:E})}function sg(t){if(!t.length)return!1;const s=t.filter(o=>o.type===Io.Text||o.type===Io.MultiText).filter(o=>o.message.message.status!=="finished_successfully"&&o.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(o=>{const a=o.message.message.content;return a?.content_type===Ls.Text&&a.parts.join("")===""})}function Mr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:o,leftTurn:a,rightTurn:n,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:h,shouldShowParagenLabels:u=!1}=ka(),m=a&&$o(a)||h,g=n&&$o(n)||h,v=i.useMemo(()=>a?.messages??[],[a?.messages]),M=i.useMemo(()=>n?.messages??[],[n?.messages]),{avatarClassName:p,firstVisibleTokenTimestampsRef:j}=d,b=i.useMemo(()=>Us(v),[v]),_=i.useMemo(()=>Us(M),[M]),C=Ca(),[w,x]=i.useMemo(()=>[b,_].map(F=>sg(F)),[b,_]),k=lt(a?Bs.getRequestIdFromConversationTurn(a):"")||w,G=lt(n?Bs.getRequestIdFromConversationTurn(n):"")||x,E=a?.role===ke.User,O=n?.role===ke.User,I=i.useRef(null),f=i.useRef(null),A=i.useRef(null),R=d.stubSideBySideFeedback||w,D=d.stubSideBySideFeedback||x;!R&&j.current.left==null&&(j.current.left=Date.now()),!D&&j.current.right==null&&(j.current.right=Date.now()),i.useEffect(()=>{if(I.current&&f.current&&A.current){const F=Array(11).fill(0).map(($,q)=>q/10),Z=new IntersectionObserver($=>$.forEach(q=>{q.target===f.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=q.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,q.intersectionRatio)):q.target===A.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=q.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,q.intersectionRatio))}),{root:I.current,threshold:F});return Z.observe(f.current),Z.observe(A.current),()=>Z.disconnect()}},[c]);const{data:W}=_a(void 0,!1,C),y=ao(),z=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(L,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),S=Ue();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:P("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",S&&"top-[var(--thread-leading-height)] pt-3",!S&&"top-[-1px]",y&&!S?"md:top-header-height":S?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(L,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),y?z:null]}),y?null:z,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:I,children:e.jsx("div",{className:P(!S&&"min-w-fit"),children:e.jsxs("div",{className:P("mx-auto flex max-w-6xl items-start",y&&!S&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!y&&!S&&"gap-4 sm:gap-6",y&&S&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",S&&!y&&"gap-4 sm:gap-6"),children:[e.jsxs(Yo,{horizontalScrollContainerRef:I,rootElementRef:f,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:R,children:[e.jsxs(Jo,{children:[e.jsx(Mn,{messages:v,isUserTurn:E,avatarClassName:p}),e.jsx(Xo,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:m}):e.jsx(L,{...Zo.responseNumber,values:{responseIndex:1}})})]}),y&&R?e.jsx(Ko,{}):e.jsxs(e.Fragment,{children:[W!=null&&!E&&e.jsx(Wo,{clientThreadId:d.clientThreadId,messages:v,isParagen:!0}),e.jsx(Cn,{...d,groupedMessagesToRender:b,allGroupedMessages:b,isEditing:!1,isUserTurn:E,isCompletionRequestInProgress:k,hasActiveRequest:r,handleEnterEdit:js,handleExitEdit:js,shouldGrowContainer:!1}),e.jsx(Qo,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:a,originalTurn:l})]})]}),e.jsxs(Yo,{horizontalScrollContainerRef:I,rootElementRef:A,onClick:()=>{t(o)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:D,children:[e.jsxs(Jo,{children:[e.jsx(Mn,{messages:M,isUserTurn:O,avatarClassName:p}),e.jsx(Xo,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(L,{...Zo.responseNumber,values:{responseIndex:2}})})]}),y&&D?e.jsx(Ko,{}):e.jsxs(e.Fragment,{children:[W!=null&&!O&&e.jsx(Wo,{clientThreadId:d.clientThreadId,messages:M,isParagen:!0}),e.jsx(Cn,{...d,groupedMessagesToRender:_,allGroupedMessages:_,isEditing:!1,isUserTurn:O,isCompletionRequestInProgress:G,hasActiveRequest:r,handleEnterEdit:js,handleExitEdit:js,shouldGrowContainer:!1}),e.jsx(Qo,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:n,originalTurn:l})]})]})]})})})]})}function Yo({horizontalScrollContainerRef:t,rootElementRef:s,onClick:o,children:a,hasActiveRequest:n,isWaitingOnFirstUserVisibleToken:r}){const l=ao(),c=Ue(),{scrollX:d}=Xi({layoutEffect:!1,container:t,target:s}),h=Ld(),u=Fd(),m=i.useRef(null),g=i.useRef(null),v=i.useRef(null),[M,p]=i.useState(!1),[j,b]=i.useState(!1),[_,C]=i.useState(!1),[w,x]=i.useState(0);i.useEffect(()=>{if(!l)return;const A=new IntersectionObserver(R=>{for(const D of R)D.target===m.current?p(D.isIntersecting):D.target===v.current?C(D.isIntersecting):D.target===g.current&&b(D.isIntersecting)},{root:h?.current,rootMargin:c?`0px 0px -${w}px 0px`:void 0});return m.current&&g.current&&v.current&&(A.observe(m.current),A.observe(g.current),A.observe(v.current)),()=>{A.disconnect()}},[w,l,c,h]);const k=!_&&(j||M),G=Ji(d,A=>k?-1*A:0),E=Mo(0);i.useEffect(()=>{if(!l)return;const A=new ResizeObserver(R=>{_s(R.length===1,"entryList.length === 1");const D=R[0];_s(D.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),E.set(D.contentBoxSize[0].inlineSize)});return s.current&&A.observe(s.current),()=>{A.disconnect()}},[l,E,s]);const O=Mo(0);i.useEffect(()=>{if(!l)return;const A=new ResizeObserver(R=>{_s(R.length===1,"entryList.length === 1");const D=R[0];_s(D.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),O.set(D.contentBoxSize[0].blockSize+16),x(D.contentBoxSize[0].blockSize)});return u.current&&A.observe(u.current),()=>{A.disconnect()}},[l,O,u]);const I=e.jsx(It,{className:l?"px-5":"mt-4 self-start",onClick:o,"data-testid":"paragen-prefer-response-button",children:e.jsx(L,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),f=r;return e.jsxs("div",{"data-paragen-root":!0,className:P("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",c&&l&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!c&&l&&"px-10",l?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:P("absolute left-0 right-0 top-48 h-px","invisible"),ref:m}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:v}),a,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:f?null:e.jsx(se.div,{style:{translateX:G,width:E,bottom:O},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:P({fixed:k,"z-20 flex w-full justify-center":!0}),children:I})}):n?null:I]})}function Ko(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(rt,{className:"h-4 w-[75%]"}),e.jsx(rt,{className:"h-4 w-[50%]"}),e.jsx(rt,{className:"h-4 w-[80%]"}),e.jsx(rt,{className:"h-4 w-[55%]"}),e.jsx(rt,{className:"h-4 w-[66%]"}),e.jsx(rt,{className:"h-4 w-[64%]"}),e.jsx(rt,{className:"h-4 w-[48%]"})]})}function ao(){const{layer:t}=tt("3119715334");return t.get("should-enable-hojicha",!1)}const Xo=fe.div`text-sm text-token-text-secondary font-semibold`,Jo=fe.div`flex gap-4 items-center mb-1`,rt=fe.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function Qo({clientThreadId:t,conversationTurnMountTime:s,turn:o,originalTurn:a}){const n=Vn();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||o==null)return null;let r=o===a?"ORIGINAL":"NEW";const l=o.messages[o.messages.length-1],c=l?.message?.metadata?.__internal;if(c){const{model_id:m,model_definition_slug:g,model_definition_virtual_model_id:v,alternative_model_selection_rule:M,augmented_paragen_prompt_group_id:p,augmented_paragen_prompt_id:j,augmented_paragen_prompt:b}=c;m&&(r+=`
Model ID: ${m}`),g&&(r+=`
Model Slug: ${g}`),v&&(r+=`
Virtual Model ID: ${v}`),M&&(r+=`
Alternative Model Rule: ${M}`),p&&(r+=`
Prompt Group ID: ${p}`),j&&(r+=`
Prompt ID: ${j}`),b&&(r+=`
Prompt: ${b}`)}r+=`
Message ID: ${l.message.id}`;const h=J.getTree(t).getParentPromptNode(o.variantIds[0]),u=h.metadata?.variantsInStreamInfo==null&&h.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${h.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${s} (persisted)`:Ze(o.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function Rs({shouldUseNewParagenEndpoint:t,params:s}){t?await Nt.submitParagenSelectionV2(s):await Nt.submitMessageComparisonFeedback(s)}function ng(){const{value:t}=Ie("3894844102");return t}const Zo=Ye({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}});function og(t){return t.author.role===ke.Tool&&t.author.name==="file_search"&&t.content.content_type===Ls.TetherBrowsingDisplay}function ag({handleShowRetrievalResults:t,clientThreadId:s,turnIndex:o,responseComplete:a=!1}){const n=$e(s,c=>Fn.getTurnContentReferences(c,o)),r=$e(s,c=>c?.conversationTurns[o]?.messages??[]),l=i.useMemo(()=>{const c=new Set,d=[];function h(m){!m||c.has(m)||(c.add(m),d.push(m))}if(n.forEach(m=>{m.type==="file"?h(m.cloud_doc_url??m.extra?.cloud_doc_url):m.type==="file_navlist"&&m.items.forEach(g=>{h(g.cloud_doc_url)})}),a){for(const m of r)if(og(m.message)){const g=Hd(m.message.content.result),v=m.message.metadata?.cloud_doc_urls??[],M=g.chunks;for(let p=0;p<M.length;p++){const j=M[p];if(!j.documentId)continue;if(p<v.length){h(v[p]);continue}const b=j.documentId.endsWith("--google")?j.documentId.split("--")[1]:void 0,_=j.metadata.cloud_doc_url??(b?`https://drive.google.com/file/d/${b}`:void 0);h(_?.toString())}break}}const u=[];for(let m=0;m<d.length;m++){const g=d[m],v=Od(g);if(v&&u.push(v.Icon),u.length>=3)break}return u},[r,n,a]);return e.jsxs(e.Fragment,{children:[e.jsx(se.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:P("not-prose group/footnote mb-2 mt-3 flex w-fit items-center gap-1.5 rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 hover:bg-token-main-surface-secondary","pl-3 pr-2.5"),onClick:t,children:[e.jsx("div",{className:"flex items-center gap-0.5 text-sm font-medium",children:e.jsx(L,{id:"/48IOP",defaultMessage:"Sources"})}),l.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:l.reverse().map((c,d)=>e.jsx(se.div,{className:P("flex items-center overflow-hidden rounded-full border-token-main-surface-primary bg-token-main-surface-primary","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(c,{className:"icon-md"})},d))})]})}),e.jsx("div",{className:"h-[60px]"})]})}const ea=[1,2,3,4,10,20,30],rg=.5;function ig({clientThreadId:t,conversationLeafId:s}){const o=sr(nr.isBusinessWorkspace),a=i.useRef(!1),n=ns(t),r=Vs(t),{isUnauthenticated:l}=Fe(),c=i.useMemo(()=>{if(!n)return-1;const O=tr(n);return O()>rg?-1:ea[Math.floor(O()*ea.length)]},[n]),d=Pi(t,s),h=d[d.length-1],u=i.useMemo(()=>Bs.getRequestIdFromConversationTurn(h),[h]),m=lt(u),[g,v]=i.useState(null),[M,p]=i.useState(!1),[j,b]=i.useState(!1),[_,C]=i.useState(!1),w=O=>{const I=Ze(d)?.messages[0]?.message.id;v(O),G(I,O)},x=d.filter(O=>O.role===ke.Assistant).length,k=h?.role===ke.Assistant,G=i.useMemo(()=>qa((O,I)=>{n&&O&&Nt.submitConversationRating({conversation_id:n,message_id:O,rating:I,shown_at_assistant_turn:c}),K.logEvent(X.conversationRatingSubmitted,{rating:I,showAtAssistantTurn:c,conversationId:n}),p(!0),setTimeout(()=>{b(!0)},1500)},2e3),[n,c]),E=x!==c||m||!k||!!o||r?.kind!==qe.PrimaryAssistant||_||l;return i.useEffect(()=>{!E&&!a.current&&(K.logEvent(X.conversationRatingShown,{showAtAssistantTurn:c,conversationId:n}),a.current=!0)},[E]),_||E?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(os,{children:M&&!j&&e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(ta,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(L,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!M&&e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(ta,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(L,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(mn,{$selected:g==="thumbsUp",onClick:()=>w("thumbsUp"),children:e.jsx(or,{className:"icon-md"})}),e.jsx(mn,{$selected:g==="thumbsDown",onClick:()=>w("thumbsDown"),children:e.jsx(ar,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(mn,{className:"p-3",$selected:!1,onClick:()=>C(!0),children:e.jsx(Di,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const mn=fe.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,ta=fe.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,lg=He(()=>Oe(()=>import("./kcip35zr0y4jdoqd.js"),__vite__mapDeps([40,1,3,4,2,5,41])));function cg({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:o,messageForRating:a,allGroupedMessages:n,currentModelId:r}){let l=null;const c=qs(g=>{const v=Fn.getCacheAwareConversationTurns(fa(t,g),s);let M=0;for(let p=v.length-1;p>=0;p--){const j=v[p];if(j.messages.some(b=>b.message.metadata?.is_indepth_feedback))return!0;if(j.messages.some(b=>b.message.author.role===ke.Assistant)&&M++,M>=3)break}return!1}),d=ns(t),h=qn(g=>g.voiceFeedbackThread),u=d===h,{voiceName:m}=Ud();return c?null:(u&&d?(Bi.feedbackShown.success({voice:m}),l=e.jsx("div",{className:"text-center",children:e.jsx(zd,{serverThreadId:d})})):a.rating&&o?l=e.jsx(lg,{clientThreadId:t,conversationMessage:a,allGroupedMessages:n,currentModelId:r}):l=e.jsx("div",{className:"text-center",children:e.jsx(ig,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const dg=He(()=>Oe(()=>import("./emkuxujigj88nqc7.js"),__vite__mapDeps([42,1,3,4,43,44,2,5,45,46])).then(t=>t.VoicePlayButton)),ug=He(()=>Oe(()=>import("./h2wrxznmzvsliwms.js"),__vite__mapDeps([47,1,2,3,4,5,48])).then(t=>t.AutomationSourceHeader)),sa=80,mg=16,na={minHeight:"calc(100cqh - var(--thread-leading-height) - var(--thread-trailing-height) - var(--previous-turn-min-height))"};function hg(t){const{turnIndex:s,conversationLeafId:o,isFinalTurn:a,clientThreadId:n,onChangeItemInView:r,onChangeRating:l,currentModelId:c,avatarClassName:d,showAvatar:h=!0,scrollToMessageId:u,dateHeaderType:m}=t,g=Ce(),v=Wn(),M=!!v&&Li(v),p=Pn(),j=sr(nr.isBusinessWorkspace),b=la(),{value:_}=Ie("2848981774"),C=J.getServerThreadId(n),w=jt(fn(n,s,o)),{messages:x,variantIds:k,variantsInStreamInfo:G}=w,E=Us(x),O=Gd();let I=x[x.length-1];for(const H of E){const ce=om(H);if(ce.some(Ge=>O.has(Ge.message.id))){I=ce[ce.length-1];break}}const f=x.slice(0,x.indexOf(I)+1),A=Ds(),[R,D]=i.useState(!1),[W,y]=i.useState(!1),z=k.findIndex(H=>f.some(ce=>ce.nodeId===H)),S=w.role===ke.User,F=ut(),Z=Ne(n),$=mt(w.gizmoId??Z)?.data,q=Kn(c),re=Wd(c),me=Ue(),ee=Vs(n,$?.gizmo.id),he=da(n)===ua.STREAMING,Pe=!1,{value:ie}=Rn("2291672486"),_e=f.some(H=>H.message.content.content_type===Ls.MultimodalText),{layer:ve}=tt("1547743984"),je=C&&A&&ve.get("show_share_button_inline",!1),{isUnauthenticated:Ae}=Fe(),[De,ze]=i.useState(!1),[Ke,ne]=i.useState(!1),B=w.messages.map(H=>H.message.id),N=i.useRef(null),U=x[x.length-1],te=U.rating,le=(u?.length??0)>2&&u!=="finalAgentTurn"&&a&&_&&me,oe=()=>{f.length===1&&(K.logEvent(X.editPrompt,{id:f[0].message.id,threadId:J.getServerThreadId(n)}),ue.logEvent("chatgpt_edit_prompt"),D(!0))},Se=i.useCallback(()=>{D(!1)},[]),ae=i.useCallback(H=>{Vd(n,s,b,H)},[n,s,b]),Te=H=>{l({nodeId:U.nodeId,messageId:U.message.id,rating:H}),K.logEvent(H==="thumbsDown"?X.messageFeedbackThumbsDownClicked:X.messageFeedbackThumbsUpClicked,{id:U.message.id,threadId:J.getServerThreadId(n),model:c,rating:H}),y(!0)},[Y]=i.useState(()=>Date.now()),be=i.useMemo(()=>Bs.getRequestIdFromConversationTurn(w),[w]),Be=ma({clientThreadId:n,conversationLeafId:o}),ge=lt(be)&&!Be,ht=Dn(),Pt=Us(f),pe=i.useRef(!1);i.useEffect(()=>{if(pe.current||u===void 0||!_||!me||!N.current){u==="finalAgentTurn"&&a&&pe.current&&J.updateScrollToMessageId(n,void 0);return}(B.includes(u)||u==="finalAgentTurn"&&a)&&(pe.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(N.current)if(u==="finalAgentTurn"&&a)N.current.scrollIntoView({behavior:"instant",block:"end"}),J.updateScrollToMessageId(n,void 0);else{const H=N.current.offsetHeight;let ce;H>sa?ce=sa-H:ce=0,N.current.style.scrollMarginTop=`calc(${ce}px + ${mg}px + var(--thread-leading-height))`,N.current.scrollIntoView({behavior:"smooth"})}})}))},[u,N.current]);const Je=Fn.getCanvasToOpenId(fa(n));i.useEffect(()=>{Je&&(qd(Je),J.setCanvasToOpenId(n,void 0))},[Je,n]);const{showDebugConversationTurns:gt}=Vn(),Dt=ha(n),ls=Ja(n),pt=$d({clientThreadId:n,conversationMode:ee}),st=dt(n),Bt=i.useCallback(({requestedModelId:H,systemMessage:ce,juice:Ge,extraStreamParams:We})=>{const vs=new Qt;pt({id:U.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:vs,requestedModelId:H,systemMessage:ce,juice:Ge,extraStreamParams:We})},[U,pt]),Ee=Pe,Lt=!p&&!Dt&&!F&&!S,cs=Yd(),ft=I.message.author.role===ke.Assistant?I.message:null;Kd({isCompletionRequestInProgress:ge,isUserTurn:S,message:ft});const Ft=$e(n,H=>H?.tree!=null&&k.some(ce=>{const Ge=H.tree.getLeafFromNode(ce);return H.tree.getHasErrorFromNode(Ge.id)})),{isOpen:Ht}=Xd(),Ot=Na(),Xe=Jd(ee),Ut=!cs&&!Xe&&Lt&&a&&G?.num_variants_in_stream===2&&!U.inlineComparisonRating&&!Ft,ds=Qd(w),Le=Ut,us=Ut&&!ds,xt=!S&&!p&&!Dt&&!Xe&&!he&&!ge&&!Ht,zt=xt&&(!j||Ee||re||M)&&!Xe&&!Ae&&!F,nt=!p&&!((ge||he)&&a)&&k.length>1&&!R&&!Le;let Gt=!1;if(S&&f.length===1){const{shouldHideContent:H}=Zd(f[0]);H&&(Gt=!0)}const ms=S&&!Xe&&!p&&!_e&&f.length===1&&!Gt&&!R&&!Ae,Wt=H=>{r(k[H]),K.logEvent(X.changeNode,{intent:"toggle_between"})},Qs=eu(w,f,gt),{toggleThreadSidebar:Vt}=Fi(),vt=i.useCallback(()=>{Vt({type:"retrievalResults",clientThreadId:n,turnIndex:s})},[Vt,n,s]),{value:ye}=Ie("2912660649"),hs=i.useMemo(()=>ye&&!Z&&!S&&tu(f)&&f.some(H=>{const ce=!!H.message.metadata?.content_references?.some(We=>We.type==="file"||We.type==="file_navlist"),Ge=q&&H.message.content.content_type===Ls.TetherBrowsingDisplay&&H.message.author.role===ke.Tool&&H.message.author.name==="file_search"&&H.message.content.result.length>0&&H.message.content.result.trim()!=="Visible: 0% - 100%";return ce||Ge}),[ye,q,S,f,Z]);if(!Qs&&!Le)return le?e.jsx("div",{style:na}):null;const St=f.some(({message:H})=>Hi.getAssetPointers(H).length>0),Zs=!St&&a&&ls&&!ie?e.jsx(Ts,{onClick:()=>{ue.logEvent("chatgpt_regenerate_try_again_button_clicked",c,{requestedModelId:c,...et({clientThreadId:n,turnIndex:s})});const H=new Qt;pt({id:st,eventMetadata:{eventSource:"mouse"},turnTracker:H}),Fs()},icon:Jn,label:g.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,gs="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",ps=!St&&ie?e.jsx(Zh,{className:gs,clientThreadId:n,message:U,onModelSelect:Bt,onDropdownChange:ze,canRegenerateResponse:ls}):null,bt=!S&&!Gt&&(!a||!ge)?e.jsx(hu,{onClick:ae}):null,tn=!S&&(!a||!ge)&&(U.disclaimers??[]).length===0&&U.nodeId?e.jsx(dg,{conversationId:n,message:U,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,sn=!S&&U&&(!a||!ge)?e.jsx(gu,{message:U,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,fs=zt&&!ge?e.jsxs("div",{className:"flex",children:[te!=="thumbsDown"&&e.jsx(Ts,{onClick:()=>Te("thumbsUp"),disabled:te==="thumbsUp",icon:te==="thumbsUp"?su:or,label:g.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${U.nodeId}`),te!=="thumbsUp"&&e.jsx(Ts,{onClick:()=>Te("thumbsDown"),disabled:te==="thumbsDown",icon:te==="thumbsDown"?nu:ar,label:g.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${U.nodeId}`)]}):null,xs=je&&e.jsx(Ts,{onClick:()=>{Os.openSharingModal(C)},label:g.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:ou}),ot=!ie&&e.jsx(Kh,{className:gs,clientThreadId:n,message:U,onModelSelect:Bt,onDropdownChange:ze});function yt(H){return me?H:e.jsx(Yn,{clientThreadId:n,isStaticSharedThread:p,withVerticalPadding:!0,withHorizontalPadding:!Le,children:H})}function qt(H){return me?H:e.jsx(Zt,{children:H})}return e.jsxs(e.Fragment,{children:[e.jsx(au,{dateHeaderType:m,turn:w}),e.jsxs("article",{className:P("w-full scroll-mb-[var(--thread-trailing-height,150px)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",u==="finalAgentTurn"&&_&&me?"opacity-0":""),style:le?na:void 0,ref:N,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":a,onMouseEnter:()=>ne(!0),onMouseLeave:()=>ne(!1),children:[e.jsx(ru,{role:w.role}),yt(e.jsx(e.Fragment,{children:Le?e.jsx(eg,{isFeedbackEnabled:zt,variantIds:k,variantsInStreamInfo:G,conversationTurnMountTime:Y,stubSideBySideFeedback:us,...t}):qt(e.jsxs(e.Fragment,{children:[!S&&h&&e.jsx(pg,{children:e.jsx(Mn,{messages:f,isUserTurn:S,avatarClassName:d,gizmo:$})}),e.jsx("div",{className:P("group/conversation-turn relative flex w-full min-w-0 flex-col",!S&&iu),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!S&&!p&&e.jsx(lu,{messages:f,clientThreadId:n,gizmoId:$?.gizmo.id}),Ot&&!S&&e.jsx(ug,{clientThreadId:n,messages:f}),e.jsx(Cn,{groupedMessagesToRender:Pt,allGroupedMessages:E,...t,isEditing:R,isUserTurn:S,isCompletionRequestInProgress:ge,isFeedbackEnabled:zt,isFinalTurn:a,hasActiveRequest:ht,showEditButton:ms,handleEnterEdit:oe,handleExitEdit:Se}),q&&!ye&&e.jsx("div",{className:"mb-4",children:e.jsx(cu,{messages:f})}),hs&&e.jsx(ag,{handleShowRetrievalResults:vt,clientThreadId:n,turnIndex:s,responseComplete:!(ge||he)}),(xt||nt)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:P("mb-2 flex gap-3 empty:hidden",S?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(du,{alwaysShow:a,showInline:a||nt,isHovered:Ke||De,pagination:nt&&e.jsx(uu,{showInline:a||nt,currentPage:z,onChangeIndex:Wt,length:k.length,className:P("self-center",k.length>1?"visible":"!invisible")}),actions:xt&&e.jsxs(e.Fragment,{children:[tn,bt,Zs,fs,sn,ot,xs,ps]})})}),xt&&!ge?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(mu,{message:U,isFinalTurn:a})}):null,a&&!ge&&e.jsx(cg,{canShowInlineMessageFeedback:W,clientThreadId:n,conversationLeafId:o,messageForRating:U,allGroupedMessages:E,currentModelId:c})]})]})})})]}))}))]})]})}const gg=ya.memo(hg),pg=fe.div`flex-shrink-0 flex flex-col relative items-end`;function fg({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:o,onRequestCompletion:a,clientThreadId:n,conversationLeafId:r,hideHeader:l}){const c=we(),d=In(),h=pu(),[u]=fu(),m=xu(),[g]=vu(),v=Vs(n),M=Gs(),p=as(n),b=J.getConversationOrigin(n)===Oi.APPLE,_=c.store.useContentAreaDimensions(Et.Header,F=>F?.height?F.height:void 0),C=c.store.useIsHeaderContentAreaPopulated(),w=xa(n),{isArchived:x}=w,k=Su(p.id),G=v?.kind===qe.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":k,E=va(n,r),O=bu(),[I,f]=i.useState(0),[A,R]=i.useState(!1);i.useEffect(()=>{d&&(I===0?f(E):!A&&E>I&&(R(!0),ue.logEvent("chatgpt_continue_conversation_first_message_sent"),K.logEvent(X.continueConversationFirstMessageSent)))},[E,I,A,d]),i.useEffect(()=>{d&&(ue.logEvent("chatgpt_continue_conversation_page_loaded"),K.logEvent(X.continueConversationPageLoaded),ue.logEvent("chatgpt_conversation_share_page_loaded"),K.logEvent(X.sharedConversationPageLoaded))},[d]);const D=i.useCallback(()=>{h({behavior:"smooth"})},[h]),W=yu(n),y=O&&!x,z=wu(n,r),S=(F,Z,$)=>[...new Array(Z-F).keys()].map(q=>{const re=q+F;return e.jsx(gg,{isFinalTurn:$(re),turnIndex:re,clientThreadId:n,conversationLeafId:r,onChangeItemInView:t,onChangeRating:o,onRequestMoreCompletions:s,onRequestCompletion:a,currentModelId:p.id,avatarClassName:G,scrollToBottom:D,dateHeaderType:z(re)},re)});return e.jsxs("div",{onCopy:W,className:P("flex flex-col text-sm",y&&"pb-[120px]",_||y?null:"md:pb-9"),style:{paddingBottom:y?void 0:_},children:[!l&&M?.data&&e.jsx(wr,{clientThreadId:n}),d&&e.jsxs(e.Fragment,{children:[e.jsx(Zt,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(L,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),E-I===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{Os.openModal(ju.ReportConversation),ue.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),K.logEvent(X.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(L,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),S(0,I,F=>F===I-1),e.jsx(Zt,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Mu,{className:"icon-xs mr-2"}),e.jsx(L,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),S(I,E,F=>F===E-1)]}),!d&&S(0,E,F=>F===E-1),b&&u&&!g&&e.jsx(oa,{className:P("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{ue.logEvent("chatgpt_thread_scroll_to_top"),m({behavior:"smooth"})},children:e.jsx(Cu,{className:"icon-md text-token-text-primary"})}),!u&&e.jsx(oa,{className:P(_?null:"bottom-5",y?C?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:O?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":_},onClick:()=>{ue.logEvent("chatgpt_thread_scroll_to_bottom"),h({behavior:"smooth"})},children:e.jsx(_u,{className:"icon-md text-token-text-primary"})})]})}const oa=fe.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,xg=60,vg=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:o=0})=>{const a=i.useRef(null);return e.jsx("div",{className:"h-full",ref:a,children:e.jsx(Ui,{children:e.jsx(nm,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Sg(a,o)?0:1/0,children:t})})})},Sg=(t,s)=>{const o=bg(t.current);if(o==null)return!1;const a=o>s,n=o<s-xg;return!a&&!n};function bg(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const o=s.getBoundingClientRect().top,a=t.getBoundingClientRect().top;return o-a}const yg=He(()=>Oe(()=>import("./j2h13udkl1zlckh2.js"),__vite__mapDeps([49,3,1,4,2,5,50,51,52,53,54,45,55])).then(t=>t.OpenDebugSidebarButton)),wg=He(()=>Oe(()=>import("./ki1h8sr57t9xokxr.js"),__vite__mapDeps([56,1,2,3,4,5]))),aa=Ye({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function jg({clientThreadId:t}){const s=ba(),o=ns(t),a=async()=>{o&&(await Nt.patchConversation(o,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),qs.setState(n=>{const r=n.threads[o];r!=null&&(r.initialThreadData.isArchived=!1)}),Vu(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(L,{...aa.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(It,{disabled:!o,onClick:a,icon:Gu,children:e.jsx(L,{...aa.unarchiveButton})})})]})}const Dg=function({clientThreadId:t,onCompletionFinished:s,onCreate:o,preRequestCompletion:a,hideHeader:n,hideMessages:r,hideFooter:l,hideToolsOverlay:c,messagesVerticalAlign:d="top",prependThreadChildren:h,renderEmptyState:u,prefetchSearch:m}){const g=ca(),v=Ys(t),M=Ws(t),p=dt(t),b=xa(t).isArchived;zi(t),i.useEffect(()=>{M||(Ct(t)?pn.addTiming("chatgpt.web.chatPage.renderNewConversation"):pn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,M]);const _=ga(t,p),C=va(t,p),{setTargetedContent:w}=Ga(),x=g?.includes(Gi),k=Tu(),G=C>=2;Ua(G);const E=Ct(t)&&!G&&Ps(v),O=Ct(t)&&!_&&(Ps(v)||v?.kind===qe.GizmoTest),f=za().id,A=Wi(t),R=A??f,D=!!A,W=Kn(R),z=Oa()[R],S=ku(t,v),F=Ha();Nu(C,t,p),i.useEffect(()=>{F||w(void 0)},[t,w,F,p]);const{caModal:Z,onRequestCompletion:$,onChangeItemInView:q,onChangeRating:re,onRequestMoreCompletions:me}=Au({clientThreadId:t,currentModelId:R,defaultModelId:f,onCompletionFinished:s,onThreadCreated:o,preRequestCompletion:a}),{isUnauthenticated:ee,isLoading:xe}=Fe(),he=Eu({clientThreadId:t,currentLeafId:p,handleRequestCompletion:$,prefetchSearchPromise:m}),Pe=Te=>e.jsx(vg,{scrollAnchorTopOffset:n?0:Wu,children:d==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),Te]}):Te});i.useEffect(()=>{document.title=S??"ChatGPT"},[S]);const ie=Ne(t),_e=ut(),ve=Vi(),je=O&&!ve&&!u&&!ie&&!W&&!_e,Ae=je&&!xe&&ee,De=je&&!xe&&!ee,ze=gh(Ae),Ke=fh(De),ne=Ae&&ze||De&&Ke,B=In(),N=Ru(),{reset:U,streamingContext:te,StreamingProvider:le}=Iu();i.useEffect(()=>{N&&(te.setOnResetContext=()=>{U()})},[N,U,te]);const oe=i.useRef(null),Se=i.useRef(null),ae=i.useMemo(()=>({threadContentScrollContainerElementRef:oe,footerRootContainerElementRef:Se}),[]);return e.jsx(Pu,{clientThreadId:t,currentLeafId:p,children:e.jsxs(le,{value:te,children:[x&&e.jsx(wg,{}),e.jsx(Du,{children:S!=null&&e.jsx("title",{children:S})}),e.jsx(qi.Provider,{value:$,children:e.jsxs(Bu,{children:[e.jsxs(Lu,{clientThreadId:t,currentModelConfig:z,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!r&&e.jsx(Fu,{value:ae,children:e.jsx(Mg,{ref:oe,children:!M&&!he?O?u??e.jsx(Vh,{clientThreadId:t,currentModelId:R,isModelLoaded:D,onRequestCompletion:$,enableV2Homepage:ne,v2HomepageDisclaimer:ne&&e.jsx(Po,{clientThreadId:t})}):G?Pe(e.jsxs(e.Fragment,{children:[h,e.jsx(fg,{onChangeItemInView:q,onRequestMoreCompletions:me,onChangeRating:re,onRequestCompletion:$,clientThreadId:t,conversationLeafId:p,hideHeader:n},t)]})):null:null})}),e.jsx(Cg,{ref:Se,children:b?e.jsx(jg,{clientThreadId:t}):e.jsxs("div",{children:[!ne&&e.jsx(dh,{clientThreadId:t,isNewThread:E,showPromptStarters:E||!_,currentModelId:R,onRequestCompletion:$}),!l&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:Ps(v)&&!ne&&e.jsx("div",{className:"min-h-4",children:e.jsx(Po,{clientThreadId:t})})})]})})]}),!c&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[k?e.jsxs(e.Fragment,{children:[e.jsx(yg,{}),!1]}):null,e.jsx(Hu,{})]}),Z,e.jsx(Ou,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:B}),e.jsx(Uu,{}),e.jsx(zu,{conversationId:t,currentModelId:R,isActiveWindow:!ve})]})})]})})},Mg=fe.div`grow flex-1 overflow-hidden @container/thread`,Cg=fe.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{gg as C,Vh as E,kn as G,gr as P,xh as S,Fh as T,vg as W,Dg as a,wr as b,dh as c,Oh as d,Pg as e,vr as u};
//# sourceMappingURL=m5cd4p680vhusvsg.js.map
