const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/b9s9od8ovvq4l0ah.js","assets/eh26o1l35t2fnjj4.js","assets/i8w88cc8b3gds516.js","assets/root-inht5vcp.css","assets/jg63sxiyqeyvfv9f.js","assets/conversation-small-nranh1cg.css","assets/mrrvs3fql96l359q.js","assets/jahe3ggfyk20o7ht.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/hmbip9k0fcw739ar.js","assets/mkf03mv1563ttunw.js","assets/h2nc3qmtjg2iytti.js","assets/e16evjtphcrwbvc6.js","assets/6kjidy9vbepnlauj.js","assets/mzkxlhrlmxhntkvn.js","assets/hq6x27nrpb56q3r0.js","assets/jwbljuc8iruf0rbh.js","assets/itdemlts8gcqwi6k.js","assets/ik96wpc41rashwi6.js","assets/buoyb8jniswedxm6.js","assets/c4bxzbp1808foto4.js","assets/dyuarriie396ezxd.js","assets/kcf5o2l7h6vtxb24.js","assets/m89x2zftpo6hrypr.js","assets/ctlsvvj6folqh10x.js","assets/hlm6hsp0qis3d7zg.js","assets/j14akxnqigsmgi7w.js","assets/ln72qaf6x6k87xpg.js","assets/h5ki4u1sjcr6cdl0.js","assets/e7ldcb1pybd2xac9.js","assets/csvcabmbpwfvn88d.js","assets/ft5z2r2wosrho43b.js","assets/jzhplvlpjjzcf6w8.js","assets/ka7w9evts347ph9j.js","assets/dqp4qy11fpzrg014.js","assets/e34qym7psp0g3xzr.js","assets/n2sybeqm169dymt4.js","assets/bu3dsffychuyne68.js","assets/dzq0v9msooejtdz0.js","assets/ens1ascotkzlvvvm.js","assets/c3ew5w7qbxkccpqx.js","assets/gdsmqpdlbx03h3zp.js","assets/c70tulx9zqykyr6q.js","assets/f26tq0bcmxctgqq5.js","assets/jv2eknshvxtq04lj.js","assets/f1h1494vismfgy40.js","assets/bqu85ad1fqrqmwk0.js","assets/cty1v3jstgrcswrf.js","assets/53nax822pkd7iwth.js","assets/f7vxxxls2qxyya5h.js","assets/btagl6w1gub4aw61.js"])))=>i.map(i=>d[i]);
import{v as le,R as ps,r as u,j as e,c as V,a as hs,M as g,e as me,ad as at,ac as xs,X as it,f as nt}from"./i8w88cc8b3gds516.js";import{X as rt,jP as vs,bA as ot,c6 as js,i2 as Oe,jQ as lt,iI as ys,jR as bs,fU as Ms,jS as ws,U as ue,it as B,b as Ts,cG as be,cH as Ps,g7 as Be,e_ as ct,eP as dt,dn as ut,dE as Re,bo as L,eQ as Me,eR as te,f0 as he,eY as xe,eT as De,i_ as Ss,jT as mt,i$ as ks,j0 as ft,jU as gt,fb as ae,eS as pt,jV as ze,cY as ht,f9 as xt,di as vt,dd as Cs,f4 as jt,f3 as yt,ga as bt,iA as Is,jW as Mt,c1 as wt,iB as Ns,iy as _s,jt as Tt,jX as Pt,h2 as St,fx as kt,ju as Ct,c0 as Ue,jv as It,ix as Nt,jY as as,iG as Ce,iH as _t,dG as is,dl as Gs,jZ as Gt,j_ as At,iD as Lt,dm as Rt,ff as zt,j$ as ns,ag as Ut,T as Et,aa as Ft,k0 as Ot,o as Bt,fc as Dt,k1 as Wt,bW as Ht,g6 as $t,ia as rs,iw as Vt,bk as qt,k2 as Qt,k3 as Yt,j as Kt,k4 as Xt,k5 as os,k6 as ls,k7 as Zt,hK as cs,cO as Jt}from"./jg63sxiyqeyvfv9f.js";import{dr as We,bT as re,h as $,r as I,aa as He,aX as $e,D as Ee,V as ea,ab as ie,W as sa,K as As,H as ta,bV as aa,bQ as Ve,bR as qe,Y as Ls,aM as Qe,aN as Ye,bY as Ke,eb as Rs,y as ne,b7 as H,aP as Xe,bU as we,co as Ze,bn as ve,ey as zs,f as ce,eo as ia,eU as na,ap as Us,an as oe,gZ as ra,a5 as Te,ds as Es,bm as Q,dn as Je,aZ as Fs,aU as Ie,P as Os,j as Bs,c2 as je,bW as oa,b9 as Ds,am as la,ej as Ws,ea as ca,dg as ye,eh as Hs,M as da,G as ua,bt as ma,bB as ds,bC as us,gA as fa,dJ as ga,dK as pa,g7 as ha,fF as xa}from"./eh26o1l35t2fnjj4.js";import{i as va,M as $s,A as de,G as ja,a as ya,b as ms,s as ba,S as Ma,c as wa,g as Ta,d as Pa}from"./jwbljuc8iruf0rbh.js";import{f as Sa}from"./m89x2zftpo6hrypr.js";import{a as Vs}from"./ctlsvvj6folqh10x.js";import{a as qs}from"./dyuarriie396ezxd.js";import{C as Qs}from"./csvcabmbpwfvn88d.js";import{i as Fe}from"./ka7w9evts347ph9j.js";import{S as ka}from"./dqp4qy11fpzrg014.js";import{S as Ys}from"./itdemlts8gcqwi6k.js";import{S as Ca}from"./mrrvs3fql96l359q.js";import{G as Ia}from"./jv2eknshvxtq04lj.js";import{S as Na}from"./f1h1494vismfgy40.js";import{F as X,a as Z,b as Ne,c as _a,G as Ga}from"./hq6x27nrpb56q3r0.js";import{G as Aa}from"./bqu85ad1fqrqmwk0.js";import{S as La}from"./cty1v3jstgrcswrf.js";import{CanvasFocusedViewManager as Ra}from"./f7vxxxls2qxyya5h.js";import{G as za}from"./hlm6hsp0qis3d7zg.js";function Ua(s,t){const a=I.getThreadCurrentLeafId(s),i=I.getTree(s),n=[];let r=i.getNodeByIdOrMessageId(a);for(;r!=null&&(t==null||r.id!==t);)n.unshift(r.message),r=r.parentId!==""?i.getNodeByIdOrMessageId(r.parentId):void 0;return n}function Ea(s){return s.filter(i=>i.recipient==="gizmo_editor.update_behavior").flatMap(i=>i.content.content_type==="text"?i.content.parts:i.content.content_type==="code"?[i.content.text]:[]).map(i=>JSON.parse(i)).reduce((i,n)=>({...i,...n}),{})}async function Fa(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const i=aa.getImageAssetPointers(a);i.length>0&&(t=i.at(-1))}if(t!=null){const a=ot(t.asset_pointer),i=await He.getFileDownloadLink(a);if(i.status===$e.Success)return{id:a,permalink:i.download_url}}}async function Oa(s,t,a,i){const n=Ua(t,i),r=Ea(n);let o=await Fa(n);if(Fe(r)&&o==null)return;const{name:d,context:m,description:c,profile_pic_file_id:w,prompt_starters:M}=r;if(w!=null)try{const f=await He.getFileDownloadLink(w,s.id);f.status===$e.Success&&(o={id:w,permalink:f.download_url})}catch(f){Ee.addError(new Error("Error while retrieving profile pic in update",{cause:f})),a.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const l={name:typeof d=="string"?d:void 0,description:typeof c=="string"?c:void 0,instructions:typeof m=="string"?m:void 0,promptStarters:Array.isArray(M)?M:void 0,profilePictureId:o?.id,profilePictureUrl:o?.permalink};return ea(l,f=>f!=null)}function Ba(s){const t=new Set;for(const m of s.tools)t.add(m.type);const a=s.name??"",i=s.description??"",n=s.instructions??"",r=Array.from(t).join(","),o=a===""&&i===""&&n==="",d=s.profilePictureUrl!=null;return o?`The GPT you are about to has the following abilities: ${r}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${i}

context: ${n}

abilities: ${r}

${d?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}function Ks(s,t,a,i){const n=a.current,r=i.current;if(We(n,r))return;const o={};n.name!==r?.name&&(o.name=n.name),(n.description??"")!==(r?.description??"")&&(o.description=n.description??""),n.instructions!==(r?.instructions??"")&&(o.context=n.instructions??"");const d=new Set(r?.files?.map(l=>l.file_id)??[]),m=new Set(n.files?.map(l=>l.file_id)??[]),c=(n.files??[]).filter(l=>!d.has(l.file_id)),w=(r?.files??[]).filter(l=>!m.has(l.file_id));if(Fe(o)&&c.length===0&&w.length===0)return;const M=[];if(!Fe(o)){const l=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(o,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;M.push(re.getTextAsMessage(l,$.System))}w.length>0&&M.push(re.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${w.map(l=>l.file_id).join(", ")}`,$.System)),c.length>0&&M.push(re.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${c.map(l=>l.file_id).join(", ")}`,$.System,{attachments:c.map(l=>({id:l.file_id,name:l.name,size:l.size}))})),M.length>0&&I.updateTree(s,l=>{let f=l.getNodeByIdOrMessageId(t).parentId;for(const x of M){const p=le();l.insertNodeBefore(t,{id:p,children:[],parentId:f,message:x,metadata:{isClientCreatedSystemMessage:!0}}),f=p}})}function Da(s,t,a){if(a.length===0)return;const i=le(),n=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${a.map(r=>`"${r.fileId}"`).join(", ")}`;I.updateTree(s,r=>{const o=r.getNodeByIdOrMessageId(t).parentId;r.insertNodeBefore(t,{id:i,children:[],parentId:o,message:re.getTextAsMessage(n,$.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Wa(s,t){const a="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",i=I.getThreadCurrentLeafId(s),n=I.getTree(s);let r=n.getNodeByIdOrMessageId(i);for(;r!=null&&r.message.author.role!==$.User;){if(r.message.content.content_type==="text"&&r.message.content.parts[0]===a)return;r=r.parentId!==""?n.getNodeByIdOrMessageId(r.parentId):void 0}I.updateTree(s,o=>{const d=o.getNodeByIdOrMessageId(t).parentId;o.insertNodeBefore(t,{id:le(),children:[],parentId:d,message:re.getTextAsMessage(a,$.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Ha(s,t){I.initThread(s,{kind:ie.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:t});const{data:a}=sa(),{data:i}=As(),n=ta(s,d=>d?.modelId)??rt(a,i).id,r=vs({clientThreadId:s});return async(d,m,c)=>{if(c.length===0)return;const w=new js;let M=I.getThreadCurrentLeafId(s);for(const k of c){const P=le();I.updateTree(s,y=>{y.addNodeToEnd(M,{id:P,children:[],parentId:M,message:re.getTextAsMessage(k,$.System),metadata:{isClientCreatedSystemMessage:!0}})}),I.setThreadCurrentLeafId(s,P),M=P}const l=M;Ks(s,l,d,m);const f={conversationMode:{kind:ie.GizmoMagicCreate,gizmo_id:d.current.id,behavior_overrides:t}},x=await Ve(),[p,T]=await Promise.all([Oe.getEnforcementToken(x),qe.getEnforcementToken(x)]);r({model:n,completionType:Ls.Next,parentNodeId:l,metadata:{},focusOnNewCompletion:!0,chatReq:x,turnstileToken:p,proofToken:T,preflightTime:0,completionMetadata:f,turnTracker:w})}}const $a="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",Va=Qe(()=>Ye(()=>import("./b9s9od8ovvq4l0ah.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));function qa(s,t){u.useEffect(()=>{const a=I.getTree(s);if(a.findNode(o=>o.message.author.role===$.User||o.metadata?.isClientCreatedSystemMessage===!0)||(I.deleteNodesByFilter(s,o=>o.metadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0),t==null||t.length===0))return;const n=I.getThreadCurrentLeafId(s);if(!a.hasNodeOrMessageId(n))return;const r=le();I.updateTree(s,o=>{o.addNode(r,t,n,$.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),I.setThreadCurrentLeafId(s,r)},[s,t])}function Qa(s,t,a){Ts(s,{kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}),u.useEffect(()=>{I.updateConversationMode(s,{kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a})},[s,t.id,a]);const[i]=u.useState(()=>{const n=t.id==null,r=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return n?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:r?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});qa(s,i)}function Ya({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,gizmoEditorDataRef:i,magicMakerBehaviorOverrides:n,magicMakerConversationGizmoEditorDataRef:r,requireGizmoId:o}){const d=u.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:n,getGizmoId:o}),[o,s,n]),m=lt(l=>l.files.filter(f=>f.status===B.Ready&&f.gizmoId!=null)),c=u.useCallback((l,f)=>{Da(l,f,m),Ks(l,f,i,r),Wa(l,f),t(x=>({...x,files:[...x.files??[],...Ke(m.map(p=>p.fileId!=null&&{file_id:p.fileId,name:p.file.name,size:p.file.size,type:ys(p.file),last_modified:p.file.lastModified,file_size_tokens:p.fileSpec?.fileTokenSize}))]})),r.current=bs(i.current)},[i,r,m,t]),w=Ms(l=>l.activeSidebar),M=Rs();return e.jsx(ws.Provider,{value:d,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:M?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%"},children:e.jsx(qs,{clientThreadId:a,preRequestCompletion:c,children:e.jsx(Qs,{hideHeader:!0,embedded:!0})})}):e.jsx(Vs,{clientThreadId:a,preRequestCompletion:c,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),w==="debug"&&e.jsx(Va,{clientThreadId:a,slideOver:!1,onClose:()=>ue.toggleActiveSidebar("debug"),isOpen:!0})]})})}const Ka=ps.memo(Ya);function Xa({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:r,showActionsModal:o,shareOnly:d,onClose:m}){const[c,w]=u.useState({type:"privacy"});return c.type==="privacy"?e.jsx(Ja,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:r,setStep:w,showActionsModal:o,shareOnly:d,onClose:m}):e.jsx(ei,{publishedGizmo:c.publishedGizmo,onClose:m})}function Za(s){return s?L.Workspace:L.Link}function Ja({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:r,setStep:o,showActionsModal:d,shareOnly:m,onClose:c}){const[w,M]=u.useState(!1),l=be(Ps.isBusinessWorkspace),f=V(),x=ne(),[p,T]=u.useState(Be(s)?Za(!!l):s.sharingRecipient),k=hs(),P=va(p,s.sharingTargets),{data:y,isLoading:R}=ct(),v=dt(),[h,C]=u.useState(t!=null&&t.gizmo.display.categories.length>0?v.data?.categories.find(b=>b.id===t.gizmo.display.categories[0])?.id:void 0);u.useEffect(()=>{C(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[N,E]=u.useState(void 0),A=u.useRef(ut((b,_)=>Re.generateCategory(b,_),1e3)),F=y?.is_verified?void 0:f.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});p===L.Marketplace&&F!=null&&!R&&T(L.Link);const D=l&&!s.sharingTargets?.some(b=>b.recipient===L.Link),z=Me(s,p,h),O=z.includes(te.MissingPublicActionPrivacyPolicyURL),Y=s.tools.find(b=>b.type===H.JIT_PLUGIN&&!b.metadata.privacy_policy_url),q=be(b=>b.currentWorkspace),K=Xe();u.useEffect(()=>{let b=!0;return(async()=>{try{if(h!=null)return;const _=await A.current(s.name,s.instructions);b&&h==null&&(_?C(_.id):E(!0))}catch{b&&h==null&&E(!0)}})(),()=>{b=!1}},[s.instructions,s.name,K,h]);const{value:fe}=we("4226692983");return e.jsx(Ze,{type:"success",isOpen:!0,onClose:c,title:e.jsx(g,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:P?e.jsx(ve,{color:"primary",disabled:z.length>0,loading:w,onClick:async()=>{try{if(M(!0),m){if(!t?.gizmo.id){x.danger(f.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const b=await Re.shareGizmo(t.gizmo.id,h?{sharing:he(p,[],xe),categories:[h]}:{sharing:he(p,[],xe)});b.error?(x.warning(f.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:b.sharing_targets}),r({gizmoId:t.gizmo.id,sharingRecipient:p,categories:t.gizmo.display.categories,moderationType:$s.PublishBlocked,sharingTargets:b.sharing_targets,showModal:de.AppealAvailable})):(k.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],_=>b.resource),a(_=>({..._,sharingRecipient:p})),x.success(f.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),c())}else{const b=await i({recipient:p,subjects:he(p,[],xe)},h);b?(o({type:"published",publishedGizmo:b}),a(_=>({..._,id:b.gizmo.id,sharingRecipient:p})),b.gizmo.live_version!=null&&a({liveVersion:b.gizmo.live_version}),x.success(f.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(x.warning(f.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),c())}}finally{M(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(g,{id:"SW4DG4",defaultMessage:"Save"})}):fe?e.jsx(e.Fragment,{children:e.jsx(ve,{color:"primary",onClick:async()=>{await n(p,h)},children:e.jsx(g,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(ve,{color:"secondary",onClick:b=>De(t,x,b,f.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(g,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Ss,{value:p,onValueChange:b=>T(b),children:[s.sharingTargets&&s.sharingTargets.map((b,_)=>e.jsx(_e,{value:b.recipient,disabled:b.recipient===L.Marketplace&&F!=null,tooltipText:b.recipient===L.Marketplace?F??f.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:b.recipient},_)),D&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{value:L.Link,disabled:!0,tooltipText:f.formatMessage(fs.workspaceDisabledHint),shareLevel:L.Link,workspaceName:q?.name}),e.jsx(_e,{value:L.Link,disabled:!0,tooltipText:f.formatMessage(fs.workspaceDisabledHint),shareLevel:L.Marketplace,workspaceName:q?.name})]})]})}),O&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:b=>e.jsx("button",{onClick:()=>{d(Y?.metadata.action_id)},className:"underline",children:b})}})}),p!==L.Private&&e.jsx(ja,{gizmo:s,category:h,categories:p===L.Marketplace?v.data?.categories??[]:void 0,onCategoryChange:p===L.Marketplace?b=>C(b.id):void 0}),p===L.Marketplace&&(N?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!P&&fe&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(g,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function ei({publishedGizmo:s,onClose:t}){const a=mt(s),i=V(),n=ne();return e.jsx(Ze,{type:"success",isOpen:!0,onClose:t,title:e.jsx(g,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(ve,{color:"primary",as:"link",to:a,children:e.jsx(g,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:a}),e.jsx("button",{onClick:r=>{De(s,n,r,i.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary","data-testid":"copy-saved-gpt-url-button",children:e.jsx(zs,{className:"icon-sm"})})]})})})}const fs=ce({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function _e({shareLevel:s,workspaceName:t,value:a,disabled:i=!1,tooltipText:n}){const r=u.useId();return e.jsx(ia,{disabled:n==null,label:n,side:"top",children:e.jsxs(ks,{id:r,value:a,disabled:i,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:r,className:"flex cursor-pointer items-center gap-1",children:e.jsx(ya,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(ft,{children:e.jsx(na,{className:"icon-lg mr-1"})})]})})}function Xs(s){window.history.length>1?s(-1):s(gt())}function si({gizmo:s,publishedGizmo:t,isUpsertLoading:a,isPromoteLoading:i,isUploadingProfilePic:n,isGeneratingProfilePic:r,updateGizmo:o,promoteGizmo:d,appealGizmo:m,setAppealState:c,showActionsModal:w}){const M=Te(),l=s!=null?Me(s):[];(s==null||i||a)&&l.push(te.Loading),n&&l.push(te.UploadingProfilePic),r&&l.push(te.GeneratingProfilePic);const f=Be(s),[x,p]=u.useState(!1),[T,k]=u.useState(!1),P=s.sharingRecipient?ms[s.sharingRecipient]:ms.private,y=i||a;return e.jsxs(e.Fragment,{children:[f?e.jsx(ae,{color:"primary",onClick:()=>p("promote"),loading:a,disabled:y||s.id===void 0||l.length>0,tooltip:l.length>0?l.map(ze).join(`
`):void 0,testId:"gizmo-editor-create-gpt-button",children:e.jsx(g,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{color:"secondary",loading:i||!t,disabled:y,icon:P,onClick:()=>p("share"),children:e.jsx(g,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(ae,{color:"primary",onClick:async()=>{let R=s.sharing.subjects.map(ba);const v=pt(s.sharing.subjects);R=he(s.sharing.recipient,R,v?.capabilities??xe),await d({recipient:s.sharing.recipient,subjects:R},t?.gizmo.display.categories[0])&&k(!0)},loading:a||!t,disabled:y||l.length>0,tooltip:l.length>0?l.map(ze).join(`
`):void 0,children:e.jsx(g,{id:"84QVoj",defaultMessage:"Update"})})]}),x&&(M?.getWorkspaceId()==null?e.jsx(Xa,{gizmo:s,publishedGizmo:t,promoteGizmo:d,appealGizmo:m,setAppealState:c,showActionsModal:w,updateGizmo:o,shareOnly:x==="share",onClose:()=>p(!1)}):e.jsx(Ma,{gizmo:s,publishedGizmo:t,promoteGizmo:d,appealGizmo:m,setAppealState:c,showActionsModal:w,updateGizmo:o,onClose:()=>p(!1),shareOnly:x==="share"})),T&&e.jsx(wa,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>k(!1),workspaceName:M?.data.name??""})]})}function ti({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const i=V(),n=ne(),r=me(),[o,d]=u.useState(!1),m=Xe(),{value:c}=we("3645668434");return!m?.includes("debug")&&s?.id==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(Es,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(ae,{color:"ghost",icon:ht}),children:[t!=null&&e.jsxs(Q.Item,{onClick:w=>{De(t,n,w)},children:[e.jsx(Ys,{className:"icon-sm"}),e.jsx(g,{...J.copyLink})]}),a!=null&&e.jsxs(Q.Item,{onClick:()=>{window.confirm(i.formatMessage(J.revertConfirm))&&a()},children:[e.jsx(xt,{className:"icon-sm"}),e.jsx(g,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&c&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(Q.Item,{onClick:()=>{r(`/g/${s.id}/view`)},children:[e.jsx(ka,{className:"icon-sm"}),e.jsx(g,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(Q.Item,{onClick:async()=>{const w=await Re.copyGizmo({gizmoId:s.id});w.gizmo.id&&r(`/gpts/editor/${w.gizmo.id}`)},children:[e.jsx(zs,{className:"icon-sm"}),e.jsx(g,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),s?.id!=null&&e.jsxs(Q.Item,{color:"danger",onClick:()=>{d(!0)},children:[e.jsx(vt,{className:"icon-sm"}),e.jsx(g,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),m?.includes("debug")&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),e.jsxs(Q.Item,{onClick:()=>{ue.toggleActiveSidebar("debug")},children:[e.jsx(Ca,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),o&&e.jsx(Ia,{gizmoId:s.id,onSuccess:()=>Xs(r),onClose:()=>{d(!1)}})]})}const pe=Us.div`flex items-center gap-1`;function ai({gizmoEditorData:s}){const t=be(a=>a.currentWorkspace?.name);switch(s.sharingRecipient){case L.Private:return e.jsxs(pe,{children:[e.jsx(bt,{className:"icon-xs"}),e.jsx(g,{...J.onlyMe})]});case L.Link:return e.jsxs(pe,{children:[e.jsx(Ys,{className:"icon-xs"}),e.jsx(g,{...J.anyoneWithLink})]});case L.Workspace:return e.jsxs(pe,{children:[e.jsx(yt,{className:"icon-xs"}),t]});case L.Marketplace:return e.jsxs(pe,{children:[e.jsx(jt,{className:"icon-xs"}),e.jsx(g,{...J.public})]});default:return e.jsx("div",{})}}function ii({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Cs,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(g,{...J.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Be(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(g,{...J.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===L.Marketplace?e.jsx(g,{...J.published}):e.jsx(g,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(ai,{gizmoEditorData:s})]})})]})]})}function ni({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:i,isGeneratingProfilePic:n,publishedGizmo:r,updateGizmo:o,promoteGizmo:d,appealGizmo:m,setAppealState:c,revertDraft:w,draftMessage:M,className:l,hasUnpublishedChanges:f,showActionsModal:x}){const p=me();return e.jsxs("div",{className:oe("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",l),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>Xs(p),children:e.jsx(ra,{className:"icon-lg"})}),e.jsx(ii,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[M,e.jsx(ti,{gizmoEditorData:s,publishedGizmo:r,revertDraft:w}),e.jsx(si,{gizmo:s,publishedGizmo:r,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:i,isGeneratingProfilePic:n,updateGizmo:o,promoteGizmo:d,appealGizmo:m,setAppealState:c,hasUnpublishedChanges:f,showActionsModal:x})]})]})}const J=ce({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),ri=512;function oi(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Je,{className:"h-1/4 w-1/4"})})}function li({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:i,setIsGeneratingProfilePic:n}){const r=V(),o=ne(),[d,m]=u.useState(void 0),c=u.useRef(t);u.useEffect(()=>{c.current=t});async function w(f){if(f.length>0){n(!1);const x=await Ct(f[0],ri),p=Ue(x);m({tempId:p,file:x,status:B.Uploading,progress:1,fileId:null,cdnUrl:null}),c.current("uploading"),It(p,x,r,o,Fs.ProfilePicture,{onFileCreated(T,k,P){m(y=>y!=="initial"&&y?.tempId===T&&y.status===B.Uploading?{...y,progress:10,fileId:k,cdnUrl:P}:y)},onFileUploadProgress(T,k){m(P=>P!=="initial"&&P?.tempId===T&&P.status===B.Uploading?{...P,progress:k}:P)},onFileUploaded(T,k,P){m(y=>y!=="initial"&&y?.tempId===T?(c.current(y),{...y,status:B.Ready,progress:100,fileSpec:{name:y.file.name,id:y.fileId,size:y.file.size,...P??{}}}):y)},onError(T){m(k=>{if(k!=="initial"&&k?.tempId===T){c.current(void 0);return}return k})}})}}const{open:M,getInputProps:l}=Is({disabled:!1,noClick:!0,onDropAccepted:w,onDropRejected:f=>Mt(f,r,o,wt.ProfilePicture),multiple:!0,maxSize:Ns,..._s(Tt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(Es,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:i?e.jsx(oi,{}):d!=null&&d!="initial"&&d.status!=B.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Pt,{file:d.file}),d.status===B.Uploading&&d.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(St,{percentage:d.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Cs,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(kt,{className:"text-4xl"})})}),children:[e.jsx(Q.Item,{onClick:M,children:e.jsx(g,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(Q.Item,{onClick:a,children:e.jsx(g,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...l()})]})}function ci({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:i}){const n=V(),r=ne(),[o,d]=u.useState(0),m=u.useRef(new Map),c=Nt(a,void 0),w=async h=>{Os.logEvent(Bs.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const C=await t();h.length>0&&await Promise.all(h.map(N=>{const E=Ue(N);m.current.set(E,{tempId:E,gizmoId:C,file:N,status:B.Uploading,progress:1,fileId:null,cdnUrl:null}),_t(Ue(N),N,n,r,{kind:Fs.Gizmo,gizmoId:C},{onFileUploaded:(A,F,D,z)=>{const O=m.current.get(A);O==null||O.fileId==null||(i(Y=>({...Y,files:[...Y.files??[],{file_id:O.fileId,name:O.file.name,size:O.file.size,type:z?.mimeType??ys(N),last_modified:O.file.lastModified,file_size_tokens:z?.fileTokenSize}]})),m.current.delete(A),d(Y=>Y+1))},onFileCreated:(A,F,D)=>{m.current.set(A,{tempId:A,gizmoId:C,file:N,status:B.Uploading,progress:1,...m.current.get(A),fileId:F,cdnUrl:D}),d(z=>z+1)},onFileUploadProgress:(A,F)=>{const D=m.current.get(A);D?.status===B.Uploading&&m.current.set(A,{...D,progress:F}),d(z=>z+1)},onError:A=>{m.current.delete(A)}},{usesRetrievalIndex:a!=null&&Ce(a,N.type,N.name)===Ie.Retrieval})}))},{getInputProps:M,open:l}=Is({disabled:!1,noClick:!0,onDropAccepted:w,multiple:!0,maxSize:Ns,maxFiles:10,..._s(c)}),f=s?.files??[];function x(h){return e.jsx(is,{onRemoveFileClick:()=>{m.current.delete(h.tempId),d(C=>C+1)},file:h.file,loadingPercentage:h.status===B.Uploading?h.progress:void 0},h.tempId)}function p(h){return e.jsx(is,{file:h.name,fileId:h.file_id,onRemoveFileClick:()=>i(C=>({...C,files:C?.files?.filter(N=>N.file_id!==h.file_id)})),gizmoId:s?.id},h.file_id)}const T=Array.from(m.current.values()).filter(h=>f.every(C=>C.file_id!==h.fileId)),[k,P]=as(T,h=>a!=null&&Ce(a,h.file.type,h.file.name)===Ie.CodeInterpreter),[y,R]=as(f,h=>a!=null&&h.type!=null&&Ce(a,h.type,h.name)===Ie.CodeInterpreter),v=u.useRef(y.length);return u.useEffect(()=>{y.length>v.current&&i(h=>h.tools?.some(C=>C.type===H.PYTHON)?h:{...h,tools:[...h.tools??[],{type:H.PYTHON}]}),v.current=y.length},[y.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(g,{...di.knowledgeWarning})}),P.length>0||R.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.map(x),R.map(p)]}):null,k.length>0||y.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(g,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.map(x),y.map(p)]})]}):null,e.jsx("div",{children:e.jsxs(ae,{onClick:l,children:[e.jsx("input",{...M()}),e.jsx(g,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const di=ce({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function ui({placeholder:s,text:t,onChange:a,onClose:i}){return e.jsx(Ze,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:i,primaryButton:e.jsx(ae,{onClick:i,children:e.jsx(g,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:n=>{a(n.target.value)},placeholder:s})})}const Ge=Us.div`text-sm text-red-500`;function mi({children:s,collapsed:t,initial:a}){return e.jsx(at,{initial:a,children:!t&&e.jsx(xs.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function fi({gizmo:s,onShowActionsEditor:t,isDisabled:a}){const i=V(),n=ne(),r=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((o,d)=>o.type!==H.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Ga,{isDisabled:a,actionTool:o,onShowActionsEditor:()=>t(o.metadata.domain)}),o.metadata.auth?.type==="oauth"&&e.jsx(zt,{label:i.formatMessage(U.callbackUrlLabel),value:`https://chat.openai.com/aip/${o.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},d)),(s?.tools?.filter(o=>o.type===H.JIT_PLUGIN)??[]).length>=ns?e.jsx("div",{children:i.formatMessage(U.maxActionsReached,{number:ns})}):e.jsx(ae,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(g,{...U.createActionLabel})})]});return a?e.jsx(Ds,{side:"top",label:i.formatMessage(U.disabledCustomActionsTooltip),children:r}):r}function gi(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===H.JIT_PLUGIN)}const pi=12;function hi({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:i,setIsUploadingProfilePic:n,isGeneratingProfilePic:r,setIsGeneratingProfilePic:o,requireGizmoId:d,onShowActionsEditor:m}){const c=s?.tools??[],[w,M]=u.useState(!1),[l,f]=u.useState(!0),x=s?.promptStarters??[],p=[...x,...x.length<pi?[""]:[]],T=Me(s),P=Te()?.isWorkspaceAccount(),y=Gs(je.WorkspaceGPTCustomActions),R=V();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(X,{children:[e.jsx(li,{gizmoEditorData:s,generateProfilePic:i,isGeneratingProfilePic:r,setIsGeneratingProfilePic:o,onFileChange:async v=>{if(v!=null&&v!=="uploading"&&v.fileId!=null){const h=await He.getFileDownloadLink(v.fileId);h.status===$e.Success&&t({profilePictureId:v.fileId!=null?v.fileId:void 0,profilePictureUrl:h.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(v==="uploading")}}),e.jsx(Z,{label:e.jsx(g,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(g,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ne,{type:"text",placeholder:R.formatMessage(U.gptNamePlaceholder),value:s?.name??"",onChange:v=>{t({name:v.target.value})},onBlurCapture:()=>t(v=>({...v,name:v.name.trim()})),"data-testid":"gizmo-name-input"}),T.includes(te.GizmoNameTooLong)?e.jsx(Ge,{className:"mt-1",children:e.jsx(g,{...U.nameTooLong,values:{length:Gt}})}):null]}),e.jsxs(X,{className:"mt-4",children:[e.jsx(Z,{label:e.jsx(g,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(g,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ne,{type:"text",placeholder:R.formatMessage(U.descriptionPlaceholder),value:s?.description??"",onChange:v=>t({description:v.target.value}),onBlurCapture:()=>t(v=>({...v,description:v.description?.trim()??""})),"data-testid":"gizmo-description-input"}),T.includes(te.GizmoDescriptionTooLong)?e.jsx(Ge,{className:"mt-1",children:e.jsx(g,{...U.descriptionTooLong,values:{length:At}})}):null]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:R.formatMessage(U.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(_a,{className:"resize-none",rows:8,value:s?.instructions,onChange:v=>t({instructions:v.target.value}),onBlurCapture:()=>t(v=>({...v,instructions:v.instructions.trim()})),placeholder:R.formatMessage(U.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>M(!0),children:e.jsx(Na,{className:"icon-sm"})})]}),T.includes(te.GizmoInstructionsTooLong)?e.jsx(Ge,{className:"mt-1",children:e.jsx(g,{...U.instructionsTooLong,values:{length:Lt}})}):null]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(g,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:p.map((v,h)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ne,{className:"rounded-r-none",value:v,type:"text",onChange:C=>{const N=C.target.value;t(E=>({...E,promptStarters:Ke(h>=(x.length??0)?[...x??[],N]:x.map((A,F)=>F===h?N===""?void 0:N:A))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(C=>({...C,promptStarters:x.filter((N,E)=>E!==h)})),children:e.jsx(oa,{className:"icon-sm"})})]},h))})]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:R.formatMessage(U.knowledgeExplanation)}),e.jsx(ci,{gizmoEditorData:s,requireGizmoId:d,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(g,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Aa,{enabledTools:c,onEnabledToolsChange:v=>t({tools:v})})]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(g,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(fi,{isDisabled:!!(P&&!y),gizmo:s,onShowActionsEditor:m})]}),!P&&gi(s)&&e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!l,onClick:()=>{f(v=>!v)}}),e.jsx(mi,{collapsed:l,initial:!1,children:e.jsx(Rt,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(g,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),w&&e.jsx(ui,{text:s.instructions??"",onChange:v=>{t({instructions:v})},onClose:()=>M(!1),placeholder:R.formatMessage(U.instructionsSubtitle)})]})}const U=ce({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function xi(s,t){const a=Ws(s);if(!Array.isArray(s.detail))return a;const i=Ke(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(U.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(U.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(U.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return i.length>0?i.join(`
`):a}function vi({upsertDraftError:s}){const t=V(),a=xi(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(g,{...Zs.errorSavingDraft})}),a!=null&&e.jsx(Ds,{label:a,children:e.jsx(Ut,{className:"icon-sm"})})]})}function ji({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:i,className:n}){return i instanceof la?e.jsx(vi,{upsertDraftError:i}):a?e.jsxs("div",{className:oe("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(g,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(g,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(Je,{})})]}):null}const Zs=ce({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),yi=Qe(()=>Ye(()=>import("./b9s9od8ovvq4l0ah.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));var bi=(s=>(s.TestGizmoAction="test_gizmo_action",s))(bi||{});const Mi=new ca;function wi({gizmoEditorData:s,isSavingDraft:t,currentModelConfig:a,showTitle:i=!0}){const[n,r]=u.useState(()=>ye());Ts(n,{kind:ie.GizmoTest,gizmo_id:s.id}),u.useEffect(()=>{I.updateConversationMode(n,{kind:ie.GizmoTest,gizmo_id:s.id})},[n,s.id]);const o=s.files?.map(T=>T.file_id).join();u.useEffect(()=>{I.getServerThreadId(n)!=null&&r(ye())},[s.id,s.instructions,s.tools,o,n]);const d=Ms(T=>T.activeSidebar),m=u.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[c,w]=u.useState(0),M=()=>{w(T=>T-360)},l=s.id,f=Ti(n,a);u.useEffect(()=>Hs(Mi,{test_gizmo_action:({rootDomain:T,operationName:k})=>{l&&f(l,T,k)}}),[f,l]);const x=Rs(),p=u.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(za,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(ws.Provider,{value:m,children:e.jsx(Et,{clientThreadId:n,children:e.jsxs("div",{className:oe("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:i&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{M(),r(ye())},className:"flex items-center gap-2",children:[e.jsx(g,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(xs.div,{className:"text-token-text-primary",animate:{rotate:c},transition:{duration:.3},children:e.jsx(Ft,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsxs("div",{className:oe("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[x?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%","--chat-screen-thread-parent-background":"var(--main-surface-secondary)"},children:e.jsx(qs,{clientThreadId:n,children:e.jsx(Qs,{hideHeader:!0,embedded:!0,renderEmptyState:p})})}):e.jsx(Vs,{clientThreadId:n,hideHeader:!0,renderEmptyState:p()}),e.jsx(La.Sidebars,{children:e.jsx(Ra,{clientThreadId:n,overrideWidth:0,isAutoFocusDisabled:!0})})]})]}),d==="debug"&&e.jsx(yi,{clientThreadId:n,slideOver:!1,onClose:()=>ue.toggleActiveSidebar("debug"),isOpen:!0})]})})})}const gs=ps.memo(wi);function Ti(s,t){const a=vs({clientThreadId:s});return u.useCallback(async(n,r,o)=>{if(!t)return;const d=new js,m=I.getThreadCurrentLeafId(s),c=le(),w=Ot(r);I.updateTree(s,p=>{p.addNodeToEnd(m,{id:c,children:[],parentId:m,message:{id:c,author:{role:$.User},content:{content_type:da.Text,parts:[`Call the ${r} API with the ${o} operation`]},recipient:"all",metadata:{jit_plugin_data:{from_client:{type:"test",operation:o,tool_name:w}}}}})});const M={conversationMode:{kind:ie.GizmoTest,gizmo_id:n}},l=await Ve(),[f,x]=await Promise.all([Oe.getEnforcementToken(l),qe.getEnforcementToken(l)]);a({model:t.id,completionType:Ls.Next,parentNodeId:c,metadata:{},focusOnNewCompletion:!0,chatReq:l,turnstileToken:f,proofToken:x,preflightTime:0,completionMetadata:M,turnTracker:d})},[s,a,t])}const Pi=Qe(()=>Ye(()=>import("./e16evjtphcrwbvc6.js"),__vite__mapDeps([13,2,1,3,14,4,5,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,12,39,40,8,10,41,42,43,44,6,45,46,47,48,49,50,51])).then(s=>s.GizmoActionsEditor));var Js=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Js||{});function Ae({value:s,label:t,testId:a}){return e.jsx(ks,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2","data-testid":a,children:t})}function Si({className:s,editorTab:t,setEditorTab:a}){const i=V(),{value:n}=we("1393076427");return e.jsxs(Ss,{className:oe("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:r=>{a(r)},children:[n&&e.jsx(Ae,{value:"magic",label:i.formatMessage(Le.magicMakerLabel)}),e.jsx(Ae,{value:"advanced",label:i.formatMessage(Le.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Ae,{value:"preview",label:i.formatMessage(Le.previewLabel)})})]})}function ki(s,t){return s.length!==t.length?!1:s.every(a=>t.some(i=>i.type===a.type))}function Ci(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&ki(s.tools,t.tools)&&We(s.files?.map(a=>a.file_id)??[],t.files?.map(a=>a.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const et=({gizmo:s,onNewGizmoId:t})=>{const a=hs(),i=Xe(),n=Gs(je.BrowsingAvailable),r=i?.includes(je.GizmoCanvasToggle)&&i?.includes(je.Canvas),o=V(),d=ne(),m=()=>{const j=[];return n&&j.push({type:H.BROWSER}),r&&j.push({type:H.CANVAS}),{...ls,tools:[...ls.tools,...j]}},c=u.useRef(s!=null?rs(s):m()),w=u.useRef(s),M=u.useRef(c.current),[l,f]=u.useState(()=>c.current),[x,p]=u.useState(()=>ye()),[T]=u.useState(()=>({context_message:Ba(c.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));Qa(x,M.current,T);const{data:k}=As(),P=(k&&Sa(k.models.values(),j=>j.tags.includes(ua.GPT_4)))??k?.models.get(Vt),{data:y}=qt(c.current.id),R=Qt(),{isPending:v,error:h}=R,C=Yt(),N=u.useMemo(()=>y!=null&&!Ci(l,y),[l,y]),E=async()=>{const j=c.current;try{const S=await R.mutateAsync({editorData:j,gizmoId:j.id});if(w.current=S,c.current.id==null){const G=S.gizmo.id;c.current={...c.current,id:G,sharingTargets:S.gizmo.sharing_targets},f(c.current),t?.(G)}for(const G of S.tools.filter(W=>W.type===H.JIT_PLUGIN)){const W=c.current.tools.find(ee=>ee.type===H.JIT_PLUGIN&&ee.metadata.domain===G.metadata.domain);W&&W.metadata.action_id!==G.metadata.action_id&&(W.metadata={...W.metadata,action_id:G.metadata.action_id},f(c.current))}return S}catch(S){const G=Ws(S)??o.formatMessage(Zs.errorSavingDraft);throw d.warning(G,{duration:2}),S}},A=u.useRef(void 0),F=async()=>c.current.id!=null?c.current.id:(A.current==null&&(A.current=E().then(j=>j.gizmo.id).catch(j=>{throw A.current=void 0,j})),A.current),[D]=u.useState(()=>Kt(()=>E(),2e3,{trailing:!0})),z=u.useCallback((j,S=!0)=>{const G=typeof j=="function"?j(c.current):Xt(c.current,j);We(G,c.current)||(c.current=G,f(c.current),S&&D())},[D]),O=u.useRef(void 0);u.useEffect(()=>Hs(ma,{completionFinished:async j=>{const S=j.serverThreadId;if(S==null){ge(!1);return}try{const G=await Oa(c.current,S,d,O.current);G!=null&&(z(G),M.current=bs(c.current))}catch(G){Ee.addError(G),d.warning("Something went wrong generating your GPT",{duration:3})}finally{O.current=I.getThreadCurrentLeafId(S),ge(!1)}}}),[d,z]);const Y=Ha(x,T),[q,K]=u.useState(void 0);u.useEffect(()=>{K(Ta(s))},[s?.gizmo.id]);const fe=async(j,S)=>{const G=Me(c.current,j.recipient,S);if(G.length>0){d.warning(`Could not save GPT:

${G.map(se=>`- ${ze(se)}`).join(`
`)}`,{duration:3});return}const W=await E(),ee=W.gizmo.id;try{return Os.logEvent(Bs.promoteGizmo,{gizmo_id:W.gizmo.id,sharing_recipient:j.recipient,editor_tab:_}),await C.mutateAsync({gizmoId:W.gizmo.id,data:{sharingSubjects:j.subjects,sharingRecipient:j.recipient,categories:S==null?void 0:[S]}},{onSuccess(ke){a.setQueryData(os(a,ee).queryKey,ke),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:ee}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:ee}]})}})}catch(se){if(se instanceof Zt)K({gizmoId:ee,sharingRecipient:j.recipient,moderationType:$s.PublishBlocked,sharingTargets:se.response?.sharing_targets,showModal:de.AppealAvailable});else{Ee.addError(se);const ke=se.detail??"An unknown error occurred";d.warning("Error saving GPT - "+ke,{duration:6})}}},{value:b}=we("1393076427"),[_,es]=u.useState(()=>{if(!b)return"advanced";const j=ds.getItem(us.GizmoEditorTab);return Object.values(Js).includes(j)?j:"magic"}),Pe=fa.useState(({windowWidth:j})=>j);u.useEffect(()=>{Pe!=null&&Pe>=768&&_==="preview"&&es("magic")},[Pe,_]);const[st,tt]=u.useState(!1),[ss,ge]=u.useState(!1),[ts,Se]=u.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(ni,{gizmoEditorData:l,isUpsertLoading:R.isPending,isPromoteLoading:C.isPending,hasUnpublishedChanges:N,isUploadingProfilePic:st,isGeneratingProfilePic:ss,publishedGizmo:y,updateGizmo:z,promoteGizmo:async(j,S)=>{const G=await fe(j,S);return c.current={...c.current,sharingRecipient:j.recipient},f(c.current),ds.setItem(us.GizmoEditorTab,_),G},appealGizmo:async(j,S)=>{q!=null&&K({...q,sharingRecipient:j,categories:S==null?void 0:[S],showModal:de.AppealAvailable})},setAppealState:K,revertDraft:y!=null&&N?()=>{const j=a.getQueryData(os(a,c.current.id).queryKey);if(j!=null){const S=rs(j);c.current=S,f(S),E()}}:void 0,draftMessage:e.jsx(ji,{isPublished:y!=null&&(y.gizmo.share_recipient==="marketplace"||y.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:N,isSavingDraft:v,upsertDraftError:h,className:"text-sm"}),showActionsModal:j=>{Se(j)},className:"flex-shrink-0"}),q&&e.jsx(Pa,{appealState:q,onAppealClose:()=>K({...q,showModal:de.None}),onAppealSubmitted:()=>K({...q,showModal:de.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:ts!==void 0?e.jsx(Pi,{currentlyEditingActionDomain:ts,gizmoEditorData:l,updateGizmo:z,onClose:()=>{Se(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Si,{editorTab:_,setEditorTab:es,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:_==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx(Ka,{gizmoEditorData:l,updateGizmo:z,clientThreadId:x,gizmoEditorDataRef:c,magicMakerBehaviorOverrides:T,magicMakerConversationGizmoEditorDataRef:M,requireGizmoId:F},x)}):_==="advanced"?e.jsx(hi,{gizmoEditorData:l,updateGizmo:z,currentModelConfig:P,generateProfilePic:()=>{ge(!0),Y(c,M,[$a])},setIsUploadingProfilePic:tt,isGeneratingProfilePic:ss,setIsGeneratingProfilePic:ge,requireGizmoId:F,onShowActionsEditor:j=>{Se(j)}}):e.jsx(gs,{gizmoEditorData:l,currentModelConfig:P,isSavingDraft:v,showTitle:!1})})]})})}),e.jsx("div",{className:oe("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",_!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5",children:e.jsx("div",{className:"h-full",children:e.jsx(gs,{gizmoEditorData:l,currentModelConfig:P,isSavingDraft:v})})})})]})]})};function Ii({gizmoId:s,version:t}){const{data:a}=Wt({gizmoId:s,draft:!0,version:t}),i=be(Ps.accountUserId),r=Ht()?.id,o=a!=null&&i!=null&&r!=null&&$t(a);return a==null||!o?null:e.jsx(et,{gizmo:a})}function Ni({onNewGizmoId:s}){return e.jsx(et,{onNewGizmoId:s})}const _i=({gizmoId:s,remixSourceId:t,version:a})=>{const i=me(),n=Te(),r=u.useRef(void 0);u.useEffect(()=>(ue.enterGizmoEditor(),()=>{ue.exitGizmoEditor()}),[]);let o=s;return s!=null&&r.current===s&&(o=void 0),Bt({resetThreadAction:()=>{i("/")}}),n?.data?o!==void 0?e.jsx(Ii,{gizmoId:o,version:a},o):e.jsx(Ni,{remixSourceId:t,onNewGizmoId:d=>{r.current=d,window.history.replaceState(window.history.state,"",Dt(d))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Je,{})})},Le=ce({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Gi(s){const t=me();u.useEffect(()=>{s||t(ga(pa.NO_ACCESS))},[s,t])}const Zi=()=>(xa(),null);function Ji(){const s=Te();Gi(s==null||s.canCreateGPTs());const t=it(),[a]=nt(),i=me(),n=t.slug,r=a.get("version"),o=n?ha(n):void 0,d=a.get("remixFrom");return u.useEffect(()=>{Ve(!0).then(m=>{Oe.initializeAndGatherData(m),qe.initializeAndGatherData(m)})},[]),u.useEffect(()=>{s!=null&&!s.canCreateGPTs()&&i("/")},[s,i]),u.useEffect(()=>{o&&cs(o)&&i(`/g/${n}/project`)},[o,i,n]),!s?.canCreateGPTs()||o&&cs(o)?null:e.jsx(Jt,{children:e.jsx(_i,{gizmoId:o,remixSourceId:d??void 0,version:r!=null?Number(r):void 0})})}export{Mi as G,bi as a,Ji as b,Zi as c};
//# sourceMappingURL=aw14hjm3lff48thd.js.map
