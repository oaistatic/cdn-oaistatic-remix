const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/oy602885cmig2wxq.js","assets/i8w88cc8b3gds516.js","assets/eh26o1l35t2fnjj4.js","assets/root-inht5vcp.css","assets/c70tulx9zqykyr6q.js","assets/jg63sxiyqeyvfv9f.js","assets/conversation-small-nranh1cg.css","assets/csrl3w0fj8safzqi.js","assets/hexd96uzgi4jb5l2.js","assets/nxfut771jrp9zvqt.js","assets/hs5tlpw8ekg8n8pe.js","assets/h2nc3qmtjg2iytti.js","assets/kqwdyvkaaavvn8k3.js","assets/ic47xq5w4y1obgxq.js","assets/d15pccfai4sxnie0.js","assets/n2sybeqm169dymt4.js","assets/gu9x9uhdpum7obxj.js","assets/e7ldcb1pybd2xac9.js","assets/bxo0vudykvsyb7bg.js","assets/n8m3m0h2ftmj7gzg.js"])))=>i.map(i=>d[i]);
import{c as ee,j as f,M as ae,r as C,ac as P,v as Hh,ad as dt,aA as Vh,aB as Fh,av as _h,ar as Wh,a as tr,b as qh,h as zh}from"./i8w88cc8b3gds516.js";import{dV as jr,dW as Br,kK as Uh,h2 as $h,pO as ir,pK as Gh,t as sr,h8 as nr,h9 as xs,cU as kt,E as Kh,kM as Yh,pP as Zh,pQ as zt,bF as nl,lw as Xh,lx as Jh,pR as Qh,cV as We,oE as ec,oz as tc,hV as ic,ab as rl,ac as ol,ae as ll,af as al,pS as Mt,pT as sc,e3 as rr,di as nc,ko as rc,pU as Ce,pN as oc,dL as Oe,oD as Ds,pH as lc,pV as ac,pW as an,dM as jt,gH as hc,pX as hl,eD as cc,pY as uc,ar as dc,N as Si,ik as fc,ja as mc,hc as gc,gY as pc,pZ as cl,p_ as ul,p$ as dl,q0 as xc,q1 as fl,q2 as Cc,Y as wc,jP as yc,W as bc,i2 as vc,c6 as Sc,q3 as kc,q4 as ml,q5 as Mc,q6 as Ec,j as Ac,q7 as hn,ni as gl,q8 as Tc,q9 as Oc,qa as Dc,gO as ci,qb as Lc,qc as Rc,gD as Nc,qd as Ic,gl as Pc,qe as jc,cR as Bc,qf as Hc,qg as Vc,qh as Fc,qi as _c,qj as Wc,qk as qc,cS as zc,cT as Uc,cW as $c,kL as Hr,ql as Gc,g as Kc,qm as Yc,qn as Zc,qo as Vr,qp as Fr,nF as Xc,qq as Gi,qr as _r}from"./jg63sxiyqeyvfv9f.js";import{co as Jc,cp as os,D as cn,an as D,hV as Qc,b as ki,ar as eu,bB as Cs,bC as ws,cD as tu,cE as iu,e8 as su,f as st,cA as nu,cB as ru,c as ou,eK as E,bn as Ut,b9 as ze,aM as lu,aN as pl,bW as au,cO as hu,b5 as xl,y as or,o as ys,B as Mi,R as Ls,fb as ji,bM as cu,gH as uu,bO as ni,ai as du,aj as fu,h as un,C as mu,a1 as gu,bm as ri,ey as Cl,ek as pu,r as bs,aa as xu,eb as lr,P as Wr,j as qr,c3 as wl,b6 as yl,ga as bl,bA as Cu,hW as wu,hX as yu,bQ as bu,bR as vu,Y as Su,bU as ku,hY as zr,ak as Mu,al as Eu,eA as Au}from"./eh26o1l35t2fnjj4.js";import{T as Rs,e as Tu,m as Ou,H as Du,a as vl,Z as gi,E as Lu,l as Ru,q as Nu,O as Sl,N as kl,c as Bt,g as Iu,A as Pu,b as ju,d as Bu,C as It,D as Hu}from"./e34qym7psp0g3xzr.js";import{S as Vu}from"./bu3dsffychuyne68.js";import{C as Fu}from"./h2nc3qmtjg2iytti.js";import{S as _u}from"./dzq0v9msooejtdz0.js";import{a7 as Wu,T as qu,a9 as zu,o as Uu}from"./dyuarriie396ezxd.js";import{i as $u}from"./ens1ascotkzlvvvm.js";import{C as Gu}from"./h5ki4u1sjcr6cdl0.js";import{a as Ku,g as Yu}from"./c3ew5w7qbxkccpqx.js";import{S as Zu}from"./gdsmqpdlbx03h3zp.js";import{S as Xu}from"./itdemlts8gcqwi6k.js";import{P as Ju}from"./n2sybeqm169dymt4.js";import{u as Qu}from"./c70tulx9zqykyr6q.js";import{u as Ur}from"./f26tq0bcmxctgqq5.js";var Ml=(s=>(s.Close="close",s.Loaded="loaded",s.Streaming="streaming",s.Download="download",s))(Ml||{}),dn=(s=>(s[s.ALLOW=0]="ALLOW",s[s.ALWAYS_ALLOW=1]="ALWAYS_ALLOW",s[s.DENY=2]="DENY",s))(dn||{});const ed=({url:s,origin:e,onConfirm:t})=>{const i=ee(),n=r=>()=>{t?.(r)};return f.jsx(Jc,{isOpen:!0,onClose:n(2),type:"success",title:f.jsx("span",{className:"text-xl",children:f.jsx(ae,{id:"msqPag",defaultMessage:"Network access requested"})}),description:f.jsxs(f.Fragment,{children:[f.jsx("span",{className:"-mb-2 mt-3 block text-token-text-secondary",children:f.jsx(ae,{id:"LyVt91",defaultMessage:"Allow your canvas code to access {url}?",values:{url:s}})}),f.jsx("span",{className:"mt-3 block text-token-text-secondary",children:f.jsx(ae,{id:"wDp4+c",defaultMessage:"You are in control. If you don't recognize the domain {origin}, deny the request.",values:{origin:e}})})]}),primaryButton:f.jsx(os.Button,{title:i.formatMessage({id:"ZeMrpd",defaultMessage:"Allow"}),color:"primary",onClick:n(0)}),secondaryButton:f.jsxs(f.Fragment,{children:[f.jsx(os.Button,{title:i.formatMessage({id:"rkqA7R",defaultMessage:"Always allow"}),color:"secondary",onClick:n(1)}),f.jsx(os.Button,{title:i.formatMessage({id:"rIvK32",defaultMessage:"Deny"}),color:"secondary",onClick:n(2)})]})})},td=({instrument:s})=>{switch(s.type){case"perf":return jr.hist(Br.WEB_SANDBOX,s.label,void 0,s.time);case"count":return jr.count(Br.WEB_SANDBOX,s.label,void 0,s.count);case"error":return cn.addError(s.error)}},id="https://persistent.oaistatic.com/canvas/loop-swirl.mp4",Ke=80,sd=({title:s,checkpoints:e,activeCheckpointId:t,isComplete:i,onTransitionComplete:n})=>{const[r,o]=C.useState(!1),[l,a]=C.useState(!1),[c,h]=C.useState(0),u=e.findIndex(w=>w.id===t),d=e[u];C.useEffect(()=>{if(!d)return;const w=e.length,y=u*100/w,S=(u+1)*100/w;h(y);let b,v=null;const k=5/d.estimatedTime,O=A=>{v==null&&(v=A);const R=A-v;if(R!==0){const j=S-y,B=y+j*(1-Math.exp(-k*R));h(Math.min(B,S-1e-4))}setTimeout(()=>{b=requestAnimationFrame(O)},16)};return b=requestAnimationFrame(O),()=>cancelAnimationFrame(b)},[u]);const m=()=>{i&&(n?.(),a(!0))},[{width:g,height:p},x]=Uh();return f.jsx(P.div,{ref:x,className:"relative flex h-full w-full items-center justify-center bg-token-main-surface-primary",transition:{type:"spring",bounce:0},children:f.jsxs(P.div,{className:"flex flex-col items-center gap-3",style:{minWidth:Ke,height:Ke},initial:{filter:"blur(16px)",scale:1.5,opacity:0},animate:{filter:"blur(0px)",scale:1,opacity:1},transition:{type:"spring",duration:.5,bounce:0},children:[f.jsxs(P.div,{className:"absolute overflow-hidden bg-blue-250 shadow-2xl",initial:!1,animate:{width:Ke,height:Ke,scaleX:l?g/Ke:1,scaleY:l?p/Ke:1,borderRadius:l?0:16,opacity:l?0:1},transition:{type:"spring",duration:1.2,bounce:0},children:[f.jsx("video",{muted:!0,loop:!0,autoPlay:!0,playsInline:!0,src:id,onLoadedData:()=>o(!0),className:D("absolute inset-0 z-0 h-full w-full object-cover transition-opacity duration-200",r?"opacity-100":"opacity-0")}),f.jsx("div",{className:D("relative z-10 flex h-full w-full items-center justify-center transition-opacity duration-100",l?"opacity-0":"opacity-100"),children:f.jsx($h,{sizeOverride:60,className:"text-white",backgroundStrokeClassName:"stroke-[rgba(0,0,0,0.1)]",percentage:i?100:c,onTransitionEnd:m,transitionDuration:"150ms",transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})})]}),f.jsxs(P.div,{className:D("flex flex-col items-center transition-opacity duration-200",i?"opacity-0":"opacity-100"),style:{translateY:Ke+8},children:[f.jsx("span",{className:"font-bold text-token-text-primary",children:s}),d&&f.jsxs(P.span,{className:"flex items-baseline text-token-text-secondary",children:[d.label," ",f.jsx(Rs,{gap:2,size:2})]})]})]})})};var Q=(s=>(s.READY="ready",s.LOG="log",s.RUN_START="run_start",s.ENVIRONMENT_STATUS="environment_status",s.ENVIRONMENT_ERROR="environment_error",s.INSTRUMENT="instrument",s.OUTPUT="output",s.ERROR="error",s.RUN_COMPLETE="run_complete",s.FETCH_REQUEST="fetch_request",s))(Q||{});const nd=["python","javascript","typescript","html","react"];function rd(s){return nd.includes(s)}var Xe=(s=>(s[s.INITIALIZING=0]="INITIALIZING",s[s.INSTALLING_PACKAGES=1]="INSTALLING_PACKAGES",s[s.RUNNING_CODE=2]="RUNNING_CODE",s))(Xe||{}),wt=(s=>(s.RUN_CODE="run",s.STOP_CODE="stop",s.FETCH_RESPONSE="fetch_response",s.PREPARE_ENVIRONMENT="prepare_environment",s))(wt||{});const od="{{.sandboxHost}}/index.html",ld=`https://${od}`,ad=["https://cdn.jsdelivr.net","https://cdn.tailwindcss.com","https://esm.sh","https://unpkg.com","https://pypi.org","https://files.pythonhosted.org"],hd=()=>"?"+["",""].filter(Boolean).join("&");function cd(){let s=null;const e=new Promise(t=>s=t);return{resolve:s,promise:e}}function ud(s){let e=null;const t=[];let i=!1;return s.on("message",n=>{e?(e({value:n,done:i}),e=null):t.push(n),n.type===Q.RUN_COMPLETE&&(i=!0)}),{[Symbol.asyncIterator](){return this},next(){if(t.length>0){const n=t.shift();return Promise.resolve({value:n,done:i})}return i?Promise.resolve({value:void 0,done:i}):new Promise(n=>{e=n})}}}const $r=()=>Gh(Cs.getItem(ws.CODE_EXECUTION_DOMAIN_ALLOW_LIST),sr,[]),dd=[{id:Xe.INITIALIZING,label:"Initializing environment",estimatedTime:1e3},{id:Xe.INSTALLING_PACKAGES,label:"Installing packages",estimatedTime:2e3},{id:Xe.RUNNING_CODE,label:"Ready",estimatedTime:1}],fd=({visuallyHidden:s,title:e},t)=>{const[i,n]=C.useState([]),r=C.useRef(null),[o]=C.useState(cd),[l,a]=C.useState(null),[c,h]=C.useState(!1),u=C.useRef(null),d=C.useRef(new Map),m=C.useCallback(b=>{u.current?.postMessage(b)},[]),g=C.useCallback(()=>{const b=d.current.keys();a(null),h(!1);for(const v of b)m({type:wt.STOP_CODE,runId:v})},[m]),p=C.useCallback(async function*(b){if(await o.promise,d.current.size!==0)return g();const v=Hh(),k=new Qc;d.current.set(v,k);const O={...b,type:wt.RUN_CODE,runId:v};m(O),a(Xe.INITIALIZING);for await(const A of ud(k))A&&A.type===Q.ENVIRONMENT_STATUS&&a(A.status),A&&!ir([Q.FETCH_REQUEST,Q.READY],A.type)&&(yield A);d.current.delete(v)},[o.promise,m,g]),x=C.useCallback(async b=>{await o.promise,m({type:wt.PREPARE_ENVIRONMENT,language:b})},[o.promise,m]),w=C.useCallback(({url:b,requestId:v})=>{try{const{origin:k}=new URL(b);if($r().concat(ad).includes(k))return m({type:wt.FETCH_RESPONSE,isApproved:!0,requestId:v});n(A=>[...A,{url:b,origin:k,requestId:v}])}catch(k){cn.addError(k),m({type:wt.FETCH_RESPONSE,isApproved:!1,requestId:v})}},[m]);C.useImperativeHandle(t,()=>({stop:g,evalAsync:p,prepareEnvironment:x})),C.useEffect(()=>ki(window,{message:b=>{if(b.source!==r?.current?.contentWindow)return;const{data:v,ports:k}=b,{type:O}=v;if(u.current=k[0],O===Q.READY)return o.resolve?.();if(O===Q.FETCH_REQUEST)return w(v);if(O===Q.INSTRUMENT)return td(v);const{runId:A}=v,R=A&&d.current.get(A);R?R.emit("message",v):cn.addError("Code execution error: missing event emitter",{messageData:b.data})}}),[o,w]);const y=(b,v)=>{n(A=>A.filter(({requestId:R})=>R!==b.requestId));const{requestId:k,origin:O}=b;m({type:wt.FETCH_RESPONSE,isApproved:v!==dn.DENY,requestId:k}),v===dn.ALWAYS_ALLOW&&Cs.setItem(ws.CODE_EXECUTION_DOMAIN_ALLOW_LIST,[...$r(),O])},S=i[0];return f.jsxs(eu,{children:[f.jsxs("div",{className:D("relative flex",s?"fixed h-0 w-0":"h-full w-full"),children:[!s&&l!=null&&f.jsx(sd,{isComplete:l===Xe.RUNNING_CODE,onTransitionComplete:()=>h(!0),activeCheckpointId:l,title:e,checkpoints:dd}),f.jsx(P.div,{layout:!0,className:D("absolute inset-0 m-auto origin-center overflow-hidden bg-token-main-surface-primary",c?"pointer-events-auto":"pointer-events-none"),style:c?{width:void 0,height:void 0}:{width:Ke,height:Ke},animate:{opacity:c?1:0},transition:{type:"spring",duration:c?1.2:0,bounce:0},children:f.jsx(P.iframe,{title:e,className:"h-full w-full overflow-hidden",animate:{borderRadius:c?0:200},transition:{type:"spring",duration:1.2,bounce:0},"aria-hidden":s?"true":void 0,src:`${ld}${hd()}`,sandbox:"allow-scripts allow-same-origin",ref:r,tabIndex:-1})})]}),S&&f.jsx(ed,{url:S.url,origin:S.origin,onConfirm:b=>y(S,b)})]})},md=C.forwardRef(fd),Ns="https://persistent.oaistatic.com/canvas/nux-videos/",gd=`${Ns}canvas_writing.mp4`,pd=`${Ns}canvas_coding.mp4`,xd=`${Ns}canvas_writing_hero.jpg`,Cd=`${Ns}canvas_coding_hero.jpg`,wd="https://help.openai.com/en/articles/9930697-what-is-the-canvas-feature-in-chatgpt-and-how-do-i-use-it",yd=({onClose:s,title:e,description:t,asset:i,size:n})=>{const r=ee(),o=i===0;return f.jsxs("div",{className:"flex flex-col items-center focus:outline-none",children:[f.jsx("div",{className:"relative flex w-full items-center justify-center overflow-hidden border-b border-token-border-light bg-token-main-surface-secondary text-token-text-secondary",style:{height:n===1?252:218},children:f.jsx("video",{muted:!0,loop:!0,autoPlay:!0,playsInline:!0,className:"h-full max-w-none",poster:o?xd:Cd,src:o?gd:pd})}),f.jsxs("div",{className:"flex flex-col items-center gap-4 px-10 py-8",children:[f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsx(nu,{className:"text-center text-xl font-semibold leading-6",children:f.jsx(ae,{...e})}),f.jsx(ru,{className:"text-center text-sm text-token-text-secondary",children:f.jsx(ae,{...t})})]}),f.jsx(os.Button,{onClick:s,title:r.formatMessage(Ht.button),color:"primary"}),f.jsxs(Kh,{href:wd,className:"flex items-center gap-1 font-medium",children:[f.jsx(ae,{...Ht.learnMore}),f.jsx(Yh,{className:"icon-sm"})]})]})]})},bd=({textdocType:s})=>{const{markAsViewed:e}=nr(xs.hasDismissedCanvasContextualOnboarding);return f.jsx(tu,{open:!0,defaultOpen:!0,modal:!1,children:f.jsx(iu,{container:su()?.document.body,children:f.jsx(P.div,{initial:{opacity:.75,scale:.9},animate:{opacity:1,scale:1},transition:{type:"spring",bounce:.2,duration:.56},className:"popover fixed bottom-4 right-4 z-50 max-w-sm overflow-hidden rounded-2xl border border-token-border-light bg-token-main-surface-primary shadow-xl",children:f.jsx(yd,{onClose:e,asset:kt(s)?1:0,size:0,title:kt(s)?Ht.contextualModalTitleCoding:Ht.contextualModalTitleWriting,description:kt(s)?Ht.contextualModalDescriptionCoding:Ht.contextualModalDescriptionWriting})})})})},Ht=st({contextualModalTitleWriting:{id:"Pi+0RT",defaultMessage:"Draft and refine on the spot"},contextualModalDescriptionWriting:{id:"Jv0f02",defaultMessage:"Make it shorter. Add an emoji. Translate to kindergartener. ChatGPT can do it all, right on the canvas."},contextualModalTitleCoding:{id:"Zi5Ty0",defaultMessage:"Refine and debug on the spot"},contextualModalDescriptionCoding:{id:"XnaO2x",defaultMessage:"Refactor code. Translate to Python. Check for bugs. ChatGPT can do it all, right on the canvas."},button:{id:"7bNl4/",defaultMessage:"Got it"},learnMore:{id:"vs1lx2",defaultMessage:"Learn more about canvas"}});function vd(s,e,t){const i=new Map;return s.forEach((n,r)=>{const o=Zh(n,e,t);o&&i.set(r,o)}),i}function Sd(s,e){const t=Ed(s);if(t.length===0)return e;let i=e;return t.forEach(n=>{i=kd(n,i)}),i}function kd(s,e){return vd(e,{start:s.fromA,end:s.toA},Md(s))}function Md(s){const{fromA:e,toA:t,fromB:i,toB:n}=s;return n-i-(t-e)}function Ed(s){const e=[],t=(i,n,r,o)=>{e.push({fromA:i,toA:n,fromB:r,toB:o})};return s.changes.iterChangedRanges(t,!0),e}function Ad(s,e){const t=Array.from(s.keys()),i=Array.from(e.keys());if(t.length!==i.length)return!1;t.sort(),i.sort();for(let n=0;n<t.length;n++)if(t[n]!==i[n])return!1;for(const n of t){const r=s.get(n),o=e.get(n);if(!r||!o||r.start!==o.start||r.end!==o.end)return!1}return!0}function Td(s,e){return{"bg-yellow-100 dark:bg-yellow-400":!0,"bg-opacity-40 bg-yellow-400 dark:bg-yellow-400 dark:bg-opacity-50":s&&!e,"bg-opacity-60 bg-yellow-400 dark:bg-yellow-500 dark:bg-opacity-70":e,"bg-yellow-100 dark:bg-yellow-400 dark:bg-opacity-30":!s&&!e}}const Od={"!bg-transparent":!0};function Dd({isHovered:s,isFocused:e,isCode:t,diffStatus:i}){return D(t?Tu:Ou,"cursor-text group is-comment transition-colors",{...i===zt.REMOVED?Od:Td(s,e)},"group-[.is-comment]:bg-opacity-40")}function Ld(s,e){return s.map(t=>{const i=e.get(t.id);return i?{...t,at:i}:null}).filter(nl)}var ie=(s=>(s.ASK="ask",s.CREATE_TEXTDOC="create_textdoc",s.COMMENT="comment",s.EDIT="edit",s))(ie||{}),fn=(s=>(s.SELECTION="selection",s.BLOCK="block",s))(fn||{});function qp(s){return s?.type==="selection"}const Rd=ou(()=>({commentingOn:null,hoveredCommentId:null,focusedCommentId:null,visibleBlockCommentLauncher_DEBUG_ONLY:null,hoveredBlockCommentLauncherPos:null})),{setState:He,getInitialState:Nd}=Rd,ft={reset:()=>He(Nd()),startCommentingOn:s=>He(e=>({...e,commentingOn:s})),cancelCommentingOn:()=>He(s=>({...s,commentingOn:null})),focusComment:s=>He(e=>({...e,focusedCommentId:s})),blurComment:()=>He(s=>({...s,focusedCommentId:null})),mouseEnterComment:s=>He(e=>({...e,hoveredCommentId:s})),mouseLeaveComment:()=>He(s=>({...s,hoveredCommentId:null})),mouseEnterBlock:s=>He(e=>({...e,hoveredBlockCommentLauncherPos:s})),mouseLeaveBlock:()=>He(s=>({...s,hoveredBlockCommentLauncherPos:null})),setVisibleBlockComment_DEBUG_ONLY:s=>He(e=>({...e,visibleBlockCommentLauncher_DEBUG_ONLY:s}))};class q{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){[e,t]=$t(this,e,t);let n=[];return this.decompose(0,e,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(t,this.length,n,1),Fe.from(n,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=$t(this,e,t);let i=[];return this.decompose(e,t,i,0),Fe.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),n=new pi(this),r=new pi(e);for(let o=t,l=t;;){if(n.next(o),r.next(o),o=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(e=1){return new pi(this,e)}iterRange(e,t=this.length){return new El(this,e,t)}iterLines(e,t){let i;if(e==null)i=this.iter();else{t==null&&(t=this.lines+1);let n=this.line(e).from;i=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new Al(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?q.empty:e.length<=32?new ne(e):Fe.from(ne.split(e,[]))}}class ne extends q{constructor(e,t=Id(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,n){for(let r=0;;r++){let o=this.text[r],l=n+o.length;if((t?i:l)>=e)return new Pd(n,l,i,o);n=l+1,i++}}decompose(e,t,i,n){let r=e<=0&&t>=this.length?this:new ne(Gr(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(n&1){let o=i.pop(),l=ls(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new ne(l,o.length+r.length));else{let a=l.length>>1;i.push(new ne(l.slice(0,a)),new ne(l.slice(a)))}}else i.push(r)}replace(e,t,i){if(!(i instanceof ne))return super.replace(e,t,i);[e,t]=$t(this,e,t);let n=ls(this.text,ls(i.text,Gr(this.text,0,e)),t),r=this.length+i.length-(t-e);return n.length<=32?new ne(n,r):Fe.from(ne.split(n,[]),r)}sliceString(e,t=this.length,i=`
`){[e,t]=$t(this,e,t);let n="";for(let r=0,o=0;r<=t&&o<this.text.length;o++){let l=this.text[o],a=r+l.length;r>e&&o&&(n+=i),e<a&&t>r&&(n+=l.slice(Math.max(0,e-r),t-r)),r=a+1}return n}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],n=-1;for(let r of e)i.push(r),n+=r.length+1,i.length==32&&(t.push(new ne(i,n)),i=[],n=-1);return n>-1&&t.push(new ne(i,n)),t}}class Fe extends q{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,n){for(let r=0;;r++){let o=this.children[r],l=n+o.length,a=i+o.lines-1;if((t?a:l)>=e)return o.lineInner(e,t,i,n);n=l+1,i=a+1}}decompose(e,t,i,n){for(let r=0,o=0;o<=t&&r<this.children.length;r++){let l=this.children[r],a=o+l.length;if(e<=a&&t>=o){let c=n&((o<=e?1:0)|(a>=t?2:0));o>=e&&a<=t&&!c?i.push(l):l.decompose(e-o,t-o,i,c)}o=a+1}}replace(e,t,i){if([e,t]=$t(this,e,t),i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(e>=r&&t<=l){let a=o.replace(e-r,t-r,i),c=this.lines-o.lines+a.lines;if(a.lines<c>>4&&a.lines>c>>6){let h=this.children.slice();return h[n]=a,new Fe(h,this.length-(t-e)+i.length)}return super.replace(r,l,a)}r=l+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i=`
`){[e,t]=$t(this,e,t);let n="";for(let r=0,o=0;r<this.children.length&&o<=t;r++){let l=this.children[r],a=o+l.length;o>e&&r&&(n+=i),e<a&&t>o&&(n+=l.sliceString(e-o,t-o,i)),o=a+1}return n}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Fe))return 0;let i=0,[n,r,o,l]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=t,r+=t){if(n==o||r==l)return i;let a=this.children[n],c=e.children[r];if(a!=c)return i+a.scanIdentical(c,t);i+=a.length+1}}static from(e,t=e.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let m of e)i+=m.lines;if(i<32){let m=[];for(let g of e)g.flatten(m);return new ne(m,t)}let n=Math.max(32,i>>5),r=n<<1,o=n>>1,l=[],a=0,c=-1,h=[];function u(m){let g;if(m.lines>r&&m instanceof Fe)for(let p of m.children)u(p);else m.lines>o&&(a>o||!a)?(d(),l.push(m)):m instanceof ne&&a&&(g=h[h.length-1])instanceof ne&&m.lines+g.lines<=32?(a+=m.lines,c+=m.length+1,h[h.length-1]=new ne(g.text.concat(m.text),g.length+1+m.length)):(a+m.lines>n&&d(),a+=m.lines,c+=m.length+1,h.push(m))}function d(){a!=0&&(l.push(h.length==1?h[0]:Fe.from(h,c)),c=-1,a=h.length=0)}for(let m of e)u(m);return d(),l.length==1?l[0]:new Fe(l,t)}}q.empty=new ne([""],0);function Id(s){let e=-1;for(let t of s)e+=t.length+1;return e}function ls(s,e,t=0,i=1e9){for(let n=0,r=0,o=!0;r<s.length&&n<=i;r++){let l=s[r],a=n+l.length;a>=t&&(a>i&&(l=l.slice(0,i-n)),n<t&&(l=l.slice(t-n)),o?(e[e.length-1]+=l,o=!1):e.push(l)),n=a+1}return e}function Gr(s,e,t){return ls(s,[""],e,t)}class pi{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof ne?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],o=r>>1,l=n instanceof ne?n.text.length:n.children.length;if(o==(t>0?l:0)){if(i==0)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(t>0?0:1)){if(this.offsets[i]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(n instanceof ne){let a=n.text[o+(t<0?-1:0)];if(this.offsets[i]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=n.children[o+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof ne?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class El{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new pi(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*t,this.value=n.length<=i?n:t<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class Al{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:n}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(q.prototype[Symbol.iterator]=function(){return this.iter()},pi.prototype[Symbol.iterator]=El.prototype[Symbol.iterator]=Al.prototype[Symbol.iterator]=function(){return this});class Pd{constructor(e,t,i,n){this.from=e,this.to=t,this.number=i,this.text=n}get length(){return this.to-this.from}}function $t(s,e,t){return e=Math.max(0,Math.min(s.length,e)),[e,Math.max(e,Math.min(s.length,t))]}let Ft="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(s=>s?parseInt(s,36):1);for(let s=1;s<Ft.length;s++)Ft[s]+=Ft[s-1];function jd(s){for(let e=1;e<Ft.length;e+=2)if(Ft[e]>s)return Ft[e-1]<=s;return!1}function Kr(s){return s>=127462&&s<=127487}const Yr=8205;function qe(s,e,t=!0,i=!0){return(t?Tl:Bd)(s,e,i)}function Tl(s,e,t){if(e==s.length)return e;e&&Ol(s.charCodeAt(e))&&Dl(s.charCodeAt(e-1))&&e--;let i=xi(s,e);for(e+=mn(i);e<s.length;){let n=xi(s,e);if(i==Yr||n==Yr||t&&jd(n))e+=mn(n),i=n;else if(Kr(n)){let r=0,o=e-2;for(;o>=0&&Kr(xi(s,o));)r++,o-=2;if(r%2==0)break;e+=2}else break}return e}function Bd(s,e,t){for(;e>0;){let i=Tl(s,e-2,t);if(i<e)return i;e--}return 0}function Ol(s){return s>=56320&&s<57344}function Dl(s){return s>=55296&&s<56320}function xi(s,e){let t=s.charCodeAt(e);if(!Dl(t)||e+1==s.length)return t;let i=s.charCodeAt(e+1);return Ol(i)?(t-55296<<10)+(i-56320)+65536:t}function zp(s){return s<=65535?String.fromCharCode(s):(s-=65536,String.fromCharCode((s>>10)+55296,(s&1023)+56320))}function mn(s){return s<65536?1:2}const gn=/\r\n?|\n/;var Ae=function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s}(Ae||(Ae={}));class Je{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,n=0;t<this.sections.length;){let r=this.sections[t++],o=this.sections[t++];o<0?(e(i,n,r),n+=r):n+=o,i+=r}}iterChangedRanges(e,t=!1){pn(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];n<0?e.push(i,n):e.push(n,i)}return new Je(e)}composeDesc(e){return this.empty?e:e.empty?this:Ll(this,e)}mapDesc(e,t=!1){return e.empty?this:xn(this,e,t)}mapPos(e,t=-1,i=Ae.Simple){let n=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],c=n+l;if(a<0){if(c>e)return r+(e-n);r+=l}else{if(i!=Ae.Simple&&c>=e&&(i==Ae.TrackDel&&n<e&&c>e||i==Ae.TrackBefore&&n<e||i==Ae.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!l)return e==n||t<0?r:r+a;r+=a}n=c}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return r}touchesRange(e,t=e){for(let i=0,n=0;i<this.sections.length&&n<=t;){let r=this.sections[i++],o=this.sections[i++],l=n+r;if(o>=0&&n<=t&&l>=e)return n<e&&l>t?"cover":!0;n=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+i+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Je(e)}static create(e){return new Je(e)}}class he extends Je{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return pn(this,(t,i,n,r,o)=>e=e.replace(n,n+(i-t),o),!1),e}mapDesc(e,t=!1){return xn(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let n=0,r=0;n<t.length;n+=2){let o=t[n],l=t[n+1];if(l>=0){t[n]=l,t[n+1]=o;let a=n>>1;for(;i.length<a;)i.push(q.empty);i.push(o?e.slice(r,r+o):q.empty)}r+=o}return new he(t,i)}compose(e){return this.empty?e:e.empty?this:Ll(this,e,!0)}map(e,t=!1){return e.empty?this:xn(this,e,t,!0)}iterChanges(e,t=!1){pn(this,e,t)}get desc(){return Je.create(this.sections)}filter(e){let t=[],i=[],n=[],r=new Ei(this);e:for(let o=0,l=0;;){let a=o==e.length?1e9:e[o++];for(;l<a||l==a&&r.len==0;){if(r.done)break e;let h=Math.min(r.len,a-l);fe(n,h,-1);let u=r.ins==-1?-1:r.off==0?r.ins:0;fe(t,h,u),u>0&&ht(i,t,r.text),r.forward(h),l+=h}let c=e[o++];for(;l<c;){if(r.done)break e;let h=Math.min(r.len,c-l);fe(t,h,-1),fe(n,h,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(h),l+=h}}return{changes:new he(t,i),filtered:Je.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],n=this.sections[t+1];n<0?e.push(i):n==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let n=[],r=[],o=0,l=null;function a(h=!1){if(!h&&!n.length)return;o<t&&fe(n,t-o,-1);let u=new he(n,r);l=l?l.compose(u.map(l)):u,n=[],r=[],o=0}function c(h){if(Array.isArray(h))for(let u of h)c(u);else if(h instanceof he){if(h.length!=t)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${t})`);a(),l=l?l.compose(h.map(l)):h}else{let{from:u,to:d=u,insert:m}=h;if(u>d||u<0||d>t)throw new RangeError(`Invalid change range ${u} to ${d} (in doc of length ${t})`);let g=m?typeof m=="string"?q.of(m.split(i||gn)):m:q.empty,p=g.length;if(u==d&&p==0)return;u<o&&a(),u>o&&fe(n,u-o,-1),fe(n,d-u,p),ht(r,n,g),o=d}}return c(e),a(!l),l}static empty(e){return new he(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let n=0;n<e.length;n++){let r=e[n];if(typeof r=="number")t.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)t.push(r[0],0);else{for(;i.length<n;)i.push(q.empty);i[n]=q.of(r.slice(1)),t.push(r[0],i[n].length)}}}return new he(t,i)}static createSet(e,t){return new he(e,t)}}function fe(s,e,t,i=!1){if(e==0&&t<=0)return;let n=s.length-2;n>=0&&t<=0&&t==s[n+1]?s[n]+=e:e==0&&s[n]==0?s[n+1]+=t:i?(s[n]+=e,s[n+1]+=t):s.push(e,t)}function ht(s,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<s.length)s[s.length-1]=s[s.length-1].append(t);else{for(;s.length<i;)s.push(q.empty);s.push(t)}}function pn(s,e,t){let i=s.inserted;for(let n=0,r=0,o=0;o<s.sections.length;){let l=s.sections[o++],a=s.sections[o++];if(a<0)n+=l,r+=l;else{let c=n,h=r,u=q.empty;for(;c+=l,h+=a,a&&i&&(u=u.append(i[o-2>>1])),!(t||o==s.sections.length||s.sections[o+1]<0);)l=s.sections[o++],a=s.sections[o++];e(n,c,r,h,u),n=c,r=h}}}function xn(s,e,t,i=!1){let n=[],r=i?[]:null,o=new Ei(s),l=new Ei(e);for(let a=-1;;)if(o.ins==-1&&l.ins==-1){let c=Math.min(o.len,l.len);fe(n,c,-1),o.forward(c),l.forward(c)}else if(l.ins>=0&&(o.ins<0||a==o.i||o.off==0&&(l.len<o.len||l.len==o.len&&!t))){let c=l.len;for(fe(n,l.ins,-1);c;){let h=Math.min(o.len,c);o.ins>=0&&a<o.i&&o.len<=h&&(fe(n,0,o.ins),r&&ht(r,n,o.text),a=o.i),o.forward(h),c-=h}l.next()}else if(o.ins>=0){let c=0,h=o.len;for(;h;)if(l.ins==-1){let u=Math.min(h,l.len);c+=u,h-=u,l.forward(u)}else if(l.ins==0&&l.len<h)h-=l.len,l.next();else break;fe(n,c,a<o.i?o.ins:0),r&&a<o.i&&ht(r,n,o.text),a=o.i,o.forward(o.len-h)}else{if(o.done&&l.done)return r?he.createSet(n,r):Je.create(n);throw new Error("Mismatched change set lengths")}}function Ll(s,e,t=!1){let i=[],n=t?[]:null,r=new Ei(s),o=new Ei(e);for(let l=!1;;){if(r.done&&o.done)return n?he.createSet(i,n):Je.create(i);if(r.ins==0)fe(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)fe(i,0,o.ins,l),n&&ht(n,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(r.len2,o.len),c=i.length;if(r.ins==-1){let h=o.ins==-1?-1:o.off?0:o.ins;fe(i,a,h,l),n&&h&&ht(n,i,o.text)}else o.ins==-1?(fe(i,r.off?0:r.len,a,l),n&&ht(n,i,r.textBit(a))):(fe(i,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&ht(n,i,o.text));l=(r.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>c),r.forward2(a),o.forward(a)}}}}class Ei{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?q.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?q.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class bt{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let i,n;return this.empty?i=n=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new bt(i,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return T.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return T.range(this.anchor,i)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return T.range(e.anchor,e.head)}static create(e,t,i){return new bt(e,t,i)}}class T{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:T.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new T([this.main],0)}addRange(e,t=!0){return T.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,T.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new T(e.ranges.map(t=>bt.fromJSON(t)),e.main)}static single(e,t=e){return new T([T.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<e.length;n++){let r=e[n];if(r.empty?r.from<=i:r.from<i)return T.normalized(e.slice(),t);i=r.to}return new T(e,t)}static cursor(e,t=0,i,n){return bt.create(e,e,(t==0?0:t<0?8:16)|(i==null?7:Math.min(6,i))|(n??16777215)<<6)}static range(e,t,i,n){let r=(i??16777215)<<6|(n==null?7:Math.min(6,n));return t<e?bt.create(t,e,48|r):bt.create(e,t,(t>e?8:0)|r)}static normalized(e,t=0){let i=e[t];e.sort((n,r)=>n.from-r.from),t=e.indexOf(i);for(let n=1;n<e.length;n++){let r=e[n],o=e[n-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,a=Math.max(r.to,o.to);n<=t&&t--,e.splice(--n,2,r.anchor>r.head?T.range(a,l):T.range(l,a))}}return new T(e,t)}}function Rl(s,e){for(let t of s.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let ar=0;class L{constructor(e,t,i,n,r){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=n,this.id=ar++,this.default=e([]),this.extensions=typeof r=="function"?r(this):r}get reader(){return this}static define(e={}){return new L(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:hr),!!e.static,e.enables)}of(e){return new as([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new as(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new as(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function hr(s,e){return s==e||s.length==e.length&&s.every((t,i)=>t===e[i])}class as{constructor(e,t,i,n){this.dependencies=e,this.facet=t,this.type=i,this.value=n,this.id=ar++}dynamicSlot(e){var t;let i=this.value,n=this.facet.compareInput,r=this.id,o=e[r]>>1,l=this.type==2,a=!1,c=!1,h=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?c=!0:((t=e[u.id])!==null&&t!==void 0?t:1)&1||h.push(e[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,d){if(a&&d.docChanged||c&&(d.docChanged||d.selection)||Cn(u,h)){let m=i(u);if(l?!Zr(m,u.values[o],n):!n(m,u.values[o]))return u.values[o]=m,1}return 0},reconfigure:(u,d)=>{let m,g=d.config.address[r];if(g!=null){let p=Ss(d,g);if(this.dependencies.every(x=>x instanceof L?d.facet(x)===u.facet(x):x instanceof Re?d.field(x,!1)==u.field(x,!1):!0)||(l?Zr(m=i(u),p,n):n(m=i(u),p)))return u.values[o]=p,0}else m=i(u);return u.values[o]=m,1}}}}function Zr(s,e,t){if(s.length!=e.length)return!1;for(let i=0;i<s.length;i++)if(!t(s[i],e[i]))return!1;return!0}function Cn(s,e){let t=!1;for(let i of e)Ci(s,i)&1&&(t=!0);return t}function Hd(s,e,t){let i=t.map(a=>s[a.id]),n=t.map(a=>a.type),r=i.filter(a=>!(a&1)),o=s[e.id]>>1;function l(a){let c=[];for(let h=0;h<i.length;h++){let u=Ss(a,i[h]);if(n[h]==2)for(let d of u)c.push(d);else c.push(u)}return e.combine(c)}return{create(a){for(let c of i)Ci(a,c);return a.values[o]=l(a),1},update(a,c){if(!Cn(a,r))return 0;let h=l(a);return e.compare(h,a.values[o])?0:(a.values[o]=h,1)},reconfigure(a,c){let h=Cn(a,i),u=c.config.facets[e.id],d=c.facet(e);if(u&&!h&&hr(t,u))return a.values[o]=d,0;let m=l(a);return e.compare(m,d)?(a.values[o]=d,0):(a.values[o]=m,1)}}}const Xr=L.define({static:!0});class Re{constructor(e,t,i,n,r){this.id=e,this.createF=t,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(e){let t=new Re(ar++,e.create,e.update,e.compare||((i,n)=>i===n),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Xr).find(i=>i.field==this);return(t?.create||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,n)=>{let r=i.values[t],o=this.updateF(r,n);return this.compareF(r,o)?0:(i.values[t]=o,1)},reconfigure:(i,n)=>n.config.address[this.id]!=null?(i.values[t]=n.field(this),0):(i.values[t]=this.create(i),1)}}init(e){return[this,Xr.of({field:this,create:e})]}get extension(){return this}}const yt={lowest:4,low:3,default:2,high:1,highest:0};function oi(s){return e=>new Nl(e,s)}const cr={highest:oi(yt.highest),high:oi(yt.high),default:oi(yt.default),low:oi(yt.low),lowest:oi(yt.lowest)};class Nl{constructor(e,t){this.inner=e,this.prec=t}}class Is{of(e){return new wn(this,e)}reconfigure(e){return Is.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class wn{constructor(e,t){this.compartment=e,this.inner=t}}class vs{constructor(e,t,i,n,r,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let n=[],r=Object.create(null),o=new Map;for(let d of Vd(e,t,o))d instanceof Re?n.push(d):(r[d.facet.id]||(r[d.facet.id]=[])).push(d);let l=Object.create(null),a=[],c=[];for(let d of n)l[d.id]=c.length<<1,c.push(m=>d.slot(m));let h=i?.config.facets;for(let d in r){let m=r[d],g=m[0].facet,p=h&&h[d]||[];if(m.every(x=>x.type==0))if(l[g.id]=a.length<<1|1,hr(p,m))a.push(i.facet(g));else{let x=g.combine(m.map(w=>w.value));a.push(i&&g.compare(x,i.facet(g))?i.facet(g):x)}else{for(let x of m)x.type==0?(l[x.id]=a.length<<1|1,a.push(x.value)):(l[x.id]=c.length<<1,c.push(w=>x.dynamicSlot(w)));l[g.id]=c.length<<1,c.push(x=>Hd(x,g,m))}}let u=c.map(d=>d(l));return new vs(e,o,u,l,a,r)}}function Vd(s,e,t){let i=[[],[],[],[],[]],n=new Map;function r(o,l){let a=n.get(o);if(a!=null){if(a<=l)return;let c=i[a].indexOf(o);c>-1&&i[a].splice(c,1),o instanceof wn&&t.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let c of o)r(c,l);else if(o instanceof wn){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(o.compartment)||o.inner;t.set(o.compartment,c),r(c,l)}else if(o instanceof Nl)r(o.inner,o.prec);else if(o instanceof Re)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof as)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,yt.default);else{let c=o.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(c,l)}}return r(s,yt.default),i.reduce((o,l)=>o.concat(l))}function Ci(s,e){if(e&1)return 2;let t=e>>1,i=s.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;s.status[t]=4;let n=s.computeSlot(s,s.config.dynamicSlots[t]);return s.status[t]=2|n}function Ss(s,e){return e&1?s.config.staticValues[e>>1]:s.values[e>>1]}const Il=L.define(),yn=L.define({combine:s=>s.some(e=>e),static:!0}),Pl=L.define({combine:s=>s.length?s[0]:void 0,static:!0}),jl=L.define(),Bl=L.define(),Hl=L.define(),Vl=L.define({combine:s=>s.length?s[0]:!1});class Jt{constructor(e,t){this.type=e,this.value=t}static define(){return new Fd}}class Fd{of(e){return new Jt(this,e)}}class _d{constructor(e){this.map=e}of(e){return new se(this,e)}}class se{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new se(this.type,t)}is(e){return this.type==e}static define(e={}){return new _d(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let n of e){let r=n.map(t);r&&i.push(r)}return i}}se.reconfigure=se.define();se.appendConfig=se.define();class ge{constructor(e,t,i,n,r,o){this.startState=e,this.changes=t,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&Rl(i,t.newLength),r.some(l=>l.type==ge.time)||(this.annotations=r.concat(ge.time.of(Date.now())))}static create(e,t,i,n,r,o){return new ge(e,t,i,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(ge.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}ge.time=Jt.define();ge.userEvent=Jt.define();ge.addToHistory=Jt.define();ge.remote=Jt.define();function Wd(s,e){let t=[];for(let i=0,n=0;;){let r,o;if(i<s.length&&(n==e.length||e[n]>=s[i]))r=s[i++],o=s[i++];else if(n<e.length)r=e[n++],o=e[n++];else return t;!t.length||t[t.length-1]<r?t.push(r,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function Fl(s,e,t){var i;let n,r,o;return t?(n=e.changes,r=he.empty(e.changes.length),o=s.changes.compose(e.changes)):(n=e.changes.map(s.changes),r=s.changes.mapDesc(e.changes,!0),o=s.changes.compose(n)),{changes:o,selection:e.selection?e.selection.map(r):(i=s.selection)===null||i===void 0?void 0:i.map(n),effects:se.mapEffects(s.effects,n).concat(se.mapEffects(e.effects,r)),annotations:s.annotations.length?s.annotations.concat(e.annotations):e.annotations,scrollIntoView:s.scrollIntoView||e.scrollIntoView}}function bn(s,e,t){let i=e.selection,n=_t(e.annotations);return e.userEvent&&(n=n.concat(ge.userEvent.of(e.userEvent))),{changes:e.changes instanceof he?e.changes:he.of(e.changes||[],t,s.facet(Pl)),selection:i&&(i instanceof T?i:T.single(i.anchor,i.head)),effects:_t(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function _l(s,e,t){let i=bn(s,e.length?e[0]:{},s.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let r=1;r<e.length;r++){e[r].filter===!1&&(t=!1);let o=!!e[r].sequential;i=Fl(i,bn(s,e[r],o?i.changes.newLength:s.doc.length),o)}let n=ge.create(s,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return zd(t?qd(n):n)}function qd(s){let e=s.startState,t=!0;for(let n of e.facet(jl)){let r=n(s);if(r===!1){t=!1;break}Array.isArray(r)&&(t=t===!0?r:Wd(t,r))}if(t!==!0){let n,r;if(t===!1)r=s.changes.invertedDesc,n=he.empty(e.doc.length);else{let o=s.changes.filter(t);n=o.changes,r=o.filtered.mapDesc(o.changes).invertedDesc}s=ge.create(e,n,s.selection&&s.selection.map(r),se.mapEffects(s.effects,r),s.annotations,s.scrollIntoView)}let i=e.facet(Bl);for(let n=i.length-1;n>=0;n--){let r=i[n](s);r instanceof ge?s=r:Array.isArray(r)&&r.length==1&&r[0]instanceof ge?s=r[0]:s=_l(e,_t(r),!1)}return s}function zd(s){let e=s.startState,t=e.facet(Hl),i=s;for(let n=t.length-1;n>=0;n--){let r=t[n](s);r&&Object.keys(r).length&&(i=Fl(i,bn(e,r,s.changes.newLength),!0))}return i==s?s:ge.create(e,s.changes,s.selection,i.effects,i.annotations,i.scrollIntoView)}const Ud=[];function _t(s){return s==null?Ud:Array.isArray(s)?s:[s]}var Ye=function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s}(Ye||(Ye={}));const $d=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let vn;try{vn=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function Gd(s){if(vn)return vn.test(s);for(let e=0;e<s.length;e++){let t=s[e];if(/\w/.test(t)||t>"Â€"&&(t.toUpperCase()!=t.toLowerCase()||$d.test(t)))return!0}return!1}function Kd(s){return e=>{if(!/\S/.test(e))return Ye.Space;if(Gd(e))return Ye.Word;for(let t=0;t<s.length;t++)if(e.indexOf(s[t])>-1)return Ye.Word;return Ye.Other}}class J{constructor(e,t,i,n,r,o){this.config=e,this.doc=t,this.selection=i,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Ci(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return Ci(this,i),Ss(this,i)}update(...e){return _l(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:n}=t;for(let l of e.effects)l.is(Is.reconfigure)?(t&&(n=new Map,t.compartments.forEach((a,c)=>n.set(c,a)),t=null),n.set(l.value.compartment,l.value.extension)):l.is(se.reconfigure)?(t=null,i=l.value):l.is(se.appendConfig)&&(t=null,i=_t(i).concat(l.value));let r;t?r=e.startState.values.slice():(t=vs.resolve(i,n,this),r=new J(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(a,c)=>c.reconfigure(a,this),null).values);let o=e.startState.facet(yn)?e.newSelection:e.newSelection.asSingle();new J(t,e.newDoc,o,r,(l,a)=>a.update(l,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:T.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),n=this.changes(i.changes),r=[i.range],o=_t(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),c=this.changes(a.changes),h=c.map(n);for(let d=0;d<l;d++)r[d]=r[d].map(h);let u=n.mapDesc(c,!0);r.push(a.range.map(u)),n=n.compose(h),o=se.mapEffects(o,h).concat(se.mapEffects(_t(a.effects),u))}return{changes:n,selection:T.create(r,t.mainIndex),effects:o}}changes(e=[]){return e instanceof he?e:he.of(e,this.doc.length,this.facet(J.lineSeparator))}toText(e){return q.of(e.split(this.facet(J.lineSeparator)||gn))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(Ci(this,t),Ss(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let n=e[i];n instanceof Re&&this.config.address[n.id]!=null&&(t[i]=n.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i){for(let r in i)if(Object.prototype.hasOwnProperty.call(e,r)){let o=i[r],l=e[r];n.push(o.init(a=>o.spec.fromJSON(l,a)))}}return J.create({doc:e.doc,selection:T.fromJSON(e.selection),extensions:t.extensions?n.concat([t.extensions]):n})}static create(e={}){let t=vs.resolve(e.extensions||[],new Map),i=e.doc instanceof q?e.doc:q.of((e.doc||"").split(t.staticFacet(J.lineSeparator)||gn)),n=e.selection?e.selection instanceof T?e.selection:T.single(e.selection.anchor,e.selection.head):T.single(0);return Rl(n,i.length),t.staticFacet(yn)||(n=n.asSingle()),new J(t,i,n,t.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(J.tabSize)}get lineBreak(){return this.facet(J.lineSeparator)||`
`}get readOnly(){return this.facet(Vl)}phrase(e,...t){for(let i of this.facet(J.phrases))if(Object.prototype.hasOwnProperty.call(i,e)){e=i[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let r=+(n||1);return!r||r>t.length?i:t[r-1]})),e}languageDataAt(e,t,i=-1){let n=[];for(let r of this.facet(Il))for(let o of r(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&n.push(o[e]);return n}charCategorizer(e){return Kd(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:n}=this.doc.lineAt(e),r=this.charCategorizer(e),o=e-i,l=e-i;for(;o>0;){let a=qe(t,o,!1);if(r(t.slice(a,o))!=Ye.Word)break;o=a}for(;l<n;){let a=qe(t,l);if(r(t.slice(l,a))!=Ye.Word)break;l=a}return o==l?null:T.range(o+i,l+i)}}J.allowMultipleSelections=yn;J.tabSize=L.define({combine:s=>s.length?s[0]:4});J.lineSeparator=Pl;J.readOnly=Vl;J.phrases=L.define({compare(s,e){let t=Object.keys(s),i=Object.keys(e);return t.length==i.length&&t.every(n=>s[n]==e[n])}});J.languageData=Il;J.changeFilter=jl;J.transactionFilter=Bl;J.transactionExtender=Hl;Is.reconfigure=se.define();function ur(s,e,t={}){let i={};for(let n of s)for(let r of Object.keys(n)){let o=n[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(t,r))i[r]=t[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let n in e)i[n]===void 0&&(i[n]=e[n]);return i}class Gt{eq(e){return this==e}range(e,t=e){return Ai.create(e,t,this)}}Gt.prototype.startSide=Gt.prototype.endSide=0;Gt.prototype.point=!1;Gt.prototype.mapMode=Ae.TrackDel;class Ai{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Ai(e,t,i)}}function Sn(s,e){return s.from-e.from||s.value.startSide-e.value.startSide}class dr{constructor(e,t,i,n){this.from=e,this.to=t,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,n=0){let r=i?this.to:this.from;for(let o=n,l=r.length;;){if(o==l)return o;let a=o+l>>1,c=r[a]-e||(i?this.value[a].endSide:this.value[a].startSide)-t;if(a==o)return c>=0?o:l;c>=0?l=a:o=a+1}}between(e,t,i,n){for(let r=this.findIndex(t,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(n(this.from[r]+e,this.to[r]+e,this.value[r])===!1)return!1}map(e,t){let i=[],n=[],r=[],o=-1,l=-1;for(let a=0;a<this.value.length;a++){let c=this.value[a],h=this.from[a]+e,u=this.to[a]+e,d,m;if(h==u){let g=t.mapPos(h,c.startSide,c.mapMode);if(g==null||(d=m=g,c.startSide!=c.endSide&&(m=t.mapPos(h,c.endSide),m<d)))continue}else if(d=t.mapPos(h,c.startSide),m=t.mapPos(u,c.endSide),d>m||d==m&&c.startSide>0&&c.endSide<=0)continue;(m-d||c.endSide-c.startSide)<0||(o<0&&(o=d),c.point&&(l=Math.max(l,m-d)),i.push(c),n.push(d-o),r.push(m-o))}return{mapped:i.length?new dr(n,r,i,l):null,pos:o}}}class W{constructor(e,t,i,n){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=n}static create(e,t,i,n){return new W(e,t,i,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(i&&(t=t.slice().sort(Sn)),this.isEmpty)return t.length?W.of(t):this;let l=new Wl(this,null,-1).goto(0),a=0,c=[],h=new Ti;for(;l.value||a<t.length;)if(a<t.length&&(l.from-t[a].from||l.startSide-t[a].value.startSide)>=0){let u=t[a++];h.addInner(u.from,u.to,u.value)||c.push(u)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(l.chunkIndex)<t[a].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&h.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(h.addInner(l.from,l.to,l.value)||c.push(Ai.create(l.from,l.to,l.value))),l.next());return h.finishInner(this.nextLayer.isEmpty&&!c.length?W.empty:this.nextLayer.update({add:c,filter:o,filterFrom:n,filterTo:r}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],a=this.chunk[o],c=e.touchesRange(l,l+a.length);if(c===!1)n=Math.max(n,a.maxPoint),t.push(a),i.push(e.mapPos(l));else if(c===!0){let{mapped:h,pos:u}=a.map(l,e);h&&(n=Math.max(n,h.maxPoint),t.push(h),i.push(u))}}let r=this.nextLayer.map(e);return t.length==0?r:new W(i,t,r||W.empty,n)}between(e,t,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n];if(t>=r&&e<=r+o.length&&o.between(r,e-r,t-r,i)===!1)return}this.nextLayer.between(e,t,i)}}iter(e=0){return Oi.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Oi.from(e).goto(t)}static compare(e,t,i,n,r=-1){let o=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=r),l=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=r),a=Jr(o,l,i),c=new li(o,a,r),h=new li(l,a,r);i.iterGaps((u,d,m)=>Qr(c,u,h,d,m,n)),i.empty&&i.length==0&&Qr(c,0,h,0,0,n)}static eq(e,t,i=0,n){n==null&&(n=999999999);let r=e.filter(h=>!h.isEmpty&&t.indexOf(h)<0),o=t.filter(h=>!h.isEmpty&&e.indexOf(h)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=Jr(r,o),a=new li(r,l,0).goto(i),c=new li(o,l,0).goto(i);for(;;){if(a.to!=c.to||!kn(a.active,c.active)||a.point&&(!c.point||!a.point.eq(c.point)))return!1;if(a.to>n)return!0;a.next(),c.next()}}static spans(e,t,i,n,r=-1){let o=new li(e,null,r).goto(t),l=t,a=o.openStart;for(;;){let c=Math.min(o.to,i);if(o.point){let h=o.activeForPoint(o.to),u=o.pointFrom<t?h.length+1:o.point.startSide<0?h.length:Math.min(h.length,a);n.point(l,c,o.point,h,u,o.pointRank),a=Math.min(o.openEnd(c),h.length)}else c>l&&(n.span(l,c,o.active,a),a=o.openEnd(c));if(o.to>i)return a+(o.point&&o.to>i?1:0);l=o.to,o.next()}}static of(e,t=!1){let i=new Ti;for(let n of e instanceof Ai?[e]:t?Yd(e):e)i.add(n.from,n.to,n.value);return i.finish()}static join(e){if(!e.length)return W.empty;let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)for(let n=e[i];n!=W.empty;n=n.nextLayer)t=new W(n.chunkPos,n.chunk,t,Math.max(n.maxPoint,t.maxPoint));return t}}W.empty=new W([],[],null,-1);function Yd(s){if(s.length>1)for(let e=s[0],t=1;t<s.length;t++){let i=s[t];if(Sn(e,i)>0)return s.slice().sort(Sn);e=i}return s}W.empty.nextLayer=W.empty;class Ti{finishChunk(e){this.chunks.push(new dr(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Ti)).add(e,t,i)}addInner(e,t,i){let n=e-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(W.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=W.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Jr(s,e,t){let i=new Map;for(let r of s)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let n=new Set;for(let r of e)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(t?t.mapPos(l):l)==r.chunkPos[o]&&!t?.touchesRange(l,l+r.chunk[o].length)&&n.add(r.chunk[o])}return n}class Wl{constructor(e,t,i,n=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<e||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Oi{constructor(e){this.heap=e}static from(e,t=null,i=-1){let n=[];for(let r=0;r<e.length;r++)for(let o=e[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new Wl(o,t,i,r));return n.length==1?n[0]:new Oi(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)Ys(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)Ys(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Ys(this.heap,0)}}}function Ys(s,e){for(let t=s[e];;){let i=(e<<1)+1;if(i>=s.length)break;let n=s[i];if(i+1<s.length&&n.compare(s[i+1])>=0&&(n=s[i+1],i++),t.compare(n)<0)break;s[i]=t,s[e]=n,e=i}}class li{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Oi.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Ki(this.active,e),Ki(this.activeTo,e),Ki(this.activeRank,e),this.minActive=eo(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:n,rank:r}=this.cursor;for(;t<this.activeRank.length&&(r-this.activeRank[t]||n-this.activeTo[t])>0;)t++;Yi(this.active,t,i),Yi(this.activeTo,t,n),Yi(this.activeRank,t,r),e&&Yi(e,t,this.cursor.from),this.minActive=eo(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&Ki(i,n)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let r=this.cursor.value;if(!r.point)this.addActive(i),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=r,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=r.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let n=i.length-1;n>=0&&i[n]<e;n--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function Qr(s,e,t,i,n,r){s.goto(e),t.goto(i);let o=i+n,l=i,a=i-e;for(;;){let c=s.to+a-t.to||s.endSide-t.endSide,h=c<0?s.to+a:t.to,u=Math.min(h,o);if(s.point||t.point?s.point&&t.point&&(s.point==t.point||s.point.eq(t.point))&&kn(s.activeForPoint(s.to),t.activeForPoint(t.to))||r.comparePoint(l,u,s.point,t.point):u>l&&!kn(s.active,t.active)&&r.compareRange(l,u,s.active,t.active),h>o)break;l=h,c<=0&&s.next(),c>=0&&t.next()}}function kn(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!=e[t]&&!s[t].eq(e[t]))return!1;return!0}function Ki(s,e){for(let t=e,i=s.length-1;t<i;t++)s[t]=s[t+1];s.pop()}function Yi(s,e,t){for(let i=s.length-1;i>=e;i--)s[i+1]=s[i];s[e]=t}function eo(s,e){let t=-1,i=1e9;for(let n=0;n<e.length;n++)(e[n]-i||s[n].endSide-s[t].endSide)<0&&(t=n,i=e[n]);return t}function Zd(s,e,t=s.length){let i=0;for(let n=0;n<t;)s.charCodeAt(n)==9?(i+=e-i%e,n++):(i++,n=qe(s,n));return i}function Xd(s,e,t,i){for(let n=0,r=0;;){if(r>=e)return n;if(n==s.length)break;r+=s.charCodeAt(n)==9?t-r%t:1,n=qe(s,n)}return i===!0?-1:s.length}const Mn="Í¼",to=typeof Symbol>"u"?"__"+Mn:Symbol.for(Mn),En=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),io=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Kt{constructor(e,t){this.rules=[];let{finish:i}=t||{};function n(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function r(o,l,a,c){let h=[],u=/^@(\w+)\b/.exec(o[0]),d=u&&u[1]=="keyframes";if(u&&l==null)return a.push(o[0]+";");for(let m in l){let g=l[m];if(/&/.test(m))r(m.split(/,\s*/).map(p=>o.map(x=>p.replace(/&/,x))).reduce((p,x)=>p.concat(x)),g,a);else if(g&&typeof g=="object"){if(!u)throw new RangeError("The value of a property ("+m+") should be a primitive value.");r(n(m),g,h,d)}else g!=null&&h.push(m.replace(/_.*/,"").replace(/[A-Z]/g,p=>"-"+p.toLowerCase())+": "+g+";")}(h.length||d)&&a.push((i&&!u&&!c?o.map(i):o).join(", ")+" {"+h.join(" ")+"}")}for(let o in e)r(n(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=io[to]||1;return io[to]=e+1,Mn+e.toString(36)}static mount(e,t,i){let n=e[En],r=i&&i.nonce;n?r&&n.setNonce(r):n=new Jd(e,r),n.mount(Array.isArray(t)?t:[t],e)}}let so=new Map;class Jd{constructor(e,t){let i=e.ownerDocument||e,n=i.defaultView;if(!e.head&&e.adoptedStyleSheets&&n.CSSStyleSheet){let r=so.get(i);if(r)return e[En]=r;this.sheet=new n.CSSStyleSheet,so.set(i,this)}else this.styleTag=i.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[En]=this}mount(e,t){let i=this.sheet,n=0,r=0;for(let o=0;o<e.length;o++){let l=e[o],a=this.modules.indexOf(l);if(a<r&&a>-1&&(this.modules.splice(a,1),r--,a=-1),a==-1){if(this.modules.splice(r++,0,l),i)for(let c=0;c<l.rules.length;c++)i.insertRule(l.rules[c],n++)}else{for(;r<a;)n+=this.modules[r++].rules.length;n+=l.rules.length,r++}}if(i)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let o="";for(let a=0;a<this.modules.length;a++)o+=this.modules[a].getRules()+`
`;this.styleTag.textContent=o;let l=t.head||t;this.styleTag.parentNode!=l&&l.insertBefore(this.styleTag,l.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}function Di(s){let e;return s.nodeType==11?e=s.getSelection?s:s.ownerDocument:e=s,e.getSelection()}function An(s,e){return e?s==e||s.contains(e.nodeType!=1?e.parentNode:e):!1}function Qd(s){let e=s.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function hs(s,e){if(!e.anchorNode)return!1;try{return An(s,e.anchorNode)}catch{return!1}}function Yt(s){return s.nodeType==3?At(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function wi(s,e,t,i){return t?no(s,e,t,i,-1)||no(s,e,t,i,1):!1}function Et(s){for(var e=0;;e++)if(s=s.previousSibling,!s)return e}function ks(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}function no(s,e,t,i,n){for(;;){if(s==t&&e==i)return!0;if(e==(n<0?0:tt(s))){if(s.nodeName=="DIV")return!1;let r=s.parentNode;if(!r||r.nodeType!=1)return!1;e=Et(s)+(n<0?0:1),s=r}else if(s.nodeType==1){if(s=s.childNodes[e+(n<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;e=n<0?tt(s):0}else return!1}}function tt(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}function Ps(s,e){let t=e?s.left:s.right;return{left:t,right:t,top:s.top,bottom:s.bottom}}function ef(s){let e=s.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function ql(s,e){let t=e.width/s.offsetWidth,i=e.height/s.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-s.offsetWidth)<1)&&(t=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(e.height-s.offsetHeight)<1)&&(i=1),{scaleX:t,scaleY:i}}function tf(s,e,t,i,n,r,o,l){let a=s.ownerDocument,c=a.defaultView||window;for(let h=s,u=!1;h&&!u;)if(h.nodeType==1){let d,m=h==a.body,g=1,p=1;if(m)d=ef(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(h).position)&&(u=!0),h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.assignedSlot||h.parentNode;continue}let y=h.getBoundingClientRect();({scaleX:g,scaleY:p}=ql(h,y)),d={left:y.left,right:y.left+h.clientWidth*g,top:y.top,bottom:y.top+h.clientHeight*p}}let x=0,w=0;if(n=="nearest")e.top<d.top?(w=-(d.top-e.top+o),t>0&&e.bottom>d.bottom+w&&(w=e.bottom-d.bottom+w+o)):e.bottom>d.bottom&&(w=e.bottom-d.bottom+o,t<0&&e.top-w<d.top&&(w=-(d.top+w-e.top+o)));else{let y=e.bottom-e.top,S=d.bottom-d.top;w=(n=="center"&&y<=S?e.top+y/2-S/2:n=="start"||n=="center"&&t<0?e.top-o:e.bottom-S+o)-d.top}if(i=="nearest"?e.left<d.left?(x=-(d.left-e.left+r),t>0&&e.right>d.right+x&&(x=e.right-d.right+x+r)):e.right>d.right&&(x=e.right-d.right+r,t<0&&e.left<d.left+x&&(x=-(d.left+x-e.left+r))):x=(i=="center"?e.left+(e.right-e.left)/2-(d.right-d.left)/2:i=="start"==l?e.left-r:e.right-(d.right-d.left)+r)-d.left,x||w)if(m)c.scrollBy(x,w);else{let y=0,S=0;if(w){let b=h.scrollTop;h.scrollTop+=w/p,S=(h.scrollTop-b)*p}if(x){let b=h.scrollLeft;h.scrollLeft+=x/g,y=(h.scrollLeft-b)*g}e={left:e.left-y,top:e.top-S,right:e.right-y,bottom:e.bottom-S},y&&Math.abs(y-x)<1&&(i="nearest"),S&&Math.abs(S-w)<1&&(n="nearest")}if(m)break;h=h.assignedSlot||h.parentNode}else if(h.nodeType==11)h=h.host;else break}function sf(s){let e=s.ownerDocument,t,i;for(let n=s.parentNode;n&&!(n==e.body||t&&i);)if(n.nodeType==1)!i&&n.scrollHeight>n.clientHeight&&(i=n),!t&&n.scrollWidth>n.clientWidth&&(t=n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;return{x:t,y:i}}class nf{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?tt(t):0),i,Math.min(e.focusOffset,i?tt(i):0))}set(e,t,i,n){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=n}}let Pt=null;function zl(s){if(s.setActive)return s.setActive();if(Pt)return s.focus(Pt);let e=[];for(let t=s;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(s.focus(Pt==null?{get preventScroll(){return Pt={preventScroll:!0},!0}}:void 0),!Pt){Pt=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],r=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let ro;function At(s,e,t=e){let i=ro||(ro=document.createRange());return i.setEnd(s,t),i.setStart(s,e),i}function Wt(s,e,t,i){let n={key:e,code:e,keyCode:t,which:t,cancelable:!0};i&&({altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey,metaKey:n.metaKey}=i);let r=new KeyboardEvent("keydown",n);r.synthetic=!0,s.dispatchEvent(r);let o=new KeyboardEvent("keyup",n);return o.synthetic=!0,s.dispatchEvent(o),r.defaultPrevented||o.defaultPrevented}function rf(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function Ul(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}function of(s,e){let t=e.focusNode,i=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=i)return!1;for(i=Math.min(i,tt(t));;)if(i){if(t.nodeType!=1)return!1;let n=t.childNodes[i-1];n.contentEditable=="false"?i--:(t=n,i=tt(t))}else{if(t==s)return!0;i=Et(t),t=t.parentNode}}function $l(s){return s.scrollTop>Math.max(1,s.scrollHeight-s.clientHeight-4)}function Gl(s,e){for(let t=s,i=e;;){if(t.nodeType==3&&i>0)return{node:t,offset:i};if(t.nodeType==1&&i>0){if(t.contentEditable=="false")return null;t=t.childNodes[i-1],i=tt(t)}else if(t.parentNode&&!ks(t))i=Et(t),t=t.parentNode;else return null}}function Kl(s,e){for(let t=s,i=e;;){if(t.nodeType==3&&i<t.nodeValue.length)return{node:t,offset:i};if(t.nodeType==1&&i<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[i],i=0}else if(t.parentNode&&!ks(t))i=Et(t)+1,t=t.parentNode;else return null}}class me{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new me(e.parentNode,Et(e),t)}static after(e,t){return new me(e.parentNode,Et(e)+1,t)}}const fr=[];class K{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.flags&2){let i=this.dom,n=null,r;for(let o of this.children){if(o.flags&7){if(!o.dom&&(r=n?n.nextSibling:i.firstChild)){let l=K.get(r);(!l||!l.parent&&l.canReuseDOM(o))&&o.reuseDOM(r)}o.sync(e,t),o.flags&=-8}if(r=n?n.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&r!=o.dom&&(t.written=!0),o.dom.parentNode==i)for(;r&&r!=o.dom;)r=oo(r);else i.insertBefore(o.dom,r);n=o.dom}for(r=n?n.nextSibling:i.firstChild,r&&t&&t.node==i&&(t.written=!0);r;)r=oo(r)}else if(this.flags&1)for(let i of this.children)i.flags&7&&(i.sync(e,t),i.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let n=tt(e)==0?0:t==0?-1:1;for(;;){let r=e.parentNode;if(r==this.dom)break;n==0&&r.firstChild!=r.lastChild&&(e==r.firstChild?n=-1:n=1),e=r}n<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!K.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let o=this.children[n];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(e,t,i=0){let n=-1,r=-1,o=-1,l=-1;for(let a=0,c=i,h=i;a<this.children.length;a++){let u=this.children[a],d=c+u.length;if(c<e&&d>t)return u.domBoundsAround(e,t,c);if(d>=e&&n==-1&&(n=a,r=c),c>t&&u.dom.parentNode==this.dom){o=a,l=h;break}h=d,c=d+u.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),t.flags&1)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=fr){this.markDirty();for(let n=e;n<t;n++){let r=this.children[n];r.parent==this&&i.indexOf(r)<0&&r.destroy()}this.children.splice(e,t-e,...i);for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new Yl(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,i,n,r,o){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}K.prototype.breakAfter=0;function oo(s){let e=s.nextSibling;return s.parentNode.removeChild(s),e}class Yl{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Zl(s,e,t,i,n,r,o,l,a){let{children:c}=s,h=c.length?c[e]:null,u=r.length?r[r.length-1]:null,d=u?u.breakAfter:o;if(!(e==i&&h&&!o&&!d&&r.length<2&&h.merge(t,n,r.length?u:null,t==0,l,a))){if(i<c.length){let m=c[i];m&&(n<m.length||m.breakAfter&&u?.breakAfter)?(e==i&&(m=m.split(n),n=0),!d&&u&&m.merge(0,n,u,!0,0,a)?r[r.length-1]=m:((n||m.children.length&&!m.children[0].length)&&m.merge(0,n,null,!1,0,a),r.push(m))):m?.breakAfter&&(u?u.breakAfter=1:o=1),i++}for(h&&(h.breakAfter=o,t>0&&(!o&&r.length&&h.merge(t,h.length,r[0],!1,l,0)?h.breakAfter=r.shift().breakAfter:(t<h.length||h.children.length&&h.children[h.children.length-1].length==0)&&h.merge(t,h.length,null,!1,l,0),e++));e<i&&r.length;)if(c[i-1].become(r[r.length-1]))i--,r.pop(),a=r.length?0:l;else if(c[e].become(r[0]))e++,r.shift(),l=r.length?0:a;else break;!r.length&&e&&i<c.length&&!c[e-1].breakAfter&&c[i].merge(0,0,c[e-1],!1,l,a)&&e--,(e<i||r.length)&&s.replaceChildren(e,i,r)}}function Xl(s,e,t,i,n,r){let o=s.childCursor(),{i:l,off:a}=o.findPos(t,1),{i:c,off:h}=o.findPos(e,-1),u=e-t;for(let d of i)u+=d.length;s.length+=u,Zl(s,c,h,l,a,i,0,n,r)}let ve=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},Tn=typeof document<"u"?document:{documentElement:{style:{}}};const On=/Edge\/(\d+)/.exec(ve.userAgent),Jl=/MSIE \d/.test(ve.userAgent),Dn=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ve.userAgent),js=!!(Jl||Dn||On),lo=!js&&/gecko\/(\d+)/i.test(ve.userAgent),Zs=!js&&/Chrome\/(\d+)/.exec(ve.userAgent),ao="webkitFontSmoothing"in Tn.documentElement.style,Ql=!js&&/Apple Computer/.test(ve.vendor),ho=Ql&&(/Mobile\/\w+/.test(ve.userAgent)||ve.maxTouchPoints>2);var M={mac:ho||/Mac/.test(ve.platform),windows:/Win/.test(ve.platform),linux:/Linux|X11/.test(ve.platform),ie:js,ie_version:Jl?Tn.documentMode||6:Dn?+Dn[1]:On?+On[1]:0,gecko:lo,gecko_version:lo?+(/Firefox\/(\d+)/.exec(ve.userAgent)||[0,0])[1]:0,chrome:!!Zs,chrome_version:Zs?+Zs[1]:0,ios:ho,android:/Android\b/.test(ve.userAgent),webkit:ao,safari:Ql,webkit_version:ao?+(/\bAppleWebKit\/(\d+)/.exec(ve.userAgent)||[0,0])[1]:0,tabSize:Tn.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const lf=256;class je extends K{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return this.flags&8||i&&(!(i instanceof je)||this.length-(t-e)+i.length>lf||i.flags&8)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new je(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=this.flags&8,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new me(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return af(this.dom,e,t)}}class it extends K{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let n of t)n.setParent(this)}setAttrs(e){if(Ul(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,i,n,r,o){return i&&(!(i instanceof it&&i.mark.eq(this.mark))||e&&r<=0||t<this.length&&o<=0)?!1:(Xl(this,e,t,i?i.children.slice():[],r-1,o-1),this.markDirty(),!0)}split(e){let t=[],i=0,n=-1,r=0;for(let l of this.children){let a=i+l.length;a>e&&t.push(i<e?l.split(e-i):l),n<0&&i>=e&&(n=r),i=a,r++}let o=this.length-e;return this.length=e,n>-1&&(this.children.length=n,this.markDirty()),new it(this.mark,t,o)}domAtPos(e){return ea(this,e)}coordsAt(e,t){return ia(this,e,t)}}function af(s,e,t){let i=s.nodeValue.length;e>i&&(e=i);let n=e,r=e,o=0;e==0&&t<0||e==i&&t>=0?M.chrome||M.gecko||(e?(n--,o=1):r<i&&(r++,o=-1)):t<0?n--:r<i&&r++;let l=At(s,n,r).getClientRects();if(!l.length)return null;let a=l[(o?o<0:t>=0)?0:l.length-1];return M.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,c=>c.width)||a),o?Ps(a,o<0):a||null}class vt extends K{static create(e,t,i){return new vt(e,t,i)}constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}split(e){let t=vt.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,i,n,r,o){return i&&(!(i instanceof vt)||!this.widget.compare(i.widget)||e>0&&r<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e instanceof vt&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return q.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,i=t&&t.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):q.empty}domAtPos(e){return(this.length?e==0:this.side>0)?me.before(this.dom):me.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);if(i)return i;let n=this.dom.getClientRects(),r=null;if(!n.length)return null;let o=this.side?this.side<0:e>0;for(let l=o?n.length-1:0;r=n[l],!(e>0?l==0:l==n.length-1||r.top<r.bottom);l+=o?-1:1);return Ps(r,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Zt extends K{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Zt&&e.side==this.side}split(){return new Zt(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?me.before(this.dom):me.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return q.empty}get isHidden(){return!0}}je.prototype.children=vt.prototype.children=Zt.prototype.children=fr;function ea(s,e){let t=s.dom,{children:i}=s,n=0;for(let r=0;n<i.length;n++){let o=i[n],l=r+o.length;if(!(l==r&&o.getSide()<=0)){if(e>r&&e<l&&o.dom.parentNode==t)return o.domAtPos(e-r);if(e<=r)break;r=l}}for(let r=n;r>0;r--){let o=i[r-1];if(o.dom.parentNode==t)return o.domAtPos(o.length)}for(let r=n;r<i.length;r++){let o=i[r];if(o.dom.parentNode==t)return o.domAtPos(0)}return new me(t,0)}function ta(s,e,t){let i,{children:n}=s;t>0&&e instanceof it&&n.length&&(i=n[n.length-1])instanceof it&&i.mark.eq(e.mark)?ta(i,e.children[0],t-1):(n.push(e),e.setParent(s)),s.length+=e.length}function ia(s,e,t){let i=null,n=-1,r=null,o=-1;function l(c,h){for(let u=0,d=0;u<c.children.length&&d<=h;u++){let m=c.children[u],g=d+m.length;g>=h&&(m.children.length?l(m,h-d):(!r||r.isHidden&&t>0)&&(g>h||d==g&&m.getSide()>0)?(r=m,o=h-d):(d<h||d==g&&m.getSide()<0&&!m.isHidden)&&(i=m,n=h-d)),d=g}}l(s,e);let a=(t<0?i:r)||i||r;return a?a.coordsAt(Math.max(0,a==i?n:o),t):hf(s)}function hf(s){let e=s.dom.lastChild;if(!e)return s.dom.getBoundingClientRect();let t=Yt(e);return t[t.length-1]||null}function Ln(s,e){for(let t in s)t=="class"&&e.class?e.class+=" "+s.class:t=="style"&&e.style?e.style+=";"+s.style:e[t]=s[t];return e}const co=Object.create(null);function Ms(s,e,t){if(s==e)return!0;s||(s=co),e||(e=co);let i=Object.keys(s),n=Object.keys(e);if(i.length-(t&&i.indexOf(t)>-1?1:0)!=n.length-(t&&n.indexOf(t)>-1?1:0))return!1;for(let r of i)if(r!=t&&(n.indexOf(r)==-1||s[r]!==e[r]))return!1;return!0}function Rn(s,e,t){let i=!1;if(e)for(let n in e)t&&n in t||(i=!0,n=="style"?s.style.cssText="":s.removeAttribute(n));if(t)for(let n in t)e&&e[n]==t[n]||(i=!0,n=="style"?s.style.cssText=t[n]:s.setAttribute(n,t[n]));return i}function cf(s){let e=Object.create(null);for(let t=0;t<s.attributes.length;t++){let i=s.attributes[t];e[i.name]=i.value}return e}class re extends K{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,n,r,o){if(i){if(!(i instanceof re))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Xl(this,e,t,i?i.children.slice():[],r,o),!0}split(e){let t=new re;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:n}=this.childPos(e);n&&(t.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)t.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Ms(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){ta(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=Ln(t,this.attrs||{})),i&&(this.attrs=Ln({class:i},this.attrs||{}))}domAtPos(e){return ea(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,t){var i;this.dom?this.flags&4&&(Ul(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Rn(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let n=this.dom.lastChild;for(;n&&K.get(n)instanceof it;)n=n.lastChild;if(!n||!this.length||n.nodeName!="BR"&&((i=K.get(n))===null||i===void 0?void 0:i.isEditable)==!1&&(!M.ios||!this.children.some(r=>r instanceof je))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let i of this.children){if(!(i instanceof je)||/[^ -~]/.test(i.text))return null;let n=Yt(i.dom);if(n.length!=1)return null;e+=n[0].width,t=n[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let i=ia(this,e,t);if(!this.children.length&&i&&this.parent){let{heightOracle:n}=this.parent.view.viewState,r=i.bottom-i.top;if(Math.abs(r-n.lineHeight)<2&&n.textHeight<r){let o=(r-n.textHeight)/2;return{top:i.top+o,bottom:i.bottom-o,left:i.left,right:i.left}}}return i}become(e){return e instanceof re&&this.children.length==0&&e.children.length==0&&Ms(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let i=0,n=0;i<e.children.length;i++){let r=e.children[i],o=n+r.length;if(o>=t){if(r instanceof re)return r;if(o>t)break}n=o+r.breakAfter}return null}}class Qe extends K{constructor(e,t,i){super(),this.widget=e,this.length=t,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,n,r,o){return i&&(!(i instanceof Qe)||!this.widget.compare(i.widget)||e>0&&r<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?me.before(this.dom):me.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new Qe(this.widget,t,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return fr}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):q.empty}domBoundsAround(){return null}become(e){return e instanceof Qe&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){return this.widget.coordsAt(this.dom,e,t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:i}=this.deco;return t==i?!1:e<0?t<0:i>0}}class Qt{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var we=function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s}(we||(we={}));class Z extends Gt{constructor(e,t,i,n){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(e){return new Bi(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new mt(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,n;if(e.isBlockGap)i=-5e8,n=4e8;else{let{start:r,end:o}=sa(e,t);i=(r?t?-3e8:-1:5e8)-1,n=(o?t?2e8:1:-6e8)+1}return new mt(e,i,n,t,e.widget||null,!0)}static line(e){return new Hi(e)}static set(e,t=!1){return W.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Z.none=W.empty;class Bi extends Z{constructor(e){let{start:t,end:i}=sa(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,i;return this==e||e instanceof Bi&&this.tagName==e.tagName&&(this.class||((t=this.attrs)===null||t===void 0?void 0:t.class))==(e.class||((i=e.attrs)===null||i===void 0?void 0:i.class))&&Ms(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Bi.prototype.point=!1;class Hi extends Z{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Hi&&this.spec.class==e.spec.class&&Ms(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Hi.prototype.mapMode=Ae.TrackBefore;Hi.prototype.point=!0;class mt extends Z{constructor(e,t,i,n,r,o){super(t,i,r,e),this.block=n,this.isReplace=o,this.mapMode=n?t<=0?Ae.TrackBefore:Ae.TrackAfter:Ae.TrackDel}get type(){return this.startSide!=this.endSide?we.WidgetRange:this.startSide<=0?we.WidgetBefore:we.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof mt&&uf(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}mt.prototype.point=!0;function sa(s,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=s;return t==null&&(t=s.inclusive),i==null&&(i=s.inclusive),{start:t??e,end:i??e}}function uf(s,e){return s==e||!!(s&&e&&s.compare(e))}function Nn(s,e,t,i=0){let n=t.length-1;n>=0&&t[n]+i>=s?t[n]=Math.max(t[n],e):t.push(s,e)}class yi{constructor(e,t,i,n){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof Qe&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new re),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Zi(new Zt(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof Qe)&&this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=r,this.textOff=0}let n=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-i)),this.getLine().append(Zi(new je(this.text.slice(this.textOff,this.textOff+n)),t),i),this.atCursorPos=!0,this.textOff+=n,e-=n,i=0}}span(e,t,i,n){this.buildText(t-e,i,n),this.pos=t,this.openStart<0&&(this.openStart=n)}point(e,t,i,n,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof mt){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=t-e;if(i instanceof mt)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Qe(i.widget||Xt.block,l,i));else{let a=vt.create(i.widget||Xt.inline,l,l?0:i.startSide),c=this.atCursorPos&&!a.isEditable&&r<=n.length&&(e<t||i.startSide>0),h=!a.isEditable&&(e<t||r>n.length||i.startSide<=0),u=this.getLine();this.pendingBuffer==2&&!c&&!a.isEditable&&(this.pendingBuffer=0),this.flushBuffer(n),c&&(u.append(Zi(new Zt(1),n),r),r=n.length+Math.max(0,r-n.length)),u.append(Zi(a,n),r),this.atCursorPos=h,this.pendingBuffer=h?e<t||r>n.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=n.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=r)}static build(e,t,i,n,r){let o=new yi(e,t,i,r);return o.openEnd=W.spans(n,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Zi(s,e){for(let t of e)s=new it(t,[s],s.length);return s}class Xt extends Qt{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Xt.inline=new Xt("span");Xt.block=new Xt("div");var oe=function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s}(oe||(oe={}));const Tt=oe.LTR,mr=oe.RTL;function na(s){let e=[];for(let t=0;t<s.length;t++)e.push(1<<+s[t]);return e}const df=na("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ff=na("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),In=Object.create(null),Ve=[];for(let s of["()","[]","{}"]){let e=s.charCodeAt(0),t=s.charCodeAt(1);In[e]=t,In[t]=-e}function ra(s){return s<=247?df[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?ff[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8204?256:64336<=s&&s<=65023?4:1}const mf=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class ct{get dir(){return this.level%2?mr:Tt}constructor(e,t,i){this.from=e,this.to=t,this.level=i}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,i,n){let r=-1;for(let o=0;o<e.length;o++){let l=e[o];if(l.from<=t&&l.to>=t){if(l.level==i)return o;(r<0||(n!=0?n<0?l.from<t:l.to>t:e[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}}function oa(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++){let i=s[t],n=e[t];if(i.from!=n.from||i.to!=n.to||i.direction!=n.direction||!oa(i.inner,n.inner))return!1}return!0}const G=[];function gf(s,e,t,i,n){for(let r=0;r<=i.length;r++){let o=r?i[r-1].to:e,l=r<i.length?i[r].from:t,a=r?256:n;for(let c=o,h=a,u=a;c<l;c++){let d=ra(s.charCodeAt(c));d==512?d=h:d==8&&u==4&&(d=16),G[c]=d==4?2:d,d&7&&(u=d),h=d}for(let c=o,h=a,u=a;c<l;c++){let d=G[c];if(d==128)c<l-1&&h==G[c+1]&&h&24?d=G[c]=h:G[c]=256;else if(d==64){let m=c+1;for(;m<l&&G[m]==64;)m++;let g=c&&h==8||m<t&&G[m]==8?u==1?1:8:256;for(let p=c;p<m;p++)G[p]=g;c=m-1}else d==8&&u==1&&(G[c]=1);h=d,d&7&&(u=d)}}}function pf(s,e,t,i,n){let r=n==1?2:1;for(let o=0,l=0,a=0;o<=i.length;o++){let c=o?i[o-1].to:e,h=o<i.length?i[o].from:t;for(let u=c,d,m,g;u<h;u++)if(m=In[d=s.charCodeAt(u)])if(m<0){for(let p=l-3;p>=0;p-=3)if(Ve[p+1]==-m){let x=Ve[p+2],w=x&2?n:x&4?x&1?r:n:0;w&&(G[u]=G[Ve[p]]=w),l=p;break}}else{if(Ve.length==189)break;Ve[l++]=u,Ve[l++]=d,Ve[l++]=a}else if((g=G[u])==2||g==1){let p=g==n;a=p?0:1;for(let x=l-3;x>=0;x-=3){let w=Ve[x+2];if(w&2)break;if(p)Ve[x+2]|=2;else{if(w&4)break;Ve[x+2]|=4}}}}}function xf(s,e,t,i){for(let n=0,r=i;n<=t.length;n++){let o=n?t[n-1].to:s,l=n<t.length?t[n].from:e;for(let a=o;a<l;){let c=G[a];if(c==256){let h=a+1;for(;;)if(h==l){if(n==t.length)break;h=t[n++].to,l=n<t.length?t[n].from:e}else if(G[h]==256)h++;else break;let u=r==1,d=(h<e?G[h]:i)==1,m=u==d?u?1:2:i;for(let g=h,p=n,x=p?t[p-1].to:s;g>a;)g==x&&(g=t[--p].from,x=p?t[p-1].to:s),G[--g]=m;a=h}else r=c,a++}}}function Pn(s,e,t,i,n,r,o){let l=i%2?2:1;if(i%2==n%2)for(let a=e,c=0;a<t;){let h=!0,u=!1;if(c==r.length||a<r[c].from){let p=G[a];p!=l&&(h=!1,u=p==16)}let d=!h&&l==1?[]:null,m=h?i:i+1,g=a;e:for(;;)if(c<r.length&&g==r[c].from){if(u)break e;let p=r[c];if(!h)for(let x=p.to,w=c+1;;){if(x==t)break e;if(w<r.length&&r[w].from==x)x=r[w++].to;else{if(G[x]==l)break e;break}}if(c++,d)d.push(p);else{p.from>a&&o.push(new ct(a,p.from,m));let x=p.direction==Tt!=!(m%2);jn(s,x?i+1:i,n,p.inner,p.from,p.to,o),a=p.to}g=p.to}else{if(g==t||(h?G[g]!=l:G[g]==l))break;g++}d?Pn(s,a,g,i+1,n,d,o):a<g&&o.push(new ct(a,g,m)),a=g}else for(let a=t,c=r.length;a>e;){let h=!0,u=!1;if(!c||a>r[c-1].to){let p=G[a-1];p!=l&&(h=!1,u=p==16)}let d=!h&&l==1?[]:null,m=h?i:i+1,g=a;e:for(;;)if(c&&g==r[c-1].to){if(u)break e;let p=r[--c];if(!h)for(let x=p.from,w=c;;){if(x==e)break e;if(w&&r[w-1].to==x)x=r[--w].from;else{if(G[x-1]==l)break e;break}}if(d)d.push(p);else{p.to<a&&o.push(new ct(p.to,a,m));let x=p.direction==Tt!=!(m%2);jn(s,x?i+1:i,n,p.inner,p.from,p.to,o),a=p.from}g=p.from}else{if(g==e||(h?G[g-1]!=l:G[g-1]==l))break;g--}d?Pn(s,g,a,i+1,n,d,o):g<a&&o.push(new ct(g,a,m)),a=g}}function jn(s,e,t,i,n,r,o){let l=e%2?2:1;gf(s,n,r,i,l),pf(s,n,r,i,l),xf(n,r,i,l),Pn(s,n,r,e,t,i,o)}function Cf(s,e,t){if(!s)return[new ct(0,0,e==mr?1:0)];if(e==Tt&&!t.length&&!mf.test(s))return la(s.length);if(t.length)for(;s.length>G.length;)G[G.length]=256;let i=[],n=e==Tt?0:1;return jn(s,n,n,t,0,s.length,i),i}function la(s){return[new ct(0,s,0)]}let aa="";function wf(s,e,t,i,n){var r;let o=i.head-s.from,l=ct.find(e,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc),a=e[l],c=a.side(n,t);if(o==c){let d=l+=n?1:-1;if(d<0||d>=e.length)return null;a=e[l=d],o=a.side(!n,t),c=a.side(n,t)}let h=qe(s.text,o,a.forward(n,t));(h<a.from||h>a.to)&&(h=c),aa=s.text.slice(Math.min(o,h),Math.max(o,h));let u=l==(n?e.length-1:0)?null:e[l+(n?1:-1)];return u&&h==c&&u.level+(n?0:1)<a.level?T.cursor(u.side(!n,t)+s.from,u.forward(n,t)?1:-1,u.level):T.cursor(h+s.from,a.forward(n,t)?-1:1,a.level)}function yf(s,e,t){for(let i=e;i<t;i++){let n=ra(s.charCodeAt(i));if(n==1)return Tt;if(n==2||n==4)return mr}return Tt}const ha=L.define(),ca=L.define(),ua=L.define(),da=L.define(),Bn=L.define(),fa=L.define(),ma=L.define(),ga=L.define({combine:s=>s.some(e=>e)}),pa=L.define({combine:s=>s.some(e=>e)}),xa=L.define();class qt{constructor(e,t="nearest",i="nearest",n=5,r=5,o=!1){this.range=e,this.y=t,this.x=i,this.yMargin=n,this.xMargin=r,this.isSnapshot=o}map(e){return e.empty?this:new qt(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new qt(T.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Xi=se.define({map:(s,e)=>s.map(e)}),Ca=se.define();function Ze(s,e,t){let i=s.facet(da);i.length?i[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const lt=L.define({combine:s=>s.length?s[0]:!0});let bf=0;const ui=L.define();class Ue{constructor(e,t,i,n,r){this.id=e,this.create=t,this.domEventHandlers=i,this.domEventObservers=n,this.extension=r(this)}static define(e,t){const{eventHandlers:i,eventObservers:n,provide:r,decorations:o}=t||{};return new Ue(bf++,e,i,n,l=>{let a=[ui.of(l)];return o&&a.push(Li.of(c=>{let h=c.plugin(l);return h?o(h):Z.none})),r&&a.push(r(l)),a})}static fromClass(e,t){return Ue.define(i=>new e(i),t)}}class Xs{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(Ze(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Ze(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){Ze(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const wa=L.define(),gr=L.define(),Li=L.define(),ya=L.define(),pr=L.define(),ba=L.define();function uo(s,e){let t=s.state.facet(ba);if(!t.length)return t;let i=t.map(r=>r instanceof Function?r(s):r),n=[];return W.spans(i,e.from,e.to,{point(){},span(r,o,l,a){let c=r-e.from,h=o-e.from,u=n;for(let d=l.length-1;d>=0;d--,a--){let m=l[d].spec.bidiIsolate,g;if(m==null&&(m=yf(e.text,c,h)),a>0&&u.length&&(g=u[u.length-1]).to==c&&g.direction==m)g.to=h,u=g.inner;else{let p={from:c,to:h,direction:m,inner:[]};u.push(p),u=p.inner}}}}),n}const va=L.define();function Sa(s){let e=0,t=0,i=0,n=0;for(let r of s.state.facet(va)){let o=r(s);o&&(o.left!=null&&(e=Math.max(e,o.left)),o.right!=null&&(t=Math.max(t,o.right)),o.top!=null&&(i=Math.max(i,o.top)),o.bottom!=null&&(n=Math.max(n,o.bottom)))}return{left:e,right:t,top:i,bottom:n}}const di=L.define();class De{constructor(e,t,i,n){this.fromA=e,this.toA=t,this.fromB=i,this.toB=n}join(e){return new De(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let n=e[t-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let n=0,r=0,o=0,l=0;;n++){let a=n==e.length?null:e[n],c=o-l,h=a?a.fromB:1e9;for(;r<t.length&&t[r]<h;){let u=t[r],d=t[r+1],m=Math.max(l,u),g=Math.min(h,d);if(m<=g&&new De(m+c,g+c,m,g).addToSet(i),d>h)break;r+=2}if(!a)return i;new De(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),o=a.toA,l=a.toB}}}class Es{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=he.empty(this.startState.doc.length);for(let r of i)this.changes=this.changes.compose(r.changes);let n=[];this.changes.iterChangedRanges((r,o,l,a)=>n.push(new De(r,o,l,a))),this.changedRanges=n}static create(e,t,i){return new Es(e,t,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class fo extends K{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Z.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new re],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new De(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:c,toA:h})=>h<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let n=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?n=this.domChanged.newSel.head:!Tf(e.changes,this.hasComposition)&&!e.selectionSet&&(n=e.state.selection.main.head));let r=n>-1?Sf(this.view,e.changes,n):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:c,to:h}=this.hasComposition;i=new De(c,h,e.changes.mapPos(c,-1),e.changes.mapPos(h,1)).addToSet(i.slice())}this.hasComposition=r?{from:r.range.fromB,to:r.range.toB}:null,(M.ie||M.chrome)&&!r&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,l=this.updateDeco(),a=Ef(o,l,e.changes);return i=De.extendWithRanges(i,a),!(this.flags&7)&&i.length==0?!1:(this.updateInner(i,e.startState.doc.length,r),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,i);let{observer:n}=this.view;n.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=M.chrome||M.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||n.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Qe&&o.widget instanceof mo&&r.push(o.dom);n.updateGaps(r)}updateChildren(e,t,i){let n=i?i.range.addToSet(e.slice()):e,r=this.childCursor(t);for(let o=n.length-1;;o--){let l=o>=0?n[o]:null;if(!l)break;let{fromA:a,toA:c,fromB:h,toB:u}=l,d,m,g,p;if(i&&i.range.fromB<u&&i.range.toB>h){let b=yi.build(this.view.state.doc,h,i.range.fromB,this.decorations,this.dynamicDecorationMap),v=yi.build(this.view.state.doc,i.range.toB,u,this.decorations,this.dynamicDecorationMap);m=b.breakAtStart,g=b.openStart,p=v.openEnd;let k=this.compositionView(i);v.breakAtStart?k.breakAfter=1:v.content.length&&k.merge(k.length,k.length,v.content[0],!1,v.openStart,0)&&(k.breakAfter=v.content[0].breakAfter,v.content.shift()),b.content.length&&k.merge(0,0,b.content[b.content.length-1],!0,0,b.openEnd)&&b.content.pop(),d=b.content.concat(k).concat(v.content)}else({content:d,breakAtStart:m,openStart:g,openEnd:p}=yi.build(this.view.state.doc,h,u,this.decorations,this.dynamicDecorationMap));let{i:x,off:w}=r.findPos(c,1),{i:y,off:S}=r.findPos(a,-1);Zl(this,y,S,x,w,d,m,g,p)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let i of t.effects)i.is(Ca)&&(this.editContextFormatting=i.value)}compositionView(e){let t=new je(e.text.nodeValue);t.flags|=8;for(let{deco:n}of e.marks)t=new it(n,[t],t.length);let i=new re;return i.append(t,0),i}fixCompositionDOM(e){let t=(r,o)=>{o.flags|=8|(o.children.some(a=>a.flags&7)?1:0),this.markedForComposition.add(o);let l=K.get(r);l&&l!=o&&(l.dom=null),o.setDOM(r)},i=this.childPos(e.range.fromB,1),n=this.children[i.i];t(e.line,n);for(let r=e.marks.length-1;r>=-1;r--)i=n.childPos(i.off,1),n=n.children[i.i],t(r>=0?e.marks[r].node:e.text,n)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let i=this.view.root.activeElement,n=i==this.dom,r=!n&&hs(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(n||t||r))return;let o=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,a=this.moveToLine(this.domAtPos(l.anchor)),c=l.empty?a:this.moveToLine(this.domAtPos(l.head));if(M.gecko&&l.empty&&!this.hasComposition&&vf(a)){let u=document.createTextNode("");this.view.observer.ignore(()=>a.node.insertBefore(u,a.node.childNodes[a.offset]||null)),a=c=new me(u,0),o=!0}let h=this.view.observer.selectionRange;(o||!h.focusNode||(!wi(a.node,a.offset,h.anchorNode,h.anchorOffset)||!wi(c.node,c.offset,h.focusNode,h.focusOffset))&&!this.suppressWidgetCursorChange(h,l))&&(this.view.observer.ignore(()=>{M.android&&M.chrome&&this.dom.contains(h.focusNode)&&Af(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let u=Di(this.view.root);if(u)if(l.empty){if(M.gecko){let d=kf(a.node,a.offset);if(d&&d!=3){let m=(d==1?Gl:Kl)(a.node,a.offset);m&&(a=new me(m.node,m.offset))}}u.collapse(a.node,a.offset),l.bidiLevel!=null&&u.caretBidiLevel!==void 0&&(u.caretBidiLevel=l.bidiLevel)}else if(u.extend){u.collapse(a.node,a.offset);try{u.extend(c.node,c.offset)}catch{}}else{let d=document.createRange();l.anchor>l.head&&([a,c]=[c,a]),d.setEnd(c.node,c.offset),d.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(d)}r&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(a,c)),this.impreciseAnchor=a.precise?null:new me(h.anchorNode,h.anchorOffset),this.impreciseHead=c.precise?null:new me(h.focusNode,h.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&wi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,i=Di(e.root),{anchorNode:n,anchorOffset:r}=e.observer.selectionRange;if(!i||!t.empty||!t.assoc||!i.modify)return;let o=re.find(this,t.head);if(!o)return;let l=o.posAtStart;if(t.head==l||t.head==l+o.length)return;let a=this.coordsAt(t.head,-1),c=this.coordsAt(t.head,1);if(!a||!c||a.bottom>c.top)return;let h=this.domAtPos(t.head+t.assoc);i.collapse(h.node,h.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let u=e.observer.selectionRange;e.docView.posFromDOM(u.anchorNode,u.anchorOffset)!=t.from&&i.collapse(n,r)}moveToLine(e){let t=this.dom,i;if(e.node!=t)return e;for(let n=e.offset;!i&&n<t.childNodes.length;n++){let r=K.get(t.childNodes[n]);r instanceof re&&(i=r.domAtPos(0))}for(let n=e.offset-1;!i&&n>=0;n--){let r=K.get(t.childNodes[n]);r instanceof re&&(i=r.domAtPos(r.length))}return i?new me(i.node,i.offset,!0):e}nearest(e){for(let t=e;t;){let i=K.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let n=this.children[t];if(i<n.length||n instanceof re)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){let i=null,n=0;for(let r=this.length,o=this.children.length-1;o>=0;o--){let l=this.children[o],a=r-l.breakAfter,c=a-l.length;if(a<e)break;if(c<=e&&(c<e||l.covers(-1))&&(a>e||l.covers(1))&&(!i||l instanceof re&&!(i instanceof re&&t>=0)))i=l,n=c;else if(i&&c==e&&a==e&&l instanceof Qe&&Math.abs(t)<2){if(l.deco.startSide<0)break;o&&(i=null)}r=c}return i?i.coordsAt(e-n,t):null}coordsForChar(e){let{i:t,off:i}=this.childPos(e,1),n=this.children[t];if(!(n instanceof re))return null;for(;n.children.length;){let{i:l,off:a}=n.childPos(i,1);for(;;l++){if(l==n.children.length)return null;if((n=n.children[l]).length)break}i=a}if(!(n instanceof je))return null;let r=qe(n.text,i);if(r==i)return null;let o=At(n.dom,i,r).getClientRects();for(let l=0;l<o.length;l++){let a=o[l];if(l==o.length-1||a.top<a.bottom&&a.left<a.right)return a}return null}measureVisibleLineHeights(e){let t=[],{from:i,to:n}=e,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,a=this.view.textDirection==oe.LTR;for(let c=0,h=0;h<this.children.length;h++){let u=this.children[h],d=c+u.length;if(d>n)break;if(c>=i){let m=u.dom.getBoundingClientRect();if(t.push(m.height),o){let g=u.dom.lastChild,p=g?Yt(g):[];if(p.length){let x=p[p.length-1],w=a?x.right-m.left:m.right-x.left;w>l&&(l=w,this.minWidth=r,this.minWidthFrom=c,this.minWidthTo=d)}}}c=d+u.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?oe.RTL:oe.LTR}measureTextSize(){for(let r of this.children)if(r instanceof re){let o=r.measureTextSize();if(o)return o}let e=document.createElement("div"),t,i,n;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=Yt(e.firstChild)[0];t=e.getBoundingClientRect().height,i=r?r.width/27:7,n=r?r.height:t,e.remove()}),{lineHeight:t,charWidth:i,textHeight:n}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new Yl(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,n=0;;n++){let r=n==t.viewports.length?null:t.viewports[n],o=r?r.from-1:this.length;if(o>i){let l=(t.lineBlockAt(o).bottom-t.lineBlockAt(i).top)/this.view.scaleY;e.push(Z.replace({widget:new mo(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return Z.set(e)}updateDeco(){let e=1,t=this.view.state.facet(Li).map(r=>(this.dynamicDecorationMap[e++]=typeof r=="function")?r(this.view):r),i=!1,n=this.view.state.facet(ya).map((r,o)=>{let l=typeof r=="function";return l&&(i=!0),l?r(this.view):r});for(n.length&&(this.dynamicDecorationMap[e++]=i,t.push(W.join(n))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let c of this.view.state.facet(xa))try{if(c(this.view,e.range,e))return!0}catch(h){Ze(this.view.state,h,"scroll handler")}let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),n;if(!i)return;!t.empty&&(n=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let r=Sa(this.view),o={left:i.left-r.left,top:i.top-r.top,right:i.right+r.right,bottom:i.bottom+r.bottom},{offsetWidth:l,offsetHeight:a}=this.view.scrollDOM;tf(this.view.scrollDOM,o,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,l),-l),Math.max(Math.min(e.yMargin,a),-a),this.view.textDirection==oe.LTR)}}function vf(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}class mo extends Qt{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function ka(s,e){let t=s.observer.selectionRange;if(!t.focusNode)return null;let i=Gl(t.focusNode,t.focusOffset),n=Kl(t.focusNode,t.focusOffset),r=i||n;if(n&&i&&n.node!=i.node){let l=K.get(n.node);if(!l||l instanceof je&&l.text!=n.node.nodeValue)r=n;else if(s.docView.lastCompositionAfterCursor){let a=K.get(i.node);!a||a instanceof je&&a.text!=i.node.nodeValue||(r=n)}}if(s.docView.lastCompositionAfterCursor=r!=i,!r)return null;let o=e-r.offset;return{from:o,to:o+r.node.nodeValue.length,node:r.node}}function Sf(s,e,t){let i=ka(s,t);if(!i)return null;let{node:n,from:r,to:o}=i,l=n.nodeValue;if(/[\n\r]/.test(l)||s.state.doc.sliceString(i.from,i.to)!=l)return null;let a=e.invertedDesc,c=new De(a.mapPos(r),a.mapPos(o),r,o),h=[];for(let u=n.parentNode;;u=u.parentNode){let d=K.get(u);if(d instanceof it)h.push({node:u,deco:d.mark});else{if(d instanceof re||u.nodeName=="DIV"&&u.parentNode==s.contentDOM)return{range:c,text:n,marks:h,line:u};if(u!=s.contentDOM)h.push({node:u,deco:new Bi({inclusive:!0,attributes:cf(u),tagName:u.tagName.toLowerCase()})});else return null}}}function kf(s,e){return s.nodeType!=1?0:(e&&s.childNodes[e-1].contentEditable=="false"?1:0)|(e<s.childNodes.length&&s.childNodes[e].contentEditable=="false"?2:0)}let Mf=class{constructor(){this.changes=[]}compareRange(e,t){Nn(e,t,this.changes)}comparePoint(e,t){Nn(e,t,this.changes)}};function Ef(s,e,t){let i=new Mf;return W.compare(s,e,t,i),i.changes}function Af(s,e){for(let t=s;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function Tf(s,e){let t=!1;return e&&s.iterChangedRanges((i,n)=>{i<e.to&&n>e.from&&(t=!0)}),t}function Of(s,e,t=1){let i=s.charCategorizer(e),n=s.doc.lineAt(e),r=e-n.from;if(n.length==0)return T.cursor(e);r==0?t=1:r==n.length&&(t=-1);let o=r,l=r;t<0?o=qe(n.text,r,!1):l=qe(n.text,r);let a=i(n.text.slice(o,l));for(;o>0;){let c=qe(n.text,o,!1);if(i(n.text.slice(c,o))!=a)break;o=c}for(;l<n.length;){let c=qe(n.text,l);if(i(n.text.slice(l,c))!=a)break;l=c}return T.range(o+n.from,l+n.from)}function Df(s,e){return e.left>s?e.left-s:Math.max(0,s-e.right)}function Lf(s,e){return e.top>s?e.top-s:Math.max(0,s-e.bottom)}function Js(s,e){return s.top<e.bottom-1&&s.bottom>e.top+1}function go(s,e){return e<s.top?{top:e,left:s.left,right:s.right,bottom:s.bottom}:s}function po(s,e){return e>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:e}:s}function Hn(s,e,t){let i,n,r,o,l=!1,a,c,h,u;for(let g=s.firstChild;g;g=g.nextSibling){let p=Yt(g);for(let x=0;x<p.length;x++){let w=p[x];n&&Js(n,w)&&(w=go(po(w,n.bottom),n.top));let y=Df(e,w),S=Lf(t,w);if(y==0&&S==0)return g.nodeType==3?xo(g,e,t):Hn(g,e,t);if(!i||o>S||o==S&&r>y){i=g,n=w,r=y,o=S;let b=S?t<w.top?-1:1:y?e<w.left?-1:1:0;l=!b||(b>0?x<p.length-1:x>0)}y==0?t>w.bottom&&(!h||h.bottom<w.bottom)?(a=g,h=w):t<w.top&&(!u||u.top>w.top)&&(c=g,u=w):h&&Js(h,w)?h=po(h,w.bottom):u&&Js(u,w)&&(u=go(u,w.top))}}if(h&&h.bottom>=t?(i=a,n=h):u&&u.top<=t&&(i=c,n=u),!i)return{node:s,offset:0};let d=Math.max(n.left,Math.min(n.right,e));if(i.nodeType==3)return xo(i,d,t);if(l&&i.contentEditable!="false")return Hn(i,d,t);let m=Array.prototype.indexOf.call(s.childNodes,i)+(e>=(n.left+n.right)/2?1:0);return{node:s,offset:m}}function xo(s,e,t){let i=s.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<i;l++){let a=At(s,l,l+1).getClientRects();for(let c=0;c<a.length;c++){let h=a[c];if(h.top==h.bottom)continue;o||(o=e-h.left);let u=(h.top>t?h.top-t:t-h.bottom)-1;if(h.left-1<=e&&h.right+1>=e&&u<r){let d=e>=(h.left+h.right)/2,m=d;if((M.chrome||M.gecko)&&At(s,l).getBoundingClientRect().left==h.right&&(m=!d),u<=0)return{node:s,offset:l+(m?1:0)};n=l+(m?1:0),r=u}}}return{node:s,offset:n>-1?n:o>0?s.nodeValue.length:0}}function Ma(s,e,t,i=-1){var n,r;let o=s.contentDOM.getBoundingClientRect(),l=o.top+s.viewState.paddingTop,a,{docHeight:c}=s.viewState,{x:h,y:u}=e,d=u-l;if(d<0)return 0;if(d>c)return s.state.doc.length;for(let b=s.viewState.heightOracle.textHeight/2,v=!1;a=s.elementAtHeight(d),a.type!=we.Text;)for(;d=i>0?a.bottom+b:a.top-b,!(d>=0&&d<=c);){if(v)return t?null:0;v=!0,i=-i}u=l+d;let m=a.from;if(m<s.viewport.from)return s.viewport.from==0?0:t?null:Co(s,o,a,h,u);if(m>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:t?null:Co(s,o,a,h,u);let g=s.dom.ownerDocument,p=s.root.elementFromPoint?s.root:g,x=p.elementFromPoint(h,u);x&&!s.contentDOM.contains(x)&&(x=null),x||(h=Math.max(o.left+1,Math.min(o.right-1,h)),x=p.elementFromPoint(h,u),x&&!s.contentDOM.contains(x)&&(x=null));let w,y=-1;if(x&&((n=s.docView.nearest(x))===null||n===void 0?void 0:n.isEditable)!=!1){if(g.caretPositionFromPoint){let b=g.caretPositionFromPoint(h,u);b&&({offsetNode:w,offset:y}=b)}else if(g.caretRangeFromPoint){let b=g.caretRangeFromPoint(h,u);b&&({startContainer:w,startOffset:y}=b,(!s.contentDOM.contains(w)||M.safari&&Rf(w,y,h)||M.chrome&&Nf(w,y,h))&&(w=void 0))}}if(!w||!s.docView.dom.contains(w)){let b=re.find(s.docView,m);if(!b)return d>a.top+a.height/2?a.to:a.from;({node:w,offset:y}=Hn(b.dom,h,u))}let S=s.docView.nearest(w);if(!S)return null;if(S.isWidget&&((r=S.dom)===null||r===void 0?void 0:r.nodeType)==1){let b=S.dom.getBoundingClientRect();return e.y<b.top||e.y<=b.bottom&&e.x<=(b.left+b.right)/2?S.posAtStart:S.posAtEnd}else return S.localPosFromDOM(w,y)+S.posAtStart}function Co(s,e,t,i,n){let r=Math.round((i-e.left)*s.defaultCharacterWidth);if(s.lineWrapping&&t.height>s.defaultLineHeight*1.5){let l=s.viewState.heightOracle.textHeight,a=Math.floor((n-t.top-(s.defaultLineHeight-l)*.5)/l);r+=a*s.viewState.heightOracle.lineLength}let o=s.state.sliceDoc(t.from,t.to);return t.from+Xd(o,r,s.state.tabSize)}function Rf(s,e,t){let i;if(s.nodeType!=3||e!=(i=s.nodeValue.length))return!1;for(let n=s.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return At(s,i-1,i).getBoundingClientRect().left>t}function Nf(s,e,t){if(e!=0)return!1;for(let n=s;;){let r=n.parentNode;if(!r||r.nodeType!=1||r.firstChild!=n)return!1;if(r.classList.contains("cm-line"))break;n=r}let i=s.nodeType==1?s.getBoundingClientRect():At(s,0,Math.max(s.nodeValue.length,1)).getBoundingClientRect();return t-i.left>5}function Vn(s,e){let t=s.lineBlockAt(e);if(Array.isArray(t.type)){for(let i of t.type)if(i.to>e||i.to==e&&(i.to==t.to||i.type==we.Text))return i}return t}function If(s,e,t,i){let n=Vn(s,e.head),r=!i||n.type!=we.Text||!(s.lineWrapping||n.widgetLineBreaks)?null:s.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head);if(r){let o=s.dom.getBoundingClientRect(),l=s.textDirectionAt(n.from),a=s.posAtCoords({x:t==(l==oe.LTR)?o.right-1:o.left+1,y:(r.top+r.bottom)/2});if(a!=null)return T.cursor(a,t?-1:1)}return T.cursor(t?n.to:n.from,t?-1:1)}function wo(s,e,t,i){let n=s.state.doc.lineAt(e.head),r=s.bidiSpans(n),o=s.textDirectionAt(n.from);for(let l=e,a=null;;){let c=wf(n,r,o,l,t),h=aa;if(!c){if(n.number==(t?s.state.doc.lines:1))return l;h=`
`,n=s.state.doc.line(n.number+(t?1:-1)),r=s.bidiSpans(n),c=s.visualLineSide(n,!t)}if(a){if(!a(h))return l}else{if(!i)return c;a=i(h)}l=c}}function Pf(s,e,t){let i=s.state.charCategorizer(e),n=i(t);return r=>{let o=i(r);return n==Ye.Space&&(n=o),n==o}}function jf(s,e,t,i){let n=e.head,r=t?1:-1;if(n==(t?s.state.doc.length:0))return T.cursor(n,e.assoc);let o=e.goalColumn,l,a=s.contentDOM.getBoundingClientRect(),c=s.coordsAtPos(n,e.assoc||-1),h=s.documentTop;if(c)o==null&&(o=c.left-a.left),l=r<0?c.top:c.bottom;else{let m=s.viewState.lineBlockAt(n);o==null&&(o=Math.min(a.right-a.left,s.defaultCharacterWidth*(n-m.from))),l=(r<0?m.top:m.bottom)+h}let u=a.left+o,d=i??s.viewState.heightOracle.textHeight>>1;for(let m=0;;m+=10){let g=l+(d+m)*r,p=Ma(s,{x:u,y:g},!1,r);if(g<a.top||g>a.bottom||(r<0?p<n:p>n)){let x=s.docView.coordsForChar(p),w=!x||g<x.top?-1:1;return T.cursor(p,w,void 0,o)}}}function cs(s,e,t){for(;;){let i=0;for(let n of s)n.between(e-1,e+1,(r,o,l)=>{if(e>r&&e<o){let a=i||t||(e-r<o-e?-1:1);e=a<0?r:o,i=a}});if(!i)return e}}function Qs(s,e,t){let i=cs(s.state.facet(pr).map(n=>n(s)),t.from,e.head>t.from?-1:1);return i==t.from?t:T.cursor(i,i<t.from?1:-1)}class Bf{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,M.safari&&e.contentDOM.addEventListener("input",()=>null),M.gecko&&Qf(e.contentDOM.ownerDocument)}handleEvent(e){!Uf(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||this.runHandlers(e.type,e)}runHandlers(e,t){let i=this.handlers[e];if(i){for(let n of i.observers)n(this.view,t);for(let n of i.handlers){if(t.defaultPrevented)break;if(n(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=Hf(e),i=this.handlers,n=this.view.contentDOM;for(let r in t)if(r!="scroll"){let o=!t[r].handlers.length,l=i[r];l&&o!=!l.handlers.length&&(n.removeEventListener(r,this.handleEvent),l=null),l||n.addEventListener(r,this.handleEvent,{passive:o})}for(let r in i)r!="scroll"&&!t[r]&&n.removeEventListener(r,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&Aa.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),M.android&&M.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return M.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=Ea.find(i=>i.keyCode==e.keyCode))&&!e.ctrlKey||Vf.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,Wt(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:M.safari&&!M.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function yo(s,e){return(t,i)=>{try{return e.call(s,i,t)}catch(n){Ze(t.state,n)}}}function Hf(s){let e=Object.create(null);function t(i){return e[i]||(e[i]={observers:[],handlers:[]})}for(let i of s){let n=i.spec;if(n&&n.domEventHandlers)for(let r in n.domEventHandlers){let o=n.domEventHandlers[r];o&&t(r).handlers.push(yo(i.value,o))}if(n&&n.domEventObservers)for(let r in n.domEventObservers){let o=n.domEventObservers[r];o&&t(r).observers.push(yo(i.value,o))}}for(let i in Be)t(i).handlers.push(Be[i]);for(let i in Le)t(i).observers.push(Le[i]);return e}const Ea=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Vf="dthko",Aa=[16,17,18,20,91,92,224,225],Ji=6;function Qi(s){return Math.max(0,s)*.7+8}function Ff(s,e){return Math.max(Math.abs(s.clientX-e.clientX),Math.abs(s.clientY-e.clientY))}class _f{constructor(e,t,i,n){this.view=e,this.startEvent=t,this.style=i,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=sf(e.contentDOM),this.atoms=e.state.facet(pr).map(o=>o(e));let r=e.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(J.allowMultipleSelections)&&Wf(e,t),this.dragging=zf(e,t)&&La(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&Ff(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,i=0,n=0,r=0,o=this.view.win.innerWidth,l=this.view.win.innerHeight;this.scrollParents.x&&({left:n,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:r,bottom:l}=this.scrollParents.y.getBoundingClientRect());let a=Sa(this.view);e.clientX-a.left<=n+Ji?t=-Qi(n-e.clientX):e.clientX+a.right>=o-Ji&&(t=Qi(e.clientX-o)),e.clientY-a.top<=r+Ji?i=-Qi(r-e.clientY):e.clientY+a.bottom>=l-Ji&&(i=Qi(e.clientY-l)),this.setScrollSpeed(t,i)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let i=0;i<e.ranges.length;i++){let n=e.ranges[i],r=null;if(n.empty){let o=cs(this.atoms,n.from,0);o!=n.from&&(r=T.cursor(o,-1))}else{let o=cs(this.atoms,n.from,-1),l=cs(this.atoms,n.to,1);(o!=n.from||l!=n.to)&&(r=T.range(n.from==n.anchor?o:l,n.from==n.head?o:l))}r&&(t||(t=e.ranges.slice()),t[i]=r)}return t?T.create(t,e.mainIndex):e}select(e){let{view:t}=this,i=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!i.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function Wf(s,e){let t=s.state.facet(ha);return t.length?t[0](e):M.mac?e.metaKey:e.ctrlKey}function qf(s,e){let t=s.state.facet(ca);return t.length?t[0](e):M.mac?!e.altKey:!e.ctrlKey}function zf(s,e){let{main:t}=s.state.selection;if(t.empty)return!1;let i=Di(s.root);if(!i||i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let o=n[r];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function Uf(s,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=s.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=K.get(t))&&i.ignoreEvent(e))return!1;return!0}const Be=Object.create(null),Le=Object.create(null),Ta=M.ie&&M.ie_version<15||M.ios&&M.webkit_version<604;function $f(s){let e=s.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{s.focus(),t.remove(),Oa(s,t.value)},50)}function Oa(s,e){let{state:t}=s,i,n=1,r=t.toText(e),o=r.lines==t.selection.ranges.length;if(Fn!=null&&t.selection.ranges.every(a=>a.empty)&&Fn==r.toString()){let a=-1;i=t.changeByRange(c=>{let h=t.doc.lineAt(c.from);if(h.from==a)return{range:c};a=h.from;let u=t.toText((o?r.line(n++).text:e)+t.lineBreak);return{changes:{from:h.from,insert:u},range:T.cursor(c.from+u.length)}})}else o?i=t.changeByRange(a=>{let c=r.line(n++);return{changes:{from:a.from,to:a.to,insert:c.text},range:T.cursor(a.from+c.length)}}):i=t.replaceSelection(r);s.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Le.scroll=s=>{s.inputState.lastScrollTop=s.scrollDOM.scrollTop,s.inputState.lastScrollLeft=s.scrollDOM.scrollLeft};Be.keydown=(s,e)=>(s.inputState.setSelectionOrigin("select"),e.keyCode==27&&s.inputState.tabFocusMode!=0&&(s.inputState.tabFocusMode=Date.now()+2e3),!1);Le.touchstart=(s,e)=>{s.inputState.lastTouchTime=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};Le.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};Be.mousedown=(s,e)=>{if(s.observer.flush(),s.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let i of s.state.facet(ua))if(t=i(s,e),t)break;if(!t&&e.button==0&&(t=Yf(s,e)),t){let i=!s.hasFocus;s.inputState.startMouseSelection(new _f(s,e,t,i)),i&&s.observer.ignore(()=>{zl(s.contentDOM);let r=s.root.activeElement;r&&!r.contains(s.contentDOM)&&r.blur()});let n=s.inputState.mouseSelection;if(n)return n.start(e),n.dragging===!1}return!1};function bo(s,e,t,i){if(i==1)return T.cursor(e,t);if(i==2)return Of(s.state,e,t);{let n=re.find(s.docView,e),r=s.state.doc.lineAt(n?n.posAtEnd:e),o=n?n.posAtStart:r.from,l=n?n.posAtEnd:r.to;return l<s.state.doc.length&&l==r.to&&l++,T.range(o,l)}}let Da=(s,e)=>s>=e.top&&s<=e.bottom,vo=(s,e,t)=>Da(e,t)&&s>=t.left&&s<=t.right;function Gf(s,e,t,i){let n=re.find(s.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(r==0)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&vo(t,i,o))return-1;let l=n.coordsAt(r,1);return l&&vo(t,i,l)?1:o&&Da(i,o)?-1:1}function So(s,e){let t=s.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:Gf(s,t,e.clientX,e.clientY)}}const Kf=M.ie&&M.ie_version<=11;let ko=null,Mo=0,Eo=0;function La(s){if(!Kf)return s.detail;let e=ko,t=Eo;return ko=s,Eo=Date.now(),Mo=!e||t>Date.now()-400&&Math.abs(e.clientX-s.clientX)<2&&Math.abs(e.clientY-s.clientY)<2?(Mo+1)%3:1}function Yf(s,e){let t=So(s,e),i=La(e),n=s.state.selection;return{update(r){r.docChanged&&(t.pos=r.changes.mapPos(t.pos),n=n.map(r.changes))},get(r,o,l){let a=So(s,r),c,h=bo(s,a.pos,a.bias,i);if(t.pos!=a.pos&&!o){let u=bo(s,t.pos,t.bias,i),d=Math.min(u.from,h.from),m=Math.max(u.to,h.to);h=d<h.from?T.range(d,m):T.range(m,d)}return o?n.replaceRange(n.main.extend(h.from,h.to)):l&&i==1&&n.ranges.length>1&&(c=Zf(n,a.pos))?c:l?n.addRange(h):T.create([h])}}}function Zf(s,e){for(let t=0;t<s.ranges.length;t++){let{from:i,to:n}=s.ranges[t];if(i<=e&&n>=e)return T.create(s.ranges.slice(0,t).concat(s.ranges.slice(t+1)),s.mainIndex==t?0:s.mainIndex-(s.mainIndex>t?1:0))}return null}Be.dragstart=(s,e)=>{let{selection:{main:t}}=s.state;if(e.target.draggable){let n=s.docView.nearest(e.target);if(n&&n.isWidget){let r=n.posAtStart,o=r+n.length;(r>=t.to||o<=t.from)&&(t=T.range(r,o))}}let{inputState:i}=s;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",s.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove"),!1};Be.dragend=s=>(s.inputState.draggedContent=null,!1);function Ao(s,e,t,i){if(!t)return;let n=s.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:r}=s.inputState,o=i&&r&&qf(s,e)?{from:r.from,to:r.to}:null,l={from:n,insert:t},a=s.state.changes(o?[o,l]:l);s.focus(),s.dispatch({changes:a,selection:{anchor:a.mapPos(n,-1),head:a.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"}),s.inputState.draggedContent=null}Be.drop=(s,e)=>{if(!e.dataTransfer)return!1;if(s.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let i=Array(t.length),n=0,r=()=>{++n==t.length&&Ao(s,e,i.filter(o=>o!=null).join(s.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(t[o])}return!0}else{let i=e.dataTransfer.getData("Text");if(i)return Ao(s,e,i,!0),!0}return!1};Be.paste=(s,e)=>{if(s.state.readOnly)return!0;s.observer.flush();let t=Ta?null:e.clipboardData;return t?(Oa(s,t.getData("text/plain")||t.getData("text/uri-list")),!0):($f(s),!1)};function Xf(s,e){let t=s.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),s.focus()},50)}function Jf(s){let e=[],t=[],i=!1;for(let n of s.selection.ranges)n.empty||(e.push(s.sliceDoc(n.from,n.to)),t.push(n));if(!e.length){let n=-1;for(let{from:r}of s.selection.ranges){let o=s.doc.lineAt(r);o.number>n&&(e.push(o.text),t.push({from:o.from,to:Math.min(s.doc.length,o.to+1)})),n=o.number}i=!0}return{text:e.join(s.lineBreak),ranges:t,linewise:i}}let Fn=null;Be.copy=Be.cut=(s,e)=>{let{text:t,ranges:i,linewise:n}=Jf(s.state);if(!t&&!n)return!1;Fn=n?t:null,e.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"});let r=Ta?null:e.clipboardData;return r?(r.clearData(),r.setData("text/plain",t),!0):(Xf(s,t),!1)};const Ra=Jt.define();function Na(s,e){let t=[];for(let i of s.facet(ma)){let n=i(s,e);n&&t.push(n)}return t?s.update({effects:t,annotations:Ra.of(!0)}):null}function Ia(s){setTimeout(()=>{let e=s.hasFocus;if(e!=s.inputState.notifiedFocused){let t=Na(s.state,e);t?s.dispatch(t):s.update([])}},10)}Le.focus=s=>{s.inputState.lastFocusTime=Date.now(),!s.scrollDOM.scrollTop&&(s.inputState.lastScrollTop||s.inputState.lastScrollLeft)&&(s.scrollDOM.scrollTop=s.inputState.lastScrollTop,s.scrollDOM.scrollLeft=s.inputState.lastScrollLeft),Ia(s)};Le.blur=s=>{s.observer.clearSelectionRange(),Ia(s)};Le.compositionstart=Le.compositionupdate=s=>{s.observer.editContext||(s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0))};Le.compositionend=s=>{s.observer.editContext||(s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionPendingKey=!0,s.inputState.compositionPendingChange=s.observer.pendingRecords().length>0,s.inputState.compositionFirstChange=null,M.chrome&&M.android?s.observer.flushSoon():s.inputState.compositionPendingChange?Promise.resolve().then(()=>s.observer.flush()):setTimeout(()=>{s.inputState.composing<0&&s.docView.hasComposition&&s.update([])},50))};Le.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};Be.beforeinput=(s,e)=>{var t;let i;if(M.chrome&&M.android&&(i=Ea.find(n=>n.inputType==e.inputType))&&(s.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let n=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>n+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}return M.ios&&e.inputType=="deleteContentForward"&&s.observer.flushSoon(),M.safari&&e.inputType=="insertText"&&s.inputState.composing>=0&&setTimeout(()=>Le.compositionend(s,e),20),!1};const To=new Set;function Qf(s){To.has(s)||(To.add(s),s.addEventListener("copy",()=>{}),s.addEventListener("cut",()=>{}))}const Oo=["pre-wrap","normal","pre-line","break-spaces"];class e1{constructor(e){this.lineWrapping=e,this.doc=q.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return Oo.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let n=e[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(t=!0,this.heightSamples[Math.floor(n*10)]=!0)}return t}refresh(e,t,i,n,r,o){let l=Oo.indexOf(e)>-1,a=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=t,this.charWidth=i,this.textHeight=n,this.lineLength=r,a){this.heightSamples={};for(let c=0;c<o.length;c++){let h=o[c];h<0?c++:this.heightSamples[Math.floor(h*10)]=!0}}return a}}class t1{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class _e{constructor(e,t,i,n,r){this.from=e,this.length=t,this.top=i,this.height=n,this._content=r}get type(){return typeof this._content=="number"?we.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof mt?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new _e(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var X=function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s}(X||(X={}));const us=.001;class ye{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>us&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return ye.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,n){let r=this,o=i.doc;for(let l=n.length-1;l>=0;l--){let{fromA:a,toA:c,fromB:h,toB:u}=n[l],d=r.lineAt(a,X.ByPosNoHeight,i.setDoc(t),0,0),m=d.to>=c?d:r.lineAt(c,X.ByPosNoHeight,i,0,0);for(u+=m.to-c,c=m.to;l>0&&d.from<=n[l-1].toA;)a=n[l-1].fromA,h=n[l-1].fromB,l--,a<d.from&&(d=r.lineAt(a,X.ByPosNoHeight,i,0,0));h+=d.from-a,a=d.from;let g=xr.build(i.setDoc(o),e,h,u);r=r.replace(a,c,g)}return r.updateHeight(i,0)}static empty(){return new Ee(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,n=0,r=0;for(;;)if(t==i)if(n>r*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(r>n*2){let l=e[i];l.break?e.splice(i,1,l.left,null,l.right):e.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(n<r){let l=e[t++];l&&(n+=l.size)}else{let l=e[--i];l&&(r+=l.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,i++),new i1(ye.of(e.slice(0,t)),o,ye.of(e.slice(i)))}}ye.prototype.size=1;class Pa extends ye{constructor(e,t,i){super(e,t),this.deco=i}blockAt(e,t,i,n){return new _e(n,this.length,i,this.height,this.deco||0)}lineAt(e,t,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(e,t,i,n,r,o){e<=r+this.length&&t>=r&&o(this.blockAt(0,i,n,r))}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more&&this.setHeight(e,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Ee extends Pa{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,i,n){return new _e(n,this.length,i,this.height,this.breaks)}replace(e,t,i){let n=i[0];return i.length==1&&(n instanceof Ee||n instanceof ce&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof ce?n=new Ee(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):ye.of(i)}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more?this.setHeight(e,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ce extends ye{constructor(e){super(e,0)}heightMetrics(e,t){let i=e.doc.lineAt(t).number,n=e.doc.lineAt(t+this.length).number,r=n-i+1,o,l=0;if(e.lineWrapping){let a=Math.min(this.height,e.lineHeight*r);o=a/r,this.length>r+1&&(l=(this.height-a)/(this.length-r-1))}else o=this.height/r;return{firstLine:i,lastLine:n,perLine:o,perChar:l}}blockAt(e,t,i,n){let{firstLine:r,lastLine:o,perLine:l,perChar:a}=this.heightMetrics(t,n);if(t.lineWrapping){let c=n+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length)),h=t.doc.lineAt(c),u=l+h.length*a,d=Math.max(i,e-u/2);return new _e(h.from,h.length,d,u,0)}else{let c=Math.max(0,Math.min(o-r,Math.floor((e-i)/l))),{from:h,length:u}=t.doc.line(r+c);return new _e(h,u,i+l*c,l,0)}}lineAt(e,t,i,n,r){if(t==X.ByHeight)return this.blockAt(e,i,n,r);if(t==X.ByPosNoHeight){let{from:m,to:g}=i.doc.lineAt(e);return new _e(m,g-m,0,0,0)}let{firstLine:o,perLine:l,perChar:a}=this.heightMetrics(i,r),c=i.doc.lineAt(e),h=l+c.length*a,u=c.number-o,d=n+l*u+a*(c.from-r-u);return new _e(c.from,c.length,Math.max(n,Math.min(d,n+this.height-h)),h,0)}forEachLine(e,t,i,n,r,o){e=Math.max(e,r),t=Math.min(t,r+this.length);let{firstLine:l,perLine:a,perChar:c}=this.heightMetrics(i,r);for(let h=e,u=n;h<=t;){let d=i.doc.lineAt(h);if(h==e){let g=d.number-l;u+=a*g+c*(e-r-g)}let m=a+c*d.length;o(new _e(d.from,d.length,u,m,0)),u+=m,h=d.to+1}}replace(e,t,i){let n=this.length-t;if(n>0){let r=i[i.length-1];r instanceof ce?i[i.length-1]=new ce(r.length+n):i.push(null,new ce(n-1))}if(e>0){let r=i[0];r instanceof ce?i[0]=new ce(e+r.length):i.unshift(new ce(e-1),null)}return ye.of(i)}decomposeLeft(e,t){t.push(new ce(e-1),null)}decomposeRight(e,t){t.push(null,new ce(this.length-e-1))}updateHeight(e,t=0,i=!1,n){let r=t+this.length;if(n&&n.from<=t+this.length&&n.more){let o=[],l=Math.max(t,n.from),a=-1;for(n.from>t&&o.push(new ce(n.from-t-1).updateHeight(e,t));l<=r&&n.more;){let h=e.doc.lineAt(l).length;o.length&&o.push(null);let u=n.heights[n.index++];a==-1?a=u:Math.abs(u-a)>=us&&(a=-2);let d=new Ee(h,u);d.outdated=!1,o.push(d),l+=h+1}l<=r&&o.push(null,new ce(r-l).updateHeight(e,l));let c=ye.of(o);return(a<0||Math.abs(c.height-this.height)>=us||Math.abs(a-this.heightMetrics(e,t).perLine)>=us)&&(e.heightChanged=!0),c}else(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class i1 extends ye{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,n){let r=i+this.left.height;return e<r?this.left.blockAt(e,t,i,n):this.right.blockAt(e,t,r,n+this.left.length+this.break)}lineAt(e,t,i,n,r){let o=n+this.left.height,l=r+this.left.length+this.break,a=t==X.ByHeight?e<o:e<l,c=a?this.left.lineAt(e,t,i,n,r):this.right.lineAt(e,t,i,o,l);if(this.break||(a?c.to<l:c.from>l))return c;let h=t==X.ByPosNoHeight?X.ByPosNoHeight:X.ByPos;return a?c.join(this.right.lineAt(l,h,i,o,l)):this.left.lineAt(l,h,i,n,r).join(c)}forEachLine(e,t,i,n,r,o){let l=n+this.left.height,a=r+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,n,r,o),t>=a&&this.right.forEachLine(e,t,i,l,a,o);else{let c=this.lineAt(a,X.ByPos,i,n,r);e<c.from&&this.left.forEachLine(e,c.from-1,i,n,r,o),c.to>=e&&c.from<=t&&o(c),t>c.to&&this.right.forEachLine(c.to+1,t,i,l,a,o)}}replace(e,t,i){let n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,i));let r=[];e>0&&this.decomposeLeft(e,r);let o=r.length;for(let l of i)r.push(l);if(e>0&&Do(r,o-1),t<this.length){let l=r.length;this.decomposeRight(t,r),Do(r,l)}return ye.of(r)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,n=i+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<n&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?ye.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,n){let{left:r,right:o}=this,l=t+r.length+this.break,a=null;return n&&n.from<=t+r.length&&n.more?a=r=r.updateHeight(e,t,i,n):r.updateHeight(e,t,i),n&&n.from<=l+o.length&&n.more?a=o=o.updateHeight(e,l,i,n):o.updateHeight(e,l,i),a?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Do(s,e){let t,i;s[e]==null&&(t=s[e-1])instanceof ce&&(i=s[e+1])instanceof ce&&s.splice(e-1,3,new ce(t.length+1+i.length))}const s1=5;class xr{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof Ee?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Ee(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0,r=i.widget?i.widget.lineBreaks:0;n<0&&(n=this.oracle.lineHeight);let o=t-e;i.block?this.addBlock(new Pa(o,n,i)):(o||r||n>=s1)&&this.addLineDeco(n,r,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Ee(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new ce(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Ee)return e;let t=new Ee(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,i){let n=this.ensureLine();n.length+=i,n.collapsed+=i,n.widgetHeight=Math.max(n.widgetHeight,e),n.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof Ee)&&!this.isCovered?this.nodes.push(new Ee(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let n of this.nodes)n instanceof Ee&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(e,t,i,n){let r=new xr(i,e);return W.spans(t,i,n,r,0),r.finish(i)}}function n1(s,e,t){let i=new r1;return W.compare(s,e,t,i,0),i.changes}class r1{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,n){(e<t||i&&i.heightRelevant||n&&n.heightRelevant)&&Nn(e,t,this.changes,5)}}function o1(s,e){let t=s.getBoundingClientRect(),i=s.ownerDocument,n=i.defaultView||window,r=Math.max(0,t.left),o=Math.min(n.innerWidth,t.right),l=Math.max(0,t.top),a=Math.min(n.innerHeight,t.bottom);for(let c=s.parentNode;c&&c!=i.body;)if(c.nodeType==1){let h=c,u=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&u.overflow!="visible"){let d=h.getBoundingClientRect();r=Math.max(r,d.left),o=Math.min(o,d.right),l=Math.max(l,d.top),a=c==s.parentNode?d.bottom:Math.min(a,d.bottom)}c=u.position=="absolute"||u.position=="fixed"?h.offsetParent:h.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:r-t.left,right:Math.max(r,o)-t.left,top:l-(t.top+e),bottom:Math.max(l,a)-(t.top+e)}}function l1(s,e){let t=s.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class en{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let n=e[i],r=t[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(e,t){return Z.replace({widget:new a1(this.size*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class a1 extends Qt{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class Lo{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Ro,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=oe.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(gr).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new e1(t),this.stateDeco=e.facet(Li).filter(i=>typeof i!="function"),this.heightMap=ye.empty().applyChanges(this.stateDeco,q.empty,this.heightOracle.setDoc(e.doc),[new De(0,0,0,e.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Z.set(this.lineGaps.map(i=>i.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let n=i?t.head:t.anchor;if(!e.some(({from:r,to:o})=>n>=r&&n<=o)){let{from:r,to:o}=this.lineBlockAt(n);e.push(new es(r,o))}}return this.viewports=e.sort((i,n)=>i.from-n.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?Ro:new Cr(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(fi(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Li).filter(h=>typeof h!="function");let n=e.changedRanges,r=De.extendWithRanges(n,n1(i,this.stateDeco,e?e.changes:he.empty(this.state.doc.length))),o=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(e.flags|=2),l?(this.scrollAnchorPos=e.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let a=r.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let c=a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,e.flags|=this.updateForViewport(),(c||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(pa)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?oe.RTL:oe.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=t.getBoundingClientRect(),a=o||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let c=0,h=0;if(l.width&&l.height){let{scaleX:b,scaleY:v}=ql(t,l);(b>.005&&Math.abs(this.scaleX-b)>.005||v>.005&&Math.abs(this.scaleY-v)>.005)&&(this.scaleX=b,this.scaleY=v,c|=8,o=a=!0)}let u=(parseInt(i.paddingTop)||0)*this.scaleY,d=(parseInt(i.paddingBottom)||0)*this.scaleY;(this.paddingTop!=u||this.paddingBottom!=d)&&(this.paddingTop=u,this.paddingBottom=d,c|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=8);let m=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=m&&(this.scrollAnchorHeight=-1,this.scrollTop=m),this.scrolledToBottom=$l(e.scrollDOM);let g=(this.printing?l1:o1)(t,this.paddingTop),p=g.top-this.pixelViewport.top,x=g.bottom-this.pixelViewport.bottom;this.pixelViewport=g;let w=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(w!=this.inView&&(this.inView=w,w&&(a=!0)),!this.inView&&!this.scrollTarget)return 0;let y=l.width;if((this.contentDOMWidth!=y||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=e.scrollDOM.clientHeight,c|=8),a){let b=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(b)&&(o=!0),o||n.lineWrapping&&Math.abs(y-this.contentDOMWidth)>n.charWidth){let{lineHeight:v,charWidth:k,textHeight:O}=e.docView.measureTextSize();o=v>0&&n.refresh(r,v,k,O,y/k,b),o&&(e.docView.minWidth=0,c|=8)}p>0&&x>0?h=Math.max(p,x):p<0&&x<0&&(h=Math.min(p,x)),n.heightChanged=!1;for(let v of this.viewports){let k=v.from==this.viewport.from?b:e.docView.measureVisibleLineHeights(v);this.heightMap=(o?ye.empty().applyChanges(this.stateDeco,q.empty,this.heightOracle,[new De(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(n,0,o,new t1(v.from,k))}n.heightChanged&&(c|=2)}let S=!this.viewportIsAppropriate(this.viewport,h)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return S&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(h,this.scrollTarget),c|=this.updateForViewport()),(c&2||S)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,r=this.heightOracle,{visibleTop:o,visibleBottom:l}=this,a=new es(n.lineAt(o-i*1e3,X.ByHeight,r,0,0).from,n.lineAt(l+(1-i)*1e3,X.ByHeight,r,0,0).to);if(t){let{head:c}=t.range;if(c<a.from||c>a.to){let h=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=n.lineAt(c,X.ByPos,r,0,0),d;t.y=="center"?d=(u.top+u.bottom)/2-h/2:t.y=="start"||t.y=="nearest"&&c<a.from?d=u.top:d=u.bottom-h,a=new es(n.lineAt(d-1e3/2,X.ByHeight,r,0,0).from,n.lineAt(d+h+1e3/2,X.ByHeight,r,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new es(this.heightMap.lineAt(i,X.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(n,X.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,X.ByPos,this.heightOracle,0,0),{bottom:r}=this.heightMap.lineAt(t,X.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:l}=this;return(e==0||n<=o-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&r<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let n of e)t.touchesRange(n.from,n.to)||i.push(new en(t.mapPos(n.from),t.mapPos(n.to),n.size));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,n=i?1e4:2e3,r=n>>1,o=n<<1;if(this.defaultTextDirection!=oe.LTR&&!i)return[];let l=[],a=(h,u,d,m)=>{if(u-h<r)return;let g=this.state.selection.main,p=[g.from];g.empty||p.push(g.to);for(let w of p)if(w>h&&w<u){a(h,w-10,d,m),a(w+10,u,d,m);return}let x=c1(e,w=>w.from>=d.from&&w.to<=d.to&&Math.abs(w.from-h)<r&&Math.abs(w.to-u)<r&&!p.some(y=>w.from<y&&w.to>y));if(!x){if(u<d.to&&t&&i&&t.visibleRanges.some(w=>w.from<=u&&w.to>=u)){let w=t.moveToLineBoundary(T.cursor(u),!1,!0).head;w>h&&(u=w)}x=new en(h,u,this.gapSize(d,h,u,m))}l.push(x)},c=h=>{if(h.length<o||h.type!=we.Text)return;let u=h1(h.from,h.to,this.stateDeco);if(u.total<o)return;let d=this.scrollTarget?this.scrollTarget.range.head:null,m,g;if(i){let p=n/this.heightOracle.lineLength*this.heightOracle.lineHeight,x,w;if(d!=null){let y=is(u,d),S=((this.visibleBottom-this.visibleTop)/2+p)/h.height;x=y-S,w=y+S}else x=(this.visibleTop-h.top-p)/h.height,w=(this.visibleBottom-h.top+p)/h.height;m=ts(u,x),g=ts(u,w)}else{let p=u.total*this.heightOracle.charWidth,x=n*this.heightOracle.charWidth,w,y;if(d!=null){let S=is(u,d),b=((this.pixelViewport.right-this.pixelViewport.left)/2+x)/p;w=S-b,y=S+b}else w=(this.pixelViewport.left-x)/p,y=(this.pixelViewport.right+x)/p;m=ts(u,w),g=ts(u,y)}m>h.from&&a(h.from,m,h,u),g<h.to&&a(g,h.to,h,u)};for(let h of this.viewportLines)Array.isArray(h.type)?h.type.forEach(c):c(h);return l}gapSize(e,t,i,n){let r=is(n,i)-is(n,t);return this.heightOracle.lineWrapping?e.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(e){en.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Z.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];W.spans(e,this.viewport.from,this.viewport.to,{span(n,r){t.push({from:n,to:r})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some((n,r)=>n.from!=t[r].from||n.to!=t[r].to);return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||fi(this.heightMap.lineAt(e,X.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||fi(this.heightMap.lineAt(this.scaler.fromDOM(e),X.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return fi(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class es{constructor(e,t){this.from=e,this.to=t}}function h1(s,e,t){let i=[],n=s,r=0;return W.spans(t,s,e,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),r+=o-n),n=l}},20),n<e&&(i.push({from:n,to:e}),r+=e-n),{total:r,ranges:i}}function ts({total:s,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(s*t);for(let n=0;;n++){let{from:r,to:o}=e[n],l=o-r;if(i<=l)return r+i;i-=l}}function is(s,e){let t=0;for(let{from:i,to:n}of s.ranges){if(e<=n){t+=e-i;break}t+=n-i}return t/s.total}function c1(s,e){for(let t of s)if(e(t))return t}const Ro={toDOM(s){return s},fromDOM(s){return s},scale:1,eq(s){return s==this}};class Cr{constructor(e,t,i){let n=0,r=0,o=0;this.viewports=i.map(({from:l,to:a})=>{let c=t.lineAt(l,X.ByPos,e,0,0).top,h=t.lineAt(a,X.ByPos,e,0,0).bottom;return n+=h-c,{from:l,to:a,top:c,bottom:h,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(t.height-n);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(e){for(let t=0,i=0,n=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.top)return n+(e-i)*this.scale;if(e<=r.bottom)return r.domTop+(e-r.top);i=r.bottom,n=r.domBottom}}fromDOM(e){for(let t=0,i=0,n=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.domTop)return i+(e-n)/this.scale;if(e<=r.domBottom)return r.top+(e-r.domTop);i=r.bottom,n=r.domBottom}}eq(e){return e instanceof Cr?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,i)=>t.from==e.viewports[i].from&&t.to==e.viewports[i].to):!1}}function fi(s,e){if(e.scale==1)return s;let t=e.toDOM(s.top),i=e.toDOM(s.bottom);return new _e(s.from,s.length,t,i-t,Array.isArray(s._content)?s._content.map(n=>fi(n,e)):s._content)}const ss=L.define({combine:s=>s.join(" ")}),_n=L.define({combine:s=>s.indexOf(!0)>-1}),Wn=Kt.newName(),ja=Kt.newName(),Ba=Kt.newName(),Ha={"&light":"."+ja,"&dark":"."+Ba};function qn(s,e,t){return new Kt(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return s;if(!t||!t[n])throw new RangeError(`Unsupported selector: ${n}`);return t[n]}):s+" "+i}})}const u1=qn("."+Wn,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Ha),mi="ï¿¿";class d1{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(J.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=mi}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let n=e;;){this.findPointBefore(i,n);let r=this.text.length;this.readNode(n);let o=n.nextSibling;if(o==t)break;let l=K.get(n),a=K.get(o);(l&&a?l.breakAfter:(l?l.breakAfter:ks(n))||ks(o)&&(n.nodeName!="BR"||n.cmIgnore)&&this.text.length>r)&&this.lineBreak(),n=o}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(t))&&(r=l.index,o=l[0].length),this.append(t.slice(i,r<0?t.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=o-1);i=r+o}}readNode(e){if(e.cmIgnore)return;let t=K.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+(f1(e,i.node,i.offset)?t:0))}}function f1(s,e,t){for(;;){if(!e||t<tt(e))return!1;if(e==s)return!0;t=Et(e)+1,e=e.parentNode}}class No{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class m1{constructor(e,t,i,n){this.typeOver=n,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:r,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,i,0))){let l=r||o?[]:x1(e),a=new d1(l,e.state);a.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=a.text,this.newSel=C1(l,this.bounds.from)}else{let l=e.observer.selectionRange,a=r&&r.node==l.focusNode&&r.offset==l.focusOffset||!An(e.contentDOM,l.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(l.focusNode,l.focusOffset),c=o&&o.node==l.anchorNode&&o.offset==l.anchorOffset||!An(e.contentDOM,l.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(l.anchorNode,l.anchorOffset),h=e.viewport;if((M.ios||M.chrome)&&e.state.selection.main.empty&&a!=c&&(h.from>0||h.to<e.state.doc.length)){let u=Math.min(a,c),d=Math.max(a,c),m=h.from-u,g=h.to-d;(m==0||m==1||u==0)&&(g==0||g==-1||d==e.state.doc.length)&&(a=0,c=e.state.doc.length)}this.newSel=T.single(c,a)}}}function Va(s,e){let t,{newSel:i}=e,n=s.state.selection.main,r=s.inputState.lastKeyTime>Date.now()-100?s.inputState.lastKeyCode:-1;if(e.bounds){let{from:o,to:l}=e.bounds,a=n.from,c=null;(r===8||M.android&&e.text.length<l-o)&&(a=n.to,c="end");let h=p1(s.state.doc.sliceString(o,l,mi),e.text,a-o,c);h&&(M.chrome&&r==13&&h.toB==h.from+2&&e.text.slice(h.from,h.toB)==mi+mi&&h.toB--,t={from:o+h.from,to:o+h.toA,insert:q.of(e.text.slice(h.from,h.toB).split(mi))})}else i&&(!s.hasFocus&&s.state.facet(lt)||i.main.eq(n))&&(i=null);if(!t&&!i)return!1;if(!t&&e.typeOver&&!n.empty&&i&&i.main.empty?t={from:n.from,to:n.to,insert:s.state.doc.slice(n.from,n.to)}:t&&t.from>=n.from&&t.to<=n.to&&(t.from!=n.from||t.to!=n.to)&&n.to-n.from-(t.to-t.from)<=4?t={from:n.from,to:n.to,insert:s.state.doc.slice(n.from,t.from).append(t.insert).append(s.state.doc.slice(t.to,n.to))}:(M.mac||M.android)&&t&&t.from==t.to&&t.from==n.head-1&&/^\. ?$/.test(t.insert.toString())&&s.contentDOM.getAttribute("autocorrect")=="off"?(i&&t.insert.length==2&&(i=T.single(i.main.anchor-1,i.main.head-1)),t={from:n.from,to:n.to,insert:q.of([" "])}):M.chrome&&t&&t.from==t.to&&t.from==n.head&&t.insert.toString()==`
 `&&s.lineWrapping&&(i&&(i=T.single(i.main.anchor-1,i.main.head-1)),t={from:n.from,to:n.to,insert:q.of([" "])}),t)return Fa(s,t,i,r);if(i&&!i.main.eq(n)){let o=!1,l="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(o=!0),l=s.inputState.lastSelectionOrigin),s.dispatch({selection:i,scrollIntoView:o,userEvent:l}),!0}else return!1}function Fa(s,e,t,i=-1){if(M.ios&&s.inputState.flushIOSKey(e))return!0;let n=s.state.selection.main;if(M.android&&(e.to==n.to&&(e.from==n.from||e.from==n.from-1&&s.state.sliceDoc(e.from,n.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&Wt(s.contentDOM,"Enter",13)||(e.from==n.from-1&&e.to==n.to&&e.insert.length==0||i==8&&e.insert.length<e.to-e.from&&e.to>n.head)&&Wt(s.contentDOM,"Backspace",8)||e.from==n.from&&e.to==n.to+1&&e.insert.length==0&&Wt(s.contentDOM,"Delete",46)))return!0;let r=e.insert.toString();s.inputState.composing>=0&&s.inputState.composing++;let o,l=()=>o||(o=g1(s,e,t));return s.state.facet(fa).some(a=>a(s,e.from,e.to,r,l))||s.dispatch(l()),!0}function g1(s,e,t){let i,n=s.state,r=n.selection.main;if(e.from>=r.from&&e.to<=r.to&&e.to-e.from>=(r.to-r.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&s.inputState.composing<0){let l=r.from<e.from?n.sliceDoc(r.from,e.from):"",a=r.to>e.to?n.sliceDoc(e.to,r.to):"";i=n.replaceSelection(s.state.toText(l+e.insert.sliceString(0,void 0,s.state.lineBreak)+a))}else{let l=n.changes(e),a=t&&t.main.to<=l.newLength?t.main:void 0;if(n.selection.ranges.length>1&&s.inputState.composing>=0&&e.to<=r.to&&e.to>=r.to-10){let c=s.state.sliceDoc(e.from,e.to),h,u=t&&ka(s,t.main.head);if(u){let g=e.insert.length-(e.to-e.from);h={from:u.from,to:u.to-g}}else h=s.state.doc.lineAt(r.head);let d=r.to-e.to,m=r.to-r.from;i=n.changeByRange(g=>{if(g.from==r.from&&g.to==r.to)return{changes:l,range:a||g.map(l)};let p=g.to-d,x=p-c.length;if(g.to-g.from!=m||s.state.sliceDoc(x,p)!=c||g.to>=h.from&&g.from<=h.to)return{range:g};let w=n.changes({from:x,to:p,insert:e.insert}),y=g.to-r.to;return{changes:w,range:a?T.range(Math.max(0,a.anchor+y),Math.max(0,a.head+y)):g.map(w)}})}else i={changes:l,selection:a&&n.selection.replaceRange(a)}}let o="input.type";return(s.composing||s.inputState.compositionPendingChange&&s.inputState.compositionEndedAt>Date.now()-50)&&(s.inputState.compositionPendingChange=!1,o+=".compose",s.inputState.compositionFirstChange&&(o+=".start",s.inputState.compositionFirstChange=!1)),n.update(i,{userEvent:o,scrollIntoView:!0})}function p1(s,e,t,i){let n=Math.min(s.length,e.length),r=0;for(;r<n&&s.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&s.length==e.length)return null;let o=s.length,l=e.length;for(;o>0&&l>0&&s.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if(i=="end"){let a=Math.max(0,r-Math.min(o,l));t-=o+a-r}if(o<r&&s.length<e.length){let a=t<=r&&t>=o?r-t:0;r-=a,l=r+(l-o),o=r}else if(l<r){let a=t<=r&&t>=l?r-t:0;r-=a,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function x1(s){let e=[];if(s.root.activeElement!=s.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:n,focusOffset:r}=s.observer.selectionRange;return t&&(e.push(new No(t,i)),(n!=t||r!=i)&&e.push(new No(n,r))),e}function C1(s,e){if(s.length==0)return null;let t=s[0].pos,i=s.length==2?s[1].pos:t;return t>-1&&i>-1?T.single(t+e,i+e):null}const w1={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},tn=M.ie&&M.ie_version<=11;class y1{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new nf,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let i of t)this.queue.push(i);(M.ie&&M.ie_version<=11||M.ios&&e.composing)&&t.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&e.constructor.EDIT_CONTEXT!==!1&&!(M.chrome&&M.chrome_version<126)&&(this.editContext=new v1(e),e.state.facet(lt)&&(e.contentDOM.editContext=this.editContext.editContext)),tn&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){e.type=="change"&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,n=this.selectionRange;if(i.state.facet(lt)?i.root.activeElement!=this.dom:!hs(i.dom,n))return;let r=n.anchorNode&&i.docView.nearest(n.anchorNode);if(r&&r.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(M.ie&&M.ie_version<=11||M.android&&M.chrome)&&!i.state.selection.main.empty&&n.focusNode&&wi(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=Di(e.root);if(!t)return!1;let i=M.safari&&e.root.nodeType==11&&Qd(this.dom.ownerDocument)==this.dom&&b1(this.view,t)||t;if(!i||this.selectionRange.eq(i))return!1;let n=hs(this.dom,i);return n&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&of(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),n&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,w1),tn&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),tn&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let n=()=>{let r=this.delayedAndroidKey;r&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=r.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&r.force&&Wt(this.dom,r.key,r.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(n)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,n=!1;for(let r of e){let o=this.readMutation(r);o&&(o.typeOver&&(n=!0),t==-1?{from:t,to:i}=o:(t=Math.min(o.from,t),i=Math.max(o.to,i)))}return{from:t,to:i,typeOver:n}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),n=this.selectionChanged&&hs(this.dom,this.selectionRange);if(e<0&&!n)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let r=new m1(this.view,e,t,i);return this.view.docView.domChanged={newSel:r.newSel?r.newSel.main:null},r}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let i=this.view.state,n=Va(this.view,t);return this.view.state==i&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),n}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.flags|=4),e.type=="childList"){let i=Io(t,e.previousSibling||e.target.previousSibling,-1),n=Io(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener("change",this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener("change",this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(lt)!=e.state.facet(lt)&&(e.view.contentDOM.editContext=e.state.facet(lt)?this.editContext.editContext:null))}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function Io(s,e,t){for(;e;){let i=K.get(e);if(i&&i.parent==s)return i;let n=e.parentNode;e=n!=s.dom?n:t>0?e.nextSibling:e.previousSibling}return null}function Po(s,e){let t=e.startContainer,i=e.startOffset,n=e.endContainer,r=e.endOffset,o=s.docView.domAtPos(s.state.selection.main.anchor);return wi(o.node,o.offset,n,r)&&([t,i,n,r]=[n,r,t,i]),{anchorNode:t,anchorOffset:i,focusNode:n,focusOffset:r}}function b1(s,e){if(e.getComposedRanges){let n=e.getComposedRanges(s.root)[0];if(n)return Po(s,n)}let t=null;function i(n){n.preventDefault(),n.stopImmediatePropagation(),t=n.getTargetRanges()[0]}return s.contentDOM.addEventListener("beforeinput",i,!0),s.dom.ownerDocument.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",i,!0),t?Po(s,t):null}class v1{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=i=>{let{anchor:n}=e.state.selection.main,r={from:this.toEditorPos(i.updateRangeStart),to:this.toEditorPos(i.updateRangeEnd),insert:q.of(i.text.split(`
`))};r.from==this.from&&n<this.from?r.from=n:r.to==this.to&&n>this.to&&(r.to=n),!(r.from==r.to&&!r.insert.length)&&(this.pendingContextChange=r,Fa(e,r,T.single(this.toEditorPos(i.selectionStart),this.toEditorPos(i.selectionEnd))),this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)))},this.handlers.characterboundsupdate=i=>{let n=[],r=null;for(let o=this.toEditorPos(i.rangeStart),l=this.toEditorPos(i.rangeEnd);o<l;o++){let a=e.coordsForChar(o);r=a&&new DOMRect(a.left,a.top,a.right-a.left,a.bottom-a.top)||r||new DOMRect,n.push(r)}t.updateCharacterBounds(i.rangeStart,n)},this.handlers.textformatupdate=i=>{let n=[];for(let r of i.getTextFormats()){let o=r.underlineStyle,l=r.underlineThickness;if(o!="None"&&l!="None"){let a=`text-decoration: underline ${o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${l=="Thin"?1:2}px`;n.push(Z.mark({attributes:{style:a}}).range(this.toEditorPos(r.rangeStart),this.toEditorPos(r.rangeEnd)))}}e.dispatch({effects:Ca.of(Z.set(n))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{e.inputState.composing=-1,e.inputState.compositionFirstChange=null};for(let i in this.handlers)t.addEventListener(i,this.handlers[i]);this.measureReq={read:i=>{this.editContext.updateControlBounds(i.contentDOM.getBoundingClientRect());let n=Di(i.root);n&&n.rangeCount&&this.editContext.updateSelectionBounds(n.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,i=!1,n=this.pendingContextChange;return e.changes.iterChanges((r,o,l,a,c)=>{if(i)return;let h=c.length-(o-r);if(n&&o>=n.to)if(n.from==r&&n.to==o&&n.insert.eq(c)){n=this.pendingContextChange=null,t+=h,this.to+=h;return}else n=null,this.revertPending(e.state);if(r+=t,o+=t,o<=this.from)this.from+=h,this.to+=h;else if(r<this.to){if(r<this.from||o>this.to||this.to-this.from+c.length>3e4){i=!0;return}this.editContext.updateText(this.toContextPos(r),this.toContextPos(o),c.toString()),this.to+=h}t+=h}),n&&!i&&this.revertPending(e.state),!i}update(e){let t=this.pendingContextChange;!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.resetRange(e.state),this.editContext.updateText(0,this.editContext.text.length,e.state.doc.sliceString(this.from,this.to)),this.setSelection(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),n=this.toContextPos(t.head);(this.editContext.selectionStart!=i||this.editContext.selectionEnd!=n)&&this.editContext.updateSelection(i,n)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e){return e+this.from}toContextPos(e){return e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class V{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:t}=e;this.dispatchTransactions=e.dispatchTransactions||t&&(i=>i.forEach(n=>t(n,this)))||(i=>this.update(i)),this.dispatch=this.dispatch.bind(this),this._root=e.root||rf(e.parent)||document,this.viewState=new Lo(e.state||J.create(e)),e.scrollTo&&e.scrollTo.is(Xi)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(ui).map(i=>new Xs(i));for(let i of this.plugins)i.update(this);this.observer=new y1(this),this.inputState=new Bf(this),this.inputState.ensureHandlers(this.plugins),this.docView=new fo(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure()}dispatch(...e){let t=e.length==1&&e[0]instanceof ge?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i=!1,n,r=this.state;for(let d of e){if(d.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=d.state}if(this.destroyed){this.viewState.state=r;return}let o=this.hasFocus,l=0,a=null;e.some(d=>d.annotation(Ra))?(this.inputState.notifiedFocused=o,l=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,a=Na(r,o),a||(l=1));let c=this.observer.delayedAndroidKey,h=null;if(c?(this.observer.clearDelayedAndroidKey(),h=this.observer.readChange(),(h&&!this.state.doc.eq(r.doc)||!this.state.selection.eq(r.selection))&&(h=null)):this.observer.clear(),r.facet(J.phrases)!=this.state.facet(J.phrases))return this.setState(r);n=Es.create(this,r,e),n.flags|=l;let u=this.viewState.scrollTarget;try{this.updateState=2;for(let d of e){if(u&&(u=u.map(d.changes)),d.scrollIntoView){let{main:m}=d.state.selection;u=new qt(m.empty?m:T.cursor(m.head,m.head>m.anchor?-1:1))}for(let m of d.effects)m.is(Xi)&&(u=m.value.clip(this.state))}this.viewState.update(n,u),this.bidiCache=As.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),t=this.docView.update(n),this.state.facet(di)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(d=>d.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(ss)!=n.state.facet(ss)&&(this.viewState.mustMeasureContent=!0),(t||i||u||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!n.empty)for(let d of this.state.facet(Bn))try{d(n)}catch(m){Ze(this.state,m,"update listener")}(a||h)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),h&&!Va(this,h)&&c.force&&Wt(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new Lo(e),this.plugins=e.facet(ui).map(i=>new Xs(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView.destroy(),this.docView=new fo(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(ui),i=e.state.facet(ui);if(t!=i){let n=[];for(let r of i){let o=t.indexOf(r);if(o<0)n.push(new Xs(r));else{let l=this.plugins[o];l.mustUpdate=e,n.push(l)}}for(let r of this.plugins)r.mustUpdate!=e&&r.destroy(this);this.plugins=n,this.pluginMap.clear()}else for(let n of this.plugins)n.mustUpdate=e;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this);t!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(i){Ze(this.state,i,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,n=i.scrollTop*this.scaleY,{scrollAnchorPos:r,scrollAnchorHeight:o}=this.viewState;Math.abs(n-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(o<0)if($l(i))r=-1,o=this.viewState.heightMap.height;else{let m=this.viewState.scrollAnchorAt(n);r=m.from,o=m.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];a&4||([this.measureRequests,c]=[c,this.measureRequests]);let h=c.map(m=>{try{return m.read(this)}catch(g){return Ze(this.state,g),jo}}),u=Es.create(this,this.state,[]),d=!1;u.flags|=a,t?t.flags|=a:t=u,this.updateState=2,u.empty||(this.updatePlugins(u),this.inputState.update(u),this.updateAttrs(),d=this.docView.update(u),d&&this.docViewUpdate());for(let m=0;m<c.length;m++)if(h[m]!=jo)try{let g=c[m];g.write&&g.write(h[m],this)}catch(g){Ze(this.state,g)}if(d&&this.docView.updateSelection(!0),!u.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let g=(r<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(r).top)-o;if(g>1||g<-1){n=n+g,i.scrollTop=n/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let l of this.state.facet(Bn))l(t)}get themeClasses(){return Wn+" "+(this.state.facet(_n)?Ba:ja)+" "+this.state.facet(ss)}updateAttrs(){let e=Bo(this,wa,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(lt)?"true":"false",class:"cm-content",style:`${M.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),Bo(this,gr,t);let i=this.observer.ignore(()=>{let n=Rn(this.contentDOM,this.contentAttrs,t),r=Rn(this.dom,this.editorAttrs,e);return n||r});return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let n of i.effects)if(n.is(V.announce)){t&&(this.announceDOM.textContent=""),t=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(di);let e=this.state.facet(V.cspNonce);Kt.mount(this.root,this.styleModules.concat(u1).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return Qs(this,e,wo(this,e,t,i))}moveByGroup(e,t){return Qs(this,e,wo(this,e,t,i=>Pf(this,e.head,i)))}visualLineSide(e,t){let i=this.bidiSpans(e),n=this.textDirectionAt(e.from),r=i[t?i.length-1:0];return T.cursor(r.side(t,n)+e.from,r.forward(!t,n)?1:-1)}moveToLineBoundary(e,t,i=!0){return If(this,e,t,i)}moveVertically(e,t,i){return Qs(this,e,jf(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),Ma(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(e),r=this.bidiSpans(n),o=r[ct.find(r,e-n.from,-1,t)];return Ps(i,o.dir==oe.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(ga)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>S1)return la(e.length);let t=this.textDirectionAt(e.from),i;for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t&&(r.fresh||oa(r.isolates,i=uo(this,e))))return r.order;i||(i=uo(this,e));let n=Cf(e.text,t,i);return this.bidiCache.push(new As(e.from,e.to,t,i,!0,n)),n}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||M.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{zl(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Xi.of(new qt(typeof e=="number"?T.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,i=this.viewState.scrollAnchorAt(e);return Xi.of(new qt(T.cursor(i.from),"start","start",i.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return Ue.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return Ue.define(()=>({}),{eventObservers:e})}static theme(e,t){let i=Kt.newName(),n=[ss.of(i),di.of(qn(`.${i}`,e))];return t&&t.dark&&n.push(_n.of(!0)),n}static baseTheme(e){return cr.lowest(di.of(qn("."+Wn,e,Ha)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),n=i&&K.get(i)||K.get(e);return((t=n?.rootView)===null||t===void 0?void 0:t.view)||null}}V.styleModule=di;V.inputHandler=fa;V.scrollHandler=xa;V.focusChangeEffect=ma;V.perLineTextDirection=ga;V.exceptionSink=da;V.updateListener=Bn;V.editable=lt;V.mouseSelectionStyle=ua;V.dragMovesSelection=ca;V.clickAddsSelectionRange=ha;V.decorations=Li;V.outerDecorations=ya;V.atomicRanges=pr;V.bidiIsolatedRanges=ba;V.scrollMargins=va;V.darkTheme=_n;V.cspNonce=L.define({combine:s=>s.length?s[0]:""});V.contentAttributes=gr;V.editorAttributes=wa;V.lineWrapping=V.contentAttributes.of({class:"cm-lineWrapping"});V.announce=se.define();const S1=4096,jo={};class As{constructor(e,t,i,n,r,o){this.from=e,this.to=t,this.dir=i,this.isolates=n,this.fresh=r,this.order=o}static update(e,t){if(t.empty&&!e.some(r=>r.fresh))return e;let i=[],n=e.length?e[e.length-1].dir:oe.LTR;for(let r=Math.max(0,e.length-10);r<e.length;r++){let o=e[r];o.dir==n&&!t.touchesRange(o.from,o.to)&&i.push(new As(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return i}}function Bo(s,e,t){for(let i=s.state.facet(e),n=i.length-1;n>=0;n--){let r=i[n],o=typeof r=="function"?r(s):r;o&&Ln(o,t)}return t}const k1=M.mac?"mac":M.windows?"win":M.linux?"linux":"key";function M1(s,e){const t=s.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let n,r,o,l;for(let a=0;a<t.length-1;++a){const c=t[a];if(/^(cmd|meta|m)$/i.test(c))l=!0;else if(/^a(lt)?$/i.test(c))n=!0;else if(/^(c|ctrl|control)$/i.test(c))r=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))e=="mac"?l=!0:r=!0;else throw new Error("Unrecognized modifier name: "+c)}return n&&(i="Alt-"+i),r&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function ns(s,e,t){return e.altKey&&(s="Alt-"+s),e.ctrlKey&&(s="Ctrl-"+s),e.metaKey&&(s="Meta-"+s),t!==!1&&e.shiftKey&&(s="Shift-"+s),s}const E1=cr.default(V.domEventHandlers({keydown(s,e){return L1(T1(e.state),s,e,"editor")}})),A1=L.define({enables:E1}),Ho=new WeakMap;function T1(s){let e=s.facet(A1),t=Ho.get(e);return t||Ho.set(e,t=D1(e.reduce((i,n)=>i.concat(n),[]))),t}let at=null;const O1=4e3;function D1(s,e=k1){let t=Object.create(null),i=Object.create(null),n=(o,l)=>{let a=i[o];if(a==null)i[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},r=(o,l,a,c,h)=>{var u,d;let m=t[o]||(t[o]=Object.create(null)),g=l.split(/ (?!$)/).map(w=>M1(w,e));for(let w=1;w<g.length;w++){let y=g.slice(0,w).join(" ");n(y,!0),m[y]||(m[y]={preventDefault:!0,stopPropagation:!1,run:[S=>{let b=at={view:S,prefix:y,scope:o};return setTimeout(()=>{at==b&&(at=null)},O1),!0}]})}let p=g.join(" ");n(p,!1);let x=m[p]||(m[p]={preventDefault:!1,stopPropagation:!1,run:((d=(u=m._any)===null||u===void 0?void 0:u.run)===null||d===void 0?void 0:d.slice())||[]});a&&x.run.push(a),c&&(x.preventDefault=!0),h&&(x.stopPropagation=!0)};for(let o of s){let l=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let c of l){let h=t[c]||(t[c]=Object.create(null));h._any||(h._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:u}=o;for(let d in h)h[d].run.push(m=>u(m,zn))}let a=o[e]||o.key;if(a)for(let c of l)r(c,a,o.run,o.preventDefault,o.stopPropagation),o.shift&&r(c,"Shift-"+a,o.shift,o.preventDefault,o.stopPropagation)}return t}let zn=null;function L1(s,e,t,i){zn=e;let n=Xh(e),r=xi(n,0),o=mn(r)==n.length&&n!=" ",l="",a=!1,c=!1,h=!1;at&&at.view==t&&at.scope==i&&(l=at.prefix+" ",Aa.indexOf(e.keyCode)<0&&(c=!0,at=null));let u=new Set,d=x=>{if(x){for(let w of x.run)if(!u.has(w)&&(u.add(w),w(t)))return x.stopPropagation&&(h=!0),!0;x.preventDefault&&(x.stopPropagation&&(h=!0),c=!0)}return!1},m=s[i],g,p;return m&&(d(m[l+ns(n,e,!o)])?a=!0:o&&(e.altKey||e.metaKey||e.ctrlKey)&&!(M.windows&&e.ctrlKey&&e.altKey)&&(g=Jh[e.keyCode])&&g!=n?(d(m[l+ns(g,e,!0)])||e.shiftKey&&(p=Qh[e.keyCode])!=n&&p!=g&&d(m[l+ns(p,e,!1)]))&&(a=!0):o&&e.shiftKey&&d(m[l+ns(n,e,!0)])&&(a=!0),!a&&d(m._any)&&(a=!0)),c&&(a=!0),a&&h&&e.stopPropagation(),zn=null,a}class Vi{constructor(e,t,i,n,r){this.className=e,this.left=t,this.top=i,this.width=n,this.height=r}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,i){if(i.empty){let n=e.coordsAtPos(i.head,i.assoc||1);if(!n)return[];let r=_a(e);return[new Vi(t,n.left-r.left,n.top-r.top,null,n.bottom-n.top)]}else return R1(e,t,i)}}function _a(s){let e=s.scrollDOM.getBoundingClientRect();return{left:(s.textDirection==oe.LTR?e.left:e.right-s.scrollDOM.clientWidth*s.scaleX)-s.scrollDOM.scrollLeft*s.scaleX,top:e.top-s.scrollDOM.scrollTop*s.scaleY}}function Vo(s,e,t,i){let n=s.coordsAtPos(e,t*2);if(!n)return i;let r=s.dom.getBoundingClientRect(),o=(n.top+n.bottom)/2,l=s.posAtCoords({x:r.left+1,y:o}),a=s.posAtCoords({x:r.right-1,y:o});return l==null||a==null?i:{from:Math.max(i.from,Math.min(l,a)),to:Math.min(i.to,Math.max(l,a))}}function R1(s,e,t){if(t.to<=s.viewport.from||t.from>=s.viewport.to)return[];let i=Math.max(t.from,s.viewport.from),n=Math.min(t.to,s.viewport.to),r=s.textDirection==oe.LTR,o=s.contentDOM,l=o.getBoundingClientRect(),a=_a(s),c=o.querySelector(".cm-line"),h=c&&window.getComputedStyle(c),u=l.left+(h?parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)):0),d=l.right-(h?parseInt(h.paddingRight):0),m=Vn(s,i),g=Vn(s,n),p=m.type==we.Text?m:null,x=g.type==we.Text?g:null;if(p&&(s.lineWrapping||m.widgetLineBreaks)&&(p=Vo(s,i,1,p)),x&&(s.lineWrapping||g.widgetLineBreaks)&&(x=Vo(s,n,-1,x)),p&&x&&p.from==x.from&&p.to==x.to)return y(S(t.from,t.to,p));{let v=p?S(t.from,null,p):b(m,!1),k=x?S(null,t.to,x):b(g,!0),O=[];return(p||m).to<(x||g).from-(p&&x?1:0)||m.widgetLineBreaks>1&&v.bottom+s.defaultLineHeight/2<k.top?O.push(w(u,v.bottom,d,k.top)):v.bottom<k.top&&s.elementAtHeight((v.bottom+k.top)/2).type==we.Text&&(v.bottom=k.top=(v.bottom+k.top)/2),y(v).concat(O).concat(y(k))}function w(v,k,O,A){return new Vi(e,v-a.left,k-a.top-.01,O-v,A-k+.01)}function y({top:v,bottom:k,horizontal:O}){let A=[];for(let R=0;R<O.length;R+=2)A.push(w(O[R],v,O[R+1],k));return A}function S(v,k,O){let A=1e9,R=-1e9,j=[];function B(_,H,F,$,N){let ue=s.coordsAtPos(_,_==O.to?-2:2),pe=s.coordsAtPos(F,F==O.from?2:-2);!ue||!pe||(A=Math.min(ue.top,pe.top,A),R=Math.max(ue.bottom,pe.bottom,R),N==oe.LTR?j.push(r&&H?u:ue.left,r&&$?d:pe.right):j.push(!r&&$?u:pe.left,!r&&H?d:ue.right))}let te=v??O.from,z=k??O.to;for(let _ of s.visibleRanges)if(_.to>te&&_.from<z)for(let H=Math.max(_.from,te),F=Math.min(_.to,z);;){let $=s.state.doc.lineAt(H);for(let N of s.bidiSpans($)){let ue=N.from+$.from,pe=N.to+$.from;if(ue>=F)break;pe>H&&B(Math.max(ue,H),v==null&&ue<=te,Math.min(pe,F),k==null&&pe>=z,N.dir)}if(H=$.to+1,H>=F)break}return j.length==0&&B(te,v==null,z,k==null,s.textDirection),{top:A,bottom:R,horizontal:j}}function b(v,k){let O=l.top+(k?v.top:v.bottom);return{top:O,bottom:O,horizontal:[]}}}function N1(s,e){return s.constructor==e.constructor&&s.eq(e)}class I1{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(ds)!=e.state.facet(ds)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){this.layer.updateOnDocViewUpdate!==!1&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,i=e.facet(ds);for(;t<i.length&&i[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;(e!=this.scaleX||t!=this.scaleY)&&(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some((t,i)=>!N1(t,this.drawn[i]))){let t=this.dom.firstChild,i=0;for(let n of e)n.update&&t&&n.constructor&&this.drawn[i].constructor&&n.update(t,this.drawn[i])?(t=t.nextSibling,i++):this.dom.insertBefore(n.draw(),t);for(;t;){let n=t.nextSibling;t.remove(),t=n}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const ds=L.define();function Wa(s){return[Ue.define(e=>new I1(e,s)),ds.of(s)]}const qa=!M.ios,Ri=L.define({combine(s){return ur(s,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function $p(s={}){return[Ri.of(s),P1,j1,B1,pa.of(!0)]}function za(s){return s.startState.facet(Ri)!=s.state.facet(Ri)}const P1=Wa({above:!0,markers(s){let{state:e}=s,t=e.facet(Ri),i=[];for(let n of e.selection.ranges){let r=n==e.selection.main;if(n.empty?!r||qa:t.drawRangeCursor){let o=r?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",l=n.empty?n:T.cursor(n.head,n.head>n.anchor?-1:1);for(let a of Vi.forRange(s,o,l))i.push(a)}}return i},update(s,e){s.transactions.some(i=>i.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let t=za(s);return t&&Fo(s.state,e),s.docChanged||s.selectionSet||t},mount(s,e){Fo(e.state,s)},class:"cm-cursorLayer"});function Fo(s,e){e.style.animationDuration=s.facet(Ri).cursorBlinkRate+"ms"}const j1=Wa({above:!1,markers(s){return s.state.selection.ranges.map(e=>e.empty?[]:Vi.forRange(s,"cm-selectionBackground",e)).reduce((e,t)=>e.concat(t))},update(s,e){return s.docChanged||s.selectionSet||s.viewportChanged||za(s)},class:"cm-selectionLayer"}),Un={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};qa&&(Un[".cm-line"].caretColor=Un[".cm-content"].caretColor="transparent !important");const B1=cr.highest(V.theme(Un));function _o(s,e,t,i,n){e.lastIndex=0;for(let r=s.iterRange(t,i),o=t,l;!r.next().done;o+=r.value.length)if(!r.lineBreak)for(;l=e.exec(r.value);)n(o+l.index,l)}function H1(s,e){let t=s.visibleRanges;if(t.length==1&&t[0].from==s.viewport.from&&t[0].to==s.viewport.to)return t;let i=[];for(let{from:n,to:r}of t)n=Math.max(s.state.doc.lineAt(n).from,n-e),r=Math.min(s.state.doc.lineAt(r).to,r+e),i.length&&i[i.length-1].to>=n?i[i.length-1].to=r:i.push({from:n,to:r});return i}class V1{constructor(e){const{regexp:t,decoration:i,decorate:n,boundary:r,maxLength:o=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,n)this.addMatch=(l,a,c,h)=>n(h,c,c+l[0].length,l,a);else if(typeof i=="function")this.addMatch=(l,a,c,h)=>{let u=i(l,a,c);u&&h(c,c+l[0].length,u)};else if(i)this.addMatch=(l,a,c,h)=>h(c,c+l[0].length,i);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=r,this.maxLength=o}createDeco(e){let t=new Ti,i=t.add.bind(t);for(let{from:n,to:r}of H1(e,this.maxLength))_o(e.state.doc,this.regexp,n,r,(o,l)=>this.addMatch(l,e,o,i));return t.finish()}updateDeco(e,t){let i=1e9,n=-1;return e.docChanged&&e.changes.iterChanges((r,o,l,a)=>{a>e.view.viewport.from&&l<e.view.viewport.to&&(i=Math.min(l,i),n=Math.max(a,n))}),e.viewportChanged||n-i>1e3?this.createDeco(e.view):n>-1?this.updateRange(e.view,t.map(e.changes),i,n):t}updateRange(e,t,i,n){for(let r of e.visibleRanges){let o=Math.max(r.from,i),l=Math.min(r.to,n);if(l>o){let a=e.state.doc.lineAt(o),c=a.to<l?e.state.doc.lineAt(l):a,h=Math.max(r.from,a.from),u=Math.min(r.to,c.to);if(this.boundary){for(;o>a.from;o--)if(this.boundary.test(a.text[o-1-a.from])){h=o;break}for(;l<c.to;l++)if(this.boundary.test(c.text[l-c.from])){u=l;break}}let d=[],m,g=(p,x,w)=>d.push(w.range(p,x));if(a==c)for(this.regexp.lastIndex=h-a.from;(m=this.regexp.exec(a.text))&&m.index<u-a.from;)this.addMatch(m,e,m.index+a.from,g);else _o(e.state.doc,this.regexp,h,u,(p,x)=>this.addMatch(x,e,p,g));t=t.update({filterFrom:h,filterTo:u,filter:(p,x)=>p<h||x>u,add:d})}}return t}}const $n=/x/.unicode!=null?"gu":"g",F1=new RegExp(`[\0-\b
--ÂŸÂ­Øœâ€‹â€Žâ€\u2028\u2029â€­â€®â¦â§â©\uFEFFï¿¹-ï¿¼]`,$n),_1={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let sn=null;function W1(){var s;if(sn==null&&typeof document<"u"&&document.body){let e=document.body.style;sn=((s=e.tabSize)!==null&&s!==void 0?s:e.MozTabSize)!=null}return sn||!1}const fs=L.define({combine(s){let e=ur(s,{render:null,specialChars:F1,addSpecialChars:null});return(e.replaceTabs=!W1())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,$n)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,$n)),e}});function Gp(s={}){return[fs.of(s),q1()]}let Wo=null;function q1(){return Wo||(Wo=Ue.fromClass(class{constructor(s){this.view=s,this.decorations=Z.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(s.state.facet(fs)),this.decorations=this.decorator.createDeco(s)}makeDecorator(s){return new V1({regexp:s.specialChars,decoration:(e,t,i)=>{let{doc:n}=t.state,r=xi(e[0],0);if(r==9){let o=n.lineAt(i),l=t.state.tabSize,a=Zd(o.text,l,i-o.from);return Z.replace({widget:new G1((l-a%l)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[r]||(this.decorationCache[r]=Z.replace({widget:new $1(s,r)}))},boundary:s.replaceTabs?void 0:/[^]/})}update(s){let e=s.state.facet(fs);s.startState.facet(fs)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(s.view)):this.decorations=this.decorator.updateDeco(s,this.decorations)}},{decorations:s=>s.decorations}))}const z1="â€¢";function U1(s){return s>=32?z1:s==10?"â¤":String.fromCharCode(9216+s)}class $1 extends Qt{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=U1(this.code),i=e.state.phrase("Control character")+" "+(_1[this.code]||"0x"+this.code.toString(16)),n=this.options.render&&this.options.render(this.code,i,t);if(n)return n;let r=document.createElement("span");return r.textContent=t,r.title=i,r.setAttribute("aria-label",i),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class G1 extends Qt{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}class K1 extends Qt{constructor(e){super(),this.content=e}toDOM(){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?e.setAttribute("aria-label","placeholder "+this.content):e.setAttribute("aria-hidden","true"),e}coordsAt(e){let t=e.firstChild?Yt(e.firstChild):[];if(!t.length)return null;let i=window.getComputedStyle(e.parentNode),n=Ps(t[0],i.direction!="rtl"),r=parseInt(i.lineHeight);return n.bottom-n.top>r*1.5?{left:n.left,right:n.right,top:n.top,bottom:n.top+r}:n}ignoreEvent(){return!1}}function Kp(s){return Ue.fromClass(class{constructor(e){this.view=e,this.placeholder=s?Z.set([Z.widget({widget:new K1(s),side:1}).range(0)]):Z.none}get decorations(){return this.view.state.doc.length?Z.none:this.placeholder}},{decorations:e=>e.decorations})}const ai="-10000px";class Y1{constructor(e,t,i,n){this.facet=t,this.createTooltipView=i,this.removeTooltipView=n,this.input=e.state.facet(t),this.tooltips=this.input.filter(o=>o);let r=null;this.tooltipViews=this.tooltips.map(o=>r=i(o,r))}update(e,t){var i;let n=e.state.facet(this.facet),r=n.filter(a=>a);if(n===this.input){for(let a of this.tooltipViews)a.update&&a.update(e);return!1}let o=[],l=t?[]:null;for(let a=0;a<r.length;a++){let c=r[a],h=-1;if(c){for(let u=0;u<this.tooltips.length;u++){let d=this.tooltips[u];d&&d.create==c.create&&(h=u)}if(h<0)o[a]=this.createTooltipView(c,a?o[a-1]:null),l&&(l[a]=!!c.above);else{let u=o[a]=this.tooltipViews[h];l&&(l[a]=t[h]),u.update&&u.update(e)}}}for(let a of this.tooltipViews)o.indexOf(a)<0&&(this.removeTooltipView(a),(i=a.destroy)===null||i===void 0||i.call(a));return t&&(l.forEach((a,c)=>t[c]=a),t.length=l.length),this.input=n,this.tooltips=r,this.tooltipViews=o,!0}}function Z1(s){let{win:e}=s;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const nn=L.define({combine:s=>{var e,t,i;return{position:M.ios?"absolute":((e=s.find(n=>n.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=s.find(n=>n.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((i=s.find(n=>n.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||Z1}}}),qo=new WeakMap,Ua=Ue.fromClass(class{constructor(s){this.view=s,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=s.state.facet(nn);this.position=e.position,this.parent=e.parent,this.classes=s.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new Y1(s,Q1,(t,i)=>this.createTooltip(t,i),t=>{this.resizeObserver&&this.resizeObserver.unobserve(t.dom),t.dom.remove()}),this.above=this.manager.tooltips.map(t=>!!t.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),s.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let s of this.manager.tooltipViews)this.intersectionObserver.observe(s.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(s){s.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(s,this.above);e&&this.observeIntersection();let t=e||s.geometryChanged,i=s.state.facet(nn);if(i.position!=this.position&&!this.madeAbsolute){this.position=i.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;t=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(s,e){let t=s.create(this.view),i=e?e.dom:null;if(t.dom.classList.add("cm-tooltip"),s.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let n=document.createElement("div");n.className="cm-tooltip-arrow",t.dom.appendChild(n)}return t.dom.style.position=this.position,t.dom.style.top=ai,t.dom.style.left="0px",this.container.insertBefore(t.dom,i),t.mount&&t.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(t.dom),t}destroy(){var s,e,t;this.view.win.removeEventListener("resize",this.measureSoon);for(let i of this.manager.tooltipViews)i.dom.remove(),(s=i.destroy)===null||s===void 0||s.call(i);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let s=this.view.dom.getBoundingClientRect(),e=1,t=1,i=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:n}=this.manager.tooltipViews[0];if(M.gecko)i=n.offsetParent!=this.container.ownerDocument.body;else if(n.style.top==ai&&n.style.left=="0px"){let r=n.getBoundingClientRect();i=Math.abs(r.top+1e4)>1||Math.abs(r.left)>1}}if(i||this.position=="absolute")if(this.parent){let n=this.parent.getBoundingClientRect();n.width&&n.height&&(e=n.width/this.parent.offsetWidth,t=n.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:t}=this.view.viewState);return{editor:s,parent:this.parent?this.container.getBoundingClientRect():s,pos:this.manager.tooltips.map((n,r)=>{let o=this.manager.tooltipViews[r];return o.getCoords?o.getCoords(n.pos):this.view.coordsAtPos(n.pos)}),size:this.manager.tooltipViews.map(({dom:n})=>n.getBoundingClientRect()),space:this.view.state.facet(nn).tooltipSpace(this.view),scaleX:e,scaleY:t,makeAbsolute:i}}writeMeasure(s){var e;if(s.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let l of this.manager.tooltipViews)l.dom.style.position="absolute"}let{editor:t,space:i,scaleX:n,scaleY:r}=s,o=[];for(let l=0;l<this.manager.tooltips.length;l++){let a=this.manager.tooltips[l],c=this.manager.tooltipViews[l],{dom:h}=c,u=s.pos[l],d=s.size[l];if(!u||u.bottom<=Math.max(t.top,i.top)||u.top>=Math.min(t.bottom,i.bottom)||u.right<Math.max(t.left,i.left)-.1||u.left>Math.min(t.right,i.right)+.1){h.style.top=ai;continue}let m=a.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,g=m?7:0,p=d.right-d.left,x=(e=qo.get(c))!==null&&e!==void 0?e:d.bottom-d.top,w=c.offset||J1,y=this.view.textDirection==oe.LTR,S=d.width>i.right-i.left?y?i.left:i.right-d.width:y?Math.min(u.left-(m?14:0)+w.x,i.right-p):Math.max(i.left,u.left-p+(m?14:0)-w.x),b=this.above[l];!a.strictSide&&(b?u.top-(d.bottom-d.top)-w.y<i.top:u.bottom+(d.bottom-d.top)+w.y>i.bottom)&&b==i.bottom-u.bottom>u.top-i.top&&(b=this.above[l]=!b);let v=(b?u.top-i.top:i.bottom-u.bottom)-g;if(v<x&&c.resize!==!1){if(v<this.view.defaultLineHeight){h.style.top=ai;continue}qo.set(c,x),h.style.height=(x=v)/r+"px"}else h.style.height&&(h.style.height="");let k=b?u.top-x-g-w.y:u.bottom+g+w.y,O=S+p;if(c.overlap!==!0)for(let A of o)A.left<O&&A.right>S&&A.top<k+x&&A.bottom>k&&(k=b?A.top-x-2-g:A.bottom+g+2);if(this.position=="absolute"?(h.style.top=(k-s.parent.top)/r+"px",h.style.left=(S-s.parent.left)/n+"px"):(h.style.top=k/r+"px",h.style.left=S/n+"px"),m){let A=u.left+(y?w.x:-w.x)-(S+14-7);m.style.left=A/n+"px"}c.overlap!==!0&&o.push({left:S,top:k,right:O,bottom:k+x}),h.classList.toggle("cm-tooltip-above",b),h.classList.toggle("cm-tooltip-below",!b),c.positioned&&c.positioned(s.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let s of this.manager.tooltipViews)s.dom.style.top=ai}},{eventObservers:{scroll(){this.maybeMeasure()}}}),X1=V.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),J1={x:0,y:0},Q1=L.define({enables:[Ua,X1]});function Yp(s,e){let t=s.plugin(Ua);if(!t)return null;let i=t.manager.tooltips.indexOf(e);return i<0?null:t.manager.tooltipViews[i]}class gt extends Gt{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}gt.prototype.elementClass="";gt.prototype.toDOM=void 0;gt.prototype.mapMode=Ae.TrackBefore;gt.prototype.startSide=gt.prototype.endSide=-1;gt.prototype.point=!0;const ms=L.define(),em={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>W.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},bi=L.define();function Zp(s){return[$a(),bi.of(Object.assign(Object.assign({},em),s))]}const zo=L.define({combine:s=>s.some(e=>e)});function $a(s){return[tm]}const tm=Ue.fromClass(class{constructor(s){this.view=s,this.prevViewport=s.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=s.state.facet(bi).map(e=>new $o(s,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!s.state.facet(zo),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),s.scrollDOM.insertBefore(this.dom,s.contentDOM)}update(s){if(this.updateGutters(s)){let e=this.prevViewport,t=s.view.viewport,i=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(i<(t.to-t.from)*.8)}s.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(zo)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=s.view.viewport}syncGutters(s){let e=this.dom.nextSibling;s&&this.dom.remove();let t=W.iter(this.view.state.facet(ms),this.view.viewport.from),i=[],n=this.gutters.map(r=>new im(r,this.view.viewport,-this.view.documentPadding.top));for(let r of this.view.viewportLineBlocks)if(i.length&&(i=[]),Array.isArray(r.type)){let o=!0;for(let l of r.type)if(l.type==we.Text&&o){Gn(t,i,l.from);for(let a of n)a.line(this.view,l,i);o=!1}else if(l.widget)for(let a of n)a.widget(this.view,l)}else if(r.type==we.Text){Gn(t,i,r.from);for(let o of n)o.line(this.view,r,i)}else if(r.widget)for(let o of n)o.widget(this.view,r);for(let r of n)r.finish();s&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(s){let e=s.startState.facet(bi),t=s.state.facet(bi),i=s.docChanged||s.heightChanged||s.viewportChanged||!W.eq(s.startState.facet(ms),s.state.facet(ms),s.view.viewport.from,s.view.viewport.to);if(e==t)for(let n of this.gutters)n.update(s)&&(i=!0);else{i=!0;let n=[];for(let r of t){let o=e.indexOf(r);o<0?n.push(new $o(this.view,r)):(this.gutters[o].update(s),n.push(this.gutters[o]))}for(let r of this.gutters)r.dom.remove(),n.indexOf(r)<0&&r.destroy();for(let r of n)this.dom.appendChild(r.dom);this.gutters=n}return i}destroy(){for(let s of this.gutters)s.destroy();this.dom.remove()}},{provide:s=>V.scrollMargins.of(e=>{let t=e.plugin(s);return!t||t.gutters.length==0||!t.fixed?null:e.textDirection==oe.LTR?{left:t.dom.offsetWidth*e.scaleX}:{right:t.dom.offsetWidth*e.scaleX}})});function Uo(s){return Array.isArray(s)?s:[s]}function Gn(s,e,t){for(;s.value&&s.from<=t;)s.from==t&&e.push(s.value),s.next()}class im{constructor(e,t,i){this.gutter=e,this.height=i,this.i=0,this.cursor=W.iter(e.markers,t.from)}addElement(e,t,i){let{gutter:n}=this,r=(t.top-this.height)/e.scaleY,o=t.height/e.scaleY;if(this.i==n.elements.length){let l=new Ga(e,o,r,i);n.elements.push(l),n.dom.appendChild(l.dom)}else n.elements[this.i].update(e,o,r,i);this.height=t.bottom,this.i++}line(e,t,i){let n=[];Gn(this.cursor,n,t.from),i.length&&(n=n.concat(i));let r=this.gutter.config.lineMarker(e,t,n);r&&n.unshift(r);let o=this.gutter;n.length==0&&!o.config.renderEmptyElements||this.addElement(e,t,n)}widget(e,t){let i=this.gutter.config.widgetMarker(e,t.widget,t);i&&this.addElement(e,t,[i])}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class $o{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,n=>{let r=n.target,o;if(r!=this.dom&&this.dom.contains(r)){for(;r.parentNode!=this.dom;)r=r.parentNode;let a=r.getBoundingClientRect();o=(a.top+a.bottom)/2}else o=n.clientY;let l=e.lineBlockAtHeight(o-e.documentTop);t.domEventHandlers[i](e,l,n)&&n.preventDefault()});this.markers=Uo(t.markers(e)),t.initialSpacer&&(this.spacer=new Ga(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Uo(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],e);n!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[n])}let i=e.view.viewport;return!W.eq(this.markers,t,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class Ga{constructor(e,t,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,n)}update(e,t,i,n){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),sm(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,t){let i="cm-gutterElement",n=this.dom.firstChild;for(let r=0,o=0;;){let l=o,a=r<t.length?t[r++]:null,c=!1;if(a){let h=a.elementClass;h&&(i+=" "+h);for(let u=o;u<this.markers.length;u++)if(this.markers[u].compare(a)){l=u,c=!0;break}}else l=this.markers.length;for(;o<l;){let h=this.markers[o++];if(h.toDOM){h.destroy(n);let u=n.nextSibling;n.remove(),n=u}}if(!a)break;a.toDOM&&(c?n=n.nextSibling:this.dom.insertBefore(a.toDOM(e),n)),c&&o++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}function sm(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(!s[t].compare(e[t]))return!1;return!0}const nm=L.define(),Vt=L.define({combine(s){return ur(s,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let n in t){let r=i[n],o=t[n];i[n]=r?(l,a,c)=>r(l,a,c)||o(l,a,c):o}return i}})}});class rn extends gt{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function on(s,e){return s.state.facet(Vt).formatNumber(e,s.state)}const rm=bi.compute([Vt],s=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(nm)},lineMarker(e,t,i){return i.some(n=>n.toDOM)?null:new rn(on(e,e.state.doc.lineAt(t.from).number))},widgetMarker:()=>null,lineMarkerChange:e=>e.startState.facet(Vt)!=e.state.facet(Vt),initialSpacer(e){return new rn(on(e,Go(e.state.doc.lines)))},updateSpacer(e,t){let i=on(t.view,Go(t.view.state.doc.lines));return i==e.number?e:new rn(i)},domEventHandlers:s.facet(Vt).domEventHandlers}));function Xp(s={}){return[Vt.of(s),$a(),rm]}function Go(s){let e=9;for(;e<s;)e=e*10+9;return e}const om=new class extends gt{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},lm=ms.compute(["selection"],s=>{let e=[],t=-1;for(let i of s.selection.ranges){let n=s.doc.lineAt(i.head).from;n>t&&(t=n,e.push(om.range(n)))}return W.of(e)});function Jp(){return lm}const Ka=se.define(),am=se.define(),hm=se.define(),cm=se.define();function um(s){return new Map(s.map(e=>[e.id,e.at]))}const Kn=Re.define({create(){return null},update(s,e){for(const t of e.effects)if(t.is(Ka))return t.value;return s}}),Ts=Re.define({create(){return[]},update(s,e){for(const o of e.effects)if(o.is(am))return o.value;const t=s,i=um(t),n=Sd(e,i);return Ad(i,n)?t:Ld(t,n)}}),Yn=Re.define({create(){return null},update(s,e){for(const t of e.effects)if(t.is(hm))return t.value;return s}}),Zn=Re.define({create(){return null},update(s,e){for(const t of e.effects)if(t.is(cm))return t.value;return s}});function Ko(s){if(!s||s.to-s.from===0)return Z.none;const e=Z.mark({class:Du.code});return Z.set([e.range(s.from,s.to)])}function Yo(s,e,t){if(s.length===0)return Z.none;const n=[...s].sort((r,o)=>r.at.start-o.at.start).map(r=>{if(r.at.end-r.at.start===0)return null;const o=r.id===e,l=r.id===t,a=Dd({isHovered:o,isFocused:l,isCode:!0,diffStatus:r.diffStatus});return Z.mark({class:a,attributes:{"data-comment-id":r.id}}).range(r.at.start,r.at.end)}).filter(nl);return Z.set(n)}const dm=Re.define({create(s){const e=s.field(Kn,!1);return Ko(e??null)},update(s,e){const t=e.state.field(Kn,!1);return Ko(t??null)},provide:s=>V.decorations.from(s)}),fm=Re.define({create(s){const e=s.field(Ts,!1),t=s.field(Yn,!1),i=s.field(Zn,!1);return Yo(e??[],t??null,i??null)},update(s,e){const t=e.state.field(Ts,!1),i=e.state.field(Yn,!1),n=e.state.field(Zn,!1);return Yo(t??[],i??null,n??null)},provide:s=>V.decorations.from(s)});function mm(s){s.state.selection.main.empty&&s.dispatch({effects:Ka.of(null)})}function Ya(s){let e=s.dataset.commentId;for(let t=0;t<10&&!e&&s.parentElement;t++)s=s.parentElement,e=s.dataset.commentId;return e}function gm(s){const e=s.target,t=Ya(e);t&&ft.focusComment(t)}function pm(s){const e=s.target,t=Ya(e);t?ft.mouseEnterComment(t):ft.mouseLeaveComment()}function Qp(s,e=null,t=null){return[Ts.init(()=>s),Kn,Yn.init(()=>e),Zn.init(()=>t),dm,fm,V.updateListener.of(i=>{i.selectionSet&&mm(i.view)}),V.domEventHandlers({click:gm,mouseover:pm})]}const xm=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M9.5 13.5C10.3284 13.5 11 12.9404 11 12.25C11 11.5596 10.3284 11 9.5 11C8.67157 11 8 11.5596 8 12.25C8 12.9404 8.67157 13.5 9.5 13.5Z",fill:"currentColor"}),C.createElement("path",{d:"M13.5 16.5C13.5 17.6046 12.8284 18.5 12 18.5C11.1716 18.5 10.5 17.6046 10.5 16.5C10.5 15.3954 11.1716 14.5 12 14.5C12.8284 14.5 13.5 15.3954 13.5 16.5Z",fill:"currentColor"}),C.createElement("path",{d:"M14.5 13.5C15.3284 13.5 16 12.9404 16 12.25C16 11.5596 15.3284 11 14.5 11C13.6716 11 13 11.5596 13 12.25C13 12.9404 13.6716 13.5 14.5 13.5Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.1689 5.17703C10.7615 5.0609 11.3741 5 12 5C12.6259 5 13.2385 5.0609 13.8311 5.17703C14.2125 4.34087 14.7295 3.51088 15.3887 2.90913C16.0678 2.2891 16.9848 1.84347 18.0577 2.05199C19.0855 2.25177 19.9991 3.00672 20.8169 4.16677C21.1354 4.61856 21.0278 5.24335 20.5766 5.56226C20.1254 5.88118 19.5014 5.77346 19.183 5.32167C18.5007 4.35394 17.9768 4.07629 17.6766 4.01793C17.4212 3.9683 17.1195 4.03899 16.7362 4.38899C16.3912 4.70395 16.054 5.18667 15.7606 5.77733C18.8328 7.11381 21 10.0398 21 13.5C21 18.2542 16.9088 22 12 22C7.09121 22 3 18.2542 3 13.5C3 10.0398 5.16716 7.11381 8.2394 5.77733C7.946 5.18667 7.60881 4.70395 7.26383 4.38899C6.88046 4.03899 6.57876 3.9683 6.32345 4.01793C6.02318 4.07629 5.49926 4.35394 4.81705 5.32167C4.49855 5.77346 3.87459 5.88118 3.4234 5.56226C2.9722 5.24335 2.86462 4.61856 3.18312 4.16677C4.00091 3.00672 4.91449 2.25177 5.94234 2.05199C7.01515 1.84347 7.9322 2.2891 8.61134 2.90913C9.27045 3.51088 9.78747 4.34087 10.1689 5.17703ZM12 7C12.3989 7 12.7889 7.03063 13.1678 7.08936C13.1054 7.34259 13.0538 7.59208 13.0135 7.83391C12.9227 8.3794 13.2907 8.8953 13.8355 8.98622C14.3803 9.07713 14.8955 8.70863 14.9863 8.16314C15.0133 8.00125 15.0469 7.83368 15.0871 7.6627C17.4243 8.73108 19 10.9719 19 13.5C19 17.03 15.9278 20 12 20C8.07223 20 5 17.03 5 13.5C5 10.9719 6.57573 8.73108 8.91295 7.6627C8.95305 7.83368 8.98674 8.00125 9.01369 8.16314C9.10448 8.70863 9.61971 9.07713 10.1645 8.98622C10.7093 8.8953 11.0773 8.3794 10.9865 7.83391C10.9462 7.59208 10.8946 7.34259 10.8322 7.08936C11.2111 7.03063 11.6011 7 12 7Z",fill:"currentColor"})),Cm=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M10.663 6.3872C10.8152 6.29068 11 6.40984 11 6.59007V8C11 8.55229 11.4477 9 12 9C12.5523 9 13 8.55229 13 8V6.59007C13 6.40984 13.1848 6.29068 13.337 6.3872C14.036 6.83047 14.5 7.61105 14.5 8.5C14.5 9.53284 13.8737 10.4194 12.9801 10.8006C12.9932 10.865 13 10.9317 13 11V13C13 13.5523 12.5523 14 12 14C11.4477 14 11 13.5523 11 13V11C11 10.9317 11.0068 10.865 11.0199 10.8006C10.1263 10.4194 9.5 9.53284 9.5 8.5C9.5 7.61105 9.96397 6.83047 10.663 6.3872Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 5V19C4 20.6569 5.34315 22 7 22H19C19.3346 22 19.6471 21.8326 19.8325 21.5541C20.0179 21.2755 20.0517 20.9227 19.9225 20.614C19.4458 19.4747 19.4458 18.5253 19.9225 17.386C19.9737 17.2637 20 17.1325 20 17V3C20 2.44772 19.5523 2 19 2H7C5.34315 2 4 3.34315 4 5ZM6 5C6 4.44772 6.44772 4 7 4H18V16H7C6.64936 16 6.31278 16.0602 6 16.1707V5ZM7 18H17.657C17.5343 18.6699 17.5343 19.3301 17.657 20H7C6.44772 20 6 19.5523 6 19C6 18.4477 6.44772 18 7 18Z",fill:"currentColor"})),wm=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 7C2 5.34315 3.34315 4 5 4H6C6.55228 4 7 4.44772 7 5C7 5.55228 6.55228 6 6 6H5C4.44772 6 4 6.44772 4 7V17C4 17.5523 4.44772 18 5 18H6C6.55228 18 7 18.4477 7 19C7 19.5523 6.55228 20 6 20H5C3.34315 20 2 18.6569 2 17V7ZM17 5C17 4.44772 17.4477 4 18 4H19C20.6569 4 22 5.34315 22 7V17C22 18.6569 20.6569 20 19 20H18C17.4477 20 17 19.5523 17 19C17 18.4477 17.4477 18 18 18H19C19.5523 18 20 17.5523 20 17V7C20 6.44772 19.5523 6 19 6H18C17.4477 6 17 5.55228 17 5ZM7.79289 9.04289C8.18342 8.65237 8.81658 8.65237 9.20711 9.04289L11.4571 11.2929C11.8476 11.6834 11.8476 12.3166 11.4571 12.7071L9.20711 14.9571C8.81658 15.3476 8.18342 15.3476 7.79289 14.9571C7.40237 14.5666 7.40237 13.9334 7.79289 13.5429L9.33579 12L7.79289 10.4571C7.40237 10.0666 7.40237 9.43342 7.79289 9.04289ZM12.25 14.25C12.25 13.6977 12.6977 13.25 13.25 13.25H15.5C16.0523 13.25 16.5 13.6977 16.5 14.25C16.5 14.8023 16.0523 15.25 15.5 15.25H13.25C12.6977 15.25 12.25 14.8023 12.25 14.25Z",fill:"currentColor"})),ym=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M15.2 4H8.8C7.11984 4 6.27976 4 5.63803 4.32698C5.07354 4.6146 4.6146 5.07354 4.32698 5.63803C4 6.27976 4 7.11984 4 8.8V15.2C4 16.8802 4 17.7202 4.32698 18.362C4.6146 18.9265 5.07354 19.3854 5.63803 19.673C6.27976 20 7.11984 20 8.8 20H15.2C16.8802 20 17.7202 20 18.362 19.673C18.9265 19.3854 19.3854 18.9265 19.673 18.362C20 17.7202 20 16.8802 20 15.2V8.8C20 7.11984 20 6.27976 19.673 5.63803C19.3854 5.07354 18.9265 4.6146 18.362 4.32698C17.7202 4 16.8802 4 15.2 4Z",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round"}),C.createElement("path",{d:"M14 8L10 16",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round"})),bm=[{id:"review",title:E({id:"upv1Y0",defaultMessage:"Code review"}),icon:wm,prompt:E({id:"t/Ghj2",defaultMessage:"Search for bugs and opportunities to improve the codeâ€”for example, ways that performance or code structure could be improved. Leave as few comments as possible, but add more comments if the text is long. DO NOT leave more than 5 comments. You may reply that you reviewed the code and left suggestions to improve the coding quality, but do not mention the prompt."}),action:ie.COMMENT},{id:"comments",title:E({id:"sTWMBR",defaultMessage:"Add comments"}),icon:Vu,prompt:E({id:"yE/5uO",defaultMessage:"Add inline code comments to explain the code, especially parts that are more complex. Make sure to rewrite all the code. You may reply that you added inline comments, but do not mention the prompt."}),action:ie.EDIT},{id:"logs",title:E({id:"+00vDz",defaultMessage:"Add logs"}),icon:ym,prompt:E({id:"rrAJ7R",defaultMessage:"Insert logs/print statements in the code that will help debug its behavior. Do not make any other changes to the code."}),action:ie.EDIT},{id:"bugs",title:E({id:"Uw2B/L",defaultMessage:"Fix bugs"}),icon:xm,prompt:E({id:"8JI5Am",defaultMessage:"Find any bugs and rewrite all the code to fix the bugs. Do not add any new comments. If there are no bugs, reply that you reviewed the code and found no bugs."}),action:ie.EDIT},{id:"port",title:E({id:"BotcNe",defaultMessage:"Port to a language"}),icon:Cm,action:ie.CREATE_TEXTDOC,menu:[{prompt:E({id:"LGUTjb",defaultMessage:"Create a new document that rewrites the code in PHP"}),title:E({id:"oR7PqF",defaultMessage:"PHP"})},{prompt:E({id:"t6K8xn",defaultMessage:"Create a new document that rewrites the code in C++"}),title:E({id:"QbnHp2",defaultMessage:"C++"})},{prompt:E({id:"hmI7x6",defaultMessage:"Create a new document that rewrites the code in Python"}),title:E({id:"viPy6U",defaultMessage:"Python"})},{prompt:E({id:"oY48Xk",defaultMessage:"Create a new document that rewrites the code in JavaScript"}),title:E({id:"Mnbu7B",defaultMessage:"JavaScript"})},{prompt:E({id:"7H04sz",defaultMessage:"Create a new document that rewrites the code in TypeScript"}),title:E({id:"pot/GV",defaultMessage:"TypeScript"})},{prompt:E({id:"IFRMM/",defaultMessage:"Create a new document that rewrites the code in Java"}),title:E({id:"78tNyh",defaultMessage:"Java"})}]}];function Za(s){return s.includes("'react'")||s.includes('"react"')}function wr(s,e){switch(s){case We.CODE_HTML:case We.CODE_REACT:return!0;case We.CODE_JAVASCRIPT:case We.CODE_TYPESCRIPT:return Za(e);default:return!1}}function yr(s){return ir([We.CODE_PYTHON],s)}function Xa(s,e){let t=vl(s)??null;return(Za(e)||s===We.CODE_REACT)&&(t="react"),t&&rd(t)?t:null}const Zo=(s=[])=>s.filter(({status:e})=>e!==ec.DISMISSED),vm=({isTextdocStreaming:s,isRequestActive:e,value:t,comments:i})=>{const[n,r]=C.useState(!1);return C.useEffect(()=>{s&&n&&(r(!1),ft.reset())},[t,i]),C.useEffect(()=>{e||(r(!1),ft.reset())},[e]),[n,r]};function Sm({onClickRestore:s,onClickResetLatest:e}){const t=ee();return f.jsx(P.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{bounce:0,duration:.24},className:"absolute bottom-0 left-0 z-30 w-full items-center border-t border-gray-100 bg-token-main-surface-primary p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] @container dark:border-token-border-xlight dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)] lg:border-l",children:f.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[f.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[f.jsx("span",{className:"text-md text-wrap font-semibold",children:t.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),f.jsx("span",{className:"text-wrap text-sm text-token-text-secondary",children:t.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),f.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[f.jsx(Ut,{as:"button",color:"primary",onClick:s,children:t.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),f.jsx(Ut,{as:"button",color:"secondary",onClick:e,children:t.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})}const km=({onClose:s,title:e,actions:t,showBorder:i=!1})=>f.jsxs("div",{className:D("flex items-center justify-between border-b bg-token-main-surface-primary py-2 pl-2 pr-2.5",{"border-token-border-xlight":i,"border-transparent":!i}),children:[f.jsx("div",{className:"flex select-none items-center gap-2 pl-4 text-sm",children:e}),f.jsxs("div",{className:"flex items-center gap-2",children:[t.map(({tooltip:n,icon:r,onClick:o},l)=>{const a=f.jsx(Ut,{size:"small",color:"ghost",as:"button",className:"aspect-square !p-1",icon:r,onClick:o},l);return n?f.jsx(ze,{label:n,children:a},l):a}),f.jsx(Ut,{size:"small",color:"ghost",as:"button",className:"aspect-square !p-1",onClick:s,icon:tc})]})]}),Mm=({onDrag:s,onDragEnd:e,onDoubleClick:t})=>f.jsx(P.div,{drag:"y",className:"absolute top-[-2px] z-10 h-[4px] w-full cursor-ns-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,height:"8px",top:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateY(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(i,n)=>{s?.(n)},onDragEnd:e,onDoubleClick:t}),Ja=(s,{name:e,message:t,line:i,stack:n})=>{const r=i!=null?`

Error occured in:
${s.split(`
`).slice(i-1,i+1).join(`
`)}`:"";return`${e}: ${t}

Stack:
${n.join("")}${r}`},Qa=s=>ir([Q.ERROR,Q.LOG,Q.OUTPUT],s.type),eh=s=>s.type===Q.OUTPUT&&th(s.output),th=s=>typeof s=="string"&&s.startsWith("data:image/png;"),vi=({as:s="li",contentBefore:e,contentAfter:t,disableEntryAnimation:i=!1,hasHint:n=!1,bottomBorder:r=!1,isHintOpen:o=!1,isSticky:l=!1,onClick:a,children:c})=>{const h=!!a,u=s==="div"?P.div:P.li;return f.jsxs(u,{initial:i?!1:{opacity:0},animate:{opacity:1},transition:{duration:.32},role:h?"button":void 0,className:D("flex items-start justify-between whitespace-pre bg-token-main-surface-primary py-1.5 pl-6 pr-4 font-mono text-sm",r&&"border-b border-token-border-xlight",l&&"sticky top-0 z-10",h&&"cursor-pointer",h&&n&&"hover:bg-red-500/10",h&&!n&&"hover:bg-gray-50 dark:hover:bg-gray-700",n&&o&&"bg-red-500/10"),onClick:h?a:void 0,children:[e&&f.jsx("div",{className:"mr-3 flex h-6 w-5 items-start",children:e}),f.jsx("div",{className:"flex min-h-6 min-w-0 flex-1 items-start justify-start gap-2 leading-6",children:c}),t&&f.jsx("div",{className:"ml-3 flex min-h-6 items-start leading-6",children:t})]})},Em=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M21.5 20.1217L21.9496 21.0149C22.2103 20.8837 22.4007 20.6451 22.4708 20.3617C22.5408 20.0783 22.4836 19.7784 22.314 19.5408L21.5 20.1217ZM16.8597 19.3052L17.456 18.5025C17.1456 18.2719 16.73 18.2409 16.3888 18.423L16.8597 19.3052ZM21.0504 19.2284C20.3627 19.5746 19.532 19.4736 18.7401 19.1758C18.36 19.0329 18.031 18.8597 17.7964 18.7212C17.6802 18.6525 17.5897 18.5939 17.5307 18.5542C17.5012 18.5344 17.4798 18.5194 17.467 18.5103C17.4607 18.5058 17.4565 18.5028 17.4547 18.5015C17.4537 18.5008 17.4534 18.5005 17.4536 18.5007C17.4537 18.5008 17.4539 18.501 17.4543 18.5013C17.4545 18.5014 17.4548 18.5016 17.4551 18.5018C17.4552 18.5019 17.4554 18.5021 17.4555 18.5021C17.4557 18.5023 17.456 18.5025 16.8597 19.3052C16.2633 20.1079 16.2636 20.1081 16.2639 20.1084C16.264 20.1084 16.2643 20.1087 16.2645 20.1088C16.2649 20.1091 16.2654 20.1095 16.2659 20.1099C16.2669 20.1106 16.2681 20.1115 16.2694 20.1125C16.2721 20.1144 16.2754 20.1168 16.2793 20.1197C16.2871 20.1254 16.2974 20.1328 16.3101 20.1418C16.3355 20.1597 16.3704 20.1841 16.4143 20.2136C16.5018 20.2725 16.6254 20.3523 16.7792 20.4432C17.0849 20.6237 17.5202 20.8539 18.0363 21.0479C19.0367 21.424 20.5262 21.7313 21.9496 21.0149L21.0504 19.2284ZM12 19.5C7.19808 19.5 3.5 16.0404 3.5 12H1.5C1.5 17.3484 6.30851 21.5 12 21.5V19.5ZM3.5 12C3.5 7.95956 7.19808 4.5 12 4.5V2.5C6.30851 2.5 1.5 6.6516 1.5 12H3.5ZM12 4.5C16.8019 4.5 20.5 7.95956 20.5 12H22.5C22.5 6.6516 17.6915 2.5 12 2.5V4.5ZM16.3888 18.423C15.112 19.1044 13.6117 19.5 12 19.5V21.5C13.9399 21.5 15.7637 21.0237 17.3305 20.1874L16.3888 18.423ZM20.5 12C20.5 12.6516 20.3865 13.2654 20.2276 13.8989C20.0836 14.4734 19.8514 15.2339 19.7154 15.8765C19.5674 16.5754 19.4787 17.3387 19.6043 18.1641C19.7311 18.9979 20.0672 19.8354 20.686 20.7025L22.314 19.5408C21.8577 18.9013 21.6563 18.3545 21.5815 17.8633C21.5055 17.3638 21.5512 16.8613 21.672 16.2907C21.8047 15.6638 21.9757 15.151 22.1676 14.3852C22.3448 13.6786 22.5 12.8853 22.5 12H20.5Z",fill:"currentColor"})),Am=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M12 9V15M9 12H15",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),C.createElement("path",{d:"M21.5 20.1217L21.9496 21.0149C22.2103 20.8837 22.4007 20.6451 22.4708 20.3617C22.5408 20.0783 22.4836 19.7784 22.314 19.5408L21.5 20.1217ZM16.8597 19.3052L17.456 18.5025C17.1456 18.2719 16.73 18.2409 16.3888 18.423L16.8597 19.3052ZM21.0504 19.2284C20.3627 19.5746 19.532 19.4736 18.7401 19.1758C18.36 19.0329 18.031 18.8597 17.7964 18.7212C17.6802 18.6525 17.5897 18.5939 17.5307 18.5542C17.5012 18.5344 17.4798 18.5194 17.467 18.5103C17.4607 18.5058 17.4565 18.5028 17.4547 18.5015C17.4537 18.5008 17.4534 18.5005 17.4536 18.5007C17.4537 18.5008 17.4539 18.501 17.4543 18.5013C17.4545 18.5014 17.4548 18.5016 17.4551 18.5018C17.4552 18.5019 17.4554 18.5021 17.4555 18.5021C17.4557 18.5023 17.456 18.5025 16.8597 19.3052C16.2633 20.1079 16.2636 20.1081 16.2639 20.1084C16.264 20.1084 16.2643 20.1087 16.2645 20.1088C16.2649 20.1091 16.2654 20.1095 16.2659 20.1099C16.2669 20.1106 16.2681 20.1115 16.2694 20.1125C16.2721 20.1144 16.2754 20.1168 16.2793 20.1197C16.2871 20.1254 16.2974 20.1328 16.3101 20.1418C16.3355 20.1597 16.3704 20.1841 16.4143 20.2136C16.5018 20.2725 16.6254 20.3523 16.7792 20.4432C17.0849 20.6237 17.5202 20.8539 18.0363 21.0479C19.0367 21.424 20.5262 21.7313 21.9496 21.0149L21.0504 19.2284ZM12 19.5C7.19808 19.5 3.5 16.0404 3.5 12H1.5C1.5 17.3484 6.30851 21.5 12 21.5V19.5ZM3.5 12C3.5 7.95956 7.19808 4.5 12 4.5V2.5C6.30851 2.5 1.5 6.6516 1.5 12H3.5ZM12 4.5C16.8019 4.5 20.5 7.95956 20.5 12H22.5C22.5 6.6516 17.6915 2.5 12 2.5V4.5ZM16.3888 18.423C15.112 19.1044 13.6117 19.5 12 19.5V21.5C13.9399 21.5 15.7637 21.0237 17.3305 20.1874L16.3888 18.423ZM20.5 12C20.5 12.6516 20.3865 13.2654 20.2276 13.8989C20.0836 14.4734 19.8514 15.2339 19.7154 15.8765C19.5674 16.5754 19.4787 17.3387 19.6043 18.1641C19.7311 18.9979 20.0672 19.8354 20.686 20.7025L22.314 19.5408C21.8577 18.9013 21.6563 18.3545 21.5815 17.8633C21.5055 17.3638 21.5512 16.8613 21.672 16.2907C21.8047 15.6638 21.9757 15.151 22.1676 14.3852C22.3448 13.6786 22.5 12.8853 22.5 12H20.5Z",fill:"currentColor"}));function Tm(s){switch(s){case"dark_gray":return{normal:"text-token-text-secondary dark:text-white-400",hover:"cursor-pointer hover:text-token-text-primary group-hover:text-token-text-primary"};case"light_gray":return{normal:"text-gray-400",hover:"cursor-pointer hover:text-token-text-secondary group-hover:text-token-text-secondary"};case"error":return{normal:"text-red-500",hover:"cursor-pointer hover:text-red-500 group-hover:text-red-500"}}}function br({children:s,className:e,onClick:t,isClickable:i=!1,theme:n="dark_gray"}){const r=Tm(n),o=(t!=null||i)&&r.hover;return f.jsxs("div",{className:D("relative inline-block h-[20px] w-[20px] shrink-0 transition-opacity",e,o,r.normal),onClick:t,children:[s?f.jsx(Em,{className:"h-[20px] w-[20px] shrink-0"}):f.jsx(Am,{className:"h-[20px] w-[20px] shrink-0"}),f.jsx("span",{className:D("absolute inset-0 flex items-center justify-center text-[8px] font-black",o,r.normal),children:s})]})}function vr(){return f.jsx(br,{theme:"light_gray",children:f.jsx(Rs,{})})}function Om({count:s,isLoading:e,onClick:t,isError:i=!1}){return e?f.jsx(vr,{}):f.jsx(br,{onClick:t,theme:i?"error":"dark_gray",children:s})}function e0({isLoading:s=!1,onClick:e}){return s?f.jsx(vr,{}):f.jsx(br,{isClickable:!0,onClick:e,theme:"light_gray"})}const Dm=lu(()=>pl(()=>import("./oy602885cmig2wxq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19])).then(s=>s.UserFormattedText),{loading:({text:s})=>f.jsx("span",{children:s}),fallback:({text:s})=>f.jsx("span",{children:s})}),ih={type:"spring",bounce:.12,duration:.5},sh="opacity-50",Lm=({position:s="absolute",count:e,offsetY:t,isLoading:i=!1,onClick:n,isError:r=!1})=>f.jsx(P.div,{className:D("flex",s,gi.collapsedComment),initial:{opacity:0},animate:{opacity:1},style:{translateY:t},transition:ih,exit:{opacity:0},children:f.jsx(Om,{count:e,isLoading:i,onClick:n,isError:r})}),Rm=({isFocused:s,isHovered:e})=>{const t=s||e?"grow font-medium text-token-text-primary transition-colors":"grow font-medium text-token-text-secondary transition-colors",i=s||e?"opacity-100 transition":"opacity-75 transition";return f.jsxs(f.Fragment,{children:[f.jsx("div",{className:i,children:f.jsx("div",{className:"gizmo-bot-avatar rounded-full",children:f.jsx(ic,{size:"gizmoConversation",iconName:"openai"})})}),f.jsx("span",{className:t,children:"ChatGPT"})]})},Nm=({comment:{diffStatus:s,content:e},isFocused:t,isSomeCommentFocused:i,isHovered:n})=>{const r=s===zt.REMOVED;return f.jsx("div",{className:D("mt-2 text-token-text-primary transition-all",{"opacity-80":!t&&!i&&!n&&!r,"opacity-40":!t&&i&&!n&&!r,[sh]:r}),children:f.jsx(Dm,{text:e})})},Im=({acceptButtonLabel:s,position:e="absolute",left:t,right:i,comment:n,disableAnimations:r=!1,onClick:o,onMouseEnter:l,onMouseLeave:a,onAccept:c,onDismiss:h,translateY:u,isFocused:d=!1,isSomeCommentFocused:m=!1,disableActions:g=!1,isHovered:p=!1},x)=>{const[w,y]=C.useState(!1),S=n.diffStatus===zt.ADDED,b=n.diffStatus===zt.REMOVED,v=n.diffStatus!=null,k=()=>{y(!0),l?.()},O=()=>{y(!1),a?.()},A=ee(),R=d||w&&!m;return f.jsx(P.div,{ref:x,className:D(e,gi.expandedComment,{"cursor-default":d,"cursor-pointer":!d,[gi.expandedCommentFocused]:d,[gi.expandedCommentHovered]:p}),style:{left:t,right:i},initial:r?!1:{translateY:u,scale:.85,opacity:0},animate:r?void 0:{translateY:u,scale:d?1:.97,opacity:1},exit:r?void 0:{scale:.85,opacity:0,filter:"blur(16px)"},transition:ih,onClick:o,onMouseEnter:g?void 0:k,onMouseLeave:g?void 0:O,"data-comment-id":n.id,children:f.jsxs("div",{className:D("flex min-h-8 flex-col overflow-hidden rounded-2xl border p-4 pt-2 text-left text-sm transition-all",{"border-transparent bg-gray-50 dark:bg-gray-800":!d&&!p,"border-token-border-light bg-token-main-surface-primary":p&&!d,"border-token-border-light bg-token-main-surface-primary shadow-xl":d||w&&!m,"relative after:absolute after:bottom-0 after:left-0 after:top-0 after:w-1":v,"after:bg-green-500":S,"after:bg-red-500":b}),style:{width:Lu},children:[f.jsxs("div",{className:D("flex h-8 flex-row items-center gap-2.5",{[sh]:b}),children:[f.jsx(Rm,{isFocused:d,isHovered:p}),f.jsx("button",{className:D("-mr-1 rounded-full bg-transparent p-1 text-token-text-secondary",{"cursor-pointer hover:bg-gray-100 hover:text-token-text-primary dark:hover:bg-gray-700":!g,"cursor-not-allowed":g}),onClick:h,disabled:g,"aria-label":A.formatMessage({id:"fYDa3C",defaultMessage:"Dismiss comment"}),children:f.jsx(au,{className:"icon-sm"})})]}),f.jsx(Nm,{comment:n,isFocused:d,isHovered:p,isSomeCommentFocused:m}),f.jsx(dt,{initial:!1,children:R&&f.jsx(P.div,{initial:r?!1:{opacity:0,height:0},animate:{opacity:1,height:"auto",transition:{opacity:{delay:.14,duration:.2},height:{bounce:0,duration:.2}}},exit:r?void 0:{opacity:0,height:0,transition:{opacity:{duration:.08},height:{bounce:0,duration:.2}}},className:"flex items-center justify-start",children:f.jsx("div",{className:"mt-2.5",children:f.jsx(Ut,{color:"secondary",onClick:c,disabled:g,children:s??A.formatMessage({id:"WIW5OL",defaultMessage:"Apply"})})})})})]})})},nh=C.forwardRef(Im),t0=({offsetY:s,opensOverDocument:e=!1,disableActions:t=!1,isFocused:i=!1,isSomeCommentFocused:n=!1,onAccept:r,onClick:o,onDismiss:l,onMouseEnter:a,onMouseLeave:c,comment:h,isHovered:u=!1})=>{const d=C.useRef(null);return C.useEffect(()=>ki(document,{mousedown:({target:m})=>{m instanceof HTMLElement&&!m.closest("[data-comment-id]")&&!d.current?.contains(m)&&ft.blurComment()}})),f.jsx(nh,{ref:d,comment:h,disableActions:t,onAccept:r,onDismiss:l,onMouseEnter:a,onMouseLeave:c,isSomeCommentFocused:n,isHovered:u,onClick:o,translateY:s,isFocused:i,left:e?void 0:Ru,right:e?Nu:void 0})};var et=(s=>(s.LOADING="loading",s.READY="ready",s.RESOLVED="resolved",s))(et||{});const rh=({hint:s,onClickFix:e,isOpen:t,onOpenChange:i})=>{const n=C.useRef(null),r=ee();return s?f.jsx("div",{className:"relative flex items-center font-sans",onClick:o=>o.stopPropagation(),children:f.jsxs(rl,{open:t,onOpenChange:i,children:[f.jsx(ol,{asChild:!0,ref:n,children:s.status==="resolved"?f.jsx("div",{className:"flex h-5 w-5 items-center",children:f.jsx(hu,{className:"text-token-text-tertiary",size:16})}):f.jsx("button",{className:"h-5 w-5",disabled:s.status==="loading",children:s.status==="loading"?f.jsx(vr,{}):f.jsx(Lm,{position:"static",isError:!0,count:1,offsetY:0})})}),f.jsx(dt,{children:t&&f.jsx(ll,{forceMount:!0,container:n.current?.ownerDocument.body,children:f.jsx(al,{side:"top",align:"start",alignOffset:-4,sideOffset:10,children:f.jsx(nh,{position:"static",translateY:0,right:0,isFocused:!0,onDismiss:()=>i?.(!1),onAccept:()=>{i?.(!1),e?.()},comment:s,acceptButtonLabel:r.formatMessage({id:"Dl9vBh",defaultMessage:"Fix bug"})})})})})]})}):f.jsx("div",{className:"w-5"})},Bs=s=>Array.isArray(s)||Mt(s)||s instanceof Map||s instanceof Set,Hs=s=>s==null||typeof s=="string"||typeof s=="number"||typeof s=="boolean",oh=s=>Mt(s)?Object.entries(s):Array.from(s.entries()),lh=s=>`${typeof s}:${typeof s=="object"?JSON.stringify(s):s}`,Pm=({isPreview:s=!1,value:e})=>{const[t,i]=C.useState(!1);return Hs(e)?f.jsx(Vs,{value:e,depth:0}):Bs(e)?f.jsxs("span",{className:D("relative z-0 max-w-full font-mono text-sm leading-6",t&&"w-full flex-auto"),children:[f.jsxs("span",{role:"button",className:"group/row flex flex-wrap items-center gap-x-1 italic",onClick:()=>i(!t),children:[!s&&f.jsx(dh,{isExpanded:t}),f.jsx(hh,{value:e,depth:0}),f.jsx(Jn,{value:e})]}),t&&!s&&f.jsx("div",{className:"pl-6",children:f.jsx(ch,{value:e,depth:0})})]}):f.jsx("span",{className:"truncate",children:String(e)})},ah=({value:s,depth:e=0})=>Bs(s)?f.jsx(ch,{depth:e,value:s}):Hs(s)?f.jsx(Vs,{depth:e,value:s}):f.jsx("span",{className:"truncate",children:String(s)}),hh=({value:s,depth:e=0})=>{const t=Array.isArray(s),i=oh(s);return f.jsxs("div",{className:"inline-flex min-w-0 max-w-fit flex-grow basis-0",children:[!Mt(s)&&f.jsx(Xn,{isShort:!0,isSecondary:!0,collection:s}),t?"[":"{",f.jsx("span",{className:"inline-flex min-w-0 max-w-fit flex-shrink flex-grow basis-0 overflow-hidden",children:i.map(([n,r],o)=>{let l=null;return Bs(r)?l=f.jsx(Xn,{collection:r}):Hs(r)?l=f.jsx(Vs,{truncate:!0,depth:e+1,value:r}):l=f.jsx(ah,{depth:e+1,value:r}),f.jsxs(C.Fragment,{children:[(Mt(s)||s instanceof Map)&&f.jsx("span",{className:"min-w-[2em] flex-shrink truncate whitespace-pre text-token-text-secondary",children:f.jsx(uh,{value:s,propertyKey:n})}),l,o<i.length-1&&f.jsx("span",{className:"whitespace-pre",children:", "})]},lh(n))})}),t?"]":"}"]})},ch=({value:s,depth:e=0})=>{const[t,i]=C.useState(()=>new Set),n=oh(s);return f.jsx("ol",{className:"flex flex-col pl-6 font-mono",children:n.map(([r,o])=>{const l=lh(r),a=t.has(l),c=Bs(o),h=()=>{i(u=>{const d=new Set(u);return d.has(l)?d.delete(l):d.add(l),d})};return f.jsxs("li",{className:D("flex whitespace-nowrap pl-1",c&&"flex-col",!c&&"group/row flex-wrap"),onClick:u=>u.stopPropagation(),children:[f.jsxs("span",{onClick:c?h:void 0,role:c?"button":void 0,className:D("group/row z-10 -ml-1 min-w-0 items-center gap-x-1",c?"flex":"inline-flex"),children:[c&&f.jsxs(f.Fragment,{children:[f.jsx(jm,{}),f.jsx(dh,{shiftLeft:!0,isExpanded:a})]}),f.jsx("span",{className:D("font-bold",(Mt(s)||Array.isArray(s))&&"text-red-900 dark:text-blue-400"),children:f.jsx(uh,{value:s,propertyKey:r})}),c&&!a&&f.jsx(hh,{value:o,depth:e+1}),c&&a&&f.jsx(Xn,{isSecondary:!0,collection:o}),c&&f.jsx(Jn,{value:o})]}),(!c||a)&&f.jsx(ah,{value:o,depth:e+1}),(typeof o=="string"||typeof o=="number")&&f.jsx(Jn,{value:o})]},l)})})},Vs=({value:s,truncate:e=!1})=>typeof s=="string"?f.jsxs("span",{className:D("text-red-500 dark:text-blue-250",e&&"min-w-[2em] max-w-fit flex-shrink-0 flex-grow basis-0 overflow-hidden text-ellipsis whitespace-nowrap",!e&&"whitespace-normal break-words break-all"),children:["'",s,"'"]}):f.jsx("span",{className:D("whitespace-nowrap",s==null?"text-token-text-secondary":"text-blue-500 dark:text-brand-purple-600"),children:String(s)}),jm=()=>f.jsx("span",{className:"absolute left-0 right-0 z-[-1] h-6 rounded-md group-hover/row:bg-gray-50 group-hover/row:dark:bg-gray-700"}),Xn=({collection:s,isSecondary:e=!1,isShort:t=!1})=>{let i=null;return Array.isArray(s)&&s.length>0?i=t?`(${s.length})`:`Array(${s.length})`:s instanceof Set?i=`Set(${s.size})`:s instanceof Map?i=`Map(${s.size})`:Mt(s)&&(i="{â€¦}"),i&&f.jsx("span",{className:D(e&&"text-token-text-secondary"),children:i})},uh=({value:s,propertyKey:e})=>Mt(s)||Array.isArray(s)?`${sr(e)}: `:s instanceof Map?f.jsxs("span",{className:"inline-flex items-center gap-1",children:[Hs(e)?f.jsx(Vs,{value:e,depth:0}):f.jsx("span",{className:"text-token-text-secondary",children:JSON.stringify(e)}),f.jsx(sc,{className:"icon-sm text-token-text-secondary"})]}):null,dh=({isExpanded:s,shiftLeft:e=!1})=>f.jsx("button",{className:D("flex h-5 flex-shrink-0 items-center overflow-hidden",e&&"ml-[-16px]"),children:f.jsx(xl,{className:D("icon-sm text-token-text-secondary transition-transform",s&&"rotate-90")})}),Jn=({value:s})=>{const e=or(),t=()=>{rr(JSON.stringify(s),e)};return f.jsx("span",{className:D("relative inline-block h-4 self-center text-token-text-secondary opacity-0 transition-opacity","group-hover/row:opacity-100 group-hover/row:delay-500","after:pointer-events-none after:absolute after:inset-[-4px] after:z-0 after:rounded-lg after:content-[''] hover:after:bg-token-main-surface-tertiary"),children:f.jsx(Fu,{iconClassName:"icon-sm z-10",iconOnly:!0,onCopy:t})})},Bm="module:",Qn=({log:s,isDisabled:e=!1,onClick:t})=>f.jsx("div",{className:"flex items-center",children:"line"in s&&s.line!=null&&f.jsxs("button",{onClick:()=>s.line!=null&&t?.(s.line),className:"select-none text-token-text-tertiary enabled:hover:underline",disabled:e,children:[Bm,s.line]})}),Hm=({isPreview:s=!1,log:e,level:t})=>f.jsxs("span",{className:D("flex flex-wrap gap-1",s?"min-w-0 flex-shrink truncate":"whitespace-pre-wrap",t==="warn"&&"text-yellow-600"),children:[t==="warn"&&"[warn]: ",typeof e=="string"?e:e.map((i,n)=>f.jsx(Pm,{isPreview:s,value:i},n))]}),fh=({error:s,isPreview:e=!1,isResolved:t=!1})=>{const i=s.name+":";return f.jsxs("span",{className:D("whitespace-pre-wrap",t?"text-token-text-primary":"text-red-500"),children:[f.jsx("span",{className:"font-semibold",children:i})," ",s.message,f.jsx("div",{children:s.stack.length>0&&!e?s.stack.join(`
`):""})]})},Vm=({output:s,isPreview:e=!1})=>{const t=ee();return s==null?null:th(s)?f.jsx("img",{alt:t.formatMessage(_m.imgAlt),className:D(e&&"h-6 rounded-lg border border-token-border-xlight"),src:s}):f.jsx("span",{className:"flex items-center gap-2",children:sr(s)})},Sr=({log:s,isHintResolved:e,isPreview:t=!1})=>{switch(s.type){case Q.LOG:return f.jsx(Hm,{isPreview:t,...s});case Q.ERROR:return f.jsx(fh,{isPreview:t,isResolved:e,...s});case Q.OUTPUT:return f.jsx(Vm,{isPreview:t,...s});default:return null}},Fm=({log:s,isStale:e=!1,onClickFix:t,onClickLineNumber:i,hint:n})=>{const[r,o]=C.useState(!1);if(s.type===Q.RUN_COMPLETE)return null;const l=n?.status===et.RESOLVED,a=s.type===Q.ERROR&&n?.status===et.READY;return f.jsx(vi,{hasHint:a,isHintOpen:r,bottomBorder:!0,onClick:n&&!l&&(()=>o(!0)),contentBefore:f.jsx(rh,{hint:n,isOpen:r,onOpenChange:o,onClickFix:()=>s.type===Q.ERROR&&n&&t?.(n,s.error)}),contentAfter:f.jsx(Qn,{log:s,isDisabled:e,onClick:i}),children:f.jsx(Sr,{log:s,isHintResolved:l})})},_m=st({imgAlt:{id:"L6t7Yb",defaultMessage:"Plot"},ranCode:{id:"ffa9Nt",defaultMessage:"Ran code"},askForHelp:{id:"wMZco9",defaultMessage:"Ask ChatGPT for help"},askForFix:{id:"A9pxgT",defaultMessage:"Fix it for me"}}),Wm=({timestamp:s,duration:e})=>{const[,t]=C.useState(0);C.useEffect(()=>{setInterval(()=>{t(r=>r+1)},5e3)},[]);const i=Date.now(),n=Math.round((i-s)/1e3);return f.jsx(ze,{label:f.jsx(ae,{id:"bFO21A",defaultMessage:"Code ran {count, plural, =0 {instantly} one {in # second} other {in # seconds}}",values:{count:Math.floor(e/1e3)}}),children:f.jsx("span",{className:"text-token-text-tertiary",children:n>=60?f.jsx(Vh,{value:-n,updateIntervalInSeconds:60,numeric:"auto"}):f.jsx(ae,{id:"bRCEFN",defaultMessage:"Just now"})})})},mh=({isComplete:s,timestamp:e,duration:t})=>s&&e!=null&&t!=null?f.jsx(Wm,{timestamp:e,duration:t}):s&&t==null?f.jsx("span",{className:"text-token-text-tertiary",children:f.jsx(ae,{id:"EMebM9",defaultMessage:"Stopped"})}):f.jsx(Rs,{gap:2}),qm=s=>{switch(s){case Xe.INITIALIZING:return f.jsx(ae,{id:"J183Z0",defaultMessage:"initializing environment"});case Xe.INSTALLING_PACKAGES:return f.jsx(ae,{id:"21sQ8o",defaultMessage:"installing packages"});case Xe.RUNNING_CODE:return f.jsx(ae,{id:"nHITHk",defaultMessage:"running code"})}},gs=({message:s,isComplete:e,statusLogs:t})=>{const i=ys(t);return f.jsxs("span",{className:"flex items-center",children:[f.jsx("span",{className:"font-semibold text-token-text-secondary",children:f.jsx(ae,{...s})}),!e&&i&&f.jsxs(P.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.3,duration:.1},className:"ml-2 flex items-baseline text-token-text-tertiary",children:[qm(i.status),f.jsx(Rs,{gap:2,size:2})]})]})},zm=({children:s,firstLog:e,lastLog:t,isHintResolved:i,duration:n,isComplete:r=!1,isLast:o=!1,statusLogs:l})=>{const[a,c]=C.useState(!0),[h,u]=C.useState(!1),d=C.useRef(null),m=()=>{c(!a)};return C.useEffect(()=>{const{current:g}=d;if(!g)return;const p=new IntersectionObserver(x=>{x[0].intersectionRatio===0?u(!0):u(!1)},{threshold:0});return p.observe(g),()=>p.unobserve(g)},[]),f.jsxs("li",{className:"relative flex flex-col",children:[f.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute h-[1px] bg-transparent",ref:d}),f.jsxs(vi,{as:"div",disableEntryAnimation:!0,isSticky:!0,bottomBorder:h||!o&&!a,contentAfter:f.jsx(mh,{isComplete:r,duration:n,timestamp:e?.timestamp}),contentBefore:f.jsx("button",{className:"text-token-text-tertiary",onClick:()=>m(),children:f.jsx(xl,{className:D("icon-md transition-transform",a&&"rotate-90")})}),onClick:()=>m(),children:[f.jsx(gs,{isComplete:r,message:ps.run,statusLogs:l}),!a&&t&&f.jsx(Sr,{isPreview:!0,isHintResolved:i,log:t})]}),a&&s]})},Um=({runMessages:s,onClickFix:e,onClickLineNumber:t,hints:i,isStale:n,isLast:r,includeContentBefore:o=!1})=>{const[l,a]=C.useState(!1),c=s.filter(y=>y.type===Q.ENVIRONMENT_STATUS),h=s.filter(Qa),u=ys(s),d=u?.type===Q.RUN_COMPLETE,m=d?u.duration:null,g=h[0];if(d){if(h.length===0)return f.jsx(vi,{isHintOpen:l,bottomBorder:!0,contentBefore:o,contentAfter:f.jsx(mh,{isComplete:d,duration:m,timestamp:g?.timestamp}),children:f.jsx(gs,{isComplete:d,message:ps.success,statusLogs:c})});if(h.length===1&&g?.type===Q.ERROR){const y=i.get(g.id);return f.jsxs(vi,{hasHint:!!y,isHintOpen:l,bottomBorder:!0,contentBefore:(o||!!y)&&f.jsx(rh,{hint:y,isOpen:l,onOpenChange:a,onClickFix:()=>y&&e?.(y,g.error)}),contentAfter:f.jsx(Qn,{log:g,isDisabled:n,onClick:t}),onClick:y&&y.status!==et.RESOLVED&&(()=>a(!0)),children:[f.jsx(gs,{isComplete:d,message:ps.run,statusLogs:c}),f.jsx(fh,{isResolved:y?.status===et.RESOLVED,...g})]})}else if(h.length===1&&g&&!eh(h[0]))return f.jsxs(vi,{bottomBorder:!0,contentBefore:o,contentAfter:f.jsx(Qn,{log:g,isDisabled:n,onClick:t}),children:[f.jsx(gs,{isComplete:d,message:ps.run,statusLogs:c}),f.jsx(Sr,{log:g})]})}const p=ys(h.filter(y=>y.type!==Q.RUN_COMPLETE)),w=(p&&i.get(p.id))?.status===et.RESOLVED;return f.jsx(zm,{statusLogs:c,firstLog:g??null,lastLog:p??null,duration:m,isComplete:d,isHintResolved:w,isLast:r,children:f.jsx("ol",{children:h.map(y=>f.jsx(Fm,{log:y,isStale:n,onClickLineNumber:t,onClickFix:e,hint:i.get(y.id)},y.id))})})},ps=st({success:{id:"laZI5H",defaultMessage:"Run successfully"},run:{id:"o7dgBT",defaultMessage:"Run"}}),$m=`You're a professional developer highly skilled in debugging. The user ran the textdoc's code, and an error was thrown.
Please think carefully about how to fix the error`,Gm=(s,e,t)=>{const i=Ja(s,t);return`
${$m}, and then rewrite the textdoc to fix it.

- NEVER change existing test cases unless they're clearly wrong.
- ALWAYS add more test cases if there aren't any yet.
- ALWAYS ask the user what the expected behavior is in the chat if the code is not clear.

# Hint

${e}

# Error

${i}`.trim()},Km=({codeRunMessages:s,scrollRef:e,onClose:t,onClickLineNumber:i,onClickFix:n,title:r,headerActions:o,lastRunId:l,hints:a})=>{const c=a.size>0,h=C.useMemo(()=>Object.entries(rc(s,"runId")),[s]),u=h.some(([,d])=>{const m=d.filter(Qa);return m.length>1||m.length===1&&eh(m[0])});return f.jsxs(f.Fragment,{children:[f.jsx(km,{title:r,actions:o,onClose:t,showBorder:s.length>0}),f.jsx("div",{ref:e,className:"flex flex-1 flex-col-reverse overflow-auto bg-token-main-surface-primary",children:f.jsx("ol",{className:"flex flex-1 flex-col justify-start pb-4",children:f.jsx(dt,{children:h.map(([d,m],g)=>f.jsx(Um,{runMessages:m,includeContentBefore:u||c,onClickFix:n,onClickLineNumber:i,hints:a,isStale:d!==l,isLast:g===h.length-1},d))})})})]})},Ym=({sandboxRef:s,textdocContent:e,textdocId:t,isTextdocAttachedPending:i,headerActions:n=[],forceOpenForTesting:r=!1,highlightLine:o,createTextdocTurn:l},a)=>{const[c,h]=C.useState(r),[u,d]=C.useState(!1),[m,g]=C.useState([]),[p,x]=C.useState(null),[w,y]=C.useState(()=>new Map),[S,b]=C.useState(320),v=C.useRef(null),k=ee();C.useEffect(()=>x(null),[e]);const O=({id:j,content:B},te)=>{y(z=>{const _=new Map(z);return _.set(j,{id:j,content:B,status:et.RESOLVED}),_}),l({action:ie.EDIT,userMessageType:Ce.CONSOLE,content:Gm(e,B,te)})},A=async(j,B)=>{if(i)return;const te=Ja(e,B.error);y(z=>{const _=new Map(z);return _.set(j,{id:j,status:et.LOADING,content:""}),_});try{const{hint:z}=await Ls.safePost("/textdoc/{textdoc_id}/code/hint",{parameters:{path:{textdoc_id:t}},requestBody:{error:te,line:B.error.line??-1}});y(_=>{const H=new Map(_);return H.set(j,{id:j,status:et.READY,content:z}),H})}catch{y(_=>{const H=new Map(_);return H.delete(j),H})}},R=async(j,B)=>{const te=Xa(j,B);if(!te)return;const z=wr(j,B),_=yr(j);if(!_&&!z)return;_&&h(!0),g(F=>F.map($=>({...$,isStale:!0})));const H=Mi(s.current).evalAsync({code:B,language:te});for await(const F of H){if(F.type===Q.RUN_START?requestAnimationFrame(()=>{v.current?.scrollTo({top:0,behavior:"smooth"})}):z&&F.type===Q.LOG&&h(!0),F.type===Q.ERROR){if(F.line!=null){const{line:$}=F;requestAnimationFrame(()=>o($))}h(!0),A(F.id,F)}x(F.runId),g($=>[...$,{...F,isStale:!1}])}};return C.useImperativeHandle(a,()=>({runCode:R,stopCode:()=>s.current?.stop(),open:()=>h(!0)})),c?f.jsxs(dt,{children:[u&&f.jsx("div",{className:"pointer-events-auto absolute inset-0 bg-transparent"},"drag-overlay"),f.jsxs(P.div,{initial:{translateY:"100%",opacity:0},animate:{translateY:"0%",opacity:1},exit:{translateY:"100%",opacity:0},transition:{type:"spring",bounce:0,duration:.48},className:"relative z-10 w-full border-t border-token-border-light shadow-[0px_0px_32px_rgba(0,0,0,0.08)]",children:[f.jsx(Mm,{onDragEnd:()=>d(!1),onDrag:({delta:{y:j}})=>{d(!0),b(B=>B-j)}}),f.jsx("div",{className:"flex flex-col",style:{height:S},children:f.jsx(Km,{scrollRef:v,codeRunMessages:m,onClose:()=>h(!1),onClickLineNumber:o,onClickFix:O,title:k.formatMessage({id:"P9VJDk",defaultMessage:"Console"}),headerActions:[...n,{tooltip:k.formatMessage({id:"gAICYK",defaultMessage:"Clear console"}),icon:nc,onClick:()=>{g([]),y(new Map)}}],lastRunId:p,hints:w})})]},"console")]}):null},Zm=C.forwardRef(Ym),Xm=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M13 7.5L21 7.5",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round"}),C.createElement("path",{d:"M13 11.9983L21 12.0006",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round"}),C.createElement("path",{d:"M13 16.5H19",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round"}),C.createElement("path",{d:"M6 7V17",stroke:"currentColor",strokeWidth:1.75,strokeLinecap:"round",strokeLinejoin:"round"}),C.createElement("path",{d:"M3.5 7.5L6 5L8.5 7.5",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),C.createElement("path",{d:"M3.5 16.5L6 19L8.5 16.5",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})),Jm=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M7 5.31702C6.075 5.15002 5.106 5.05302 4.044 5.01702C3.476 4.99802 3 5.44801 3 6.01601V17.853C3 18.395 3.433 18.843 3.974 18.851C7.066 18.898 9.394 19.468 12 21C14.606 19.468 16.934 18.898 20.026 18.852C20.567 18.844 21 18.395 21 17.853V6.01601C21 5.45701 20.541 4.99801 19.983 5.01601C16.912 5.11501 14.594 5.69301 12 7.14601",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),C.createElement("path",{d:"M7 15.238V3.012C7 2.283 7.766 1.774 8.417 2.101C10.173 2.981 11.653 4.77 12 6.612V21C11.604 18.901 9.739 16.871 7.669 16.176C7.267 16.041 7 15.662 7 15.238Z",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})),Qm=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M6.14473 10.3906C8.69611 8.9948 9.33551 7.32632 8.84995 6.14456C8.61487 5.57244 8.12312 5.16589 7.54741 5.0406C7.0405 4.93027 6.48512 5.04119 6 5.4178C5.51487 5.04119 4.9595 4.93027 4.45258 5.0406C3.87687 5.16589 3.38512 5.57245 3.15005 6.14457C2.6645 7.32633 3.30391 8.99481 5.85529 10.3906C5.94547 10.44 6.05456 10.44 6.14473 10.3906Z",fill:"currentColor"}),C.createElement("path",{d:"M13 6.5C12.4477 6.5 12 6.94772 12 7.5C12 8.05228 12.4477 8.5 13 8.5H20C20.5523 8.5 21 8.05228 21 7.5C21 6.94772 20.5523 6.5 20 6.5H13Z",fill:"currentColor"}),C.createElement("path",{d:"M13 15.5C12.4477 15.5 12 15.9477 12 16.5C12 17.0523 12.4477 17.5 13 17.5H20C20.5523 17.5 21 17.0523 21 16.5C21 15.9477 20.5523 15.5 20 15.5H13Z",fill:"currentColor"}),C.createElement("path",{d:"M5.37271 13.357C5.64815 12.8683 6.35185 12.8683 6.62729 13.357L7.28648 14.5265C7.30116 14.5525 7.32644 14.5709 7.35574 14.5768L8.67173 14.8424C9.22159 14.9533 9.43905 15.6226 9.05941 16.0355L8.15083 17.0239C8.1306 17.0459 8.12094 17.0756 8.12437 17.1053L8.2785 18.4389C8.34291 18.9961 7.7736 19.4098 7.26354 19.1763L6.04281 18.6176C6.01563 18.6052 5.98437 18.6052 5.95719 18.6176L4.73646 19.1763C4.2264 19.4098 3.65709 18.9961 3.7215 18.4389L3.87563 17.1053C3.87906 17.0756 3.8694 17.0459 3.84917 17.0239L2.94059 16.0355C2.56095 15.6226 2.7784 14.9533 3.32827 14.8424L4.64426 14.5768C4.67356 14.5709 4.69884 14.5525 4.71352 14.5265L5.37271 13.357Z",fill:"currentColor"})),eg=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M11.2677 10.4406C14.6243 9.30561 15.7445 7.43895 15.4119 5.91828C15.2509 5.18208 14.7469 4.59023 14.0826 4.3181C13.4978 4.07848 12.8079 4.09406 12.1462 4.44331C11.6438 3.88879 11.0009 3.63821 10.3693 3.66334C9.65201 3.69187 8.97596 4.07564 8.57287 4.71237C7.74025 6.02759 8.15446 8.1648 10.9204 10.3794C11.0182 10.4576 11.1491 10.4807 11.2677 10.4406Z",fill:"currentColor"}),C.createElement("path",{d:"M7.04565 11.8375C6.58099 11.3632 5.77636 11.5788 5.61114 12.2219L5.21572 13.7611C5.20691 13.7954 5.18363 13.8242 5.15194 13.8399L3.72856 14.5467C3.13382 14.842 3.09023 15.6739 3.65084 16.0298L4.99253 16.8815C5.02241 16.9004 5.04256 16.9315 5.04773 16.9665L5.28009 18.5386C5.37718 19.1955 6.15487 19.494 6.66657 19.0708L7.8912 18.058C7.91847 18.0354 7.9542 18.0259 7.9891 18.0318L9.55608 18.2966C10.2108 18.4072 10.7351 17.7599 10.4907 17.1424L9.90586 15.6647C9.89284 15.6318 9.89477 15.5949 9.91116 15.5635L10.6473 14.1551C10.9548 13.5666 10.5011 12.868 9.8384 12.9096L8.25232 13.0091C8.217 13.0114 8.18247 12.9981 8.1577 12.9728L7.04565 11.8375Z",fill:"currentColor"}),C.createElement("path",{d:"M14.7071 12.2928C14.3166 11.9023 13.6834 11.9023 13.2929 12.2928C12.9023 12.6834 12.9023 13.3165 13.2929 13.707L15.3358 15.7499L13.2929 17.7928C12.9023 18.1834 12.9023 18.8165 13.2929 19.207C13.6834 19.5976 14.3166 19.5976 14.7071 19.207L16.75 17.1641L18.7929 19.207C19.1834 19.5976 19.8166 19.5976 20.2071 19.207C20.5976 18.8165 20.5976 18.1834 20.2071 17.7928L18.1642 15.7499L20.2071 13.707C20.5976 13.3165 20.5976 12.6834 20.2071 12.2928C19.8166 11.9023 19.1834 11.9023 18.7929 12.2928L16.75 14.3357L14.7071 12.2928Z",fill:"currentColor"})),tg=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M5.82446 3.89469C6.12108 3.36844 6.87892 3.36843 7.17554 3.89469L7.88544 5.15418C7.90125 5.18223 7.92847 5.20201 7.96003 5.20838L9.37725 5.49433C9.96941 5.61381 10.2036 6.33455 9.79475 6.77928L8.81628 7.84364C8.79449 7.86734 8.78409 7.89934 8.78779 7.93133L8.95377 9.36754C9.02313 9.96764 8.41003 10.4131 7.86073 10.1617L6.5461 9.56001C6.51683 9.54661 6.48317 9.54661 6.4539 9.56001L5.13927 10.1617C4.58997 10.4131 3.97687 9.96764 4.04623 9.36754L4.21221 7.93133C4.21591 7.89934 4.20551 7.86734 4.18372 7.84364L3.20525 6.77928C2.79641 6.33455 3.03059 5.61381 3.62275 5.49433L5.03997 5.20838C5.07153 5.20201 5.09875 5.18223 5.11456 5.15418L5.82446 3.89469Z",fill:"currentColor"}),C.createElement("path",{d:"M3 14C3 13.4477 3.44772 13 4 13H20C20.5523 13 21 13.4477 21 14C21 14.5523 20.5523 15 20 15H4C3.44772 15 3 14.5523 3 14Z",fill:"currentColor"}),C.createElement("path",{d:"M3 19C3 18.4477 3.44772 18 4 18H20C20.5523 18 21 18.4477 21 19C21 19.5523 20.5523 20 20 20H4C3.44772 20 3 19.5523 3 19Z",fill:"currentColor"})),ig=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M13.1447 8.64062C15.6961 7.2448 16.3355 5.57632 15.8499 4.39456C15.6149 3.82244 15.1231 3.41589 14.5474 3.2906C14.0405 3.18027 13.4851 3.29119 13 3.6678C12.5149 3.29119 11.9595 3.18027 11.4526 3.2906C10.8769 3.41589 10.3851 3.82245 10.1501 4.39457C9.6645 5.57633 10.3039 7.24481 12.8553 8.64062C12.9455 8.68995 13.0546 8.68995 13.1447 8.64062Z",fill:"currentColor"}),C.createElement("path",{d:"M4 5C3.44772 5 3 5.44772 3 6C3 6.55228 3.44772 7 4 7H7C7.55228 7 8 6.55228 8 6C8 5.44772 7.55228 5 7 5H4Z",fill:"currentColor"}),C.createElement("path",{d:"M19 5C18.4477 5 18 5.44772 18 6C18 6.55228 18.4477 7 19 7H20C20.5523 7 21 6.55228 21 6C21 5.44772 20.5523 5 20 5H19Z",fill:"currentColor"}),C.createElement("path",{d:"M11 12C11 11.4477 11.4477 11 12 11H20C20.5523 11 21 11.4477 21 12C21 12.5523 20.5523 13 20 13H12C11.4477 13 11 12.5523 11 12Z",fill:"currentColor"}),C.createElement("path",{d:"M4 17C3.44772 17 3 17.4477 3 18C3 18.5523 3.44772 19 4 19H13C13.5523 19 14 18.5523 14 18C14 17.4477 13.5523 17 13 17H4Z",fill:"currentColor"}),C.createElement("path",{d:"M5.12271 8.8665C5.39815 8.37783 6.10185 8.37783 6.37729 8.8665L7.03648 10.036C7.05116 10.0621 7.07644 10.0804 7.10574 10.0863L8.42173 10.3519C8.97159 10.4628 9.18905 11.1321 8.80941 11.545L7.90083 12.5334C7.8806 12.5554 7.87094 12.5851 7.87437 12.6148L8.0285 13.9484C8.09291 14.5057 7.5236 14.9193 7.01354 14.6858L5.79281 14.1271C5.76563 14.1147 5.73437 14.1147 5.70719 14.1271L4.48646 14.6858C3.9764 14.9193 3.40709 14.5057 3.4715 13.9484L3.62563 12.6148C3.62906 12.5851 3.6194 12.5554 3.59917 12.5334L2.69059 11.545C2.31095 11.1321 2.5284 10.4628 3.07827 10.3519L4.39426 10.0863C4.42356 10.0804 4.44884 10.0621 4.46352 10.036L5.12271 8.8665Z",fill:"currentColor"})),sg=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 7.5C12 6.94772 12.4477 6.5 13 6.5L20 6.5C20.5523 6.5 21 6.94772 21 7.5C21 8.05228 20.5523 8.5 20 8.5L13 8.5C12.4477 8.5 12 8.05228 12 7.5Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 16.5C12 15.9477 12.4477 15.5 13 15.5L20 15.5C20.5523 15.5 21 15.9477 21 16.5C21 17.0523 20.5523 17.5 20 17.5L13 17.5C12.4477 17.5 12 17.0523 12 16.5Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.25 6.25C5.55964 6.25 5 6.80964 5 7.5C5 8.19036 5.55964 8.75 6.25 8.75C6.94036 8.75 7.5 8.19036 7.5 7.5C7.5 6.80964 6.94036 6.25 6.25 6.25ZM3 7.5C3 5.70507 4.45507 4.25 6.25 4.25C8.04493 4.25 9.5 5.70507 9.5 7.5C9.5 9.29493 8.04493 10.75 6.25 10.75C4.45507 10.75 3 9.29493 3 7.5Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.25 15.25C5.55964 15.25 5 15.8096 5 16.5C5 17.1904 5.55964 17.75 6.25 17.75C6.94036 17.75 7.5 17.1904 7.5 16.5C7.5 15.8096 6.94036 15.25 6.25 15.25ZM3 16.5C3 14.7051 4.45507 13.25 6.25 13.25C8.04493 13.25 9.5 14.7051 9.5 16.5C9.5 18.2949 8.04493 19.75 6.25 19.75C4.45507 19.75 3 18.2949 3 16.5Z",fill:"currentColor"})),ng=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 7.5C11 6.94772 11.4477 6.5 12 6.5L20 6.5C20.5523 6.5 21 6.94772 21 7.5C21 8.05228 20.5523 8.5 20 8.5L12 8.5C11.4477 8.5 11 8.05228 11 7.5Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 16.5C11 15.9477 11.4477 15.5 12 15.5L20 15.5C20.5523 15.5 21 15.9477 21 16.5C21 17.0523 20.5523 17.5 20 17.5L12 17.5C11.4477 17.5 11 17.0523 11 16.5Z",fill:"currentColor"}),C.createElement("path",{d:"M4.1942 19.5C3.63587 19.5 3.39312 19.1885 3.39312 18.7596C3.39312 18.444 3.53877 18.2013 3.86244 17.9302L5.46864 16.5546C6.12407 15.9922 6.31018 15.7374 6.31018 15.3894C6.31018 15.0212 6.02697 14.7664 5.61025 14.7664C5.30276 14.7664 5.09238 14.908 4.8739 15.2235C4.64734 15.5553 4.441 15.6767 4.11328 15.6767C3.67633 15.6767 3.40931 15.4218 3.40931 15.0091C3.40931 14.8756 3.43358 14.7502 3.48618 14.6288C3.79366 13.9329 4.61497 13.5 5.63452 13.5C7.05462 13.5 7.96089 14.2161 7.96089 15.2761C7.96089 16.061 7.5563 16.4697 6.65003 17.2546L5.58597 18.173V18.2053H7.43897C7.86784 18.2053 8.11059 18.4602 8.11059 18.8527C8.11059 19.237 7.86784 19.5 7.43897 19.5H4.1942Z",fill:"currentColor"}),C.createElement("path",{d:"M5.79008 10.5C5.2797 10.5 4.9381 10.1705 4.9381 9.66008V6.05928H4.90595L4.29108 6.48526C4.14641 6.58573 4.05398 6.61788 3.89323 6.61788C3.57574 6.61788 3.3306 6.38078 3.3306 6.0432C3.3306 5.8061 3.42705 5.61319 3.6521 5.46048L4.70501 4.7572C5.04259 4.53215 5.33596 4.5 5.6655 4.5C6.28037 4.5 6.64205 4.86973 6.64205 5.45244V9.66008C6.64205 10.1705 6.30046 10.5 5.79008 10.5Z",fill:"currentColor"})),rg=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M8.65462 8.37396L15.6388 15.3512M12.8501 6.74062L13.6043 7.49413L17.0132 4.01672C17.8319 3.18151 19.1748 3.17483 20.0018 4.00185C20.8274 4.82744 20.8224 6.16751 19.9907 6.98689L16.5195 10.4064L17.2738 11.1599C18.1482 12.0335 18.0504 13.4663 17.1702 14.3341C15.6073 15.875 14.4302 17.5857 13.5582 19.5912C13.0469 20.7672 11.6642 21.384 10.5542 20.7403C7.99788 19.2577 7.10726 18.7102 5.45202 16.6699L7.01481 14.0165L4.21729 14.9911C3.89155 14.5044 3.57358 13.9929 3.25992 13.4531C2.61553 12.3442 3.23316 10.9633 4.4104 10.4525C6.41784 9.5814 8.13032 8.40545 9.67274 6.84413C10.5414 5.96481 11.9756 5.86704 12.8501 6.74062Z",stroke:"currentColor",strokeWidth:2,strokeLinejoin:"round"})),og=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 4C10.5523 4 11 4.44772 11 5V9H20C20.5523 9 21 9.44772 21 10C21 10.5523 20.5523 11 20 11H11V19C11 19.5523 10.5523 20 10 20C9.44772 20 9 19.5523 9 19V11H4C3.44772 11 3 10.5523 3 10C3 9.44772 3.44772 9 4 9H9V5C9 4.44772 9.44772 4 10 4Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.2587 3.5H15.7413C16.5463 3.49999 17.2106 3.49998 17.7518 3.54419C18.3139 3.59012 18.8306 3.68868 19.316 3.93597C20.0686 4.31947 20.6805 4.93139 21.064 5.68404C21.3113 6.16937 21.4099 6.68608 21.4558 7.24817C21.5 7.78936 21.5 8.45372 21.5 9.25868V14.7413C21.5 15.5463 21.5 16.2106 21.4558 16.7518C21.4099 17.3139 21.3113 17.8306 21.064 18.316C20.6805 19.0686 20.0686 19.6805 19.316 20.064C18.8306 20.3113 18.3139 20.4099 17.7518 20.4558C17.2106 20.5 16.5463 20.5 15.7413 20.5H8.25868C7.45372 20.5 6.78936 20.5 6.24817 20.4558C5.68608 20.4099 5.16937 20.3113 4.68404 20.064C3.93139 19.6805 3.31947 19.0686 2.93597 18.316C2.68868 17.8306 2.59012 17.3139 2.54419 16.7518C2.49998 16.2106 2.49999 15.5463 2.5 14.7413V9.2587C2.49999 8.45373 2.49998 7.78937 2.54419 7.24817C2.59012 6.68608 2.68868 6.16937 2.93597 5.68404C3.31947 4.93139 3.93139 4.31947 4.68404 3.93597C5.16937 3.68868 5.68608 3.59012 6.24817 3.54419C6.78937 3.49998 7.45373 3.49999 8.2587 3.5ZM6.41104 5.53755C5.97262 5.57337 5.74842 5.6383 5.59202 5.71799C5.2157 5.90973 4.90973 6.2157 4.71799 6.59202C4.6383 6.74842 4.57337 6.97262 4.53755 7.41104C4.50078 7.86113 4.5 8.44342 4.5 9.3V14.7C4.5 15.5566 4.50078 16.1389 4.53755 16.589C4.57337 17.0274 4.6383 17.2516 4.71799 17.408C4.90973 17.7843 5.2157 18.0903 5.59202 18.282C5.74842 18.3617 5.97262 18.4266 6.41104 18.4624C6.86113 18.4992 7.44342 18.5 8.3 18.5H15.7C16.5566 18.5 17.1389 18.4992 17.589 18.4624C18.0274 18.4266 18.2516 18.3617 18.408 18.282C18.7843 18.0903 19.0903 17.7843 19.282 17.408C19.3617 17.2516 19.4266 17.0274 19.4624 16.589C19.4992 16.1389 19.5 15.5566 19.5 14.7V9.3C19.5 8.44342 19.4992 7.86113 19.4624 7.41104C19.4266 6.97262 19.3617 6.74842 19.282 6.59202C19.0903 6.2157 18.7843 5.90973 18.408 5.71799C18.2516 5.6383 18.0274 5.57337 17.589 5.53755C17.1389 5.50078 16.5566 5.5 15.7 5.5H8.3C7.44342 5.5 6.86113 5.50078 6.41104 5.53755Z",fill:"currentColor"})),lg=s=>C.createElement("svg",{width:16,height:17,viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M12.0464 13.9622C10.5481 13.9622 9.49341 13.0267 9.49341 11.6453C9.49341 10.3004 10.5262 9.47447 12.3373 9.37214L14.4394 9.24789V8.65586C14.4394 7.80071 13.8648 7.28907 12.9047 7.28907C12.1482 7.28907 11.6464 7.55951 11.2099 8.26117C11.0499 8.49506 10.8463 8.59739 10.5699 8.59739C10.1771 8.59739 9.89345 8.33426 9.89345 7.93958C9.89345 7.77878 9.93709 7.60336 10.0316 7.42794C10.4317 6.55817 11.5882 6.00269 12.9629 6.00269C14.8176 6.00269 16.0032 6.9894 16.0032 8.53161V13.1728C16.0032 13.6698 15.6904 13.9695 15.2467 13.9695C14.8103 13.9695 14.5121 13.6845 14.4976 13.2167V12.5662H14.4612C14.0175 13.4213 13.0429 13.9622 12.0464 13.9622ZM12.4755 12.7124C13.5738 12.7124 14.4394 11.9522 14.4394 10.9509V10.3442L12.5483 10.4612C11.61 10.527 11.079 10.9436 11.079 11.6014C11.079 12.2738 11.6391 12.7124 12.4755 12.7124Z",fill:"currentColor"}),C.createElement("path",{d:"M0.814628 13.9476C0.327306 13.9476 0 13.6479 0 13.202C0 13.0778 0.0290939 12.917 0.101828 12.7196L3.29488 4.0219C3.50581 3.43718 3.86221 3.16675 4.43681 3.16675C5.00414 3.16675 5.35327 3.42987 5.57147 4.01459L8.7718 12.7196C8.84453 12.9243 8.87362 13.0632 8.87362 13.202C8.87362 13.6333 8.53177 13.9476 8.059 13.9476C7.62259 13.9476 7.38256 13.7429 7.2371 13.2751L6.43701 11.002H2.42206L1.62926 13.2678C1.47651 13.7429 1.23649 13.9476 0.814628 13.9476ZM2.83665 9.66447H6.02243L4.44409 5.03786H4.40044L2.83665 9.66447Z",fill:"currentColor"})),ag=[{id:"suggest",title:E({id:"DJBCXv",defaultMessage:"Suggest edits"}),icon:oc,prompt:E({id:"BfBd/I",defaultMessage:"Suggest edits that would improve this text, like content to add or remove, places to rephrase so that the text flows more smoothly, or ways to reorganize the ideas to be more effective. Leave as few comments as possible, but add a few more comments if the text is long. DO NOT leave more than 5 comments. You can reply that you added comments and suggestions to help improve the writing quality, but do not mention the prompt."}),action:ie.COMMENT},{id:"emoji",title:E({id:"nH2MaB",defaultMessage:"Add emojis"}),icon:_u,action:ie.EDIT,grid:[{prompt:E({id:"JTAWur",defaultMessage:"Replace as many words as possible with emojis."}),icon:ig,title:E({id:"rADAL1",defaultMessage:"Words"})},{prompt:E({id:"AvWBKJ",defaultMessage:"Add three emojis at the start or end of every major section or paragraph to give subtle decoration. Do not change the structure of the original text. Do not add emojis to lists."}),icon:tg,title:E({id:"qoHmnu",defaultMessage:"Sections"})},{prompt:E({id:"Rzca6Y",defaultMessage:"Add emojis to lists for visual flair. Do not change the structure of the original text."}),icon:Qm,title:E({id:"/iBeX+",defaultMessage:"Lists"})},{prompt:E({id:"YOtrrm",defaultMessage:"Remove emojis"}),icon:eg,title:E({id:"Ex7XkT",defaultMessage:"Remove"})}]},{id:"polish",title:E({id:"q/wllh",defaultMessage:"Add final polish"}),icon:rg,prompt:E({id:"qTOQqX",defaultMessage:"Add some final polish to the text. If relevant, add a large title or any section titles. Check grammar and mechanics, make sure everything is consistent and reads well. You can reply that you added some final polish and checked for grammar, but do not mention the prompt."}),action:ie.EDIT},{id:"reading-level",title:E({id:"e1CNWE",defaultMessage:"Reading level"}),icon:Jm,action:ie.EDIT,scrub:[{prompt:E({id:"98kB8D",defaultMessage:"Rewrite this text at the reading level of a doctoral writer in this subject. You may reply that you adjusted the text to reflect a graduate school reading level, but do not mention the prompt."}),title:E({id:"zIN5xc",defaultMessage:"Graduate School"})},{prompt:E({id:"XfveZa",defaultMessage:"Rewrite this text at the reading level of a college student majoring in this subject"}),title:E({id:"lZ5ttG",defaultMessage:"College"})},{prompt:E({id:"ed5yE6",defaultMessage:"Rewrite this text at the reading level of a high school student who has taken a couple of classes in this subject."}),title:E({id:"KeBm6Z",defaultMessage:"High School"})},{title:E({id:"tO5EOl",defaultMessage:"Keep current reading level"}),isCancel:!0},{prompt:E({id:"YIIyU/",defaultMessage:"Rewrite this text at the reading level of a middle schooler."}),title:E({id:"FlwtZ0",defaultMessage:"Middle School"})},{prompt:E({id:"TQ0+4A",defaultMessage:"Rewrite this text at the reading level of a kindergartener."}),title:E({id:"4hQpWn",defaultMessage:"Kindergarten"})}]},{id:"length",title:E({id:"D+HIXi",defaultMessage:"Adjust the length"}),icon:Xm,action:ie.EDIT,scrub:[{prompt:E({id:"CPELTR",defaultMessage:"Make this text 75% longer."}),title:E({id:"UMJQry",defaultMessage:"Longest"})},{prompt:E({id:"GfSrP9",defaultMessage:"Make this text 50% longer."}),title:E({id:"n3jwqb",defaultMessage:"Longer"})},{title:E({id:"+Vn3dN",defaultMessage:"Keep current length"}),isCancel:!0},{prompt:E({id:"oQnJVV",defaultMessage:"Make this text 50% shorter."}),title:E({id:"OP0SP3",defaultMessage:"Shorter"})},{prompt:E({id:"k5SZ0S",defaultMessage:"Make this text 75% shorter."}),title:E({id:"bMef50",defaultMessage:"Shortest"})}]}],i0=[{id:"none",title:E({id:"XqUjk5",defaultMessage:"Plain text"}),icon:lg,prompt:E({id:"H2OFQy",defaultMessage:"Transform this into plain text. Remove any formatting."}),action:ie.EDIT},{id:"bullets",title:E({id:"+qR+tC",defaultMessage:"Bulleted list"}),icon:sg,prompt:E({id:"8Anlmq",defaultMessage:"Transform this into a bulleted list."}),action:ie.EDIT},{id:"list",title:E({id:"Rm67Xw",defaultMessage:"Numbered list"}),icon:ng,prompt:E({id:"0pEdK3",defaultMessage:"Transform this into a numbered list."}),action:ie.EDIT},{id:"table",title:E({id:"zUJNQu",defaultMessage:"Table"}),icon:og,prompt:E({id:"BX96Lh",defaultMessage:"Transform this into a table. Add any appropriate labels to the columns or rows headers."}),action:ie.EDIT}];class hg{dependencies(){return[]}unifiedInitializationHook(e){return e}}class gh extends hg{unistToProseMirrorTest(e){return e.type===this.unistNodeName()}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}postUnistToProseMirrorHook(e){}}class s0 extends gh{proseMirrorToUnistTest(e){return this.proseMirrorNodeName()===e.type.name}proseMirrorNodeView(){return null}proseMirrorNodeName(){return this.constructor.proseMirrorNodeName()}static proseMirrorNodeName(){throw new Error("Method not implemented.")}}class cg extends gh{proseMirrorMarkName(){return this.constructor.proseMirrorMarkName()}static proseMirrorMarkName(){throw new Error("Method not implemented.")}}class ug extends cg{unistNodeName(){return"startend"}static proseMirrorMarkName(){return"startend"}proseMirrorMarkSpec(){return{attrs:{start:{},end:{}},toDOM(){return["span",0]}}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:i}){return t.map(n=>n.mark(n.marks.concat([e.marks[this.proseMirrorMarkName()].create(i)])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}function Os(s){if(s.type.name!=="text"){const{start:n,end:r}=s.attrs;return n==null||r==null?null:{start:n,end:r}}const e=s.marks.find(n=>n.type.name===ug.proseMirrorMarkName());if(!e)return null;const{start:t,end:i}=e.attrs;return t==null||i==null?null:{start:t,end:i}}function ph(s,e){const{parent:t,textOffset:i}=e,n=s.nodeAt(e.pos);if(!n)return Mi(Os(t)).end;const{start:r}=Mi(Os(n));return r+i}function xh(s,e){const t=s.nodeAt(e.pos);if(t){const{start:i}=Mi(Os(t));return i+e.textOffset}return Mi(Os(e.parent)).end}function n0(s,e){const t=new Map;for(const[i,n]of e){const r=ph(s,s.resolve(n.start)),o=xh(s,s.resolve(n.end));t.set(i,{start:r,end:o})}return t}function dg(s){const{doc:e,selection:t}=s,{$from:i,$to:n}=t,{pos:r}=i,{pos:o}=n,l=e.textBetween(r,o);try{const a=ph(e,i),c=xh(e,n);return{sourceFrom:a,sourceTo:c,from:r,to:o,selectedText:l}}catch(a){Oe.logError("Getting source selection",a)}return{selectedText:l,from:r,to:o}}const St={type:"spring",bounce:.2,duration:.5};function fg(s){return s instanceof Wu}function r0(s){return s instanceof V}const mg=C.createContext(()=>null),gg=C.createContext(null),pg=C.createContext(0),xg=()=>C.useContext(mg),o0=()=>C.useContext(gg),l0=()=>C.useContext(pg),Cg=C.createContext(()=>null),wg=C.createContext(null),a0=C.createContext(0),yg=()=>C.useContext(Cg),h0=()=>C.useContext(wg);function bg(){const s=yg(),e=xg();return C.useMemo(()=>()=>s()??e(),[s,e])}const Ch=({title:s,icon:e,size:t,opacity:i,initialHeight:n=t,initialScale:r=1,onClick:o,isConfirming:l,isSmall:a,onSubmit:c})=>{const h=ee(),u=Fh(),[d,m]=C.useState(!1),g=ji(),p=()=>{m(!0)},x=()=>{m(!1)},w=f.jsx(P.div,{initial:{scale:r,opacity:0},animate:{scale:1,opacity:1,transition:{type:"spring",bounce:.24,duration:.52}},exit:{scale:.5,opacity:0,transition:{type:"spring",bounce:.24,duration:.52,opacity:{duration:.1}}},whileHover:{scale:1.15},transition:St,children:f.jsx(P.div,{className:"flex cursor-pointer items-start overflow-hidden",initial:{width:t,height:t},animate:{width:t,height:t},transition:St,onMouseEnter:p,onMouseLeave:x,children:l?f.jsx(P.button,{className:"m-auto h-8 w-8 rounded-full bg-black text-center dark:bg-white",initial:{opacity:0,scale:.64},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:c,children:f.jsx(Ds,{className:D("h-8 w-8 animate-pulsing text-white dark:text-black",a?"icon-md":"icon-lg")})}):e})});return f.jsx(P.div,{role:"button",onClick:o,initial:{height:n},animate:{height:t,opacity:l?1:i??.52},exit:{height:0},whileHover:{opacity:1},transition:St,children:g?f.jsx(ze,{delayDuration:0,sideOffset:4,open:u?!!(l||d):!1,label:h.formatMessage(s),side:"right",contentClassName:"pointer-events-none",children:w}):w})};function Xo({accelerator:s,size:e,opacity:t,onClick:i,onSubmit:n,disableHeightAnimation:r=!1,disableLabel:o=!1,isCancelledScrubber:l=!1,isSmall:a=!1,isConfirming:c}){const{title:h,icon:u}=s,d=ji(),m=ee();return f.jsxs("div",{className:"relative",children:[!d&&!o&&f.jsx(P.div,{className:"absolute right-full top-1/2 w-[160px] -translate-y-1/2 transform pr-4 text-right text-sm text-token-text-secondary",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:m.formatMessage(h)}),f.jsx(Ch,{size:e,onClick:i,opacity:t,initialHeight:l||r?"auto":0,initialScale:l?.88:.5,title:h,isSmall:a,isConfirming:c,onSubmit:n,icon:f.jsx(u,{className:D("text-token-primary m-auto",a?"icon-md":"icon-lg")})})]})}function vg({title:s,onSubmit:e,icon:t}){const i=ee(),n=t;return f.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,className:"flex aspect-square w-20 min-w-20 max-w-20 cursor-pointer flex-col items-center rounded-2xl p-3 text-token-text-secondary transition-colors hover:bg-gray-100/75 hover:text-token-text-primary dark:hover:bg-gray-700",children:[f.jsx(n,{className:"icon-2xl m-auto"}),f.jsx("div",{className:"line-clamp-1 w-16 max-w-16 overflow-hidden text-center text-xs",children:i.formatMessage(s)})]})}function Sg({grid:s,onSubmit:e,title:t}){const i=ee();return f.jsxs("div",{className:"flex h-full flex-col content-center gap-y-4 overflow-x-hidden px-3 py-4",children:[f.jsx("div",{className:"text-token-primary mt-1 text-center font-medium",children:t}),f.jsx("div",{className:"flex-auto",children:f.jsx("div",{className:"grid grid-cols-2 gap-1",children:s.map((n,r)=>f.jsx(vg,{title:n.title,icon:n.icon,onSubmit:()=>{const o=s[r];"prompt"in o&&e?.(i.formatMessage(o.prompt))}},r))})})]})}function kg({title:s,onClick:e,isConfirming:t,onSubmit:i,isAnyItemConfirmed:n}){const r=ee();return f.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,className:D("flex-item my-1 flex min-w-40 cursor-pointer items-center overflow-hidden text-clip whitespace-nowrap rounded-2xl py-2 pl-4 pr-2 font-medium transition-colors hover:bg-gray-100/75 dark:hover:bg-gray-700",{"bg-gray-100/50 dark:bg-gray-700/50":t,"text-token-text-secondary hover:text-token-text-primary":!t&&n}),children:[f.jsx("div",{className:"flex-auto",children:r.formatMessage(s)}),f.jsx(P.button,{className:D("ml-3 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"pointer-events-none invisible":!t}),initial:{opacity:0,scale:.64},animate:{opacity:t?1:0,scale:t?1:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:i,children:f.jsx(Ds,{className:D("icon-sm h-6 w-6 text-white dark:text-black")})})]})}function Mg({menu:s,onConfirm:e,onSubmit:t}){const[i,n]=C.useState(!1),r=ee();return f.jsx("div",{className:"h-full flex-col content-center overflow-x-hidden px-3",children:s.map((o,l)=>f.jsx(kg,{title:o.title,isConfirming:i===l,isAnyItemConfirmed:i!==!1,onClick:()=>{n(l),e?.()},onSubmit:()=>{const a=s[l];"prompt"in a&&t?.(r.formatMessage(a.prompt))}},`menu-item-${o.title}`))})}const Eg=s=>"isCancel"in s&&s.isCancel,ln=280;function Ag(s,e,t){if(t===e)return 1;const i=(s-e)/(t-e);return lc(i,0,1)}function Tg({size:s,acceleratorScrubber:e,onConfirm:t,onCancel:i,onSubmit:n,onDragStart:r,isConfirming:o}){const{icon:l}=e,a="scrub"in e?e.scrub:[],c=6,h=s-c*2,u=ee(),d=C.useRef(null),m=C.useRef(null),[g,p]=C.useState(a?Math.floor(a.length/2):0),x=Math.round(g),w=C.useRef(g),y=a?u.formatMessage(a[x].title):null,S=_h(0);Wh(S,"change",k=>{const O=-(ln-c)/2+h/2,A=(ln-c)/2-h/2,j=Ag(k,O,A)*(a?a.length-1:0);w.current=j,p(j)});const b=()=>{if(!a||Eg(a[x])||o)return i?.();a&&t?.()},v=()=>{!a||!o||!("prompt"in a[x])||n?.(u.formatMessage(a[x].prompt))};return f.jsx(P.div,{ref:d,className:"start-items relative z-20 flex w-full",style:{top:c,height:ln-c*2},children:f.jsx(P.div,{drag:"y",ref:m,dragConstraints:d,dragMomentum:!1,dragElastic:0,className:D("m-auto rounded-full border border-token-border-light shadow-md transition-colors",o?"cursor-pointer bg-black dark:bg-white":"cursor-grab bg-token-main-surface-primary"),style:{y:S,width:h,height:h},onDragStart:r,onDragEnd:b,children:f.jsx(ze,{delayDuration:0,open:!0,sideOffset:10,label:y,side:"right",children:f.jsx("div",{className:"flex h-full w-full items-start overflow-hidden",children:o?f.jsx(Ds,{onClick:v,className:"icon-lg mx-auto h-10 w-10 translate-y-0.5 animate-pulsing text-white dark:text-black"}):f.jsx(l,{className:D("text-token-primary icon-lg m-auto")})})})})})}const rs=280,Og=235,Jo=1250,Dg=56,Lg=32,Rg=28;function Ng({top:s}){return f.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute left-1/2 m-auto h-1 w-1 -translate-x-1/2 rounded-full bg-gray-300",style:{top:s}})}function Ig({bottom:s=20,right:e=20,isEmbeddedInPromptArea:t=!1,disableHint:i=!1,disableOverlay:n=!1,onCancel:r,onExpandedChange:o,onSubmit:l,isRequestActive:a=!1,isVisuallyHidden:c=!1,actions:h}){const[u,d]=C.useState(!1),[m,g]=C.useState(!i&&!a),[p,x]=C.useState(!0),[w,y]=C.useState(null),[S,b]=C.useState(!1),[v,k]=C.useState(!1),[O,A]=C.useState(!1),[R,j]=C.useState(null),[B,te]=C.useState(null),[z,_]=C.useState(null),H=!p,F=cu(),$=t&&!m,N=$?Lg:Dg,ue=ee(),pe=ji(),Fi=bg(),Se=C.useRef(null),be=a||u,nt=a&&!m&&p;C.useEffect(()=>{m&&!v&&k(!0),o?.(m)},[m,v]),C.useEffect(()=>{S&&!be&&!R&&(Se.current!=null&&clearTimeout(Se.current),g(!0)),!S&&!be&&!R&&(Se.current!=null&&clearTimeout(Se.current),Se.current=window.setTimeout(()=>{g(!1),y(null),A(!1)},Jo))},[S,be,R,m]),C.useEffect(()=>{if(a){y(null);return}d(!1),!v&&!i&&(k(!0),g(!0),Se.current!=null&&clearTimeout(Se.current),Se.current=window.setTimeout(()=>{g(!1),y(null),A(!1),k(!0)},Jo))},[a,i,v]);const ei=I=>{y(I)},Ot=(I,le)=>{b(!1),d(!0),g(!1),y(null),A(!1),j(null),te(null),_(null);const Rt=Fi(),Me=(Ge,Ct)=>{Oe.logButtonClick(jt.ACCELERATOR,{action:{action:le.action,id:le.id,title:le.title},prompt:I,sourceFrom:Ge,sourceTo:Ct})};if(Rt&&fg(Rt)){const{state:Ge}=Rt,{sourceFrom:Ct,sourceTo:rt}=dg(Ge);if(Me(Ct,rt),Ct==null||rt==null){l?.(null,I,le);return}l?.({start:Ct,end:rt},I,le);const si=Ge.tr.setSelection(qu.create(Ge.doc,Ge.selection.anchor));Rt.dispatch(si);return}Me(),l?.(null,I,le)},Te=h[0],Y=h.slice(1),de=!!R&&h.find(({id:I})=>I===R),ke=!!B&&h.find(({id:I})=>I===B),$e=!!z&&h.find(({id:I})=>I===z),Fs=I=>{if(H)return;if(!S){b(!0);return}const{id:le}=I;if("scrub"in I)return j(le);if("menu"in I)return te(le);if("grid"in I)return _(le);ei(le)},pt=I=>{H||"prompt"in I&&Ot(ue.formatMessage(I.prompt),I)},xe=Y.map(I=>{if(!m)return null;const{id:le}=I;return f.jsx(Xo,{accelerator:I,isConfirming:le===w,isCancelledScrubber:O,size:N,onClick:()=>Fs(I),onSubmit:()=>pt(I)},le)}),Dt=C.useRef(null);C.useEffect(()=>{const{current:I}=Dt;if(I)return ki(document,{mousedown:({target:le})=>{le instanceof HTMLElement&&!I.contains(le)&&(g(!1),y(null),A(!1),b(!1),j(null),te(null),_(null))}})},[R,B,z]);const ti=Math.round(rs/N)*2,xt=[];let Lt=0;for(let I=0;I<ti-1;I++)Lt+=rs/ti,xt.push(f.jsx(Ng,{top:Lt}));const ii=f.jsx(P.div,{ref:Dt,initial:{opacity:0,scale:.85,borderRadius:N/2},exit:{opacity:0,borderRadius:N/2},className:D("absolute select-none overflow-visible border border-token-border-light transition-colors",gi.accelerators,{"pointer-events-none":c,"bg-token-main-surface-primary shadow-xl":m&&!R&&!a,"bg-token-main-surface-primary shadow-lg":!m&&!R&&!a&&!t,"border-transparent bg-token-main-surface-primary shadow-sm":!m&&!R&&!a&&t,"border-transparent bg-token-main-surface-secondary":R&&!a,"bg-token-main-surface-primary":a&&!nt,"!bg-black !text-white":!F&&nt,"!bg-white !text-black":F&&nt}),style:{right:e,bottom:s},animate:{scale:be||nt||u?.85:1,opacity:c?0:1,borderRadius:B&&ke&&!be||z&&$e&&!be?Rg:N/2},onHoverStart:()=>{Se.current!=null&&clearTimeout(Se.current),b(!0)},onHoverEnd:()=>b(!1),children:f.jsx(dt,{children:B&&ke&&"menu"in ke&&!be?f.jsx(P.div,{initial:{height:N,width:N},transition:St,animate:{height:rs,width:"auto"},exit:{height:N,width:N},children:f.jsx(Mg,{isConfirming:w===ke.id,onConfirm:()=>ei(ke.id),onSubmit:I=>Ot(I,ke),menu:ke.menu})}):z&&$e&&"grid"in $e&&!be?f.jsx(P.div,{initial:{height:N,width:N},transition:St,animate:{height:Og,width:"auto"},exit:{height:N,width:N},children:f.jsx(Sg,{title:ue.formatMessage($e.title),onSubmit:I=>Ot(I,$e),grid:$e.grid})}):R&&de&&!be?f.jsxs(P.div,{initial:{height:N,width:N},transition:St,animate:{height:rs,width:N},exit:{height:N,width:N},onClick:()=>{y(null)},children:[f.jsx(Tg,{onDragStart:()=>y(null),isConfirming:w===de.id,onConfirm:()=>ei(de.id),onSubmit:I=>Ot(I,de),onCancel:()=>{j(null),A(!0)},size:N,acceleratorScrubber:de}),xt]}):f.jsxs(P.div,{className:"flex flex-col",initial:t?!1:{height:N,width:N},transition:St,animate:{height:m?N*h.length:N,width:N},exit:{height:N,width:N},onAnimationComplete:()=>x(!0),onAnimationStart:()=>x(!1),children:[f.jsx(dt,{children:xe}),f.jsx("div",{className:"flex items-center",style:{width:N,height:N},children:be?nt?f.jsx(Ch,{title:Pg.cancel,icon:f.jsx(ac,{className:D("m-auto shrink-0 animate-pulsing",$?"h-6 w-6":"h-10 w-10")}),isSmall:$,opacity:1,size:N,onClick:()=>{y(null),r?.()}}):f.jsx(an,{size:20,className:"m-auto text-token-text-secondary"}):f.jsx(Xo,{disableHeightAnimation:t,disableLabel:pe||!m,isCancelledScrubber:O,accelerator:Te,isConfirming:w===Te.id,opacity:m?void 0:1,isSmall:$,size:N,onSubmit:()=>pt(Te),onClick:()=>Fs(Te)})})]})})});return n||pe?ii:f.jsxs(f.Fragment,{children:[m&&f.jsx(Sl,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),ii]})}const Pg=st({cancel:{id:"Hov840",defaultMessage:"Cancel"}}),jg={type:"spring",bounce:.2,duration:.56},Bg=({clientThreadId:s,turn:e})=>{const t=uu(),i=hc(e.messages);return f.jsxs(P.div,{className:"absolute left-0 right-0 top-0 z-10 -translate-y-full",children:[f.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 -top-5 bg-vert-light-gradient dark:bg-gradient-to-t dark:from-token-main-surface-primary dark:to-transparent"}),f.jsx(P.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:jg,children:f.jsx(Gu,{clientThreadId:s,onChangeItemInView:ni,onRequestCompletion:async n=>ni(n),onRequestMoreCompletions:ni,groupedMessagesToRender:i,allGroupedMessages:i,isEditing:!1,isUserTurn:!0,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:t,showEditButton:!1,handleEnterEdit:ni,handleExitEdit:ni})})]},"user-message")},Hg=({clientThreadId:s})=>{const e=du(s),t=fu(s,e),{lastUserTurn:i,lastAssistantTurn:n}=C.useMemo(()=>{let o=null,l=null;for(let a=t.length-1;a>0;a--){const c=t[a];if(!o&&c.role===un.User?o=c:!l&&c.role===un.Assistant&&(l=c),o&&l)break}return{lastUserTurn:o,lastAssistantTurn:l}},[t]),r=i&&!n?.messages.find(({message:o})=>o.recipient?.startsWith(mu));return f.jsx(dt,{initial:!1,children:r&&f.jsx(Bg,{turn:i,clientThreadId:s})})},Vg=({isRequestActive:s=!1,clientThreadId:e,readonlyReason:t,onCancel:i,onSubmit:n,onSubmitAccelerator:r,acceleratorActions:o=[]})=>{const[l,a]=C.useState(!1),[c,h]=C.useState(""),[u,d]=C.useState(!0),m=ee(),[g,p]=C.useState(!1),x=ji(),w=()=>{n?.(c),h("")},y=S=>{const{metaKey:b,shiftKey:v,key:k}=S;k==="Enter"&&c.trim()&&!(v||b)&&(w(),S.preventDefault())};return f.jsxs(f.Fragment,{children:[l&&!x&&f.jsx(Sl,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),f.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:f.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[f.jsx(Hg,{clientThreadId:e}),f.jsx("div",{className:"flex flex-auto items-start",children:f.jsx("div",{className:D("flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 pl-6 pr-2 dark:bg-token-main-surface-secondary",{"rounded-full":u,"rounded-2xl":!u,"bg-transparent":g}),children:f.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[f.jsx($u,{placeholder:m.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:s,value:c,className:D("w-full resize-none border-0 bg-transparent p-0 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",{"opacity-0":g}),maxRows:4,onChange:({target:{value:S}})=>h(S),onKeyDown:y,onHeightChange:(S,{rowHeight:b})=>d(Math.floor(S/b)<=1)}),c?f.jsx(P.button,{className:D("dark h-8 w-8 rounded-full bg-token-main-surface-primary text-center disabled:bg-[#D7D7D7]",{"self-end":!u}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>w(),children:f.jsx(Ds,{className:"h-8 w-8 text-token-text-primary"})}):(o?.length??0)>0&&f.jsx(Ig,{disableHint:!0,isVisuallyHidden:t?.isReadonly&&!t.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:s,actions:o,onCancel:i,onExpandedChange:S=>{x||p(S),a(S)},onSubmit:r,right:0,bottom:4})]})})})]})})]})};function Fg(s,e){const t=new Set(s.map(l=>l.id)),i=new Set(e.map(l=>l.id)),n=s.filter(l=>!i.has(l.id)).map(l=>({...l,diffStatus:zt.REMOVED})),r=e.filter(l=>!t.has(l.id)).map(l=>({...l,diffStatus:zt.ADDED})),o=s.filter(l=>i.has(l.id));return n.concat(r,o)}const _g=s=>{const{textdocId:e}=s,t=hl(i=>i?.resolveTempTextdocId[e]??e);return C.useMemo(()=>({...s,textdocId:t}),[t,s])};function Wg(s){const{voiceName:e}=cc(),t=()=>qg(s?.textdocId,e,Yu()),i=`${s?.textdocId}.${s?.versionInt}.${e}`;return Ku(t,i)}async function qg(s,e,t){if(!s)return null;const i={voice:e};t&&(i.format=t);const n=new URLSearchParams(i);return await Ls.get(`${gu}/textdoc/${s}/synthesize?${n.toString()}`,{skipJsonTransform:!0})}const zg=({textdocVersion:s,isPersisting:e=!1,isTextdocAttachedPending:t,children:i})=>{const n=ee(),r=or();uc(),Wg(s);const o=[null].filter(Boolean);if(o.length===0)return f.jsxs("div",{className:"ml-2.5",children:[i,e&&f.jsx(an,{size:12,className:"pl-1 text-token-text-secondary"})]});const l=s&&f.jsx(ri.Portal,{children:f.jsxs(ri.Content,{onCloseAutoFocus:a=>a.preventDefault(),children:[f.jsx(ri.Item,{icon:Cl,onClick:()=>rr(s.content,r),children:n.formatMessage({id:"KQqo8h",defaultMessage:"Copy"})},"copy"),o]})});return f.jsxs(f.Fragment,{children:[!1,f.jsxs(ri.Root,{children:[f.jsxs(ri.Trigger,{className:"pr-2",children:[i,e?f.jsx(an,{size:12,className:"pl-1 text-token-text-secondary"}):f.jsx(dc,{className:"icon-md text-token-text-tertiary"},"chevron")]}),l]})]})};function Ug({textdocVersion:s,clientThreadId:e}){const t=ee(),i=or(),[n,r]=C.useState(!1),o=pu(),l=hl(h=>s&&h?.lastCanvasAssistantMessageById[s.textdocId]),a=C.useRef(s?.content??"");C.useEffect(()=>{a.current=s?.content??""},[s]);const c=h=>{n||(o(async()=>{const u=bs.getServerThreadId(e);s!=null&&u!=null&&l!=null&&xu.submitImplicitMessageFeedback({type:"copy",source:"mouse",location:"canvas",selectedText:a.current,messageId:l,serverThreadId:u}),Oe.logButtonClick(jt.COPY,{contentLength:a.current.length,textdocType:s?.type});const d={"text/plain":a.current};try{if(s?.type===We.DOCUMENT){const{markdownToHtml:m}=await pl(async()=>{const{markdownToHtml:g}=await import("./oy602885cmig2wxq.js");return{markdownToHtml:g}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]));d["text/html"]=await m(a.current)}}catch(m){Oe.logError("Error copying rich text",m)}rr(d,i,h)},0),r(!0),o(()=>r(!1),2e3))};return f.jsx(ze,{label:t.formatMessage($g.copy),children:f.jsx(Si,{icon:n?fc:Cl,onClick:c})})}const $g=st({copy:{id:"rbIYfo",defaultMessage:"Copy"}}),Gg=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M21 13.6647C21 14.9442 20.7333 16.0559 20.1996 17C19.666 17.9503 18.8997 18.6863 17.9008 19.208C16.908 19.736 15.7198 20 14.3361 20H12.0372C11.696 20 11.4137 19.8851 11.1902 19.6553C10.9669 19.4317 10.8553 19.1584 10.8553 18.8354C10.8553 18.5124 10.9669 18.2391 11.1902 18.0155C11.4137 17.792 11.696 17.6801 12.0372 17.6801H14.2245C15.18 17.6801 15.9897 17.5032 16.6535 17.1491C17.3237 16.795 17.8325 16.3136 18.1799 15.7049C18.5336 15.0901 18.7105 14.3851 18.7105 13.5901C18.7105 12.8075 18.5336 12.1118 18.1799 11.5031C17.8325 10.8944 17.3237 10.4193 16.6535 10.0776C15.9897 9.73607 15.18 9.56516 14.2245 9.56516H8.64014L5.3268 9.41619L5.70838 8.80125L8.05379 10.7577L10.2316 12.8819C10.331 12.9876 10.4116 13.1056 10.4737 13.236C10.5419 13.3664 10.5761 13.5187 10.5761 13.6926C10.5761 14.0155 10.4705 14.2826 10.2596 14.4938C10.0549 14.705 9.78176 14.8106 9.44056 14.8106C9.13032 14.8106 8.85421 14.6894 8.61223 14.4472L3.36299 9.25782C3.2451 9.1522 3.15513 9.0249 3.09307 8.8758C3.03103 8.72056 3 8.56519 3 8.40995C3 8.24845 3.03103 8.09321 3.09307 7.94411C3.15513 7.78888 3.2451 7.65531 3.36299 7.54342L8.61223 2.35404C8.85421 2.11801 9.13032 2 9.44056 2C9.78176 2 10.0549 2.1056 10.2596 2.31678C10.4705 2.52175 10.5761 2.78572 10.5761 3.1087C10.5761 3.28261 10.5419 3.4379 10.4737 3.57454C10.4116 3.70497 10.331 3.82299 10.2316 3.92857L8.05379 6.0528L5.70838 8.00926L5.3268 7.39445L8.64014 7.24535H14.2245C15.6267 7.24535 16.8335 7.51548 17.8449 8.05587C18.8624 8.59626 19.6412 9.35091 20.1811 10.3199C20.727 11.2826 21 12.3976 21 13.6647Z",fill:"currentColor"})),Kg=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{d:"M3 13.6647C3 12.3976 3.26992 11.2826 3.80973 10.3199C4.35574 9.35091 5.13444 8.59626 6.14582 8.05587C7.16341 7.51548 8.37334 7.24535 9.77563 7.24535H15.3506L18.6732 7.39445L18.2917 8.00926L15.937 6.0528L13.7684 3.92857C13.6629 3.82299 13.576 3.70497 13.5078 3.57454C13.4457 3.4379 13.4147 3.28261 13.4147 3.1087C13.4147 2.78572 13.517 2.52175 13.7218 2.31678C13.9328 2.1056 14.209 2 14.5501 2C14.8666 2 15.1427 2.11801 15.3785 2.35404L20.637 7.54342C20.7549 7.65531 20.8449 7.78888 20.907 7.94411C20.969 8.09321 21 8.24845 21 8.40995C21 8.56519 20.969 8.72056 20.907 8.8758C20.8449 9.0249 20.7549 9.1522 20.637 9.25782L15.3785 14.4472C15.1427 14.6894 14.8666 14.8106 14.5501 14.8106C14.209 14.8106 13.9328 14.705 13.7218 14.4938C13.517 14.2826 13.4147 14.0155 13.4147 13.6926C13.4147 13.5187 13.4457 13.3664 13.5078 13.236C13.576 13.1056 13.6629 12.9876 13.7684 12.8819L15.937 10.7577L18.2917 8.80125L18.6732 9.41619L15.3506 9.56516H9.77563C8.82007 9.56516 8.00726 9.73607 7.33714 10.0776C6.66702 10.4193 6.15513 10.8944 5.80146 11.5031C5.45399 12.1118 5.28026 12.8075 5.28026 13.5901C5.28026 14.3851 5.45399 15.0901 5.80146 15.7049C6.15513 16.3136 6.66702 16.795 7.33714 17.1491C8.00726 17.5032 8.82007 17.6801 9.77563 17.6801H11.9627C12.3041 17.6801 12.5833 17.792 12.8005 18.0155C13.0238 18.2391 13.1355 18.5124 13.1355 18.8354C13.1355 19.1584 13.0238 19.4317 12.8005 19.6553C12.5833 19.8851 12.3041 20 11.9627 20H9.66399C8.28026 20 7.08895 19.736 6.08999 19.208C5.09722 18.6863 4.33403 17.9503 3.80043 17C3.26681 16.0559 3 14.9442 3 13.6647Z",fill:"currentColor"})),Yg=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 5.99929V4.5C4 3.94772 3.55228 3.5 3 3.5C2.44772 3.5 2 3.94772 2 4.5V9C2 9.55228 2.44772 10 3 10H7C7.55228 10 8 9.55228 8 9C8 8.44772 7.55228 8 7 8H5.07004C6.4544 5.60707 9.04034 4 12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C8.194 20 5.0066 17.3412 4.19823 13.7787C4.07601 13.2401 3.54032 12.9026 3.00173 13.0248C2.46314 13.147 2.12559 13.6827 2.24781 14.2213C3.25835 18.6747 7.23965 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C8.72759 2 5.82361 3.57195 4 5.99929ZM12 6C12.5523 6 13 6.44772 13 7V12C13 12.2652 12.8946 12.5196 12.7071 12.7071L10.2071 15.2071C9.81658 15.5976 9.18342 15.5976 8.79289 15.2071C8.40237 14.8166 8.40237 14.1834 8.79289 13.7929L11 11.5858V7C11 6.44772 11.4477 6 12 6Z",fill:"currentColor"}));function Zg({disabled:s=!1,isShowingChanges:e,onMouseEnter:t,onClick:i,onEsc:n}){const r=ee(),o=C.useRef(null);return C.useEffect(()=>{if(e){const l=a=>{a.key==="Escape"&&(n?.(),o.current&&o.current===document.activeElement&&o.current.blur())};return window.document.addEventListener("keydown",l),()=>{window.document.removeEventListener("keydown",l)}}},[e,n]),f.jsx(ze,{label:!s&&r.formatMessage(e?Qo.hideChanges:Qo.showChanges),children:f.jsx(Si,{icon:Yg,ref:o,disabled:s,onClick:i,onMouseEnter:t,className:D("transition-colors",e&&kl)})})}const Qo=st({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}});function Xg({disabled:s=!1,hasPreviousVersion:e,hasNextVersion:t,isShowingChanges:i,onHoverPrevious:n,onHoverShowChanges:r,onToggleShowChanges:o,onClickPrevious:l,onClickNext:a}){const c=lr(),h=ee();return f.jsxs("div",{className:D("flex items-center",c?"gap-1":"gap-1.5"),children:[f.jsx(Zg,{disabled:s||!e,isShowingChanges:i,onMouseEnter:r,onClick:o,onEsc:o}),f.jsx(ze,{label:e&&h.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"}),children:f.jsx(Si,{disabled:s||!e,icon:Gg,onMouseOver:n,onClick:l})}),f.jsx(ze,{label:t&&h.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"}),children:f.jsx(Si,{disabled:s||!t,icon:Kg,onClick:a})})]})}const Jg=s=>C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",...s},C.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2ZM9 8.963v6.074c0 .9.996 1.444 1.754.957l4.723-3.037a1.138 1.138 0 0 0 0-1.914l-4.723-3.037A1.138 1.138 0 0 0 9 8.963Z",clipRule:"evenodd"}));function Qg({isDisabled:s=!1,isCodePreviewable:e=!1,isCodeRunning:t,clientThreadId:i,onClick:n}){const r=ee(),[o,l]=C.useState(t),a=nr(xs.hasSeenCanvasCodeExecutionNux),[c,h]=C.useState(!1);C.useEffect(()=>{let x=null;return!t||e?l(t):(x=setTimeout(()=>{l(t)},200),()=>clearTimeout(x))},[t,e]);const u=()=>({conversation_id:bs.getServerThreadId(i)}),d=()=>{if(Wr.logEventWithStatsig(qr.canvasRunCodeButtonClicked,"chatgpt_canvas_run_code_button_clicked",u()),!!!Cs.getItem(ws.HasConfirmedCanvasCodeExecution))return h(!0);setTimeout(()=>n?.())},m=f.jsxs("button",{disabled:s||t&&!o,onClick:d,className:D("btn flex gap-2 rounded-full border transition-colors",o?D(kl,"border-blue-400/15"):"border-token-border-light bg-token-main-surface-primary hover:bg-token-main-surface-secondary"),children:[o?f.jsx(Zu,{className:"icon-md"}):f.jsx(Jg,{className:"icon-md"}),f.jsx(ae,{...o?hi.stopCode:e?hi.previewCode:hi.runCode})]}),g=!a.isLoading&&a.eligible,p=t?null:f.jsx(ae,{...e?hi.previewCodeTooltip:hi.runCodeTooltip});return f.jsxs(f.Fragment,{children:[c&&f.jsx(mc,{isOpen:!0,textCenter:!0,title:f.jsx("span",{className:"text-xl",children:f.jsx(ae,{id:"w3tO4v",defaultMessage:"Run Python code?"})}),description:f.jsx("span",{className:"-mb-2 mt-3 block text-token-text-secondary",children:f.jsx(ae,{id:"yOSeuT",defaultMessage:"Python in canvas can make network requests and interact with external systems. Please review your code carefully before proceeding."})}),onClose:()=>{Wr.logEventWithStatsig(qr.canvasRunCodeConfirmationCancelButtonClicked,"chatgpt_canvas_run_code_confirmation_cancel_button_clicked",u()),h(!1)},onConfirm:()=>{Cs.setItem(ws.HasConfirmedCanvasCodeExecution,!0),n?.(),h(!1)},confirmText:r.formatMessage({id:"e6qVuM",defaultMessage:"Always run"})}),g?f.jsx(gc,{announcementKey:xs.hasSeenCanvasCodeExecutionNux,show:!0,side:"bottom",align:"end",theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:f.jsx(ae,{id:"+N5tJg",defaultMessage:"Run Python code"}),description:f.jsx(ae,{id:"ew1tTJ",defaultMessage:"See your output and get help debugging without leaving the canvas."}),onDismiss:a.markAsViewed,sideOffset:0,children:m}):p?f.jsx(ze,{label:p,children:m}):m]})}const hi=st({previewCode:{id:"a08baM",defaultMessage:"Preview"},runCode:{id:"O/1aYA",defaultMessage:"Run"},stopCode:{id:"nCwG4+",defaultMessage:"Stop"},runCodeTooltip:{id:"UeNB/S",defaultMessage:"See output and debug"},previewCodeTooltip:{id:"wZB9Dv",defaultMessage:"View and debug your app in canvas"}});function ep(){const s=window.location.origin+"/canvas/shared/...",e=ee();return f.jsx("div",{className:"w-[300px] bg-token-main-surface-primary sm:w-[400px]",children:f.jsxs("div",{className:"flex flex-col gap-4 rounded-[22px] px-[22px] pb-[18px] pt-[22px] shadow-[0_4px_24px_-5px_rgba(0,0,0,0.2)]",children:[f.jsx("div",{className:"text-lg",children:e.formatMessage(er.shareCanvas)}),f.jsxs("div",{className:"mb-2 flex items-center justify-between rounded-full border border-token-border-medium bg-token-main-surface-primary p-1.5 text-token-text-secondary last:mb-2 sm:p-2",children:[f.jsxs("div",{className:"relative ml-1 flex-grow",children:[f.jsx("input",{type:"text",readOnly:!0,value:s,className:D("w-full rounded-xl border-0 bg-token-main-surface-primary px-2 py-1 text-lg sm:py-2.5","text-token-text-tertiary")}),f.jsx("div",{className:"pointer-events-none absolute bottom-0 right-0 top-0 w-12 bg-gradient-to-l from-token-main-surface-primary"})]}),f.jsx(Ut,{icon:Xu,children:e.formatMessage(er.createLink)})]})]})})}function tp(){const s=ee();return f.jsxs(rl,{children:[f.jsx(ol,{children:f.jsx(ze,{label:s.formatMessage(er.copy),children:f.jsx(Si,{icon:pc})})}),f.jsx(ll,{children:f.jsx(al,{align:"end",className:"z-50",sideOffset:8,children:f.jsx(ep,{})})})]})}const er=st({copy:{id:"Tne3oh",defaultMessage:"Share"},createLink:{id:"Ns/mpl",defaultMessage:"Create link"},shareCanvas:{id:"M2CfrH",defaultMessage:"Share this canvas"}}),ip=({clientThreadId:s,isHistoricalVersion:e,textdocVersion:t,readonlyReason:i,hasDebug:n,isEmbedded:r,isPersisting:o,isShowingChanges:l,hideRunCode:a=!1,hideHistoryActions:c=!1,onHoverPrevious:h,onHoverShowChanges:u,onToggleShowChanges:d,onClickPrevious:m,onClickNext:g,setShowDebugView:p,onClickCodePreview:x,onClose:w,isCodeRunning:y,isTextdocAttachedPending:S})=>{const b=wl(),v=lr(),k=cl(t?.textdocId),O=ul(t?.title??""),A=dl(),R=xc(),j=fl(),B=!!t&&wr(t.type,t.content),te=!a&&(t==null?!1:B&&A||yr(t.type)&&j),z=D("transition-opacity duration-500",i.isStreaming&&"pointer-events-none opacity-0"),_=t?.versionInt,H=_!=null&&_>1,F=e,$=!c&&(H||F),N=ji(),ue=!O||k?.status===Cc.INFERRING;return f.jsxs(Bt.Header,{className:"@container",children:[f.jsxs("div",{className:"flex flex-1 items-center gap-1 truncate leading-[0] @container",children:[(!v||!N)&&f.jsx(Bt.CloseButton,{onClick:w}),f.jsx(zg,{isPersisting:o,textdocVersion:t,isTextdocAttachedPending:S,children:f.jsx(Bt.Title,{className:"@[0px]:hidden @[150px]:block",children:ue?f.jsx("div",{className:"w-52",children:f.jsx(Ju,{lines:1,size:"base",width:100,widthVariance:0})}):O})})]}),f.jsxs("div",{className:D("flex select-none items-center leading-[0]",v?"gap-1":"gap-2"),children:[$&&f.jsx("div",{className:z,children:f.jsx(Xg,{disabled:i.isStreaming,hasNextVersion:F,hasPreviousVersion:H,isShowingChanges:l,onHoverPrevious:h,onHoverShowChanges:u,onToggleShowChanges:d,onClickPrevious:m,onClickNext:g})}),f.jsx("div",{className:z,children:f.jsx(Ug,{clientThreadId:s,textdocVersion:t})}),R&&f.jsx("div",{className:z,children:f.jsx(tp,{})}),te&&f.jsx("div",{className:B?void 0:z,children:f.jsx(Qg,{clientThreadId:s,isCodePreviewable:B,isDisabled:_==null||i.isStreaming&&!y,onClick:x,isCodeRunning:y})}),!1,!v&&!r&&!b&&f.jsx(zu,{}),v&&N&&f.jsx(Bt.CloseButton,{onClick:w})]})]})},sp=/\s/,np=30;function el(s,e){const t=s.indexOf(e);return t===-1?!1:s.indexOf(e,t+e.length)===-1}function ut(s,e){return sp.test(s[e])}function tl(s,e,t=!1){if(e===0||t&&ut(s,e-1))return e;for(;e>0&&ut(s,e-1);)e--;for(;e>0&&!ut(s,e-1);)e--;return ut(s,e)&&e++,e}function il(s,e,t=!1){if(e===s.length||t&&ut(s,e))return e;for(;e<s.length&&ut(s,e);)e++;for(;e<s.length&&!ut(s,e);)e++;return ut(s,e-1)&&e--,e}function rp(s,e,t=!0,i=np){if(s.start<0||s.end>e.length||s.start>s.end)throw new Error("Invalid commentSourceRange provided.");const n=e.substring(s.start,s.end);let r=s.start,o=s.end;t&&(r=tl(e,r,!0),o=il(e,o,!0));let l=e.substring(r,s.start),a=e.substring(s.end,o),c=`${l}${n}${a}`;if(el(e,c)&&(i==null||c.length>=i))return{before:l,after:a,allSurrounding:c};let h=r,u=o,d=!0;for(;d&&(i==null||c.length<i);){let m=!1;const g=h>0?tl(e,h):h;g<h&&(h=g,m=!0);const p=u<e.length?il(e,u):u;if(p>u&&(u=p,m=!0),m){const x=e.substring(h,s.start),w=e.substring(s.end,u),y=`${x}${n}${w}`;if(el(e,y)&&(i==null||y.length>=i))return{before:x,after:w,allSurrounding:y};l=x,a=w,c=y}else d=!1}return{before:l,after:a,allSurrounding:c}}const Ni="# Context",Ii="# Instructions";function Pi(s,e,t){if(e==null||t==null)return`The user is referring to the entire text of "${s}".`;const i=`
## Selected Text
The user has selected this text in "${s}" in particular:
${e}
`.trim();return t.allSurrounding===e?i:`
${i}

## Surrounding Context
Here is the surrounding context:
${t.allSurrounding}
`.trim()}function wh(s,e){return s==null||e==null?"entire document":s===e.allSurrounding?"selected text":"surrounding context"}function yh(s){return`For the update pattern, create a regex which exactly matches the ${s}. Edit just this string in order to fullfill the user's request. NEVER rewrite the entire document. Instead, ALWAYS edit ONLY the ${s}. The only exception to this rule is if the ${s} includes markdown lists or tables. In that case, fully rewrite the document using ".*" as the regex update pattern.`.trim()}function op(s,e,t,i){if(!kt(e)&&t&&i){const n=wh(t,i);return`
${Ni}
The user requests that you directly edit the document.

${Pi(s,t,i)}

${Ii}
Use the update_textdoc tool to make this edit. ${yh(n)}`.trim()}return`
${Ni}
The user requests that you directly edit the document.

${Pi(s,t,i)}

${Ii}
Use the update_textdoc tool to make this edit. You MUST fully rewrite the entire document by using ".*" as the update regex pattern.`.trim()}function lp(s,e,t){return`
${Ni}
The user requests that you add comments about some text.

${Pi(s,e,t)}

${Ii}
Do not respond to the user's question directly, just leave comments.`.trim()}function ap(s,e){return kt(s)?e==="entire document"?` If you choose to update the ${e}, you MUST fully rewrite the ${e} by using ".*" as the update regex pattern.`:` If you choose to update the ${e}, you MUST fully rewrite the entire document by using ".*" as the update regex pattern. When you do so, ONLY modify the ${e} and rewrite other sections exactly as is, except for parts that must change based on this update`:e==="entire document"?"":` If you choose to update the ${e}, follow these instructions: ${yh(e)}`}function hp(s,e,t,i){const n=wh(t,i),r=ap(e,n);return`
${Ni}
${Pi(s,t,i)}

${Ii}
The user would like you perform one of the following actions:
- Update the ${n} via the \`update_textdoc\` tool.${r}
- Explain the selected text via chat, or answer a general question about the selected text (no tool call required).
- Comment on the ${n} with feedback via the \`comment_textdoc\` tool. This should only be used if the user very explicitly asks for feedback, critique, or comments.

Based on the user's request, choose the appropriate action.
`.trim()}function cp(s,e,t){return`
${Ni}
${Pi(s,e,t)}

${Ii}
The user would like you to create a new textdoc.
`.trim()}function up(s,e,t,i=null,n=null){switch(t){case ie.ASK:return hp(s,e,i,n);case ie.CREATE_TEXTDOC:return cp(s,i,n);case ie.EDIT:return op(s,e,i,n);case ie.COMMENT:return lp(s,i,n)}}function dp(s){switch(s){case Ce.ACCELERATOR:case Ce.CONSOLE:case Ce.ACCEPT_COMMENT:return!0;case Ce.ASK_CHATGPT:case Ce.FULL_SCREEN_SUBMIT:return!1}}function fp(s,e){switch(e){case Ce.ASK_CHATGPT:case Ce.ACCEPT_COMMENT:case Ce.FULL_SCREEN_SUBMIT:return s.formatMessage(gp.askChatGPT);case Ce.ACCELERATOR:case Ce.CONSOLE:return}}const mp=(s,e)=>{const t=ee(),i=tr(),n=yl(),r=wc(s),o=yc({clientThreadId:s}),l=bl();return C.useCallback(async({content:a,sourceRange:c,action:h,userMessageType:u,acceleratorMetadata:d,selectionMetadata:m})=>{const g=Cu(s),p=wu(i,n),x=bc(p?.models,g?.modelId);if(e?.versionInt==null||l||!x)return;const{textdocId:w,type:y,versionInt:S,content:b}=e;let v,k=null;c&&c.start!==c.end&&(v=b.slice(c.start,c.end),k=rp(c,b));const O=up(w,y,h,v,k),R=yu(O,{exclude_after_next_user_message:!0}),j=performance.now(),B=await bu(),[te,z]=await Promise.all([vc.getEnforcementToken(B),vu.getEnforcementToken(B)]),_=new Sc,H=bs.getThreadCurrentLeafId(s),F=`${H}-nextPrompt`;bs.updateTree(s,$=>{$.addNode(F,a,H,un.User,void 0,{canvas:{textdoc_id:w,textdoc_type:y,version:S,textdoc_content_length:b.length,user_message_type:u,accelerator_metadata:d,selection_metadata:m},is_visually_hidden_from_conversation:dp(u),targeted_reply:v,targeted_reply_label:fp(t,u),open_in_canvas_view:{type:"canvas_textdoc",id:w}})}),o({model:x.id,completionType:Su.Next,parentNodeId:F,metadata:{eventSource:"mouse"},completionMetadata:r?{conversationMode:r}:void 0,chatReq:B,turnstileToken:te??null,proofToken:z??null,preflightTime:performance.now()-j,appendMessages:[R],turnTracker:_})},[e,i,n,l,s,o,r,t])},gp=st({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}}),pp=s=>{const{isLoading:e,value:t}=ku("80186230"),i=wl(),{eligible:n,isLoading:r,markAsViewed:o}=nr(s);return{markAsViewed:o,eligible:!i&&n&&t,isLoading:r||e}};function xp(){return pp(xs.hasDismissedCanvasContextualOnboarding)}function Cp(s){const e=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,t=new Set,i=s.matchAll(e);for(const n of i){const r=n[2];try{let o=r;o.startsWith("www.")&&(o="http://"+r),new URL(o),t.add(r)}catch{}}return t}const wp=async({lastVersion:s,textdocId:e,content:t,comments:i})=>{const n=kc(i,t);return(await Ls.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:e}},requestBody:{version:s,content:t,comments:n}})).version},yp=()=>{const s=C.useRef([]),e=C.useRef(null),{mutateAsync:t,isPending:i}=qh({mutationKey:["canvas","textdoc","persist"],mutationFn:wp});return[C.useCallback(async(r,o,l)=>{const a=new AbortController,h=(async()=>{const[g]=s.current;try{await g?.promise}catch(p){Oe.logError("Saving document",p)}if(!a.signal.aborted)try{const p=Math.max(e.current??0,r.versionInt??ml);let x="";try{zr(o)?x=o():x=o}catch(b){Oe.logError("Serializing document",b)}let w=[];try{zr(l)?w=l():w=l}catch(b){Oe.logError("Adjusting comments",b)}const{textdocId:y}=r;Mc({textdocId:y,basedOnVersionInt:p,content:x,comments:w});const S=await t({textdocId:y,lastVersion:p,content:x,comments:w});Ec({textdocId:y,basedOnVersionInt:p,newVersion:S}),e.current=S}catch(p){Oe.logError("Error saving document",p)}finally{s.current.shift()}})(),u={abort:()=>a.abort(),promise:h},[d,m]=s.current;return m&&(m.abort(),s.current=d?[d]:[]),s.current=d?[d,u]:[u],h},[t]),s,i]},bp=3e3,vp=s=>{const[e,t,i]=yp(),n=ee(),r=C.useRef(null),o=C.useCallback(Ac(async(c,h,u)=>{if(!hn(c))return e(c,h,u);gl.replaceTempTextdocContent(c.textdocId,typeof h=="string"?h:h())},bp,{leading:!1}),[e]),l=Tc(s);return C.useEffect(()=>{if(!l)return;const c=ki(window,{pagehide:()=>o.flush(),beforeunload:u=>{o.flush(),u.returnValue=n.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),h=ki(document,{visibilitychange:()=>o.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&o.flush(),r.current="mouse"}});return()=>{r.current=null,h(),c()}},[n,l,o]),C.useEffect(()=>()=>{o.flush()},[s,o]),Oc(async()=>{await o.flush(),await Promise.allSettled(t.current?.map(({promise:c})=>c)??[])}),[C.useCallback((c,h,u)=>{const{textdocId:d}=c;return hn(c)||Dc(d),o(c,h,u)},[o]),o.flush,i||l]};function Sp(s,e,t){const i=tr(),n=t!=null&&e!=null,{data:r,error:o,fetchNextPage:l,hasNextPage:a,isFetching:c}=zh(sl(s,e,n)),h=C.useCallback(async()=>{const p=e!=null;await i.prefetchInfiniteQuery(sl(s,e,p))},[i,s,e]);C.useEffect(()=>{const p=e;return()=>{i.removeQueries({queryKey:bh(s,p),exact:!0})}},[i,s,e]);const[u,d,m,g]=C.useMemo(()=>{if(r&&t){const x=r.pages.flatMap(y=>y),w=x.findIndex(y=>"beforeVersion"in t?(y.versionInt??ml)<t.beforeVersion:y.versionInt===t.version);if(w!==-1)return[w===x.length-1,x[w],w>0?x[w-1]:null,w<x.length-1?x[w+1]:null]}const p=r?.pages.flatMap(x=>x)??[];return[!0,null,null,p.length===0?null:p[0]]},[r,t]);return C.useEffect(()=>{!c&&n&&a&&u&&l()},[c,n,a,u,l]),C.useEffect(()=>{!d&&o&&ci(s)},[d,o,s]),{historicalTextdocVersion:d,nextHistoricalTextdocVersion:m,prefetchHistoricalTextdocVersion:h,previousHistoricalTextdocVersion:g}}function bh(s,e=null){return["textdocHistory",s,e]}function sl(s,e,t=!0){return{queryKey:bh(s,e),queryFn:({pageParam:i})=>kp(s,i),initialPageParam:e??void 0,getNextPageParam:i=>{const n=ys(i)?.versionInt;if(n&&n>1)return n},enabled:t,staleTime:1/0,retry:2}}async function kp(s,e){return e===void 0?[]:(await Ls.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:s},query:{before_version:e}}})).previous_doc_states.map(({id:i,version:n,textdoc_type:r,title:o,content:l,updated_at:a,comments:c,metadata:h})=>({textdocId:i,versionInt:n,messageId:null,title:o,type:Lc(r),content:l,status:Rc.COMPLETE,createdAt:Nc(a),comments:Ic(c,l),metadata:{content_references:h?.content_references}}))}const c0=({isFullScreen:s=!1,isEmbedded:e=!1,hideHeader:t=!1,hideRunCode:i=!1,isReadonlyFromQueryParam:n=!1,clientThreadId:r,focusedTextdoc:o,onClose:l,isAnimating:a=!1,width:c,hideBottomComposer:h=!1})=>{const{textdocId:u,history:d,showChangesAtVersion:m=null}=_g(o),[g,p,x]=vp(u),{targetedContent:w}=Pc(),y=jc(),[S,b]=C.useState(!1),v=Bc(u),k=Hc(),O=Mu(r),A=Eu(O),{data:R,isLoading:j}=Vc(u,m),[B,te]=C.useState(!1),z=Fc(r),_=C.useRef(null),H=v?.versions??[],F=H[0]?.versionInt,{historicalTextdocVersion:$,nextHistoricalTextdocVersion:N,previousHistoricalTextdocVersion:ue,prefetchHistoricalTextdocVersion:pe}=Sp(u,F,d),Fi=_c();C.useEffect(()=>{ft.reset()},[u]);const Se=H.length>0?H[H.length-1]:null,be=H.length>1?H[H.length-2]:null,nt=Au(r),{restoreHistoricalTextdocVersion:ei,optimisticRestoredTextdocVersion:Ot}=Wc(nt,Se,$),Te=d!=null,Y=Te?$:Se,de=m!=null,ke=mp(r,Y),$e=a?null:R,pt=(()=>{if(a||Y==null)return[];const U=Zo(Y.comments);return!de&&$!=null?$.comments:!de||R==null?U:R.contentBefore!==R.contentAfter?[]:Fg(R.commentsBefore,R.commentsAfter)})(),xe=Y?.type??We.LOADING,Dt=qc(),ti=hn(Y),xt=zc(Y),Lt=Uc(Y),ii=$c(Y),I=ii&&!e,le=Ur(k),Rt=Ur(A);C.useEffect(()=>{!ti&&H.length===0&&Dt!==Hr.NATIVE&&(!k&&le||!A&&Rt||!k&&!A)&&l?.()},[H.length,k,A]);const{content:Me,currentlyStreamingLineIndex:Ge}=R?.contentBefore!=null&&!kt(xe)?{content:R.contentBefore,currentlyStreamingLineIndex:null}:Iu(Y,be),Ct=Qu(nt,Array.from(Cp(Me))),[rt,si]=vm({value:Me,isRequestActive:A,isTextdocStreaming:xt,comments:pt}),kr=Gc(Y),Mr=Dt===Hr.LAST_TURN||rt||x;C.useEffect(()=>{Kc().sendMessage({type:Ml.Streaming,streaming:Mr})},[Mr]);const vh=({getSerializedDocument:U,getAdjustedComments:Pe})=>{Y&&g(Y,U,Pe)},Sh=U=>{if(!Y)return;const Pe=U.doc.toString();g(Y,Pe,U.field(Ts,!1)??[])},Er=(U,Pe,ot,Nt)=>{si(!0),ke({action:Pe,content:U,userMessageType:Ce.ASK_CHATGPT,sourceRange:ot,selectionMetadata:{selection_type:Nt,selection_position_range:ot}})},Ar=({id:U})=>{kr(U,Fr.DISMISS),ft.reset()},Tr=async U=>{si(!0);const{id:Pe,at:ot,content:Nt}=U;if(await kr(Pe,Fr.ACCEPT)===!1)return si(!1);ke({content:Nt,userMessageType:Ce.ACCEPT_COMMENT,sourceRange:ot,action:ie.EDIT,selectionMetadata:{selection_type:fn.SELECTION,selection_position_range:ot}})},_s=(U,Pe,ot)=>{const{action:Nt}=ot;ke({action:Nt,content:Pe,sourceRange:U,userMessageType:Ce.ACCELERATOR,acceleratorMetadata:{action:Nt,id:ot.id,prompt:Pe},selectionMetadata:U!=null?{selection_type:fn.SELECTION,selection_position_range:U}:void 0})},kh=U=>{ke({action:ie.EDIT,content:U,userMessageType:Ce.FULL_SCREEN_SUBMIT})},Mh=yl(),Eh=tr(),Ah=Yc(),Or=U=>Ah?.[U]??U,Ws=()=>Xc({clientThreadId:r,currentRequestId:O,queryClient:Eh,isHistoryAndTrainingDisabled:Mh}),Th=()=>{d?Gi(u,d):ci(u)},Ne=Bu({streamingSource:Dt,isRestoring:Ot!=null,isStreaming:A||xt,isReadonlyFromQueryParam:n,isHistoricalVersion:Te,isShowingChanges:de});let _i=null;const Dr=a||Ne.isReadonly||rt,Wi=bl()||z||n||ti,Lr=()=>a&&pt.length>0?It.ALL_HIDDEN:Wi?It.COMMENTS_READONLY:Ne.isReadonly?Ne.isStreaming?It.ENABLED:Ne.isReadonlyFromQueryParam||Ne.isShowingChanges||Ne.isHistoricalVersion?It.COMMENTS_READONLY:It.ALL_HIDDEN:It.ENABLED,Rr=s||a||n;let qs=[];switch(xe){case We.LOADING:_i=f.jsx(Hu,{});break;case We.DOCUMENT:_i=f.jsx(ju,{value:Me,comments:pt,previousValue:be?.content,previousComments:Zo(be?.comments),isRewriting:Lt,isAnimatingFromPreview:a,isSendDisabled:Wi,getStableCommentId:Or,diff:$e,isRequestActive:A,isDisabled:Ne.isReadonly||k,isWaitingForCommentResponse:rt,hideAccelerators:Rr,hideToolbar:Dr,hideEditOverlay:a,commentsMode:Lr(),readonlyReason:Ne,onBlur:p,onSave:p,onChange:vh,onCancelRequest:Ws,targetedContent:w,onAddComment:Er,onAcceptComment:Tr,onDismissComment:Ar,onSubmitAccelerator:_s,onExitShowChanges:Th,safeUrls:Ct,width:c,modelCursor:ii||xt&&!Lt?Y?.modelCursor:void 0,shouldResetSelection:Y?.versionInt===1,metadata:v?.metadata}),qs=ag;break;default:kt(xe)&&(_i=f.jsx(Pu,{id:"codemirror",getStableCommentId:Or,language:vl(xe),value:Me,comments:pt,hideAccelerators:Rr,commentsMode:Lr(),hideToolbar:Dr,onSubmitAccelerator:_s,currentlyStreamingLineIndex:Ge??null,readonlyReason:Ne,isRequestActive:A,isSendDisabled:Wi,isWaitingForCommentResponse:rt,onChange:Sh,onCancelRequest:Ws,onAddComment:Er,onBlur:p,onSave:p,codemirrorRef:_,onDismissComment:Ar,onAcceptComment:Tr,textdocDiff:$e??void 0,modelCursor:xt&&Ge==null?Y?.modelCursor:void 0}),qs=bm)}const zs=C.useRef(null),Us=C.useRef(null),Nr=fl(),qi=dl()&&wr(xe,Me),Ir=Nr&&yr(xe),Oh=()=>{!B&&(qi||Ir)?(te(!0),zs.current?.runCode(xe,Me).finally(()=>te(!1))):(zs.current?.stopCode(),te(!1))},{eligible:Dh,markAsViewed:Lh}=xp(),$s=lr(),Ie=Y?.versionInt,Rh=Ie!=null&&Ie>1,Nh=Te,zi=ue?.versionInt,Gs=N?.versionInt,Ih=()=>{de?d?Gi(u,d):ci(u):(Oe.logButtonClick(jt.SHOW_CHANGES,{textdocType:xe,textdocId:u,versionInt:Ie,latestVersionInt:F}),Ie&&_r(u,Ie,d))},Ph=()=>{Oe.logButtonClick(jt.HISTORY_PREVIOUS,{textdocType:xe,textdocId:u,versionInt:Ie,latestVersionInt:F,isShowingChanges:de}),u&&Ie&&Rh&&Gi(u,{beforeVersion:Ie},de&&zi!=null?zi:void 0)},jh=()=>{Oe.logButtonClick(jt.HISTORY_NEXT,{textdocType:xe,textdocId:u,versionInt:Ie,latestVersionInt:F,isShowingChanges:de}),Nh&&(Gs?Gi(u,{version:Gs},de?Gs:void 0):de&&F?_r(u,F,null):ci(u))},Bh=Uu(),Ui=cl(Y?.textdocId),Ks=!t&&f.jsx(ip,{hideRunCode:i,clientThreadId:r,isHistoricalVersion:Te,textdocVersion:Y,readonlyReason:Ne,hasDebug:y,isEmbedded:e,isPersisting:x,isShowingChanges:de,hideHistoryActions:n,onHoverPrevious:()=>{pe(),zi&&Fi(u,zi)},onHoverShowChanges:()=>{pe(),Ie&&Fi(u,Ie)},onToggleShowChanges:Ih,onClickPrevious:Ph,onClickNext:jh,setShowDebugView:b,onClose:()=>{if(Oe.logButtonClick(jt.CLOSE_TEXTDOC,{textdocType:Y?.type}),Lh(),Ui){const U=Ui.create_source;gl.removeTempTextdoc(Ui.tempTextdocId),(Ui.hasUserEdits||U===Zc.USER_CREATED_COMPOSER)&&Bh.appendText(Me)}l?.()},onClickCodePreview:Oh,isCodeRunning:B,isTextdocAttachedPending:Vr(Y)});let Pr=null;const $i=!i&&Nr&&!Te&&(Ir||qi);return C.useEffect(()=>{if(!$i)return;const U=Xa(xe,Me);U&&Us.current?.prepareEnvironment(U)},[$i,xe,Me]),$i&&(Pr=f.jsx(md,{title:ul(Y?.title??""),visuallyHidden:!qi||!B,ref:Us})),f.jsxs(Bt,{children:[!$s&&Ks,f.jsx(Bt.Content,{header:$s?Ks:null,scrollToBottomMode:I?"bottom":"top",shouldScrollToTop:Lt,isLoading:j,hideChildren:qi&&B,height:$s&&Ks?"calc(100%-var(--screen-thread-header-min-height,60px))":void 0,overlay:Pr,children:_i}),$i&&f.jsx(Zm,{ref:zs,sandboxRef:Us,textdocId:u,textdocContent:Me,isTextdocAttachedPending:Vr(Y),highlightLine:U=>_.current?.highlightLine(U),isRequestActive:A,createTextdocTurn:ke}),f.jsx(dt,{children:Te&&!n&&f.jsx(Sm,{onClickRestore:ei,onClickResetLatest:()=>ci(u)})}),s&&!Te&&!h&&!Wi&&f.jsx(Vg,{isRequestActive:A,clientThreadId:r,onSubmitAccelerator:_s,onSubmit:kh,onCancel:Ws,readonlyReason:Ne,acceleratorActions:qs}),!a&&!e&&Dh&&f.jsx(bd,{textdocType:xe})]})};export{Ae as $,Jt as A,l0 as B,Ml as C,Z as D,V as E,L as F,gt as G,Rd as H,Ig as I,bm as J,oe as K,Ze as L,ur as M,Zd as N,ge as O,cr as P,Gt as Q,Ti as R,Yg as S,c0 as T,mn as U,Ue as V,Qt as W,xi as X,Ye as Y,Q1 as Z,Yp as _,T as a,zp as a0,Je as a1,qe as a2,bg as a3,fn as a4,ft as a5,fg as a6,r0 as a7,s0 as a8,Os as a9,vd as aa,Ld as ab,Dd as ac,yg as ad,h0 as ae,e0 as af,ie as ag,Lm as ah,vr as ai,t0 as aj,nh as ak,cg as al,$p as am,ug as an,hg as ao,n0 as ap,Cg as aq,wg as ar,a0 as as,i0 as at,lg as au,dg as av,ag as aw,se as b,Re as c,J as d,q as e,W as f,Zp as g,Kt as h,he as i,Gp as j,Jp as k,Xp as l,A1 as m,Qp as n,Is as o,Kp as p,qp as q,Ka as r,am as s,hm as t,cm as u,mg as v,gg as w,pg as x,xg as y,o0 as z};
//# sourceMappingURL=dqp4qy11fpzrg014.js.map
