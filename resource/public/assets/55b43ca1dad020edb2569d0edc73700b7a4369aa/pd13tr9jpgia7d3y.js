import{j as e,ac as V,M as i,c as S,r as l,e as q,d as $}from"./i8w88cc8b3gds516.js";import{eb as E,an as U,c1 as H,r as z,bn as f,y as Z,b8 as Y}from"./eh26o1l35t2fnjj4.js";import{jb as p,bH as J,am as j,jc as O,jd as K,je as Q,jf as X,jg as G,jh as ee,ji as te,jj as _,jk as se,jl as ae,dD as re,jm as ne,jn as ie,jo as le,bp as ce,jp as h,e3 as oe,jq as D,hq as de,jr as ue,js as xe}from"./jg63sxiyqeyvfv9f.js";import{S as F}from"./h5ki4u1sjcr6cdl0.js";import{SUMMARY_MARKDOWN_COMPONENT_OVERRIDES as me}from"./obl0r3ppfp7a769l.js";function pe({children:t,index:s=0,className:a=""}){return E()?e.jsx("div",{className:a,children:t}):e.jsx(V.div,{className:a,initial:{opacity:0},animate:{opacity:1},transition:{delay:(s+1)*.03},children:t})}function g({children:t}){const s=E();return e.jsx(pe,{className:U("sticky top-0 z-[1] flex h-[calc(var(--screen-thread-header-min-height,60px)+1px)] items-center border-b border-token-border-sharp bg-token-main-surface-primary px-6 pr-9 pt-4 font-medium text-token-text-primary",s?"pb-3.5 text-base":"pb-4 text-sm"),children:e.jsx("div",{className:"w-[calc(100%-1.5rem)] truncate",children:t})})}function y({children:t}){return e.jsx("div",{className:"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)] h-full w-full",children:t})}function fe(){return e.jsxs("div",{className:"w-full",children:[e.jsx(p,{className:"mb-2"}),e.jsx(p,{className:"mb-2"}),e.jsx(p,{className:"mb-2"})]})}const L=({children:t})=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"inline-flex h-[21px] w-6 items-center justify-center gap-2.5 pt-[3px]",children:e.jsx(J,{className:"relative h-[18px] text-token-text-tertiary"})}),t]}),je=({searchMessageGroup:t})=>{const s=t.query;return s?e.jsx(L,{children:e.jsx("div",{className:"flex text-base text-token-text-tertiary",children:e.jsx(i,{id:"bANbZr",defaultMessage:'Searched for "{query}"',values:{query:s}})})}):null},he=()=>{const t=S();return e.jsx(L,{children:e.jsx("div",{className:"relative flex h-10 w-full",children:e.jsx(F,{className:"w-full items-start justify-start",highlightedText:t.formatMessage({id:"9xsgO4",defaultMessage:"Searching..."}),shouldShimmer:!0})})})};function A({children:t}){return e.jsx(O,{fillIcon:!0,icon:e.jsx(K,{className:"inline-flex h-4 w-4 items-center justify-center"}),children:t})}function ge({row:t}){const s=t.summary,a=t.title;return s?e.jsx(A,{children:e.jsx("div",{className:"text-base text-token-text-tertiary",children:e.jsx(j,{componentOverrides:me,className:"not-prose leading-6",children:a&&s?`**${a}**
${s}`:s})})}):null}function ye(){const t=S();return e.jsx(A,{children:e.jsx("div",{className:"relative flex h-10 w-full",children:e.jsx(F,{className:"w-full items-start justify-start",highlightedText:t.formatMessage({id:"DoR/m1",defaultMessage:"Thinking..."}),shouldShimmer:!0})})})}const Se=({searchMessageGroup:t,isActive:s})=>{const a=l.useMemo(()=>t.rows.length>0&&t.rows[t.rows.length-1].type==="websiteOpen",[t.rows]);return t.rows.length===0&&s?e.jsx(he,{}):t.rows.length===0&&!s?null:e.jsxs("div",{className:"flex flex-col items-start justify-start gap-4",children:[e.jsx(je,{searchMessageGroup:t}),t.rows.map((r,c)=>r.type==="summary"?e.jsx(ge,{row:r},`cot_${c}_${t.id}`):r.type==="websiteOpen"?e.jsx(Q,{website:r},`website_${c}_${t.id}`):null),s&&a&&e.jsx("div",{className:"w-full",children:e.jsx(ye,{})}),!s&&e.jsx(X,{searchMessageGroup:t})]})},be=120;function I(t){t?.scrollIntoView({block:"center",behavior:"smooth"})}function ve({activeTask:t,caterpillarStatusMessageTexts:s}){const[a,r]=l.useState(""),c=H("caterpillar-interrupts"),b=l.useRef(!1),o=l.useRef(null),x=t.messages,u=l.useMemo(()=>(b.current=!!o.current&&G(o.current,be),x?ee(x):[]),[x]);l.useEffect(()=>{b.current&&I(o.current)},[u]),l.useEffect(()=>{I(o.current)},[]);const v=te({taskId:t.taskId,prompt:a}),m=t.messages?.findLast(n=>n.end_turn&&n.author.role==="assistant"&&!n.metadata?.is_visually_hidden_from_conversation),N=t.messages?.[0],P=!!m||_(t)||se(t),W=S(),C=l.useCallback(async()=>{await v.mutateAsync(),r("")},[v,r]),w=q(),M=$(),k=ae("canvas"),R=l.useMemo(()=>{const{originalConversationId:n,responseCanvasTextdocId:d,responseMessageId:B}=t;return!n||!d||!B?null:()=>{const T=re(n);k(),M.pathname!==T?(w(T),z.setCanvasToOpenId(n,d)):ne(d)}},[t,k,M.pathname,w]);return e.jsx(y,{children:e.jsxs("div",{children:[e.jsx(g,{children:t.title}),e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex w-full flex-col gap-4 p-4",children:[u.length?u.map((n,d)=>e.jsx(Se,{searchMessageGroup:n,isActive:d===u.length-1&&!P},n.id)):e.jsx(fe,{}),!!m?.create_time&&!!N?.create_time&&e.jsx(O,{icon:e.jsx(ie,{className:"text-token-text-tertiary"}),fillIcon:!1,children:e.jsxs("div",{className:"text-token-text-tertiary",children:[s?.completedMessage??e.jsx(i,{id:"nZ8w6W",defaultMessage:"Completed in"})," ",e.jsx(le,{startTimestamp:new Date(N.create_time*1e3).toString(),endTimestamp:new Date(m.create_time*1e3).toString()})]})}),R&&e.jsx("div",{className:"mx-auto flex w-64 flex-col gap-2 p-4",children:e.jsx(f,{onClick:R,children:e.jsx(i,{id:"cW/oVM",defaultMessage:"Open Response"})})})]})}),c&&!_(t)&&e.jsxs("div",{className:"flex w-full flex-col justify-center gap-4 p-4",children:[e.jsx(ce,{ariaLabel:W.formatMessage({id:"aYWRtV",defaultMessage:"Press enter to interrupt task"}),name:"interrupt-caterpillar-prompt",value:a,onChange:n=>r(n.target.value),color:"search",onPressEnter:C}),e.jsx(f,{onClick:C,children:e.jsx(i,{id:"h73FdF",defaultMessage:"Interrupt task"})})]}),e.jsx("div",{ref:o},"task-footer")]})})}function Ne({terminatedTask:t,caterpillarStatusMessageTexts:s}){const a=Z(),r=()=>{oe(t.taskId,a),a.success("Task ID copied to clipboard",{duration:2,hasCloseButton:!0})};return t.status===h.CANCELLED?e.jsxs(y,{children:[e.jsx(g,{children:e.jsx("div",{className:"text-token-text-secondary",children:s?.cancelledMessage??e.jsx(i,{id:"eztZ+D",defaultMessage:"Cancelled"})})}),e.jsxs("div",{className:"flex flex-col items-start justify-start gap-2 p-4",children:[e.jsx("div",{className:"text-token-text-primary",children:e.jsx(i,{id:"lCfyEq",defaultMessage:"Cancelled Prompt:"})}),e.jsx(j,{className:"text-token-text-secondary",children:t.prompt})]})]}):e.jsxs(y,{children:[e.jsx(g,{children:e.jsx("div",{className:"text-token-text-secondary",children:e.jsx(i,{id:"uevBRu",defaultMessage:"Task has failed"})})}),e.jsxs("div",{className:"flex flex-col items-start justify-start gap-2 p-4",children:[e.jsxs("div",{className:"pb-4",children:[e.jsx("div",{className:"text-token-text-primary",children:s?.failureMessage??e.jsx(i,{id:"utqOJw",defaultMessage:"Failed"})}),e.jsx(f,{color:"secondary",onClick:r,children:e.jsx(i,{id:"Wiec86",defaultMessage:"Copy Task Id"})})]}),e.jsx("div",{className:"text-token-text-primary",children:e.jsx(i,{id:"d3yOEh",defaultMessage:"Failed Prompt:"})}),e.jsx(j,{className:"text-token-text-secondary",children:t.prompt})]})]})}function Ce(t){return t.status===h.CANCELLED||t.status===h.FAILED}function we(){const{data:t}=D(),s=t?.caterpillar_status_message_texts;if(s)return{cancelledMessage:s.cancelled_message,failureMessage:s.failure_message,completedMessage:s.completed_message}}function Me({taskInfo:t}){const s=we();return Ce(t)?e.jsx(Ne,{terminatedTask:t,caterpillarStatusMessageTexts:s}):e.jsx(ve,{activeTask:t,caterpillarStatusMessageTexts:s})}function ke(){const{data:t}=D();return t?.caterpillar_disclaimer_text}function Oe({taskId:t}){const s=de(c=>ue.getTask(t,c)),{closeThreadSidebar:a}=Y(),r=ke();return e.jsx(xe,{handleClose:()=>a({}),trailing:r&&e.jsx("div",{className:"bg-token-main-surface-primary py-2 text-center text-xs text-token-text-secondary keyboard-open:hidden",children:r}),children:s&&e.jsx(Me,{taskInfo:s})})}export{Oe as C};
//# sourceMappingURL=pd13tr9jpgia7d3y.js.map
