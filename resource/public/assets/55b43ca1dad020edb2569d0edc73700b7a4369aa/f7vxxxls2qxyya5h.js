import{r as h,am as q,j as o,ac as m,ad as K}from"./i8w88cc8b3gds516.js";import{gD as Y,C as g,gE as X,gl as J,gF as Q,gG as $,gH as Z,gI as ee,dN as te,co as _,gJ as se,gK as ae,gL as O,dL as oe,fU as M,gM as ne,gN as ie,gO as re,u as ce,gP as R,U as W,gQ as D}from"./jg63sxiyqeyvfv9f.js";import{gA as S,bB as F,ak as de,al as le,ai as ue,eG as he,e7 as pe,o as me,gB as ge,m as fe,T as j,fd as xe,eb as L,g9 as ve,an as Ce,gC as we}from"./eh26o1l35t2fnjj4.js";import{L as be}from"./e34qym7psp0g3xzr.js";import{u as ye}from"./f26tq0bcmxctgqq5.js";import{T as Se}from"./dqp4qy11fpzrg014.js";import{g as Te}from"./btagl6w1gub4aw61.js";import"./ln72qaf6x6k87xpg.js";import"./n2sybeqm169dymt4.js";import"./bu3dsffychuyne68.js";import"./h2nc3qmtjg2iytti.js";import"./dzq0v9msooejtdz0.js";import"./dyuarriie396ezxd.js";import"./ens1ascotkzlvvvm.js";import"./fzrn137102spawew.js";import"./hmbip9k0fcw739ar.js";import"./h5ki4u1sjcr6cdl0.js";import"./e7ldcb1pybd2xac9.js";import"./c3ew5w7qbxkccpqx.js";import"./gdsmqpdlbx03h3zp.js";import"./itdemlts8gcqwi6k.js";import"./c70tulx9zqykyr6q.js";const k="oai/apps/canmoreSidebarWidth",Ie=.25,Ee=400,U=400;function G(e){return e-Ee}function b(e,s){return q(U,G(e),s??Ie*e)}function Ae(){const e=S.useState(S.selectWindowWidth),s=b(e,Y(F.DANGER_SECRET_FOLDERS_ONLY_getItem(k))),a=H(),[t,c]=h.useState(s);h.useEffect(()=>{(t<U||t>G(e))&&c(b(e,t))},[e]);function n(l){c(f=>b(e,f+=l.delta.x))}function i(l){c(l),F.DANGER_SECRET_FOLDERS_ONLY_setItem(k,l)}function d(){const l=b(e,void 0);i(l)}const r=`calc(100vw - ${t}px)`;return a?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:r,viewportWidth:e,handleDrag:n,handleDoubleClick:d,persist:i}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function H(e){const s=S.useState(S.selectWindowWidth);return(e??s)>1e3}function Ne(e,s){let a;return s?.type===g.Textdoc&&(s.textdocId.startsWith(X)||(a={type:"canvas_textdoc",id:s.textdocId})),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:a}}}const V=({isFullScreen:e=!1,clientThreadId:s,focusedObject:a,onClose:t,isAnimating:c=!1,width:n})=>{const{setTargetedContent:i}=J(),d=h.useRef(!1);if(h.useEffect(()=>(d.current&&i(void 0),d.current=!0,()=>{d.current=!1}),[a]),a==null)return null;switch(a.type){case g.Textdoc:return o.jsx(Se,{isFullScreen:e,onClose:t,clientThreadId:s,focusedTextdoc:a,isAnimating:c,width:n});case g.ADAVisualization:return null;case g.Sonic:return!1}},_e=300,Me=e=>{switch(e?.type){case g.Textdoc:return e.textdocId;case g.Sonic:return e.messageId;default:return null}};function Re(e,s){const a=de(e),t=le(a),c=ue(e),n=he(e,c),i=pe({clientThreadId:e,conversationLeafId:c}),d=Q(),[r,l]=h.useMemo(()=>{if(n&&$(n))return[void 0,null];if(s===!0)return[void 0,null];let x;return!i&&n&&(x=me(Z(n.messages))),We({clientThreadId:e,isRequestActive:t,latestTextdocId:d,groupedMessage:x})},[i,n,t,d,s,e]),f=l!=null,T=Me(l);h.useEffect(()=>{if(l&&r&&!ge()&&(ee(l,r),l.type===g.Textdoc)){const{textdocId:x}=l,I=Te(x);te(document.getElementById(I))}},[f,T])}function We({clientThreadId:e,isRequestActive:s,latestTextdocId:a,groupedMessage:t}){switch(t?.type){case _.Canmore:{const[c,n]=t.messages;if(!se(c?.message))break;const i=ae(s,c.message,n?.message??null),d=i.textdocId??a;if(d&&(i.function===fe.CreateTextdoc?(i.content??"").length>_e||i.status===j.WAITING:i.status===j.STREAMING))return[i.messageId,{type:g.Textdoc,textdocId:d}];break}case _.SonicCanvas:break}return[void 0,null]}const De=260,y={type:"spring",bounce:.12,duration:.64},Fe={type:"spring",bounce:0,duration:.58},je=({clientThreadId:e,focusedObject:s,onClose:a})=>{const{chatWidth:t,canvasWidthCalc:c,handleDrag:n,handleDoubleClick:i,persist:d}=Ae(),r=L(),[l,f]=h.useState(!0),[T,x]=h.useState(!1),I=M(u=>u.activeSidebar),E=ne(({rect:u})=>u),{windowHeight:v,windowWidth:C}=ve(u=>u,{windowWidth:0,windowHeight:0});let p=E??{top:0,left:t,width:C-t,height:v},N=!1;if(E&&(p.top<0||p.top+p.height>v)){N=!0;const u={width:(C-t)*.75,height:v*.75};p={top:v/2-u.height/2,left:(C-t-u.width)/2+t,width:u.width,height:u.height}}if(r){const u=C-p.width-p.left;p={...p,left:-u}}const w=E?.borderRadius,A=ie(),z=A?.history!=null||A?.showChangesAtVersion!=null,B=M(u=>u.isDesktopNavCollapsed);return o.jsxs(o.Fragment,{children:[z&&o.jsx(be,{onClick:()=>re(A.textdocId),zIndexKey:"chatOverlay"}),o.jsxs(m.div,{initial:!r&&{marginRight:B?0:-De},animate:!r&&{marginRight:0},transition:Fe,children:[o.jsx(m.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...y,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!r&&o.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),o.jsx(m.div,{className:"relative z-20 h-full",style:{width:c},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),o.jsx(m.div,{className:Ce("absolute z-20 h-full transition-shadow",r&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!r&&"overflow-hidden",!r&&(I==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:w,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:N?0:1,x:p.left,y:p.top,height:p.height,width:p.width},animate:{opacity:1,x:r?0:t,y:0,width:c,height:v,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:w,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:T?{duration:0}:y,onAnimationComplete:()=>f(!1),children:o.jsx(m.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:w},animate:{borderRadius:0},exit:{borderRadius:w},transition:y,children:o.jsxs("div",{className:"h-full",children:[o.jsx(m.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(u,P)=>{x(!0),n(P)},onDragEnd:()=>{x(!1),d(t)},onDoubleClick:()=>i()}),o.jsx(V,{onClose:a,clientThreadId:e,isAnimating:l,focusedObject:s,width:C-t})]})})})]})},ke=h.memo(je),Oe=({clientThreadId:e,focusedObject:s,onClose:a})=>o.jsx(we,{children:o.jsx(m.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:y,children:o.jsx(V,{isFullScreen:!0,clientThreadId:e,focusedObject:s,onClose:a})})}),Le=({clientThreadId:e,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{let t=H(s);const c=ye(e);Re(e,a);const n=ce();h.useEffect(()=>{O()},[e]);const i=n&&(t?o.jsx(ke,{clientThreadId:e,onClose:D,focusedObject:n},"canvas-sidebar"):o.jsx(Oe,{clientThreadId:e,onClose:D,focusedObject:n},"canvas-modal"));h.useEffect(()=>{if(n)return R(f=>Ne(f,n)),()=>R(null)},[n]);const d=L(),r=i!=null;return h.useEffect(()=>{if(!d)return W.setActiveStageSidebar(r),()=>{r&&W.setActiveStageSidebar(!1)}},[r,d]),c!==e?null:o.jsx(K,{children:i})},rt=e=>{const s=h.useRef(null);return o.jsx(xe,{ref:s,onError:(a,t)=>{O(),setTimeout(()=>{s.current?.resetErrorBoundary()}),oe.logError("Error boundary hit",a,{componentStack:t})},name:"canmore-focused-view",children:o.jsx(Le,{...e})})};export{rt as CanvasFocusedViewManager};
//# sourceMappingURL=f7vxxxls2qxyya5h.js.map
