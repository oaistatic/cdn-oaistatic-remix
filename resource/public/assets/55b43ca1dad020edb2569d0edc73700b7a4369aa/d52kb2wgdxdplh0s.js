import{r as a,X as O,c as y,e as T,j as _}from"./i8w88cc8b3gds516.js";import{y as N,aa as h,dJ as i,dK as u,eT as D,R as b,f as A}from"./eh26o1l35t2fnjj4.js";import{G as v}from"./jg63sxiyqeyvfv9f.js";function I(){const p=a.useRef(!1),[g,E]=a.useState(""),{code:c,error:l,error_description:f,state:r}=Object.fromEntries(new URLSearchParams(g.substring(1)).entries()),t=O().pluginId,n=y(),C=N(),s=T();return a.useEffect(()=>{E(window.location.hash)},[]),a.useEffect(()=>{if(p.current)return;t&&c&&r&&(p.current=!0);async function S(){const M=window.location.origin+`/ca/${t}/oauth/callback`;if(!t||!c||!r){s("/");return}const e=await h.connectorOauthCallback(t,c,M,r);if(!e.success){s(i(u.CUSTOM_ERROR,e.redirect_path,e.error??e.message));return}let o=D.SLACK_SYNC_CONNECTOR;t===v&&(o=D.GDRIVE_SYNC_CONNECTOR);try{const m=await b.safePost("/connectors/{connector_name}/connect_account",{parameters:{path:{connector_name:o}},requestBody:{}});if(!m.success){await h.deleteUserConnectedApp(o);let R=d.connectedDriveErrorDesc;m.status_code===405&&(R=d.emailNotMatchDesc),s(i(u.CUSTOM_ERROR,e.redirect_path,n.formatMessage(R)));return}}catch{await h.deleteUserConnectedApp(o),s(i(u.CUSTOM_ERROR,e.redirect_path,n.formatMessage(d.connectedDriveErrorDesc)));return}s(i(u.CUSTOM_MSG,e.redirect_path,n.formatMessage(d.connectedDriveSyncDesc)))}S()},[t,c,r,n,s]),a.useEffect(()=>{l&&C.danger(`${l}${f?`: ${f}`:""}`)},[l,f,C]),_.jsx(_.Fragment,{})}const d=A({connectedDriveSyncDesc:{id:"CACallback.connectedDriveSyncDesc.1",defaultMessage:"Your account has been connected."},connectedDriveErrorDesc:{id:"CACallback.connectedDriveErrorDesc.1",defaultMessage:"We encountered an issue. Please retry and contact your admin if this issue persists."},emailNotMatchDesc:{id:"CACallback.emailNotMatchDesc.1",defaultMessage:"The account you're trying to connect to doesn't match your ChatGPT account"}});export{I as default};
//# sourceMappingURL=d52kb2wgdxdplh0s.js.map
