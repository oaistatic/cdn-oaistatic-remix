import{r as h,j as e,c as _,M as f,v as oe,f as Pe,L as Me}from"./i8w88cc8b3gds516.js";import{hl as Te,ak as A,bE as c,ik as Ee,il as U,im as De,io as re,ip as Oe,iq as L,ir as ae,is as ie,it as D,iu as _e,iv as le,ia as Ae,eQ as Ue,iw as Le,ix as Be,iy as Re,iz as Ge,iA as ze,iB as He,iC as q,eR as Xe,iD as G,iE as J,iF as Ze,iG as z,c0 as Qe,iH as Ve,iI as Ke,iJ as X,iK as We,bk as $e,iL as Ye,iM as qe,iN as Je,iO as et,iP as ce,iQ as tt,iR as st,iS as nt,iT as ot,fP as rt,f5 as at,hm as it,dD as lt,dV as ct,dW as dt,iU as ut,iV as mt,iW as xt,j as ft,iX as ee,iY as ht,iZ as pt}from"./jg63sxiyqeyvfv9f.js";import{an as S,dn as de,ap as B,K as gt,y as Z,cp as O,co as ue,aU as H,G as jt,P as me,j as xe,aZ as vt,ej as fe,cA as yt,bn as bt,cC as St,cb as Nt,b$ as Ct,gS as te,g6 as kt,eh as wt}from"./eh26o1l35t2fnjj4.js";import{S as It}from"./bxo0vudykvsyb7bg.js";import{F as Ft}from"./hq6x27nrpb56q3r0.js";import{f as Pt}from"./m89x2zftpo6hrypr.js";import{P as Mt}from"./ctlsvvj6folqh10x.js";import"./hlm6hsp0qis3d7zg.js";import"./dyuarriie396ezxd.js";import"./j14akxnqigsmgi7w.js";import"./ln72qaf6x6k87xpg.js";import"./h5ki4u1sjcr6cdl0.js";import"./e7ldcb1pybd2xac9.js";const Tt=[null,"#F14D42","#E36E30","#B98618","#DB9F1E","#3DCB40","#30A633","#27C0A6","#16B7DB","#6490F0","#0088FF","#1D53BF","#512AEB","#875BE1","#EE4D83","#E659C2"];function Et({color:t,active:n,onClick:s}){const o=_();return e.jsx("button",{onClick:()=>s(t),className:"flex h-10 w-10 items-center justify-center rounded-full bg-token-text-primary can-hover:hover:scale-110 can-hover:active:scale-100","aria-label":t??o.formatMessage(c.defaultColor),style:{backgroundColor:t??void 0},children:n&&e.jsx(Ee,{className:"h-6 w-6 text-token-main-surface-primary"})})}function Dt({currentTheme:t,onSelect:n}){return e.jsx("div",{className:"m-4 grid grid-cols-4 gap-4",children:Tt.map(s=>e.jsx(Et,{active:s===t,color:s,onClick:o=>{n(o)}},s))})}const Ot=({currentTheme:t,isPopoverOpen:n,disabled:s,...o},a)=>e.jsxs("button",{ref:a,disabled:s,...o,className:S("group relative flex h-[60px] w-[60px] items-center justify-center",s&&"pointer-events-none"),children:[e.jsx("div",{className:S("absolute flex h-full w-full items-center justify-center rounded-full",t&&"opacity-10",!t&&"bg-token-main-surface-secondary"),style:{backgroundColor:t??void 0}}),e.jsx("div",{className:"relative flex h-full w-full items-center justify-center",children:e.jsx(Te,{className:S("icon-lg duration-200 ease-out can-hover:group-hover:scale-110",s&&"text-token-text-tertiary"),style:{color:t}})}),e.jsx("div",{className:S("absolute bottom-0 right-0 flex h-6 w-6 scale-0 items-center justify-center rounded-full border border-token-border-light bg-token-main-surface-primary text-token-text-secondary opacity-0 drop-shadow-sm duration-200 ease-out group-hover:scale-100 group-hover:opacity-100",n&&"scale-100"),children:e.jsx(A,{className:"h-[18px] w-[18px] rounded-full text-token-text-secondary"})})]}),he=h.forwardRef(Ot);function Q({file:t,fileName:n,fileId:s,gizmoId:o}){const a=U(n)&&s!=null,r=De(t&&re(t)?t:null,n,s,o,void 0);return a?e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-[#129FBF] bg-cover bg-center text-white",style:{backgroundImage:`url(${r})`},children:!r&&e.jsx(Oe,{className:"icon-lg"})}):null}function _t({gizmoId:t,gizmoName:n,pendingFiles:s,files:o,modelCapacityUsed:a,interpreterOnlyFileIds:r,onAddFiles:l,removePendingFile:d,pendingFileUpsertMutationsRef:i}){return s.length===0&&o.length===0?e.jsx("div",{className:"h-full pb-6",children:e.jsx(Bt,{gizmoName:n,onAddFiles:l})}):e.jsx("div",{className:"pb-6",children:e.jsx(At,{gizmoId:t,modelCapacityUsed:a,files:o,pendingFiles:s,interpreterOnlyFileIds:r,removePendingFile:d,pendingFileUpsertMutationsRef:i})})}function At({gizmoId:t,modelCapacityUsed:n,files:s,pendingFiles:o,interpreterOnlyFileIds:a,removePendingFile:r,pendingFileUpsertMutationsRef:l}){const d=L();return s.length===0&&o.length===0?null:e.jsxs("div",{className:"overflow-hidden rounded-lg border border-token-border-light",children:[n&&n>1?e.jsxs("div",{className:"border-b border-token-border-light bg-gray-50 px-4 py-3 text-xs text-token-text-secondary dark:bg-gray-750",children:[e.jsx("div",{className:"font-medium",children:e.jsx(f,{...c.tooManyFilesTitle})}),e.jsx("div",{children:e.jsx(f,{...c.tooManyFilesDescription})})]}):null,s.map(i=>e.jsx(Lt,{gizmoId:t,gizmoFile:i,interpreterOnly:a.includes(i.file_id),onDelete:async()=>{const m=new Promise(u=>{l.current.push({id:t,mutationId:oe(),update:j=>{const g=j.files.filter(v=>v.file_id!==i.file_id);return{...j,files:g}},onSuccess:u})});return ae(t)({gizmoId:t,upsertProjectMutation:d,pendingFileUpsertMutationsRef:l}),m}},i.file_id)),o.map(i=>e.jsx(Ut,{interpreterOnly:a.includes(i.tempId),pendingFile:i,onDelete:async()=>r(i.tempId)},i.tempId))]})}function pe(){return e.jsx("div",{className:"truncate",children:e.jsx(f,{...c.interpreterOnlyLabel})})}function Ut({pendingFile:t,onDelete:n,interpreterOnly:s}){const o=t.file.name,r=(re(t.file)&&t.file?.type.startsWith("image/")||U(o))&&e.jsx(Q,{file:t.file,fileName:o,fileId:t.fileId??void 0,gizmoId:t.gizmoId??void 0});return e.jsx(ge,{interpreterOnly:s,onDelete:n,children:e.jsx(ie,{icon:r,fileName:t.file.name,loadingPercentage:t.status===D.Uploading?t.progress:void 0,customFileDescription:s?e.jsx(pe,{}):void 0})})}function Lt({gizmoFile:t,gizmoId:n,interpreterOnly:s,onDelete:o}){const a=t.name,l=U(a)&&t.file_id!=null&&e.jsx(Q,{fileName:a,fileId:t.file_id,gizmoId:n});return e.jsx(ge,{interpreterOnly:s,onDelete:o,children:e.jsx(ie,{icon:l,fileName:t.name,customFileDescription:s?e.jsx(pe,{}):void 0})})}function ge({children:t,onDelete:n,interpreterOnly:s}){const[o,a]=h.useState(!1);return e.jsxs("div",{className:S("group flex w-full justify-between border-b border-token-border-light p-3 text-sm last:border-b-0",s&&"grayscale"),children:[e.jsx("div",{className:"w-10/12 can-hover:w-full can-hover:group-hover:w-11/12",children:t}),e.jsx("div",{className:S("flex shrink-0 grow-0 bg-token-main-surface-primary pl-1 can-hover:group-hover:flex",!o&&"can-hover:hidden"),children:o?e.jsx("div",{className:"flex h-full w-6 items-center justify-center",children:e.jsx(de,{})}):e.jsx("button",{onClick:async()=>{n&&(a(!0),await n(),a(!1))},children:e.jsx(_e,{className:"text-token-secondary rounded-full hover:bg-token-main-surface-secondary dark:hover:bg-token-main-surface-tertiary"})})})]})}function Bt({gizmoName:t,onAddFiles:n}){return e.jsx("div",{className:"flex h-full cursor-pointer items-center justify-center rounded-lg border border-token-border-light px-4 py-3 pb-6 active:bg-token-main-surface-tertiary",onClick:n,children:e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4 text-sm text-token-text-secondary",children:[e.jsx(le,{}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"max-w-100 text-token-text-secondary",children:e.jsx(f,{...c.emptyFileInstructions,values:{gizmoNameText:e.jsx("span",{className:"font-bold",children:e.jsx(f,{...c.emptyFileGizmoName,values:{gizmoName:t}})},"gizmoNameText")}})})})]})})}const je=B.div`text-sm text-red-500`,Rt=B.textarea`w-full overflow-y-auto overflow-x-clip rounded-lg border px-3 py-2 focus:ring-2 focus:ring-token-text-primary border-token-border-medium bg-token-main-surface-primary`,E=20;function ve({onClose:t,gizmo:n}){const s=_(),[o,a]=h.useState(n?.gizmo?.instructions||""),r=L(),l=Z(),d=[];o?.length>G&&d.push(s.formatMessage(c.instructionsTooLong,{length:G}));const i=g=>{a(g.target.value)},m=()=>{t()},x=async()=>{try{await r.mutateAsync({update:{instructions:o??""},id:n.gizmo.id}),t()}catch(g){const v=fe(g);l.danger(v??"Error",{duration:2})}},u=e.jsx(O.Button,{title:s.formatMessage(c.save),color:"primary",onClick:x,loading:r.isPending,disabled:d.length>0}),j=e.jsx(O.Button,{title:s.formatMessage(c.cancel),color:"secondary",onClick:m,disabled:r.isPending});return e.jsx(ue,{className:"min-h-[50dvh] max-w-[820px]",isOpen:!0,showCloseButton:!r.isPending,hideSeparator:!0,noPadding:!0,size:"custom",type:"success",title:e.jsx("div",{className:"h-8",children:s.formatMessage(c.editCustomInstructionsTitle)}),onClose:()=>{r.isPending||t()},children:e.jsxs("div",{className:"flex h-full flex-col px-6 pb-7 pt-0",children:[e.jsx("div",{className:"text-sm font-medium",children:s.formatMessage(c.editCustomInstructionsSubtitle)}),e.jsx("div",{className:"text-sm text-token-text-secondary",children:s.formatMessage(c.editCustomInstructionsDescription)}),e.jsx(Rt,{autoFocus:!0,placeholder:s.formatMessage(c.projectInstructionsPlaceholder),className:"mb-1 mt-4 min-h-24 w-full flex-grow resize-none rounded-md bg-token-main-surface-primary",onChange:i,value:o,disabled:r.isPending}),d.map(g=>e.jsx(je,{className:"mt-1",children:g},g)),e.jsx(O.Actions,{primaryButton:u,secondaryButton:j})]})})}function Gt({gizmoId:t,gizmoName:n,gizmoEditorData:s,openFileDialog:o,pendingFiles:a,setVersion:r,pendingFileUpsertMutationsRef:l,currentModelConfig:d}){const i=s?.files?.reduce((p,C)=>p+(C.file_size_tokens??0),0)??0,m=s?.contextStuffingBudget;let x;m&&(x=i/m,i>0&&x<.01&&(x=.01));const u=s?.files??[],j=Array.from(a.current.values()).filter(p=>u.every(C=>C.file_id!==p.fileId)),g=j.filter(p=>d!=null&&z(d,p.file.type,p.file.name)===H.CodeInterpreter),v=u.filter(p=>d!=null&&p.type!=null&&z(d,p.type,p.name)===H.CodeInterpreter),y=[...g.map(p=>p.tempId),...v.map(p=>p.file_id)];return e.jsx(_t,{gizmoId:t,gizmoName:n,pendingFiles:j,pendingFileUpsertMutationsRef:l,files:u,modelCapacityUsed:x,interpreterOnlyFileIds:y,onAddFiles:o,removePendingFile:p=>{a.current.delete(p),r(C=>C+1)}})}const zt=h.forwardRef(function({gizmo:n,showInstructions:s=!0},o){const a=_(),[r,l]=h.useState(!1),d=L(),i=Ae(n),m=Ue(i),{data:x}=gt(),u=(x&&Pt(x.models.values(),w=>w.tags.includes(jt.GPT_4o)))??x?.models.get(Le),j=Z(),[g,v]=h.useState(0),y=h.useRef(new Map),p=h.useRef([]),C=Be(u,void 0),Se=w=>{w.some(({errors:I})=>I.length!==1||I[0]?.code!==q.TooManyFiles)?j.danger(a.formatMessage(c.unknownError),{duration:2}):j.danger(a.formatMessage(c.dragTooManyFilesError,{MAX_FILES_PER_PROJECT:E}),{duration:2})},Ne=async w=>{me.logEvent(xe.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const I=i.id;w.length>0&&await Promise.all(w.map(F=>{const R=Qe(F);y.current.set(R,{tempId:R,gizmoId:I,file:F,status:D.Uploading,progress:1,fileId:null,cdnUrl:null}),Ve(R,F,a,j,{kind:vt.Gizmo,gizmoId:I},{onFileUploaded:async(b,k,M,P)=>{const N=y.current.get(b);N?.fileId&&N?.fileId&&(p.current.push({id:n.gizmo.id,mutationId:oe(),update:T=>{if(!N.fileId)return T;const Fe=[...T.files??[],{file_id:N.fileId,name:N.file.name,size:N.file.size,type:P?.mimeType??Ke(N.file),last_modified:N.file.lastModified,file_size_tokens:P?.fileTokenSize}];return{...T,files:Fe}},onSuccess:()=>{y.current.delete(b),v(T=>T+1)}}),ae(n.gizmo.id)({gizmoId:n.gizmo.id,upsertProjectMutation:d,pendingFileUpsertMutationsRef:p}))},onFileCreated:(b,k,M)=>{y.current.set(b,{tempId:b,gizmoId:I,file:F,status:D.Uploading,progress:1,...y.current.get(b),fileId:k,cdnUrl:M}),v(P=>P+1)},onFileUploadProgress:(b,k)=>{const M=y.current.get(b);M?.status===D.Uploading&&y.current.set(b,{...M,progress:k>95?95:k}),v(P=>P+1)},onError:b=>{y.current.delete(b),v(k=>k+1)}},{usesRetrievalIndex:u!=null&&z(u,F.type,F.name)===H.Retrieval})}))},K=Re(C),W=Ge(K),$=y.current.size+i.files.length,{open:Y,getInputProps:Ce,getRootProps:ke,isDragAccept:we,isDragReject:Ie}=ze({noClick:!0,noDragEventsBubbling:!0,onDropAccepted:Ne,onDropRejected:Se,multiple:!0,maxSize:He,maxFiles:E-$,validator:()=>$>=E?{code:q.TooManyFiles,message:"Too many files"}:null,...K});return h.useImperativeHandle(o,()=>({openFileDialog:Y})),e.jsxs("div",{...ke({className:"h-full px-6"}),children:[e.jsx("input",{...Ce()}),s&&e.jsxs(Ft,{children:[e.jsx("button",{className:"w-full",onClick:()=>l(!0),children:e.jsx("div",{className:"w-full rounded-lg border border-token-border-light text-left text-sm",children:i?.instructions?.length?e.jsx("div",{className:"mx-4 my-3 line-clamp-4",children:i.instructions}):e.jsxs("div",{className:"flex h-full w-full items-center px-4 py-3 text-token-text-secondary",children:[e.jsx("div",{className:"flex-1",children:e.jsx(f,{...c.addCustomInstructions})}),e.jsx(A,{className:"icon-sm"})]})})}),m.includes(Xe.GizmoInstructionsTooLong)?e.jsx(je,{className:"mt-1",children:e.jsx(f,{...c.instructionsTooLong,values:{length:G}})}):null]}),r&&e.jsx(ve,{gizmo:n,onClose:()=>{l(!1)}}),e.jsx(Gt,{gizmoId:n.gizmo.id,gizmoName:n.gizmo.display.name,gizmoEditorData:i,openFileDialog:Y,pendingFiles:y,pendingFileUpsertMutationsRef:p,setVersion:v,currentModelConfig:u}),we&&e.jsxs(J,{children:[e.jsx(Ze,{}),e.jsx("h3",{children:e.jsx(f,{...c.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:W.length>0?W.join(", "):e.jsx(f,{...c.dragAllAccepted})})]}),Ie&&e.jsxs(J,{children:[e.jsx(It,{className:"icon-2xl"}),e.jsx("h3",{children:e.jsx(f,{...c.dragTooManyFiles})}),e.jsx("h4",{className:"w-2/3 text-center",children:e.jsx(f,{...c.dragTooManyFilesDescription,values:{MAX_FILES_PER_PROJECT:E}})})]})]})});function Ht({gizmo:t,onClose:n}){const s=h.useRef(null),o=h.useCallback(()=>{s.current?.openFileDialog()},[s]);return e.jsx(e.Fragment,{children:e.jsx(ue,{className:"min-h-72 max-w-[820px]",isOpen:!0,showCloseButton:!0,hideSeparator:!0,noPadding:!0,size:"custom",type:"success",onClose:()=>{n()},children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(O.TitleBar,{$hasSeparator:!1,children:e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(yt,{className:"text-lg font-semibold leading-6 text-token-text-primary",children:e.jsx(f,{...c.projectFilesModalTitle})})}),e.jsx(bt,{color:"secondary",onClick:o,children:e.jsx(f,{...c.addFilesButtonLabel})}),e.jsx(St,{asChild:!0,className:"sm:mt-0",children:e.jsx(Nt,{onClick:n})})]})}),e.jsx("div",{className:"h-[50dvh] flex-grow overflow-y-auto pt-0",children:e.jsx(zt,{ref:s,gizmo:t,showInstructions:!1})})]})})})}function Xt({gizmo:t}){return e.jsx("div",{className:"mt-6 grid grid-cols-1 items-start gap-5 xs:grid-cols-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Zt,{gizmo:t}),e.jsx(Vt,{gizmo:t})]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsx(se,{})]})})}function V({header:t,context:n,contextClassName:s="",icon:o,modal:a,onClick:r,disabled:l=!1,isModalOpen:d=!1}){return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,className:S("group/snorlax-control-tile relative h-full rounded-2xl border border-token-border-xlight bg-token-main-surface-primary shadow-xxs hover:bg-token-main-surface-secondary active:bg-token-main-surface-tertiary active:drop-shadow-none",l&&"pointer-events-none"),children:e.jsxs("div",{className:"relative mx-5 my-4 flex items-center justify-between gap-3 overflow-hidden",children:[e.jsxs("div",{className:"w-full grow text-left",children:[e.jsx("div",{className:"text-sm font-medium",children:t}),e.jsx("div",{className:S("text-xs text-token-text-secondary",s),children:n})]}),o]})}),d&&a]})}function se(){return e.jsx(V,{disabled:!0,header:e.jsx("div",{className:"my-2 h-2 w-48 rounded-full bg-token-main-surface-secondary"}),context:e.jsx("div",{className:"my-2 h-2 w-32 rounded-full bg-token-main-surface-secondary"})})}function Zt({gizmo:t}){const{files:n}=t,s=!n.length,o=X(t.gizmo.id),[a,r]=h.useState(!1),l=a&&e.jsx(Ht,{gizmo:t,onClose:()=>{r(!1)}}),d=()=>r(!0);let i,m,x;if(s)i=e.jsx(f,{...c.addFilesButtonLabel}),m=e.jsx(f,{...c.filesControlDescription}),x=e.jsxs("div",{className:"relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full",children:[e.jsx("div",{className:"absolute h-full w-full rounded-full bg-token-main-surface-secondary opacity-5",style:{backgroundColor:o??void 0}}),e.jsx(le,{className:"icon-md h-5 w-5",style:{color:o}})]});else{const j=n.slice(0,3);i=e.jsx(f,{...c.projectFilesModalTitle}),m=e.jsx(f,{...c.filesCount,values:{count:n.length}}),x=e.jsx("div",{className:"relative flex h-10 w-20 shrink-0 items-center justify-center rounded-full",children:j.toReversed().map((g,v)=>e.jsx(Qt,{file:g,index:v,gizmoId:t.gizmo.id},g.id))})}return e.jsx(V,{isModalOpen:a,modal:l,onClick:d,header:i,context:m,icon:x})}function Qt({file:t,index:n,gizmoId:s}){const o=t.name,r=U(o)&&t.file_id!=null&&e.jsx(Q,{fileName:o,fileId:t.file_id,gizmoId:s});return e.jsx("div",{className:"absolute right-0 top-0 h-10 w-10 overflow-hidden rounded-xl border-2 border-token-main-surface-primary group-hover/snorlax-control-tile:border-token-main-surface-secondary",style:{transform:`translateX(${n*-20}px)`},children:r||e.jsx(We,{className:"h-9 w-9 flex-shrink-0",filename:t.name,contextConnectorInfo:void 0})})}function Vt({gizmo:t}){const{instructions:n}=t.gizmo,s=!n.length,o=X(t.gizmo.id),[a,r]=h.useState(!1),l=a&&e.jsx(ve,{gizmo:t,onClose:()=>{r(!1)}}),d=()=>r(!0);let i,m,x,u;return s?(i=e.jsx(f,{...c.customInstructionsTitle}),m=e.jsx(f,{...c.customInstructionsDescription}),x=e.jsxs("div",{className:"relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full",children:[e.jsx("div",{className:"absolute h-full w-full rounded-full bg-token-main-surface-secondary opacity-5",style:{backgroundColor:o??void 0}}),e.jsx(A,{className:"icon-md h-5 w-5",style:{color:o}})]})):(i=e.jsx(f,{...c.editCustomInstructionsTitle}),u="overflow-hidden text-ellipsis whitespace-nowrap",m=n),e.jsx(V,{isModalOpen:a,modal:l,onClick:d,header:i,context:m,icon:x,contextClassName:u})}const ye=B.h3`p4 overflow-hidden text-ellipsis break-all py-3 px-4 text-xs font-semibold text-token-text-secondary`,Kt=B.div`h-24 w-full rounded-3xl bg-token-main-surface-secondary`,Wt=()=>e.jsx("div",{className:"ml-1 mt-3 h-10",children:e.jsx("div",{className:"my-[15px] h-[10px] w-48 rounded-full bg-token-main-surface-secondary"})}),ne=new Map;function $t(t){const n=ne.get(t);if(n)return n;const s=ft(Yt,2e3,{trailing:!0});return ne.set(t,s),s}async function Yt({gizmoId:t,upsertProjectMutation:n,toaster:s}){const o=pt,a=ee(o.getState(),"theme",t);try{a!==void 0&&await n.mutateAsync({id:t,update:{theme:a??void 0}}),ee(o.getState(),"theme",t)===a&&ht(t,"theme")}catch(r){const l=fe(r);s.warning(l??"Error",{duration:2})}}function qt({gizmoId:t,theme:n,upsertProjectMutation:s,toaster:o}){xt(t,"theme",n),$t(t)({gizmoId:t,upsertProjectMutation:s,toaster:o})}function Jt({gizmo:t}){const n=t.gizmo.display.emoji,s=X(t.gizmo.id),o=nt(),a=L(),[r,l]=h.useState(!1),d=Z();if(o&&n)return e.jsx(ot,{emoji:n,className:"icon-lg text-2xl"});const i=m=>{m!==s&&(ct.count(dt.DEFAULT,"projects.theme.change",[{key:"theme",value:m??"default"}]),qt({gizmoId:t.gizmo.id,theme:m,upsertProjectMutation:a,toaster:d}))};return e.jsx(rt,{open:r,sideOffset:4,alignOffset:7,side:"bottom",alignAgainstAnchor:"start",size:"none",modal:!0,onOpenChange:m=>l(m),triggerButton:e.jsx(he,{currentTheme:s,isPopoverOpen:r}),children:e.jsx(Dt,{currentTheme:s,onSelect:i})})}function es({gizmo:t}){return e.jsxs("div",{className:"mb-6 flex w-full flex-col px-4",children:[t?e.jsx(Jt,{gizmo:t}):e.jsx(he,{disabled:!0,currentTheme:null,isPopoverOpen:!1}),t?e.jsxs("button",{className:"group ml-1 mt-3 self-start text-balance text-left text-4xl font-semibold hover:text-token-text-secondary",onClick:()=>{ce.setShowProjectSettingsModal(!0)},children:[t.gizmo.display.name,e.jsx(A,{className:"icon-lg ml-2.5 inline-block text-token-text-secondary opacity-0 group-hover:opacity-100 motion-safe:transition-opacity motion-safe:duration-100"})]}):e.jsx(Wt,{})]})}function be({children:t}){return e.jsx("div",{className:"group relative flex flex-col gap-1 p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(at,{className:"icon-md text-token-sidebar-icon"}),t]})})}function ts({conversation:t,gizmo:n}){const s=kt(t.id)??t.title,[o,a]=h.useState(!1);h.useEffect(()=>wt(it,{editTitleInMainScreen:({serverThreadId:d})=>{d===t.id&&a(!0)}}),[t.id]);const{snippet:r}=t,l=e.jsxs(be,{children:[e.jsxs("div",{className:"flex-grow overflow-hidden group-hover:mr-5",children:[o?e.jsx(ut,{conversation:t,onClose:()=>{a(!1)}}):e.jsx("div",{className:"text-sm font-medium",children:s}),r&&e.jsx("div",{className:"truncate text-sm text-token-text-secondary",children:r})]}),!o&&e.jsx(ss,{conversation:t})]});return o?l:e.jsx(Me,{to:lt(t.id,n),children:l})}function ss({conversation:t}){const[n,s]=h.useState(!1);return e.jsx("div",{className:S("absolute bottom-0 top-0 items-center gap-1.5 pr-4 ltr:right-0 rtl:left-0",n?"flex":"hidden can-hover:group-hover:flex"),onClick:o=>{o.preventDefault()},children:e.jsx(mt,{conversation:t,conversationTitle:t.title,onOpenChange:o=>{s(o),o&&me.logEvent(xe.conversationHistoryItemOpenMenu,{conversationId:t.id})},inMainScreen:!0})})}function ns({gizmo:t}){tt(t.gizmo.id);const{items:n,hasNextPage:s,fetchNextPage:o,isLoading:a,isFetching:r,isFetchingNextPage:l}=st(t.gizmo.id),d=h.useRef(null),i=h.useCallback(x=>{a||x==null||(d.current?.disconnect(),d.current=new IntersectionObserver(u=>{u[0].isIntersecting&&s&&!r&&o()}),d.current.observe(x))},[a,s,o,r]);h.useEffect(()=>()=>{d.current?.disconnect()},[]);const m=n.length;return e.jsxs("div",{className:"mb-14 mt-6",children:[m||a?e.jsx(rs,{gizmo:t,items:n??[],hasNextPage:s,infiniteScrollTriggerElementRef:i}):e.jsx(os,{}),l&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(de,{})})]})}function os(){return e.jsxs(e.Fragment,{children:[e.jsx(ye,{children:e.jsx(f,{...c.emptyChatsInProjectTitle})}),e.jsx("ol",{children:Array.from({length:5}).map((n,s)=>e.jsx("li",{style:{opacity:1-s*.2,transition:"opacity 0.3s ease-in-out"},className:S(s!==4&&"border-b border-token-border-xlight"),children:e.jsx(be,{children:e.jsxs("div",{className:"my-2 flex w-full flex-col gap-2",children:[e.jsx("div",{className:"h-2 w-2/12 rounded-full bg-token-main-surface-tertiary"}),e.jsx("div",{className:"h-2 w-5/12 rounded-full bg-token-main-surface-tertiary"})]})})},s))})]})}function rs({gizmo:t,items:n,hasNextPage:s,infiniteScrollTriggerElementRef:o}){const a=n.length;return e.jsxs(e.Fragment,{children:[e.jsx(ye,{children:e.jsx(f,{...c.chatsInProjectTitle})}),e.jsx("ol",{children:n.map((r,l)=>{const d=s&&l===n.length-3?o:void 0;return e.jsx("li",{ref:d,className:S("first:rounded-t-lg last:rounded-b-lg hover:bg-token-main-surface-secondary",l!==a-1&&"border-b border-token-border-xlight"),children:e.jsx(ts,{conversation:r,gizmo:t})},r.id)})})]})}function ys({clientThreadId:t,gizmoId:n,currentModelId:s,onRequestCompletion:o}){const a=_(),{data:r}=$e(n),l=Ye(u=>u.showProjectSettingsModal),[d,i]=Pe(),{value:m}=Ct("3463955812"),x=r&&qe(r);return h.useEffect(()=>(!x&&!m&&(te(t,u=>{u.modelId="gpt-4o",u.lockModel=!0}),i(u=>(u.delete("model"),u))),()=>{te(t,u=>{u.lockModel=!1})}),[t,x,i,m]),e.jsxs(Je,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:[e.jsx(es,{gizmo:r}),r?e.jsx(Mt,{clientThreadId:t,isNewThread:!0,currentModelId:s,onRequestCompletion:o,hideHeader:!0,showPromptStarters:!1}):e.jsx(Kt,{}),e.jsx(Xt,{gizmo:r}),r&&e.jsx(ns,{gizmo:r}),l&&e.jsx(et,{submitButtonTitle:a.formatMessage(c.projectSettingsSubmitButton),gizmo:r,onClose:()=>{ce.setShowProjectSettingsModal(!1)}},n)]})}export{ys as SnorlaxSplashScreen};
//# sourceMappingURL=le2nrmn696pq5622.js.map
