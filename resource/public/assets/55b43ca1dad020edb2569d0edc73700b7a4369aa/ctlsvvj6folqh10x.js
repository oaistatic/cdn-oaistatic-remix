const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/smefd1vnfyujpy2a.js","assets/eh26o1l35t2fnjj4.js","assets/i8w88cc8b3gds516.js","assets/root-inht5vcp.css","assets/jg63sxiyqeyvfv9f.js","assets/conversation-small-nranh1cg.css","assets/n5cjh9myd07lujm0.js","assets/gnpg1i5j0eqzqb3c.js","assets/fl1t4c9vpnb1ofrn.js","assets/f62w10vx9anohvac.js","assets/gjkb6ikcjvcmoft7.js","assets/buoyb8jniswedxm6.js","assets/c4bxzbp1808foto4.js","assets/i09ixv564jwzaz97.js","assets/ik96wpc41rashwi6.js","assets/i8svd71fvah1tt8i.js","assets/jzhplvlpjjzcf6w8.js","assets/dyuarriie396ezxd.js","assets/mwkkzpk83u6e8doo.js","assets/53nax822pkd7iwth.js","assets/ft5z2r2wosrho43b.js","assets/jv2eknshvxtq04lj.js","assets/gwp5e6wxf55yxdnx.js","assets/hlm6hsp0qis3d7zg.js","assets/ks978xypam3896ia.js","assets/05brdf5reu7ran2x.js","assets/itdemlts8gcqwi6k.js","assets/kcf5o2l7h6vtxb24.js","assets/cd0tm93keko1hti4.js","assets/k3roy11bbqcslziz.js","assets/bxo0vudykvsyb7bg.js","assets/j36zxu0jsrspjc86.js","assets/nbui16zd89j1b3kp.js","assets/oh4o3ugq8w1dadrw.js","assets/le2nrmn696pq5622.js","assets/hq6x27nrpb56q3r0.js","assets/m89x2zftpo6hrypr.js","assets/j14akxnqigsmgi7w.js","assets/ln72qaf6x6k87xpg.js","assets/h5ki4u1sjcr6cdl0.js","assets/e7ldcb1pybd2xac9.js","assets/i08snqhpy1q5wgpn.js","assets/cvqqffrvl521xsgr.js","assets/e0nx23jhoddiye0f.js","assets/gdsmqpdlbx03h3zp.js","assets/fioevnw06bqx6tt9.js","assets/mkf03mv1563ttunw.js","assets/c3ew5w7qbxkccpqx.js","assets/cugsqf18bce1nyqa.js","assets/fqvmdqxedgfcj4co.js","assets/b9s9od8ovvq4l0ah.js","assets/mrrvs3fql96l359q.js","assets/jahe3ggfyk20o7ht.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/hmbip9k0fcw739ar.js","assets/h2nc3qmtjg2iytti.js","assets/ksnwm75was8ro53u.js"])))=>i.map(i=>d[i]);
import{X as aa,df as Ce,ae as it,ah as bt,ab as Oe,ap as he,ef as Yr,eb as Pe,d$ as Bs,b$ as Me,aR as Kr,b5 as Xr,ds as ra,bm as Z,dn as Jr,g6 as Qr,aM as De,aN as Be,K as Xe,b9 as Kt,ht as xo,W as Fs,I as ia,r as Q,aW as Ue,cr as Ls,P as Y,j as K,an as D,el as Zr,hu as ei,S as xe,f as Ve,c2 as Ts,a5 as An,af as Nn,H as Re,cb as vo,as as Hs,bn as Tt,ak as Os,al as rt,hv as la,bu as So,c as ti,g as si,bC as un,e9 as mn,ai as _t,dv as ks,h as Ie,bK as ni,cc as oi,aO as Xt,eX as En,a0 as yt,eA as Jt,c0 as bo,ge as ai,gc as ri,eU as ii,dr as ca,hq as li,cR as ci,J as di,y as da,aP as ua,dp as ui,f4 as mi,ga as Rn,ex as hi,O as yo,bQ as gi,bR as pi,b1 as fi,gB as xi,c3 as As,f8 as vi,bU as ma,$ as jt,hw as Si,cW as bi,D as hn,fO as ha,ac as ga,e7 as pa,fk as yi,b6 as ji,Y as jo,g2 as wi,hx as fa,g1 as In,gH as Pn,u as Us,N as Vt,b2 as wo,fJ as Mi,aa as wt,eV as xa,B as St,de as Ci,Z as Ti,fl as _i,e_ as ki,hy as Ai,bM as Ni,e5 as gn,eh as Ei,o as Ke,bt as Ri,bT as Ns,bO as fs,M as va,bz as Dn,aj as Ii,bW as Pi,bA as Sa,fg as Di,fa as Bi,b8 as Fi,bV as Li,e0 as Hi,hz as ba,gy as ya,ar as Oi,gz as Ui,hA as zi,hB as Gi,bN as Wi,b4 as Vi}from"./eh26o1l35t2fnjj4.js";import{c as ve,r as i,j as e,L as pn,M as P,e as Bn,R as ja,f as wa,ac as ne,ad as Qt,as as qi,a as Ma,X as $i,v as Yi,at as Ki,au as Xi,av as Mo}from"./i8w88cc8b3gds516.js";import{Y as zs,ck as Fn,gv as _s,gz as Zt,bk as lt,iR as Ji,iS as Qi,bE as fn,lZ as Zi,_ as Co,a1 as el,dD as tl,f5 as sl,l_ as nl,ar as Ln,bY as kt,ii as Hn,iM as ol,kg as Ca,l$ as Ta,bd as al,m0 as Ye,bt as rl,m1 as il,m2 as xn,m3 as on,m4 as ll,m5 as xs,m6 as cl,a6 as dl,d0 as ul,d1 as _a,a5 as ml,hK as hl,m7 as gl,i3 as vs,m8 as pl,ag as ka,fU as On,dl as fl,m9 as xl,fw as vl,cj as Un,r as Sl,ma as bl,mb as yl,hf as jl,mc as wl,md as Ml,da as $t,me as Aa,mf as Na,mg as Se,d7 as zn,c6 as Gs,mh as vn,mi as He,aa as Ea,mj as Cl,jF as Ra,jI as Ia,eK as Tl,B as Pa,fB as _l,jE as kl,mk as Da,ml as Al,mm as Nl,mn as Mt,hE as Ba,mo as $,mp as Fa,mq as La,mr as El,ms as Rl,mt as Il,mu as Pl,mv as Dl,mw as Bl,mx as Fl,my as Ll,eM as Hl,mz as Ol,mA as Ul,mB as zl,mC as Gl,mD as Wl,mE as Vl,mF as ql,mG as Ha,mH as Oa,mI as $l,mJ as Yl,mK as Kl,mL as Xl,mM as Jl,mN as Ql,mO as Zl,mP as ec,mQ as tc,mR as sc,mS as Ua,mT as nc,W as Es,mU as za,mV as Ws,fI as es,mW as Ga,h8 as Gn,h9 as Ct,hc as Wa,E as oc,mX as ac,fK as Yt,dp as rc,fd as ic,mY as lc,mZ as cc,m_ as dc,m$ as Rs,n0 as uc,n1 as Va,n2 as mc,H as hc,lA as gc,dX as qa,iu as pc,n3 as fc,bW as Wn,bX as $a,dO as xc,dP as Ya,n4 as vc,n5 as Sc,n6 as To,n7 as _o,n8 as bc,n9 as yc,c1 as ko,b_ as jc,ix as wc,jQ as Ao,na as Mc,nb as Cc,nc as Tc,gk as Ka,nd as _c,ne as kc,X as Xa,lK as No,gl as Ja,hD as Vn,nf as Eo,i2 as Ac,bZ as Nc,ng as Ec,iA as Rc,jW as Ic,iB as Pc,iy as Dc,nh as Bc,b$ as Sn,ni as Fc,nj as Lc,nk as Hc,nl as Oc,nm as Uc,U as Is,dd as zc,nn as Gc,no as Wc,ib as Vc,ab as qc,kP as $c,np as Yc,ae as Kc,af as Xc,nq as Jc,nr as Qc,ns as Zc,nt as ed,nu as td,nv as sd,dG as nd,it as od,kZ as ad,nw as rd,nx as id,ny as ld,nz as cd,nA as dd,fJ as ud,nB as md,nC as hd,nD as bn,nE as gd,nF as pd,d8 as Qa,nG as fd,nH as xd,nI as Za,iN as qn,db as Ps,nJ as vd,nK as Sd,nL as bd,nM as yn,j as er,nN as Ro,nO as yd,nP as jd,nQ as wd,nR as Md,jM as tr,d6 as Cd,nS as Td,nT as _d,ft as kd,nU as Ad,nV as Nd,nW as Ed,nX as Rd,nY as Id,jY as Pd,nZ as Dd,n_ as Ss,f9 as sr,n$ as nr,o0 as Bd,gH as Ds,o1 as jn,o2 as Fd,o3 as Ld,o4 as bs,co as Io,o5 as Hd,cl as Od,cm as Ud,cG as or,cH as ar,f$ as rr,g1 as ir,eD as zd,o6 as Gd,h3 as Wd,o7 as Vd,o8 as qd,o9 as $d,jm as Yd,oa as Kd,ob as Xd,oc as Jd,od as Qd,bV as Zd,dF as eu,gG as tu,cp as su,oe as nu,of as ou,fS as an,f_ as au,g0 as ru,gY as iu,og as lu,oh as cu,oi as du,oj as uu,ok as mu,ol as hu,om as gu,on as pu,oo as fu,op as xu,c3 as vu,kI as Su,kH as bu,oq as yu,hp as ju,or as wu,gm as Mu,go as Cu,A as Tu,ga as _u,i8 as ku,i9 as Au,os as Nu,ot as Eu,gn as Ru,c5 as Iu,gi as Pu,ou as Du,ov as Bu,cJ as Fu,cK as Lu,cI as Hu,cM as Ou,ow as Uu,gp as Po,fy as zu,cs as Gu,ct as Wu,hZ as Vu,kN as qu,ox as $u,hy as Yu}from"./jg63sxiyqeyvfv9f.js";import{S as Ku,G as Xu,L as Ju,a as Qu}from"./hlm6hsp0qis3d7zg.js";import{u as $n,i as Zu,h as em,j as Yn,s as tm,k as sm,l as ys,m as nm,n as om,o as Vs,C as lr}from"./dyuarriie396ezxd.js";import{u as am}from"./j14akxnqigsmgi7w.js";import{B as rm}from"./ln72qaf6x6k87xpg.js";import{C as wn,g as im}from"./h5ki4u1sjcr6cdl0.js";function cr({clientThreadId:t,currentLeafId:s}){const{currentModelId:o}=$n(),a=zs(t),n=aa(t,s),r=Ce(t),l=it(),c=Fn(o),d=bt(t)&&!n&&(_s(a)||a?.kind===Oe.GizmoTest),h=Zt(r);return{showEmptyState:d,canUseNewHomepage:d&&h||d&&!r&&!c&&!l}}const Do=he.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function lm({conversation:t,gizmoResource:s,elementRef:o}){const a=Qr(t.id)??t.title;return e.jsx(pn,{to:tl(t.id,s),children:e.jsx(Z.Item,{icon:sl,children:e.jsx("div",{ref:o,children:a})},t.id)})}function cm({gizmoId:t,clientThreadId:s,inMobileHeader:o,modelLabel:a,modelPickerContent:n}){const r=ve(),{data:l}=lt(t),{items:c,hasNextPage:d,fetchNextPage:h,isLoading:u,isFetchingNextPage:m}=Ji(t),g=i.useRef(null),b=i.useCallback(E=>{u||E==null||(g.current?.disconnect(),g.current=new IntersectionObserver(p=>{p[0].isIntersecting&&d&&h()}),g.current.observe(E))},[u,d,h]);i.useEffect(()=>()=>{g.current?.disconnect()},[]);const{title:f,titleSource:x}=Yr(s),S=Pe(),{conversationLeafId:v}=$n(),{showEmptyState:j}=cr({clientThreadId:s,currentLeafId:v}),C=Bs(s),w=Qi(),y=r.formatMessage(fn.newChatTitle),{resolvedTitle:A,isTypingEffect:z}=Zi(s,f??null,!0),{value:R}=Me("1856506891");if(!l||j)return null;const H=A==null&&(bt(s)||x===Kr.NewChat),N=C?e.jsx(e.Fragment,{}):e.jsxs(Do,{$isScreenArch:S,$shimmer:H,children:[e.jsxs("div",{className:"truncate",children:[z?e.jsx(nl,{text:A??""}):A??y,R&&e.jsx("span",{className:"relative bottom-[1px] mx-1 inline-block rounded-md bg-token-main-surface-secondary px-1 text-xs leading-4 text-token-text-secondary",children:a})]}),e.jsx(Ln,{className:"icon-md text-token-text-tertiary"})]}),I=w&&l.gizmo.display.emoji?e.jsxs(e.Fragment,{children:[l.gizmo.display.emoji," ",l.gizmo.display.name]}):l.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(Do,{$isScreenArch:S,children:e.jsx(pn,{className:"truncate",to:Co(l),children:I})}),e.jsxs(e.Fragment,{children:[e.jsx(Xr,{className:"icon-md text-token-text-tertiary"}),e.jsxs(ra,{contentAlign:o?"center":"start",size:"small",triggerButton:N,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[R&&e.jsxs(Z.Sub,{children:[e.jsx(Z.SubMenuTrigger,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1",children:[e.jsx(P,{id:"ilkdMh",defaultMessage:"Model"}),e.jsx("span",{className:"text-xs font-medium text-token-text-secondary",children:a})]})}),e.jsx(Z.Portal,{children:e.jsx(Z.SubContent,{children:n})})]}),e.jsx(pn,{to:Co(l),children:e.jsx(Z.Item,{icon:el,children:e.jsx(P,{...fn.newChatProjectDropdownItem,values:{name:`"${l.gizmo.display.name}"`}})},"new-chat")}),c.filter(E=>E.id!==s).map((E,p)=>{const _=d&&p===c.length-4?b:void 0;return e.jsx(lm,{elementRef:_,conversation:E,gizmoResource:l},E.id)}),m&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(Jr,{})})]})]})]})}const dm=De(()=>Be(()=>import("./smefd1vnfyujpy2a.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.ThreadHeaderGizmoDropdown)),Mn=he.button`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$isScreenArch:t})=>t?"h-[44px] @lg/screen-composer:pl-3 [line-height:26px] [font-size:17px] px-3":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function um({clientThreadId:t}){const s=ve(),o=it(),a=Zr(t),n=Bn(),[,r]=wa(),l=()=>{!a&&!o?n({pathname:"/",search:new URLSearchParams({[vs]:"true"}).toString()}):r(c=>(c.get(vs)==="true"?c.delete(vs):c.set(vs,"true"),c),{replace:a,state:pl()})};return e.jsx(Z.Item,{size:"large",className:"!pr-3",onClick:l,icon:cl,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(P,{...Qn.temporaryChat})}),e.jsx(dl,{enabled:o,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function mm(t){return t.title?t.title:t.shortLabel}function Kn(t,s){let o=t;if(t===xo.AUTO){const r=s?.categories.filter(({defaultModel:l})=>l!==xo.AUTO);r?.length===1&&(o=r[0].defaultModel)}const a=s?.categories.find(({defaultModel:r})=>r===o);if(a){const{categoryId:r}=a,l=mm(a);return{selectedCategory:r,modelLabel:l,omitPrefix:!!a.title}}const n=s?.groups.find(({modelIds:r})=>r.includes(o));if(n){const{group:r,shortLabel:l}=n;return{selectedCategory:r,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function hm({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function gm({clientThreadId:t,inMobileHeader:s}){const{isLoading:o,data:a}=Xe(),n=ei(),l=kt(t).id,c=Hn(),{modelLabel:d,omitPrefix:h}=Kn(l,a),u=Xn(t,c),m=ve(),{isUnauthenticated:g}=Ue(),b=!g&&!n;i.useEffect(()=>{o||ul({namespace:_a.ChatPageLoad})?.logTiming("render_model_switcher")},[o]);const f=Pe(),x=e.jsxs("div",{className:D(f?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[h?null:`${Ca} `,b?e.jsx("span",{className:"text-token-text-secondary",children:d}):g&&d?e.jsx(hm,{modelLabel:d}):null]});return u.length?o?null:e.jsx(ra,{sideOffset:8,size:"large",triggerButton:e.jsxs(Mn,{$isScreenArch:f,style:{viewTransitionName:"var(--vt-thread-model-switcher)"},"aria-label":d?m.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:d}):"",children:[x,f?e.jsx(ml,{className:"icon-md text-token-text-tertiary"}):e.jsx(Ln,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:S=>{Y.logEvent(K.toggleModelSwitcher,{isOpen:S}),xe.logEvent("toggle_model_switcher",null,{isOpen:String(S)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(Jn,{sections:u})}):e.jsx(Mn,{className:"cursor-default",children:x})}function pm({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:o,currentModelId:a,testId:n}){const{defaultModel:r,label:l,description:c,isBeta:d,isAlpha:h}=t,u=hl(o??"");return e.jsx(xn,{value:r,currentModelId:a,modelSwitcherDenialsBySlug:s,renderName:m=>e.jsx(Cn,{name:l,description:c,isDisabled:m,isBeta:d,isAlpha:h}),isSelected:(!o||u)&&a===r,testId:n},r)}function Xn(t,s){const o=kt(t),a=o.id,n=Ce(t),{data:r}=Xe(),{data:l}=Fs(),c=l&&ia(l),d=Q.getServerThreadId(t),h=Ta({clientThreadId:t}),u=ve(),m=!d,{isUnauthenticated:g}=Ue(),b=al(),{layer:f}=Ls("2723963139"),x=f.get("is_dynamic_model_enabled",!1),S=s.find(({categoryId:F})=>F===Ye.ALPHA),v=s.find(({categoryId:F})=>F===Ye.DATA_CAMPAIGNS),j=s.find(({categoryId:F})=>F===Ye.EXPERIMENTS),C=s.find(({categoryId:F})=>F===Ye.MAINLINE),w=!!S?.options?.length,y=!!v?.options?.length,A=!!j?.options?.length,z=!!C?.options?.length,R=Bn(),H=i.useCallback(()=>{Y.logEvent(K.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),rl(R,"Thread header dropdown")},[R]),N=()=>{xe.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),Y.logEvent(K.modelSwitcherPlusUpgradeButtonClicked),g?b({shouldOpenPaymentModalOnAuth:!0,callback:F=>{Y.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:F})}}):H()},I=[],E=e.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(P,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:x?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(ka,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(g){const F={id:"modelSection",content:[]};F.content.push(e.jsx(il,{},"noAuthUpsell")),I.push(F)}else if(!c&&!n){const F={id:"modelSection",content:[]};F.content.push(e.jsx(xn,{value:"",currentModelId:a,onClick:N,modelSwitcherDenialsBySlug:h,isUpgradeUpsell:!0,renderName:L=>e.jsx(Cn,{icon:gl,isDisabled:L,name:u.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:u.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"})}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),F.content.push(e.jsx(xn,{value:on.AUTO,currentModelId:a,modelSwitcherDenialsBySlug:h,renderName:L=>e.jsx(Cn,{icon:ll,name:u.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:u.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:L}),isSelected:!n&&a===on.AUTO,showNewChatHint:!0},on.AUTO)),I.push(F)}else{const F={id:"modelSection",content:[]};r?.categories.length&&F.content.push(E);const L=new Map;r?.categories.forEach(U=>{const T=e.jsx(pm,{category:U,currentGizmoId:n,currentModelId:a,modelSwitcherDenialsBySlug:h,testId:`model-switcher-${U.defaultModel}`},U.categoryId);U.subcategory?(L.has(U.subcategory)||L.set(U.subcategory,[]),L.get(U.subcategory)?.push(T)):F.content.push(T)}),L.forEach((U,T)=>{const B=r?.categories.find(q=>q.subcategory===T&&q.defaultModel===o.id);F.content.push(e.jsxs(Z.Sub,{children:[e.jsx(Z.SubMenuTrigger,{"data-testid":T==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[T,!!B&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:B.label})]})}),e.jsx(Z.Portal,{children:e.jsx(Z.SubContent,{className:"min-w-72",children:U})})]},T))}),I.push(F)}const p={id:"otherOptionsSection",content:[]},{selectedCategory:_}=Kn(a,r);return m&&(w&&p.content.push(e.jsx(xs,{isSelected:_===Ye.ALPHA,currentModel:o,option:S,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},S.value)),y&&p.content.push(e.jsx(xs,{isSelected:_===Ye.DATA_CAMPAIGNS,currentModel:o,option:v,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},v.value)),A&&p.content.push(e.jsx(xs,{currentModel:o,isSelected:_===Ye.EXPERIMENTS,option:j,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},j.value)),z&&p.content.push(e.jsx(xs,{isSelected:_===Ye.MAINLINE,currentModel:o,option:C,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},C.value))),p.content.length&&I.push(p),!g&&!n&&I.push({id:"temporaryChatSection",content:[e.jsx(um,{clientThreadId:t},"tempChat")]}),I}function fm(){const t=ve();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(Qn.beta)})}function xm(){const t=ve();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(Qn.alpha)})}function Cn({isDisabled:t,name:s,icon:o,description:a,extra:n,isBeta:r=!1,isAlpha:l=!1}){let c=s;return r&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(fm,{})]})),l&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(xm,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[o&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:e.jsx(o,{className:"h-4 w-4 text-token-text-primary"})}),e.jsxs("div",{children:[c,e.jsxs("div",{className:D(!t&&"text-token-text-secondary","text-xs"),children:[a,n]})]})]})}function Jn({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,o)=>e.jsxs(ja.Fragment,{children:[o!==0?e.jsx(Z.Separator,{}):null,s.content]},s.id))})}function vm({clientThreadId:t,inMobileHeader:s=!1}){const o=Ce(t),a=Zt(o),{conversationLeafId:n}=$n(),{showEmptyState:r}=cr({clientThreadId:t,currentLeafId:n}),{value:l}=Me("408434742"),{value:c}=Me("3463955812"),{data:d}=lt(o),h=Pe(),{data:u}=Xe(),g=kt(t).id,{modelLabel:b}=Kn(g,u),f=Hn(),x=Xn(t,f),S=e.jsx(gm,{clientThreadId:t,inMobileHeader:s});return o==null?S:a?r&&l&&d?c||ol(d)?S:e.jsx("div",{className:"inline-block",children:e.jsx(Kt,{label:e.jsx(P,{id:"u2Bz6Y",defaultMessage:"When using custom instructions or files, only GPT-4o is available"}),side:"right",children:e.jsxs(Mn,{$isScreenArch:h,disabled:!0,children:[Ca," ","4o"]})})}):e.jsx(cm,{modelLabel:b??"",modelPickerContent:e.jsx(Jn,{sections:x}),gizmoId:o,clientThreadId:t,inMobileHeader:s}):e.jsx(dm,{clientThreadId:t,gizmoId:o,inMobileHeader:s})}const Qn=Ve({alpha:{id:"o5FsPB",defaultMessage:"Alpha"},beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Sm=De(()=>Be(()=>import("./gnpg1i5j0eqzqb3c.js"),__vite__mapDeps([7,2,1,3,8,9,4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,6,24,25,26,27])).then(t=>t.GizmoUsingAsOwnerNotice)),bm=({clientThreadId:t})=>{const s=On(m=>m.activeStageSidebar),o=Q.getServerThreadId(t),a=fl(Ts.WorkspaceShareLinks),{isUnauthenticated:n}=Ue(),r=it(),l=Ce(t),c=Zt(l),d=a&&o&&!n&&!r&&!c,h=Pe(),u=!s&&!(!n&&h);return e.jsx("div",{className:D(!h&&"gap-2",h&&"@lg/screen-composer:gap-1","flex items-center pr-1 leading-[0]"),children:e.jsx(Zu,{showShareButton:d,showProfileDropdown:u,clientThreadId:t})})};function ym({clientThreadId:t,gizmoId:s}){const o=xl(),{data:a}=lt(s),n=An();return e.jsxs(e.Fragment,{children:[e.jsxs(vl,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&n?.isWorkspaceAccount()&&a.gizmo.tags?.includes(Un.WorkspaceDisabled)&&e.jsx(Sm,{gizmo:a}),e.jsx(Sl,{gizmoId:s,clientThreadId:t})]}),e.jsx(bl,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(em,{clientThreadId:t}),e.jsx(vm,{clientThreadId:t})]})}),e.jsx(bm,{clientThreadId:t})]}),o&&e.jsx(yl,{})]})}function dr({clientThreadId:t}){const s=Ce(t),o=Nn(),a=Pe();return o||a?null:e.jsx(ym,{gizmoId:s,clientThreadId:t})}const Bo=he.div`m-8 flex flex-col items-center`;function Fo(t){return e.jsx(ne.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function jm({clientThreadId:t}){const o=Re(t,n=>n?.promptGptRating)?.gizmoId,{data:a}=lt(o);return o==null||a==null||!jl(a)?null:e.jsx(wm,{gizmoId:o})}function wm({gizmoId:t}){const[s,o]=i.useState(!1),[a,n]=i.useState(!1),r=wl(t),l=async d=>{o(!0),setTimeout(()=>{n(!0)},5e3),Y.logEvent(K.submitInlineRating,{gizmo_id:t,rating:d}),await r.mutateAsync({rating:d})},c=async()=>{n(!0),Y.logEvent(K.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{a||Y.logEvent(K.showInlineRating,{gizmo_id:t})},[a,t]),a?null:s?e.jsx(Bo,{children:e.jsxs(Fo,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(vo,{onClick:()=>{n(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(P,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Bo,{children:e.jsxs(Fo,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(vo,{onClick:c})]}),e.jsx(Ml,{rating:void 0,onRating:l})]})})}const js={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},Mm=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((o,a)=>e.jsx(ne.div,{initial:js.initial,animate:js.animate,transition:{delay:(a-1)*js.transition.delay},exit:js.exit,children:e.jsx(Tt,{as:"button",color:"secondary",size:"small",onClick:()=>{s(o,t,a)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(Tm,{suggestion:o})},a)},a))});function Cm({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:o}){const a=t?.length>0;i.useEffect(()=>{a&&$t(t,o)},[a,o]);const{isUnauthenticated:n}=Ue();return a?t.every(Aa)?e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[n&&e.jsx(Hs,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(Ku,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(Na)?e.jsx(Mm,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function Tm({suggestion:t}){return Na(t)?e.jsx(e.Fragment,{children:t.text}):Aa(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:D("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function _m(){const{store:t}=Se(),s=t.useSharedProps();return s?e.jsx(km,{...s}):null}function km({clientThreadId:t,suggestions:s}){const o=zn();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(Am,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(Cm,{suggestions:s,onSelectingSuggestedReply:o,clientThreadId:t})})})})}const Am=he.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,ur=({className:t,children:s})=>e.jsx(ne.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Nm({currentLeafId:t,canContinue:s,onContinueGenerating:o}){const a=i.useCallback(()=>{const r=new Gs;o(t,r),vn()},[o,t]);let n=null;return s&&(n=e.jsx(Rm,{onHandleContinueGenerating:a})),n&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:n})}function Em({className:t}){return e.jsx(Ea,{className:D("-rotate-180",t)})}const Rm=({onHandleContinueGenerating:t})=>e.jsx(ur,{children:e.jsx(Tt,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:Em,size:"small",children:e.jsx(P,{...He.continueGenerating})})}),Im=({clientThreadId:t})=>{const s=la(),o=Os(t),a=rt(o);i.useEffect(()=>{a&&So.dismissBanner()},[a]);const n=s?.is_dismissible?()=>So.dismissBanner():void 0;return e.jsx(Qt,{children:s&&e.jsx(ne.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Cl,{clientThreadId:t,rateLimitInfo:s,onDismiss:n})})})};function Pm(t){const s=Os(t),o=rt(s),a=la();return!o&&a!=null}const Tn=window.sessionStorage,_n=ti(si(()=>({memoryFullBannerDismissed:!!Tn?.getItem(un.MemoryFullBannerDismissed)}))),mr={dismissBanner(){_n.setState(t=>{t.memoryFullBannerDismissed=!0}),Tn?.setItem(un.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){_n.setState(t=>{t.memoryFullBannerDismissed=!1}),Tn?.removeItem(un.MemoryFullBannerDismissed)}};function Dm(t){const s=Ce(t),o=Ra(),{data:a}=Ia(s,!1,o),n=a!=null,r=n&&a.memoryFullPct>=100,[l,c]=i.useState(!1);i.useEffect(()=>{!r&&n&&(c(!0),mr.clearDismissedBanner())},[r,n]);const d=_n(h=>h.memoryFullBannerDismissed);return r&&l&&!d}function Bm(){const t=ve(),{openSettings:s}=Tl();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Pa,{title:t.formatMessage(ws.memoryFullTitle),content:t.formatMessage(ws.memoryFullTooltip,ws.memoryFullTooltip.values),primaryCtaText:t.formatMessage(ws.memoryManageButton),onPrimaryCtaClick:()=>s(_l.Personalization),onDismiss:()=>mr.dismissBanner()})})}const ws=Ve({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:kl,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Fm=()=>{const{shouldShowSkipButton:t}=Da();return t?e.jsx(ur,{className:"flex justify-center",children:e.jsx(Tt,{as:"button",color:"secondary",onClick:()=>Al.skipParagen(),children:e.jsx(P,{...Lm.skip})})}):null},Lm=Ve({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),Hm=De(()=>Be(()=>import("./cd0tm93keko1hti4.js"),__vite__mapDeps([28,2,4,1,3,5,29,30,31])).then(t=>t.JawboneNotificationsBanner)),hr=i.memo(function({className:s}){const{store:o}=Se(),a=o.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:D(s??"absolute bottom-full left-0 right-0",La.PromptTextareaHeader),children:e.jsx(Nl,{shouldRender:a,contentArea:Mt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(gr,{}),e.jsx(pr,{})]})})})});function gr(){const{store:t}=Se(),s=t.useSharedProps(r=>r?.clientThreadId),o=t.useContentAreaId(Mt.HeaderTop),a=Ba();let n;switch(o){case $.ProjectConversationAutoChangeModel:n=e.jsx(Wm,{});break;case $.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(Ll,{clientThreadId:s});break;case $.ParagenControls:n=e.jsx(Fm,{});break;case $.ItemActions:n=e.jsx(_m,{});break;case $.BannerSignup:n=e.jsx(zm,{});break;case $.BannerTermsDisclaimer:n=e.jsx(Vm,{});break;case $.PromptTextareaAction:n=e.jsx(qm,{});break;case $.BannersRateLimit:n=e.jsx($m,{});break;case $.BannerSidekickAnnouncement:n=e.jsx(Fl,{});break;case $.SearchBrowserExtensionAnnouncement:n=e.jsx(Bl,{});break;case $.MemoryInSearchAnnouncement:n=e.jsx(Dl,{});break;case $.MoonshineAnnouncement:n=e.jsx(Pl,{});break;case $.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(Il,{});break;case $.BannerMemoryFull:n=e.jsx(Bm,{});break;case $.Box:n=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case $.JawboneAnnouncement:a?n=e.jsx(Hm,{}):n=null;break;case $.JawboneMaxActiveAnnouncement:a?n=e.jsx(Rl,{}):n=null;break;default:if(o==="CaterpillarDoneAnnouncement"){n=s&&e.jsx(El,{clientThreadId:s});break}n=null;break}return n}function pr(){const{store:t}=Se(),s=t.useContentAreaId(Mt.HeaderBottom);let o;switch(s){case Fa.DallePromptControls:o=e.jsx(Um,{});break;default:o=null;break}return o}const Om=De(()=>Be(()=>import("./nbui16zd89j1b3kp.js"),__vite__mapDeps([32,2,1,3,4,5,33])).then(t=>t.default));function Um(){const{store:t}=Se(),s=t.useSharedProps(o=>o?.composerController);return s?e.jsx(Om,{composerController:s}):null}function zm(){const{store:t}=Se(),s=t.useSharedProps(n=>n?.clientThreadId),o=Hl(),a=Ol();return s?o?e.jsx(Ul,{threadId:s,showSignUp:a}):e.jsx(zl,{threadId:s,showLogin:a}):null}function Gm({clientThreadId:t}){const s=kt(t);return e.jsx(Pa,{icon:e.jsx(ka,{}),content:e.jsx(P,{id:"IJzX01",defaultMessage:"The model {modelName} does not support project files or instructions. Your conversation will continue with GPT-4o.",values:{modelName:s?.title}})})}function Wm(){const{store:t}=Se(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(Gm,{clientThreadId:s}):null}function Vm(){const{store:t}=Se(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(Gl,{threadId:s}):null}function qm(){const{store:t}=Se(),s=t.useSharedProps();return s?e.jsx(Nm,{...s}):null}function $m(){const{store:t}=Se(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(Im,{clientThreadId:s}):null}const Ym=i.memo(function(s){return Km(s),Xm(s),Jm(),null});function Km(t){const{store:s}=Se(),o=s.useSetSharedProps();mn(()=>{o(t)},[t,o])}function Xm(t){const{clientThreadId:s,canContinue:o}=t,{store:a}=Se(),n=i.useRef({top:a.useContentAreaApi(Mt.HeaderTop),bottom:a.useContentAreaApi(Mt.HeaderBottom)}).current,r=eh(t),l=Wl(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:d}=th(s),h=Pm(s),u=Vl(t),m=ql(t),g=Ha(),b=Oa(),f=$l(t),x=Dm(s),S=Yl(),v=Kl(t),j=Xl(s),C=Jl(s),w=Ql(s),y=Re(s,z=>z?.modelId),A=zs(s);mn(()=>{y&&A?.kind===Oe.GizmoInteraction&&A.gizmo&&sc(y,A.gizmo)?n.top.set($.ProjectConversationAutoChangeModel):v.eligible?n.top.set($.AdvancedVoiceOnMobileAnnouncement):S?n.top.set($.ParagenControls):d?n.top.set($.BannerTermsDisclaimer):h?n.top.set($.BannersRateLimit):C?n.top.set($.JawboneAnnouncement):w?n.top.set($.JawboneMaxActiveAnnouncement):u.eligible?n.top.set($.BannerSidekickAnnouncement):g?n.top.set($.MemoryInSearchAnnouncement):b?n.top.set($.MoonshineAnnouncement):m?n.top.set($.SearchBrowserExtensionAnnouncement):f?n.top.set($.SearchBrowserExtensionReactiveAnnouncement):r?n.top.set($.ItemActions):o?n.top.set($.PromptTextareaAction):c?n.top.set($.BannerSignup):x?n.top.set($.BannerMemoryFull):j?n.top.set("CaterpillarDoneAnnouncement"):n.top.set(null)},[n,r,o,d,c,h,u,x,S,v]),mn(()=>{l&&n.bottom.set(Fa.DallePromptControls)},[n,l])}function Jm(){const{store:t}=Se();i.useEffect(()=>()=>{t.reset()},[t])}function Qm(t){const s=Ua(),o=_t(t),a=Q.getTree(t).getLastValidNode(o)?.message?.id;return s?.messageId===a?s.suggestions:[]}function Zm(t){return Qm(t).length>0}function eh(t){const s=Zl(t.clientThreadId),o=Zm(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||o}function th(t){const{isUnauthenticated:s}=Ue(),o=_t(t),{layer:a}=ks("3637408529"),n=a.get("should_show_no_auth_signup_banner",!0),r=ec(g=>g.bannerDisclaimerClientThreadId),l=tc(),c={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return c;const d=Q.getTree(t),h=d.countMessagesByAuthor(Ie.User),u=d.getNodeByIdOrMessageId(o),m=u?.message?.author.role===Ie.Assistant&&ni(u.message);return c.shouldShowBannerTermsDisclaimer=m&&s&&h===1&&!l&&(r==null||r===t),c.shouldShowBannerSignup=n&&m&&s&&h>0&&h%5===0,c}function fr(){const t=am(),{value:s}=Me("3162708430"),{value:o}=Me("869080118"),{config:a}=oi("933762510"),n=a.get("user_context_message_search_tools_default",!0),l=s&&(o||!n)&&t.data?.includes("browser");return{userIsInSearchHoldoutWithWebDisabled:t.isLoading?!0:l}}function Zn(t){let s=Xt(t);const o=nc(),a=kt(t),n=i.useMemo(()=>!o.isSuccess||!o.data?[]:o.data,[o.data,o.isSuccess]),r=Ta({clientThreadId:t}),{userIsInSearchHoldoutWithWebDisabled:l}=fr();return i.useMemo(()=>{const d=new Set(a.enabledTools||[]);return n.filter(h=>!(h.requiredFeatures.length===0||h.requiredFeatures.every(b=>d.has(b)))||h.systemHint==="search"&&l||!(h.requiredModels.length===0||h.requiredModels.some(b=>!r[b]))||!(h.requiredConversationModes.length===0||h.requiredConversationModes.some(b=>b===s?.kind))?!1:h.systemHint==="contextual_answers"?h.requiredModels?.includes(a.id):!0)},[n,a,r,s?.kind,l])}const sh=({disabled:t,clientThreadId:s})=>{const o={clientThreadId:s},a=Ce(s),n=Hn(),r=Xn(s,n),{isLoading:l,data:c}=Xe(),d=Re(s,f=>f?.modelId),h=Es(c?.models,d);if(l||a||!h)return null;const m=c?.categories.find(f=>f.defaultModel===h.id)?.shortLabel??h.title;function g(){Y.logEventWithStatsig(K.composerSystemHintButtonHovered,"composer_model_selector_button_hovered",o)}function b(){Y.logEventWithStatsig(K.composerSystemHintButtonClicked,"composer_model_selector_button_clicked",o)}return e.jsx(nh,{disabled:t,modelLabel:m,onHover:g,onOpen:b,children:e.jsx(Jn,{sections:r})})},nh=({disabled:t,children:s,modelLabel:o,onHover:a,onOpen:n})=>{const r=ve(),[l,c]=i.useState(!1);return e.jsxs(Z.Root,{open:l,onOpenChange:d=>{c(d),d&&n?.()},children:[e.jsx(oh,{disabled:!!t,children:e.jsx(En,{className:D(za.toolsButton,"flex h-8 min-w-8 items-center justify-center gap-1 rounded-lg p-1 px-2 text-sm font-semibold hover:bg-black/10 focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white"),"aria-label":r.formatMessage({id:"njhg2P",defaultMessage:"Choose a model"}),disabled:t,onPointerOver:a,onClick:d=>{d.preventDefault()},onFocusCapture:d=>{d.stopPropagation()},children:o})}),e.jsx(Z.Portal,{children:e.jsx(Z.Content,{alignOffset:-16,onCloseAutoFocus:d=>{d.preventDefault()},children:e.jsx("div",{className:"flex max-h-[60dvh] flex-col",children:s})})})]})},oh=({disabled:t,children:s})=>e.jsx(Kt,{side:"right",sideOffset:0,label:t?e.jsx(P,{id:"WU1XH1",defaultMessage:"Model selector unavailable"}):e.jsx(P,{id:"7bVJwH",defaultMessage:"Choose a model"}),children:s});function ah({composerController:t,isDisabled:s,highlightTooltip:o,clientThreadId:a}){const{setThreadSearchMode:n}=Ws(),r=es(),l=qi(),[c,d]=i.useState(!1),h=ve(),u={clientThreadId:a};return e.jsx(ih,{highlightTooltip:o,analyticsMetadata:u,isThreadUsingSearchMode:r,isDisabled:s,children:e.jsxs("button",{className:D("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",c&&"transition-all duration-150",r||o?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":s?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":r,"aria-label":h.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>d(!1),onClick:m=>{m.stopPropagation(),m.preventDefault(),d(!0),Y.logEventWithStatsig(K.composerSearchButtonClicked,"composer_search_button_clicked",u),n(!r,u,yt.CONVERSATION_COMPOSER_WEB_ICON),r||(t.trimLeadingText(/^search\b/i),t.removeSystemHints(),t.focus())},children:[e.jsx(Ga,{}),e.jsx(Qt,{children:r&&e.jsx(ne.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:l?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2",children:e.jsx(P,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function rh(){const t=Ha(),s=Oa(),o=Gn(Ct.hasSeenComposerSearchButtonTooltip);return!o.isLoading&&o.eligible&&!t&&!s}function ih({children:t,highlightTooltip:s,analyticsMetadata:o,isThreadUsingSearchMode:a,isDisabled:n}){const r=rh()&&!a,l=Gn(Ct.hasSeenComposerSearchButtonTooltip);return r?e.jsx(Wa,{announcementKey:Ct.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(P,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:l.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(P,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(oc,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(P,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Kt,{sideOffset:0,label:n?e.jsx(P,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(P,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(a?!1:void 0),onOpenChange:c=>{c&&Y.logEventWithStatsig(K.composerSearchButtonHovered,"composer_search_button_hovered",o)},children:t})})}function lh({composerController:t,clientThreadId:s}){const o=Jt(s),a=es(),{setThreadSearchMode:n}=Ws(),r=Zn(s),[l,c]=i.useState([]),[d,h]=i.useState(void 0),[u,m]=i.useState(0);i.useEffect(()=>{c(d?r.filter(y=>y.name.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())||y.systemHint.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())):[])},[d]),i.useEffect(()=>{t.view.dispatch(tm(t.view.state.tr,{onHintMatch(y){h(A=>ca(A,y)?A:y)}}))},[t]);const g=!r.length||!l.length||!d;i.useEffect(()=>{g&&m(0)},[g]);const b=l.length,f=i.useCallback(y=>{m(A=>(y(A)%b+b)%b)},[b]),x=l[u],S=({hintToSave:y=x,expectPerfectMatch:A})=>{if(!d||!x||A&&y.name.toLowerCase()!==d.text.toLowerCase())return!1;Y.logEvent(K.systemHintSelected,{system_hint:y.systemHint,conversation_id:o??bo});const z=d.range.from===1?y.name:d.text+y.name.slice(d.text.length),R={clientThreadId:s};return ys(t.view),y.systemHint===Yt.Search?(n(!0,R,yt.CONVERSATION_COMPOSER_SLASH_SEARCH),d.range&&t.delete(d.range.from,d.range.to),t.removeSystemHints(),!0):(a&&n(!1,R,yt.CONVERSATION_COMPOSER_SLASH_SEARCH),t.addSystemHint(y.systemHint,z,d.range.from,d.range.to),!0)},v=i.useRef(S);v.current=S;const j=i.useRef(f);j.current=f;const C=i.useRef(d);C.current=d;const w=t.view;return i.useEffect(()=>(g||sm(w,y=>{if(y==="up")j.current(A=>A-1);else if(y==="down")j.current(A=>A+1);else if(y==="cancel")ys(w),nm(w);else{if(y==="submit")return ys(w),v.current({expectPerfectMatch:!1});if(y==="checkMatch")return v.current({expectPerfectMatch:!0})}}),()=>ys(w)),[g,w]),i.useEffect(()=>{g||Y.logEvent(K.systemHintListOpened,{conversation_id:o??bo})},[g]),g?null:e.jsx(ai,{className:"max-w-60",onMouseDown:y=>{y.preventDefault()},children:l.map((y,A)=>e.jsx("div",{onMouseOver:()=>m(A),onClick:()=>{S({hintToSave:y,expectPerfectMatch:!1}),t.focus()},children:e.jsx(ri,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:A===u,children:e.jsx(xr,{title:y.name,description:y.description,logo:y.logo})})},y.systemHint))})}function xr({title:t,description:s,logo:o,checked:a}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(ac,{svgString:o,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:s})]}),a&&e.jsx(ii,{className:D("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function ch({composerController:t,clientThreadId:s}){return t instanceof Yn?e.jsx(lh,{composerController:t,clientThreadId:s}):null}function dh({children:t,className:s,showBackground:o}){return e.jsxs("div",{className:"relative",children:[t,o&&e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:D("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function uh({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,getInputProps:r,openFileDialog:l,onOauthRedirect:c,historyDisabled:d,isDisabled:h,highlightTooltip:u}){const m=rc(),{gdriveStatus:g,o365Status:b}=ic(),f=e.jsx(dc,{className:d?"text-white":u?"text-brand-blue-800":void 0}),x=g!=="false"||b!=="false"||m;return e.jsx("div",{className:"relative",children:e.jsx(dh,{showBackground:u,className:"bg-brand-blue-800/20",children:x?e.jsx(lc,{clientThreadId:t,icon:f,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,onOauthRedirect:c,uploadType:s,openFileDialog:l,getInputProps:r,isDisabled:h,highlightTooltip:u}):e.jsx(cc,{clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,icon:f,isDisabled:h,highlightTooltip:u})})})}function mh({suggestions:t,composerController:s,onSelect:o,onChange:a}){const n=zn(),r=i.useCallback((u,m,g)=>{o?.(u,m,g),n(u,m,g)},[o,n]),[l,c]=i.useState(-1),[d,h]=i.useState(!1);return i.useEffect(()=>{const u=m=>{if(m.key==="ArrowDown"){const g=l===t.length-1?0:l+1;c(g),a?.(g,!0,t[g])}else if(m.key==="ArrowUp"){m.preventDefault();const g=l<=0?t.length-1:l-1;c(g),a?.(g,!0,t[g])}else m.key==="Enter"&&!m.shiftKey&&t[l]&&r(t[l],t,l)};return s.subscribe("keydown",u)},[t,l,a,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{c(-1),a?.(-1,!1)}),[s,a]),i.useEffect(()=>{if(!d){const u=()=>{h(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[d]),i.useEffect(()=>{c(-1),a?.(-1,!1),h(!1)},[t,a]),e.jsx(ne.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((u,m)=>e.jsxs(ne.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:m*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[m>0&&e.jsx("div",{className:D("h-[1px] opacity-60 max-lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:D("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===m?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),r(u,t,m)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{d&&(c(m),a?.(m,!1,u))},onMouseLeave:()=>{c(-1),a?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:u.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((g,b)=>e.jsx("span",{className:D(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},b))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:D(u.type===Rs.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),m>0&&e.jsx("div",{className:D("h-[1px] opacity-60 lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},u.id??m))})}function hh(t,s){t=t.toLocaleLowerCase();const o=s;s=s.toLocaleLowerCase();const a=[];let n=0;for(let c=0;c<s.length&&(n<t.length&&t[n]===s[c]&&(a.push(c),n++),n!==t.length);c++);const r=[];let l=0;if(a.forEach(c=>{if(c>l){const d=o.slice(l,c);d&&r.push({text:d,isMatched:!1})}r.push({text:o[c],isMatched:!0}),l=c+1}),l<s.length){const c=o.slice(l);c&&r.push({text:c,isMatched:!1})}return gh(r)}function gh(t){if(t.length===0)return t;let s=[t[0]];for(let a=1;a<t.length;a++){const n=s[s.length-1],r=t[a];n.isMatched===r.isMatched?n.text+=r.text:s.push(r)}const o=s.filter(a=>a.isMatched).reduce((a,n)=>a+n.text.trim().length,0);return s.length<=4&&o>=2?s:[{text:s.map(a=>a.text).join(""),isMatched:!1}]}const ph=i.forwardRef(function({type:s,placeholder:o,replyRegions:a,state:n,renderFiles:r,leftSideActions:l,topRightAction:c,onSubmit:d,inputState:h,currentLeafId:u,composerController:m,clientThreadId:g,gizmoId:b,disableReason:f},x){const S=Pe(),v=uc();let j=null;const{isLoading:C}=v;C||(j=v.modelId),i.useEffect(()=>{C||li()||m.focus()},[j,m,C]);const w=y=>{yh({target:y.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||m.focus()};return e.jsxs("div",{id:"composer-background",ref:x,className:D("flex w-full cursor-text flex-col rounded-3xl px-2.5 py-1 transition-colors contain-inline-size",S&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",S&&s!=="temporary"&&"bg-token-composer-surface",!S&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:w,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsx(Qt,{initial:!1,children:a.length>0&&e.jsx(ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(xh,{replyRegions:a})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-2",children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:m instanceof Va?e.jsx(fh,{composerController:m,currentLeafId:u,placeholder:o,inputState:h}):e.jsx(om,{composerController:m,placeholder:o})}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1 text-token-text-primary",children:l}),e.jsxs("div",{className:"flex gap-x-1",children:[!1,e.jsx(mc,{inputState:h,state:n,onSubmit:d,composerController:m,clientThreadId:g,gizmoId:b,disableReason:f})]})]})]})]})});function fh({composerController:t,currentLeafId:s,placeholder:o,inputState:a}){const n=i.useContext(ci);return e.jsxs(e.Fragment,{children:[e.jsx(hc,{id:gc,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof Va))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:o,disabled:a!=="default",className:D("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",a==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function xh({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,o)=>{switch(s.type){case"text":return e.jsx(vh,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"object":return e.jsx(Sh,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"mention":case"system_hint":return e.jsx(bh,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},o)}})})}function vh({value:t,onRemoveRegion:s}){return e.jsxs(to,{className:"text-token-text-secondary",children:[e.jsx(so,{children:e.jsx(qa,{className:"icon-lg-heavy"})}),e.jsx(no,{children:`“${t}”`}),e.jsx(eo,{onClick:s})]})}function Sh({value:t,onRemoveRegion:s}){return e.jsxs(to,{className:"text-blue-selection",children:[e.jsx(so,{children:e.jsx(qa,{className:"icon-lg-heavy"})}),e.jsx(no,{className:"font-semibold",children:t}),e.jsx(eo,{onClick:s})]})}function bh({value:t,icon:s,onRemoveRegion:o}){return e.jsxs(to,{children:[e.jsx(so,{className:"mt-0",children:s}),e.jsx(no,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(eo,{onClick:o})]})}function eo({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(pc,{className:"icon-lg"})})}const to=he.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,so=he.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,no=he.span`flex-1 line-clamp-3 py-0.5`;function yh({target:t,rootId:s,additonalInteractiveIds:o}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||o.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const jh=({composerController:t,disabled:s,clientThreadId:o})=>{const a=es(),{setThreadSearchMode:n}=Ws(),r=Zn(o),l=t.useState(x=>x.getSystemHints()[0]),c=a?Yt.Search:l,[d,h]=i.useState(!1);if(i.useEffect(()=>{const x=Math.random(),S=setInterval(()=>{const v=new Date,j=v.getHours()+v.getMinutes()/60+v.getSeconds()/3600,C=Math.abs((6+j)%12-6)/6;h(Math.pow(C,15)>x)},1e3);return()=>clearInterval(S)},[]),!(t instanceof Yn))return null;const u=t,m={clientThreadId:o};function g(){Y.logEventWithStatsig(K.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",m)}function b(){Y.logEventWithStatsig(K.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",m)}function f(x,S){if(x.systemHint===Yt.Search){n(S,m,yt.CONVERSATION_COMPOSER_TOOL_MENU),u.removeSystemHints(),setTimeout(()=>{u.focus()},0);return}S?(a&&n(!1,m,yt.CONVERSATION_COMPOSER_TOOL_MENU),u.addSystemHint(x.systemHint,x.name),setTimeout(()=>{u.focus()},0)):u.removeSystemHints()}return e.jsx(wh,{systemHints:r,selectedHint:c,showJack:d,disabled:s,onHover:g,onOpen:b,onSelect:f})},wh=({systemHints:t,selectedHint:s,showJack:o,disabled:a,onHover:n,onOpen:r,onSelect:l})=>{const c=ve(),[d,h]=i.useState(!1);return e.jsxs(Z.Root,{open:d,onOpenChange:u=>{h(u),u&&r?.()},children:[e.jsx(Mh,{disabled:!!a,children:e.jsx(En,{className:D(za.toolsButton,"flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold hover:bg-black/10 focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white"),"data-opened":Lo(d),"data-jack":Lo(!!o),"aria-label":c.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:a,onPointerOver:n,onClick:u=>{u.preventDefault()},onFocusCapture:u=>{u.stopPropagation()},children:e.jsx(fc,{className:"pointer-events-none"})})}),e.jsx(Z.Portal,{children:e.jsx(Z.Content,{alignOffset:-16,onCloseAutoFocus:u=>{u.preventDefault()},children:t.map(u=>e.jsx(Z.Item,{className:"px-1 py-2",onClick:()=>l?.(u,u.systemHint!==s),children:e.jsx(xr,{title:u.name,description:u.description,logo:u.logo,checked:u.systemHint===s})},u.systemHint))})})]})},Mh=({disabled:t,children:s})=>{const o=Gn(Ct.hasSeenComposerSystemHintButtonTooltip);return!t&&!o.isLoading&&o.eligible?e.jsx(Wa,{announcementKey:Ct.hasSeenComposerSystemHintButtonTooltip,show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(P,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(P,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."}),children:s}):e.jsx(Kt,{side:"right",sideOffset:0,label:t?e.jsx(P,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(P,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function Lo(t){return t?"":null}const Ch=1,Th=3e3;function _h({files:t,className:s}){const o=As(),a=$a(),n=td();return e.jsxs("div",{className:s,children:[n.map(r=>e.jsx(sd,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(nd,{borderRadius:"2xl",useV2Style:!0,width:o?"normal":"wide",onRemoveFileClick:()=>Sn.remove(a,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===od.Uploading?r.progress:void 0},r.tempId))]})}function kh({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:o,currentModelId:a,clientThreadId:n,isNewThread:r,isCompletionInProgress:l,className:c,disabled:d=!1,disabledReason:h,canPause:u=!1,canContinue:m=!1,suggestions:g,isInteractableSharedThread:b,composerContainerRef:f,autocompletions:x,requiresFileUpload:S,onComposerInput:v,onComposerChange:j,onAutocompleteSelect:C,headerClassName:w,hideHeader:y,setComposerBarElement:A,onTaggingDropdownOpen:z,onTaggingDropdownClose:R}){const H=i.useRef(null),N=ad(H,A),{data:I}=Fs(),{data:E}=Xe(),p=Vs(),_=Wn(),F=di(I),{isUnauthenticated:L}=Ue(),U=ve(),T=da(),B=$a(),q=_t(n),ee=Os(n),[X]=wa(),{value:re}=Me("1358499025"),ie=Bn(),{gizmoEditorData:se,mode:we,getGizmoId:be}=xc(),Te=ua(),Fe=ui(),le=it(),O=Ya(),k=Jt(n),te=!!mi(),oe=!!Rn(),[ce,ae]=i.useState({}),{setThreadSearchMode:ge,clearSearchModeTrigger:J,getSearchModeTrigger:V}=Ws(),de=es(),[ye,ze]=i.useState(!1),[Ne,Le]=i.useState(!1),ct=Pe(),Je=i.useRef(!1),pe=Es(E?.models,a),At=Re(n,M=>M?.overrideModelId);let G=zs(n),Ge=G&&"gizmo"in G?G.gizmo:void 0;const dt=Zt(Ge?.gizmo.id),Nt=vc(),Et=Sc();let Rt;Ge?.gizmo.id&&(dt?Rt=To.PROJECT:Rt=To.GPT);const[fe,ut]=i.useState(null);fe!==null&&(G={gizmo:fe,gizmo_id:fe.gizmo.id,kind:Oe.GizmoInteraction},Ge=fe);const Qe=_o(pe,G);let ts=!1;bc(G)&&Ge?.gizmo.id===yc&&(ts=!0);const qs=hi(),ss=!d&&!ts&&Qe!==ko.None&&!L,Ze=jc(pe,G),ns=wc(pe,G);let _e=Ao(M=>M.files);const[It]=i.useState(()=>Mc());we==="magic"?_e=_e.filter(M=>M.gizmoId!=null):_e=_e.filter(M=>M.gizmoId==null);const os=Cc(),We=_e.length>0||os,mt=Ao(rd.hasUploadInProgress),Pt=p.useState(M=>{const ue=Tc(M);return typeof pe?.maxTokens=="number"&&ue>pe.maxTokens}),qe=p.useState(M=>!M.isEmpty()),ht=!Pt&&!mt&&(qe||We);Ka(_e.length>0||mt||qe);const et=(Qe===ko.Multimodal?_c:kc)-_e.length,gt=et<=0,Ee=ht&&!d&&!l&&!oe,[pt,$s]=i.useState(!1),as=a??Xa(I,E).id,Dt=Es(E?.models,as),rs=No(Dt,yo.Search),{userIsInSearchHoldoutWithWebDisabled:Bt}=fr(),is=!d&&!Ge&&Te?.includes(Ts.SearchTool)&&!Te?.includes(Ts.SearchToolHoldout)&&!Bt&&(Te?.includes(Ts.BrowsingAvailable)||!F?.isEnterprisey()),tt=is&&rs,{targetedContent:ls,setTargetedContent:Ft}=Ja(),ke=ls?.isFocusedViewContent&&!O?void 0:ls,{rebaseSystemMessageContent:cs}=Vn();i.useEffect(()=>{if(!_?.id)return;const M=Eo.getAndReset(_?.id,k);M&&p.setText(M.inputText)},[_?.id,k,p]),i.useEffect(()=>{const M=X.get("prompt")??"";p.getCurrentText().length===0&&M.length>0&&p.setText(M)},[p,X]),i.useEffect(()=>{pt!==Ee&&($s(Ee),Ee&&gi(!0).then(M=>{Ac.startEnforcement(M),pi.startEnforcement(M)}))},[Ee,pt,G?.kind,Te]);const Lt=Nc(pe,G),{handleFileAccepted:Ys}=Ec(U,_o(pe,G),Ze,"mouse",be,Lt?.attachments),{getInputProps:Ks,open:Xs}=Rc({disabled:d||!ss||gt,noClick:!0,onDropAccepted:Ys,onDropRejected:M=>Ic(M,U,T,Qe),multiple:!0,maxSize:Pc,maxFiles:et,...Dc(ns)}),ds=fi(It),us=i.useCallback(()=>{p.eraseContent(),ds.clearMessages(),p.resize(Ch),Q.clearOverrideModelId(n),Bc();for(const M of _e)Sn.remove(B,M.tempId,"none");Fc.markAllAsSent()},[p,ds,_e,B,n]),ft=async(M,ue)=>{if(M?.preventDefault(),d||!ht&&!ue||!G||jt.isLoading(n)!==!1)return;const Ae=new Gs({gizmoType:Rt});ze(!0),Nt?.(),Et?.();const je=p.getContentToSend(),nt=id(je.content),tn=`${q}-nextPrompt`,zt=new ld(_a.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:qr,attachments:mo}=cd(B,nt,pe,G),ho=[],sn=[];cs&&sn.push(Si(cs));const nn={...G};"gizmo"in nn&&delete nn.gizmo;let ps=p.getSystemHints();de&&(ps=[Yt.Search]);const go=V(),$r=de?go??yt.CONVERSATION_COMPOSER_WEB_ICON:void 0,po=dd(),fo=ud();let Gt={promptId:tn,content:qr,eventMetadata:{eventSource:M?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:nn,systemHints:ps,searchSource:$r},messageMetadata:{...mo.length>0&&{attachments:mo},...fe&&{gizmo_id:fe?.gizmo.id},...ce,...ps.length>0&&{system_hints:ps},...!!je.metadata&&{serialization_metadata:je.metadata},...po.length>0&&{canvas:{user_created_textdocs:po.map(Wt=>({user_created_temp_textdoc_id:Wt.tempTextdocId,type:Wt.type,title:Wt.title,content:Wt.content,create_source:Wt.create_source}))}},...Object.keys(fo).length>0&&{__internal:{search_settings:fo}}},prependMessages:ho.length>0?ho:void 0,appendMessages:sn.length>0?sn:void 0,turnTracker:Ae,profiler:zt,requestedModelId:At};Gt=md(Gt),ke?.createNewCompletionParams&&(Gt=await ke.createNewCompletionParams(Gt)),zt.logTiming("request_params_ready"),await s(Gt),ke?.onCreateCompletion?.({serverThreadId:k,currentLeafId:q}),ke?.shouldPersistAcrossMessages!==!0&&Ft(void 0),Is.hideThreadHeader(),us(),ze(!1),zt.logTiming("prompt_submitted"),g!==void 0&&(xe.logEvent("chatgpt_prompt_ignore_suggestions"),Y.logEvent(K.promptIgnoreSuggestions)),de&&go&&J()},Js=i.useRef(ft);i.useEffect(()=>{Js.current=ft});const W=M=>{Ft(M.targetedReply),M.targetedReply&&(p.focus(),Y.logEvent(K.targetedReplyButtonClicked,{conversationId:k,sourceMessageId:M.messageId}))},me=i.useCallback(()=>{ke?.onCleared?.({serverThreadId:k,currentLeafId:q}),Ft(void 0),p.focus()},[q,k,ke,Ft,p]),$e={Enter:{validator:M=>{const ue=M.isComposing||M.keyCode===229;return!(Ne&&Je.current)&&(M.metaKey||(Fe||bi)&&!M.shiftKey&&!ue)},handler:M=>{if(!Ee){Pt&&T.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}M.preventDefault(),ft()}},Escape:{validator:M=>!M.isComposing,handler:M=>{u&&l&&(t("",ee),Y.logEvent(K.pauseCompletion,{threadId:Q.getServerThreadId(n),currentLeafId:Q.getTree(n).getMessageId(q),eventSource:"keyboard"})),M.target.value===""&&me()}}},st=i.useRef($e);st.current=$e;const xt=Lc(Dt?.tags,G?.kind),[Qs,ms]=i.useState(!1),[Zs,ao]=i.useState(!1),Ht=xt&&Qs&&!dt,ro=p.isReady();i.useEffect(()=>p.subscribe("keydown",M=>{p.acceptLegacyKeydown()&&st.current[M.key]?.validator(M)&&st.current[M.key].handler(M);const Ae=p.getCurrentText();if(M.key==="@"){const je=p.getSelectionStart(),nt=Ae.substring(0,je);(!nt||/\s$/.test(nt)||je===0)&&setTimeout(()=>ms(!0),10)}else Qs&&ms(!1);if(M.key==="Escape"&&(ut(null),Le(!1)),tt&&!de){let je;M.key==="Backspace"?je=Ae.substring(0,Ae.length-1):je=Ae+M.key,/^search\s?$/i.test(je)?ao(!0):Zs&&ao(!1)}de&&M.key==="Escape"&&ge(!1,{clientThreadId:n})}),[p,ro,Qs,Zs,tt,de,ge,n]),i.useEffect(()=>{const M=Object.fromEntries(Object.keys(st.current).map(ue=>[ue,je=>{const nt=st.current[ue];if(!nt||p.acceptLegacyKeydown())return!1;const{validator:tn,handler:zt}=nt;return tn(je)?(zt(je),!0):!1}]));p.registerKeyHandlers(M)},[p,ro]),i.useEffect(()=>p.subscribe("paste",M=>{Hc({filePickerStore:B,event:M,intl:U,toaster:T,clientThreadId:n,conversationMode:G,currentModelConfig:pe,getEditorGizmoId:be,modelSupportedImageMimeTypes:Ze})}),[U,n,G,pe,be,Ze,p,T,B]);const wr=M=>{te||ut(M),p.trimLeadingText("@"),vn(),ms(!1)},Mr=Oc(n,It,Ze,Lt?.attachments),Cr=i.useCallback(M=>{M?.preventDefault(),t("",ee),Y.logEvent(K.pauseCompletion,{threadId:Q.getServerThreadId(n),currentLeafId:Q.getTree(n).getMessageId(q),eventSource:"mouse"}),vn()},[t,n,ee,q]),io=i.useCallback(()=>{Eo.set(_?.id,k,p.getCurrentText())},[k,_?.id,p]);i.useEffect(()=>{se||!ye&&!xi()&&p.focus()},[ye,p]),i.useEffect(()=>{se||Sn.reset(B)},[a,B,se]),i.useEffect(()=>{(!xt&&fe||te)&&ut(null)},[xt,fe,te]);const[lo,Tr]=(()=>{switch(h){case"workspaceDisallowsGizmo":return[He.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[He.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[He.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[He.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[He.loading,!0];case"noTestGizmoId":return[He.noTestGizmoId,!0];default:return b?[He.placeholderWithName,!1]:ke?.placeholderTextOverride!=null?[ke.placeholderTextOverride,!1]:[He.placeholderWithName,!1]}})(),_r=dt?r?U.formatMessage(fn.newChatInProject):U.formatMessage(lo,{name:"ChatGPT"}):U.formatMessage(lo,{name:se!=null?we==="magic"?Uc:se.name||"GPT":Ge?.gizmo.display.name??"ChatGPT"});i.useEffect(()=>p.subscribe("input",()=>{On.getState().isThreadHeaderVisible&&Is.hideThreadHeader(),Le(!0)}),[p]),i.useEffect(()=>{if(v)return p.subscribe("input",()=>{v?.()})},[p,v]),i.useEffect(()=>{if(j)return p.subscribe("change",()=>{j?.()})},[p,j]),i.useEffect(()=>p.subscribe("focus",()=>{Le(!0)}),[p]);const kr=Zn(n).length>0,Ar=G?.kind===Oe.PrimaryAssistant||G?.kind===Oe.GizmoInteraction&&dt,hs=kr&&Ar,Nr=As(),Er=hs&&!Nr,Rr={clientThreadId:n,uploadType:Qe,modelAcceptedMimeTypes:ns,modelSupportedImageMimeTypes:Ze,attachmentsProductFeature:Lt?.attachments,getInputProps:Ks,openFileDialog:Xs,historyDisabled:le,onOauthRedirect:io,highlightTooltip:S&&!We},Ot=[],Ir=!d&&!gt&&(ss||qs!=null)&&!de;Ot.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(uh,{...Rr,isDisabled:!Ir})},"file-upload-button")),Er&&Ot.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(jh,{composerController:p,clientThreadId:n,disabled:!hs})},"system-hint-button")),is&&Ot.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},children:e.jsx(ah,{composerController:p,highlightTooltip:Zs,clientThreadId:n,isDisabled:!tt||We})},"search-button")),re&&Ot.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-model-selector)"},children:e.jsx(sh,{clientThreadId:n})},"model-selector-button"));const Pr=We&&e.jsxs(e.Fragment,{children:[we==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(P,{...He.gizmoKnowledgeWarning})}),e.jsx(_h,{files:_e,className:"flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),Dr=Tr?"disabled":"default",Br=l&&u,Fr=vi(),Lr=!Ee||ye||Fr,Hr=hd(mt,qe,Pt),gs=Br?"streaming":Lr?"disabled":"idle",Ut=i.useRef(null),vt=i.useRef(null),Or=a&&a.startsWith("o1");i.useEffect(()=>{const M=()=>{Ut.current!=null&&hn.addAction("composer_state_disabled",{threadId:Q.getServerThreadId(n),disabledReason:Ut.current})};if(ht&&gs==="disabled"){let ue="unknown";d?ue=h??"component_disabled_unknown":l?ue="completion_in_progress":oe?ue="thread_hard_blocked":ye&&(ue="starting_new_completion_request"),Ut.current!==ue&&(vt.current&&clearTimeout(vt.current),vt.current=setTimeout(M,Th)),Ut.current=ue}else Ut.current=null;return()=>{vt.current&&(clearTimeout(vt.current),vt.current=null)}},[n,ht,gs,d,h,l,oe,ye]);const en=[];if(ke?.label&&en.push({type:ke.type,value:ke.label,onRemoveRegion:me}),fe!==null){const M=!!fe.gizmo.tags?.includes(Un.FirstParty);en.push({type:"mention",value:fe.gizmo.display.name,icon:e.jsx(zc,{isFirstParty:M,src:fe.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{ut(null),p.focus()}})}i.useEffect(()=>{(!x||x.length===0||!Ne)&&(Je.current=!1)},[x,Ne]);const Ur=(M,ue,Ae)=>{Je.current=M>=0,ue&&p.setText(Ae?`${Ae.title}${Ae.body}`:"")},co=Ne&&x&&x.length>0&&!Ht&&!p.hasMultipleLines()&&p.canShowAutocompletion();i.useEffect(()=>{Ht?z?.():R?.()},[Ht,z,R]);const uo=gs==="streaming"?Cr:ft,zr=No(Dt,yo.Canvas),{value:Gr}=ma("61299031"),Wr=As(),Vr=zr&&Gr&&!os&&!Wr;return e.jsxs(Gc.Provider,{value:It,children:[e.jsx(Wc,{onOauthRedirect:io,children:e.jsx("form",{className:c,onSubmit:uo,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!y&&!ct&&e.jsx(hr,{className:w}),e.jsxs("div",{ref:f,className:"group relative flex w-full items-center",children:[r&&X.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{ie("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Vc,{className:"icon-lg"})}),e.jsxs(qc,{open:Ht||hs||re,children:[e.jsx($c,{className:"w-full",children:e.jsx(ph,{type:le?"temporary":"default",ref:N,replyRegions:en,placeholder:_r,inputState:Dr,composerController:p,leftSideActions:Ot,topRightAction:Vr&&e.jsx(Yc,{composerRef:H,composerController:p,clientThreadId:n}),state:gs,onSubmit:uo,renderFiles:Pr,currentLeafId:q,clientThreadId:n,gizmoId:Ge?.gizmo.id,disableReason:Hr,modelId:as})}),e.jsx(Kc,{children:e.jsxs(Xc,{side:"bottom",align:"start",sideOffset:12,children:[Ht&&e.jsx(Jc,{onClick:M=>wr(M),onClose:()=>{ms(!1),p.focus()}}),hs&&e.jsx(ch,{composerController:p,clientThreadId:n})]})})]}),co&&e.jsx("div",{className:"absolute left-0 z-10 box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(mh,{suggestions:x,composerController:p,onSelect:C,onChange:Ur})})]}),e.jsx(Qc,{composerController:p,parsedDocumentHandler:Mr})]})})}),e.jsx(Ym,{canUseInlineTagging:xt,isDisabled:d,clientThreadId:n,currentLeafId:q,currentRequestId:ee,canContinue:m,composerController:p,setPromptInputMetadata:ae,suggestions:g,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:o,onResetState:us,conversationMode:G,isShowingAutocomplete:!!co}),G!=null&&!Or&&Zc.includes(G.kind)&&e.jsx(ed,{clientThreadId:n,onTargetedReply:W})]})}function Ah(t){const s=t.message?.author.role===Ie.User,o=t.metadata?.err!=null&&t.metadata?.errCode!==wo.ContentPolicy,a=t.metadata?.errCode===wo.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:s||o}function Nh(t){return e.jsx(lr,{clientThreadId:t.clientThreadId,children:e.jsx(Eh,{...t})})}function Eh({clientThreadId:t,isNewThread:s,currentModelId:o,showPromptStarters:a,noWrap:n,onRequestCompletion:r,composerContainerRef:l}){const c=Vs(),d=Nn(),h=Pn(),u=Us(g=>{const b=jt.getCurrentNode(t,g);return Ah(b)});if(Za(c),!h&&u)return e.jsx(Rh,{clientThreadId:t});const m=e.jsx(e.Fragment,{children:e.jsx(vr,{composerContainerRef:l,clientThreadId:t,currentModelId:o,isNewThread:s,showPromptStarters:a,onRequestCompletion:r})});return n?m:e.jsxs(e.Fragment,{children:[e.jsx(jm,{clientThreadId:t}),e.jsx(qn,{clientThreadId:t,isStaticSharedThread:d,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx(Ps,{children:m})})]})}function Rh({clientThreadId:t}){const s=vd(t),o=Us(r=>jt.getCurrentNode(t,r).metadata?.errCode===Sd),a=bd(r=>r.isoDate),n=_t(t);return o&&a!=null&&a!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs","data-has-thread-error":!0,children:e.jsx(P,{...Ho.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(Tt,{as:"button",color:"primary",onClick:()=>{const r=new Gs;xe.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,Vt({clientThreadId:t})),s({id:n,eventMetadata:{eventSource:"mouse"},conversationMode:jt.getConversationMode(t),turnTracker:r})},className:"m-auto",icon:Ea,"data-testid":"regenerate-thread-error-button",children:e.jsx(P,{...Ho.regenerateResponse})})})]})}function vr({clientThreadId:t,currentModelId:s,isNewThread:o,onRequestCompletion:a,showPromptStarters:n,composerContainerRef:r,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:h,onAutocompleteSelect:u,headerClassName:m,hideHeader:g,onTaggingDropdownClose:b,onTaggingDropdownOpen:f}){const{data:x}=Xe(),S=_t(t),v=Os(t),j=bn(),{isUnauthenticated:C}=Ue(),y=ha(t)===ga.STREAMING,A=pa({clientThreadId:t,conversationLeafId:S}),z=rt(v),R=yi({clientThreadId:t}),H=!C,N=ji(),{isOpen:I,onClose:E}=gd({type:"just-hit-rate-limit"}),p=i.useCallback((J,V)=>{Y.logEvent(K.continueCompletion),a({type:jo.Continue,promptId:J,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:jt.getConversationMode(t)},turnTracker:V})},[a,t]),_=Ma(),F=i.useCallback(async(J,V)=>pd({clientThreadId:t,currentRequestId:V,isHistoryAndTrainingDisabled:N,queryClient:_}),[t,N,_]),L=i.useCallback(async({promptId:J,content:V,eventMetadata:de,completionMetadata:ye,messageMetadata:ze,prependMessages:Ne,appendMessages:Le,turnTracker:ct,profiler:Je,requestedModelId:pe})=>{const At=Q.getThreadCurrentLeafId(t);Q.updateTree(t,G=>{G.addNode(J,V,At,Ie.User,void 0,ze)}),await a({type:jo.Next,promptId:J,eventMetadata:de,cancelActiveRequests:!0,completionMetadata:ye,prependMessages:Ne,appendMessages:Le,turnTracker:ct,profiler:Je,...pe?{requestedModelId:pe}:{}})},[t,a]),U=Re(t,J=>J?.tree.getHasErrorFromNode(S)??!1),T=Re(t,J=>J?.tree.isMessageIncomplete(S)??!1),B=!A&&(z||y),q=i.useMemo(()=>B?!1:!U&&T,[U,T,B]),ee=B,X=Bs(t),re=Ce(t),ie=lt(re).data,{promptStarters:se,isSuccess:we}=Qa(o&&!X,t,4),be=Ua(),Te=(()=>{if(be?.messageId===Q.getTree(t).getLastValidNode(S)?.message?.id)return be?.suggestions;if(n&&!X&&we&&!H)return se})(),Fe=wi(),le=(()=>{if(ie?.gizmo.tags?.includes(Un.WorkspaceDisabled)&&!Fe)return"workspaceDisallowsGizmo";if(x?.models.size===0)return"noModelsAvailable";if(j.displayingSideBySideFeedback&&j.unskippable)return"feedbackRequired";const V=jt.getConversationMode(t);return V?.kind===Oe.GizmoTest&&V.gizmo_id==null?"noTestGizmoId":null})(),O=fa(t),k=Xt(t),te=ma("15117983")?.value,oe=$i(),ce=In(),ae=oe.action==="moderate",{value:ge}=Me("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center",children:ce&&ae&&ge?e.jsx(fd,{}):null}),I?e.jsx(xd,{onClose:E}):null,te&&k&&k.kind===Oe.PrimaryAssistant&&k.plugin_ids&&k.plugin_ids.length>0?e.jsx(Ih,{}):e.jsx(kh,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:L,onAbortCompletion:F,onContinueGenerating:p,currentModelId:s,isNewThread:o,isCompletionInProgress:R,className:"w-full",canContinue:q,suggestions:Te??[],disabled:!!le,disabledReason:le??void 0,canPause:ee,isInteractableSharedThread:O,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:h,onAutocompleteSelect:u,headerClassName:m,hideHeader:g,onTaggingDropdownClose:b,onTaggingDropdownOpen:f},t)]})}function Ih(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const Ho=Ve({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),Sr=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${La.PromptTextareaHeader}`,children:[e.jsx(gr,{}),e.jsx(pr,{})]})}),Pg=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:Sr},Symbol.toStringTag,{value:"Module"})),Oo=De(()=>Be(()=>import("./le2nrmn696pq5622.js"),__vite__mapDeps([34,2,4,1,3,5,30,35,36,23,17,37,38,39,40])).then(t=>t.SnorlaxSplashScreen)),rn=4;function Ph(){const{layer:t}=ks("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),o=Wn();return!!o&&o.created*1e3>=new Date(s).getTime()}const ln=t=>`${t.title}${t.body}`.toLocaleLowerCase();function Dh(t){const s=Ce(t.clientThreadId),o=Zt(s);return e.jsx(lr,{clientThreadId:t.clientThreadId,children:o&&s&&Oo?e.jsx(Oo,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(Hh,{...t})})}function Bh({children:t}){const{store:s}=Se(),[o,a]=i.useState(!1),n=Vs();i.useEffect(()=>n.subscribe("focus",()=>{a(!0)}),[n]),i.useEffect(()=>n.subscribe("blur",()=>{a(!1)}),[n]);const l=!!s.useSharedProps()?.isShowingAutocomplete;return t(l&&o)}function Fh({isSendBlocked:t,clientThreadId:s,headlineOption:o,shouldShowStarterPrompts:a,promptChips:n,onSelectStarterPrompt:r,starterPromptExpanded:l,setStarterPromptExpanded:c}){const d=xa();return e.jsx(Bh,{children:h=>e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:h?0:1},exit:{opacity:0},transition:{duration:.1},className:D("justify-center",h?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary [display:var(--display-hidden-until-loaded,flex)]",d?"@lg/thread:hidden":"lg:hidden"),children:[o==="CHATGPT_LOGO"?e.jsx(Hs,{className:"inline-block h-12 w-12"}):e.jsx(br,{headlineOption:o}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:D(!l&&"h-[116px]"),children:a&&e.jsx(yr,{starterPrompts:n,onSelectStarterPrompt:r,disabled:t,clientThreadId:s,onExpand:()=>c(!0),mobileLayout:!0})})]})})}function Lh(t){const s=Me("1468311859").value,o=Me("3664702598").value,{layer:a}=Ls("4031588851"),n=Ph(),r=s,l=o&&n;let c="HARDCODED";if(t){const d=a.get("search_autocomplete_mode","");r&&d&&(c=d)}else l&&(c=a.get("autocomplete_mode","HARDCODED"));return c}function Hh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,chatgptHomepageDisclaimer:n}){const r=Vs(),l=bt(t),c=Bs(t),d=Rn(),[h,u]=i.useState([]),m=i.useCallback(O=>{u(k=>{const te=typeof O=="function"?O(k):O;return ca(te,k)?k:te})},[]),{trendingSuggestions:g,fetchTrendingSuggestions:b}=Gh(rn),f=i.useRef(!1),{isUnauthenticated:x}=Ue(),S=Mi(),[v,j]=i.useState(!1),C=es(),w=Pe();Za(r);const y=Me("589604007").value,{layer:A}=ks("4031588851"),{layer:z}=ks("3533083032"),{promptStarters:R,isSuccess:H}=Qa(l&&!c&&o,t,8,y,!0,s??void 0),N=S&&!!h.find(O=>!!O.requires_file_upload),I=i.useCallback(O=>{const k=r.getCurrentText();return k&&ln(O).startsWith(k.toLocaleLowerCase())},[r]),E=i.useCallback(O=>{const k=r.getCurrentText(),te=O.title+O.body;return I(O)?{...O,title:k,body:te.slice(k.length)}:{...O,title:te,body:""}},[r,I]),p=i.useCallback((O=!1)=>{m(k=>!k.some(I)&&k.length>0?[]:O?k:k.map(E))},[I,E,m]),_=(O,k,te)=>{const oe=O.title;m([]),r.focus(),r.setText(oe),requestAnimationFrame(()=>{const ce=(R?.filter(ae=>ae.theme===O.theme)??[]).map(ae=>{const ge=St(ae.oneliner),J=ge.startsWith(ae.title);return{...ae,title:J?`${ae.title} `:"",body:J?ae.body:ge,autocompletionChunks:hh(oe,ge),type:Rs.Autocomplete}});m(ce),ce.length>0&&$t(ce,t),wd(O,te,t)})};i.useEffect(()=>{const O=h.some(k=>k.theme===yn.Search);C&&r.getCurrentText()===""?g.length>0?m(g):b():O&&!C&&m(k=>k.filter(te=>te.theme!==yn.Search))},[h,C,g,b,r,m]);const F=R?.reduce((O,k)=>(k.theme&&!O[k.theme]&&(O[k.theme]=k),O),{}),L=[];if(F)for(const O in F)L.push(F[O]);const U=L&&L.length>0,T=!!(H&&U&&o),B=rn-h.filter(I).length,q=Lh(C),ee=x?z.get("headline_option","HELP_WITH"):A.get("headline_option","HELP_WITH"),X=A.get("autocomplete_min_char",4),re=A.get("autocomplete_fetch_interval",200),ie=i.useRef(null),se=i.useCallback(er(async O=>{const k=r.getCurrentText();if(!k||k.length<X||k.length>80||r.hasMultipleLines()){m([]);return}if(!f.current&&!(ie.current&&ie.current.length>X&&k.startsWith(ie.current)))try{const te=await wt.generateAutocompletions(k,O,C);if(te.completions.length===0){ie.current=k;return}const oe=te.completions.map(ce=>({id:Yi(),type:Rs.Autocomplete,title:ce.slice(0,k.length),body:ce.slice(k.length),oneliner:ce,prompt:ce,source:q})).filter(I).map(E);m(ce=>{const ae=ce.filter(I),ge=oe.filter(J=>{const V=ln(J);return!ae.some(de=>{const ye=ln(de);if(V===ye)return!0;const ze=/[\p{P}\p{S}]$/u,Ne=V.replace(ze,""),Le=ye.replace(ze,"");return Ne===ye||V===Le||Ne===Le})}).slice(0,rn-ae.length);return[...ae,...ge]}),oe.length>0&&$t(oe,t)}catch{}},q==="BING"?150:re),[r,q,E,re]),we=i.useCallback(()=>{p(),B>0&&se(B)},[se,p,B]);i.useEffect(()=>{f.current&&m([])},[f,m]);const be=i.useMemo(()=>q==="HARDCODED"?p:we,[q,we,p]),Te=i.useCallback(()=>{r instanceof Yn&&p(!0),r.getCurrentText().indexOf(`
`)>0&&m([])},[r,m,p]),Fe=i.useCallback((O,k,te)=>{k.forEach(oe=>{oe.id===O.id&&(oe.userInput=r.getCurrentText())}),m([k[te]])},[r,m]),le=xa();return e.jsx(e.Fragment,{children:e.jsx(Qt,{children:e.jsx("div",{className:D("h-full w-full",le?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(qn,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs(Ro,{children:[e.jsx("div",{className:D("mb-7 hidden text-center",le?"@lg/thread:block":"lg:block"),children:ee==="CHATGPT_LOGO"?e.jsx(Hs,{className:"inline-block h-12 w-12"}):e.jsx(br,{headlineOption:ee})}),e.jsx(Fh,{headlineOption:ee,shouldShowStarterPrompts:T,promptChips:L,onSelectStarterPrompt:_,starterPromptExpanded:v,setStarterPromptExpanded:j,isSendBlocked:d,clientThreadId:t}),e.jsx("div",{className:D(le?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"[display:var(--display-hidden-until-loaded,block)] lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Ro,{className:"@lg/thread:pb-0",children:w?e.jsx(Sr,{}):e.jsx(hr,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(vr,{clientThreadId:t,isNewThread:l,currentModelId:s,onRequestCompletion:a,showPromptStarters:!1,autocompletions:h,requiresFileUpload:N,onComposerInput:be,onComposerChange:Te,onAutocompleteSelect:Fe,onTaggingDropdownClose:()=>{f.current=!1},onTaggingDropdownOpen:()=>{f.current=!0},hideHeader:!0})}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:D("hidden",le?"@lg/thread:block":"lg:block",n&&x&&v?"":"h-[70px]"),children:T&&e.jsx(yr,{starterPrompts:L,onSelectStarterPrompt:_,disabled:d,clientThreadId:t,onExpand:()=>j(!0)})}),n&&e.jsx("div",{className:D("w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",le?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:D("min-h-4",w&&"keyboard-open:hidden"),children:n})})]})})})})})}function br({headlineOption:t}){const o=ve().formatMessage(Wh[t]||qt.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:o})})}function Oh({starterPrompt:t,starterPrompts:s,index:o,disabled:a,onSelectStarterPrompt:n}){const r=t.theme??t.title,l=zn(),{mutate:c}=Md(),d=t.category==="onboarding"?()=>{c({key:Ct.hasUsedConversationalOnboardingStarterPrompt}),l(t,s,o)}:()=>n(t,s,o);return e.jsx(tr,{disabled:a,onClick:d,icon:e.jsx(Cd,{category:t.category,useV2Colors:!0}),label:r})}function Uo({clientThreadId:t,onClick:s}){i.useEffect(()=>{Td(t)},[t]);const o=ve();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(tr,{onClick:()=>{_d(t),s()},label:o.formatMessage(qt.moreStarterPrompts)})})}const Uh=5,zh=3;function yr({starterPrompts:t,onSelectStarterPrompt:s,disabled:o,clientThreadId:a,onExpand:n,mobileLayout:r=!1}){const l=r?zh:Uh,[c,d]=i.useState(l),[h,u]=i.useState(!1),m=i.useRef(null),g=t.length<=c;i.useEffect(()=>{$t(t.slice(0,l),a)},[a]),i.useEffect(()=>{if(!h&&!g&&m.current){const f=m.current,x=f.getBoundingClientRect(),S=x.width,v=Array.from(f.children);let j=0;for(let C=0;C<v.length&&v[C].getBoundingClientRect().right-x.left<=S;C++)j++;d(j),u(!0)}},[t,g,h]);const b=()=>{const f=t.slice(c,t.length).map(x=>({...x,isAdditional:!0}));f.length>0&&$t(f,a),d(t.length),n()};return e.jsxs("div",{className:D("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",h&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:D("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",g||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:m,children:[t.slice(0,c).map((f,x)=>e.jsx(ne.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Oh,{starterPrompt:f,starterPrompts:t,index:x,disabled:o,onSelectStarterPrompt:s})},f.id??x)),r&&t.length>c&&e.jsx(Uo,{clientThreadId:a,onClick:b})]}),!r&&t.length>c&&e.jsx(Uo,{clientThreadId:a,onClick:b})]})}const Gh=t=>{const[s,o]=i.useState([]),a=i.useCallback(async()=>{const r=(await wt.generateTrendingSuggestions(t)).suggestions.map((l,c)=>({type:Rs.Starter,title:zo(l),body:"",icon:e.jsx(yd,{}),prompt:zo(l),id:`starter-${c}`,theme:yn.Search}));o(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:a}};function zo(t){return t.split(" ").map(jd).join(" ")}const qt=Ve({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Wh={HELP_WITH:qt.whatCanIHelpWith,WHERE_TO_START:qt.whereShouldWeStart,ASK_CHATGPT:qt.askChatgptAnything};function Vh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,showChatgptHomepage:n,chatgptHomepageDisclaimer:r}){const l=it();let c=e.jsx(Ju,{}),d;return l?(d=e.jsx(qh,{}),c=e.jsx(Hs,{className:"mb-6 h-12 w-12"})):t!=null?(d=n?e.jsx(Dh,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,chatgptHomepageDisclaimer:r}):e.jsx(Qu,{clientThreadId:t}),c=null):d=e.jsx($h,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[c,d]})}function qh({gizmo:t}){const s=Ad(),o=t?Nd(t.tools):!1,a=An();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Ed,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(P,{...at.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(P,{...a?.isWorkspaceAccount()?s?at.temporaryChatBizMemoryAvailable:at.temporaryChatBizMemoryUnavailable:s?at.temporaryChatDescriptionMemoryAvailable:at.temporaryChatDescriptionMemoryUnavailable}),o&&e.jsx("div",{className:"mt-3",children:e.jsx(P,{...at.temporaryChatDescriptionGptActions,values:{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:n})}})})]})]})}function $h(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(P,{...at.howCanIHelpYouToday})})}function Yh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,showChatgptHomepage:n,chatgptHomepageDisclaimer:r}){const l=Ce(t),c=Ci(),d=Rn(),{data:h}=lt(l),u=kd(),m=Ti(()=>navigator.windowControlsOverlay);return(c!=null||l!=null)&&h==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:m?.visible?D("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",u?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(dr,{clientThreadId:t})}),h!=null?e.jsx(Xu,{gizmo:h,showStarterPrompts:!0,disableStarterPrompts:d}):e.jsx(Vh,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,showChatgptHomepage:n,chatgptHomepageDisclaimer:r})]})}const at=Ve({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Kh({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:o,isRegenerateEnabled:a,isHovered:n,animateShortLabel:r}){const{data:l}=Xe(),[c,d]=i.useState("initial");i.useEffect(()=>{if(s){const g=setTimeout(()=>d("show"),500),b=setTimeout(()=>d("initial"),2e3);return()=>{clearTimeout(g),clearTimeout(b)}}d("initial")},[s]);const{shorterLabel:h}=l?.categories.find(({defaultModel:g})=>g===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},m=o?"visible":n?"show":c;return e.jsxs(ne.div,{initial:"initial",animate:m,className:"flex items-center pb-0",children:[e.jsx(sr,{className:"icon-md"}),(a||r)&&e.jsx(ne.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:u,transition:{type:"tween",duration:.18},children:h}),a&&e.jsx(Ln,{className:"icon-sm"})]})}function kn(t,s){const{modelSwitcherDeny:o,subscriptionLevel:a}=t;return!!o&&o.reason===ki.RATE_LIMIT&&a===Ai.PLUS&&!s}const Ms="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Xh({className:t,clientThreadId:s,message:o,onModelSelect:a,onDropdownChange:n,canRegenerateResponse:r}){const[l,c]=i.useState(null),[d,h]=i.useState(!1),[u,m]=i.useState(!1),g=Ce(s),b=Rd({clientThreadId:s,message:o}),f=o.message.metadata?.model_slug,x=o.message.id,{modelOptions:S,modelSlug:v,animateModelLabelOnRender:j,messageModelEnabledTools:C}=b,w=Id(o.message),y=C.includes(Yt.Search),A=i.useMemo(()=>S.find(p=>p.value===f),[S,f]),z=i.useRef(null),{data:R=null}=Fs(),H=R&&ia(R),N=p=>{p||setTimeout(()=>{z.current&&z.current.blur()},10)};if(i.useEffect(()=>{N(d)},[d]),_i(s))return null;const E=r&&S.some(p=>kn(p,H));return g?null:e.jsxs(Z.Root,{onOpenChange:p=>{r&&(h(p),n(p),N(p)),p&&Y.logEvent(K.conversationOpenMessageModelSelector,{has_get_plus_button:E,is_new_regen_dropdown:!0})},children:[r?e.jsx(Qh,{label:e.jsx(P,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(En,{ref:z,className:D("cursor-pointer",t),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:e.jsx(Kh,{modelSlug:v,animateModelLabelOnRender:j,isDropdownOpen:d,isRegenerateEnabled:r,isHovered:u})})}):null,r&&e.jsx(Z.Portal,{children:e.jsxs(Z.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(Z.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(P,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Jh,{clientThreadId:s,messageId:x,onModelSelect:a,messageModelSlug:f,modelOptions:S,setHoveredOption:c,hoveredOption:l,retryOption:A,lastResponseUsedSearch:w,modelSupportsSearch:y,doesUserHaveAnyAccountsWithPlusFeatures:H})]})})]})}function Jh({clientThreadId:t,messageId:s,modelOptions:o,messageModelSlug:a,onModelSelect:n,setHoveredOption:r,hoveredOption:l,retryOption:c,lastResponseUsedSearch:d,modelSupportsSearch:h,doesUserHaveAnyAccountsWithPlusFeatures:u}){const m=ve(),[g,b]=i.useMemo(()=>Pd(o,v=>v.subcategory),[o]),f=i.useMemo(()=>{const v=new Map;return g.forEach(j=>{const C=j.subcategory;C&&(v.has(C)||v.set(C,[]),v.get(C)?.push(j))}),v},[g]),x=D("icon-sm","order-10 ml-auto text-token-text-tertiary icon-md"),S=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:m.formatMessage(cn.search),icon:e.jsx(Ga,{className:x}),condition:h&&!d,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:m.formatMessage(cn.nosearch),icon:e.jsx(Dd,{className:x}),condition:h&&d,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[b.map(v=>{const{value:j,...C}=v;return e.jsx(Ss,{value:j,onSelect:()=>{xe.logEvent("chatgpt_regenerate_switch_model_button_clicked",j,{requestedModelId:j,...Vt({clientThreadId:t,messageId:s})}),n({requestedModelId:j})},includeRegenerate:!1,onMouseEnter:()=>r(j),onMouseLeave:()=>r(null),isHovered:l===j,messageModelSlug:a,includeCheck:!1,shouldShowUpsell:kn(v,u),className:Ms,...C,icon:e.jsx("span",{className:x})},j)}),[...f.entries()].map(([v,j])=>e.jsxs(Z.Sub,{children:[e.jsx(Z.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:v})}),e.jsx(Z.Portal,{children:e.jsx(Z.SubContent,{className:"min-w-fit",children:j.map(C=>{const{value:w,...y}=C;return e.jsx(Ss,{value:w,onSelect:()=>{xe.logEvent("chatgpt_regenerate_switch_model_button_clicked",w,{requestedModelId:w,...Vt({clientThreadId:t,messageId:s})}),n({requestedModelId:w})},includeRegenerate:!1,onMouseEnter:()=>r(w),onMouseLeave:()=>r(null),isHovered:l===w,messageModelSlug:a,includeCheck:!1,className:Ms,...y,icon:null,shouldShowUpsell:kn(C,u)},v+"-"+w)})})})]},v)),!!c&&e.jsxs(e.Fragment,{children:[e.jsx(Z.Separator,{}),e.jsx(Ss,{onSelect:()=>{xe.logEvent("chatgpt_regenerate_try_again_button_clicked",c.value,{requestedModelId:c.value,...Vt({clientThreadId:t,messageId:s})}),n({requestedModelId:c.value})},includeRegenerate:!0,onMouseEnter:()=>r(c.value),onMouseLeave:()=>r(null),messageModelSlug:a,includeCheck:!1,className:Ms,...c,label:m.formatMessage(cn.tryAgain),subtitle:c.label,icon:e.jsx(sr,{className:x})},c.value),S.filter(v=>v.condition).map(v=>e.jsx(Ss,{onSelect:()=>{xe.logEvent(v.eventName,c.value,{requestedModelId:c.value,...Vt({clientThreadId:t,messageId:s})}),n({requestedModelId:c.value,extraStreamParams:v.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(v.key),onMouseLeave:()=>r(null),isHovered:l===v.key,messageModelSlug:a,includeCheck:!1,className:Ms,...c,label:v.label,subtitle:"",icon:v.icon},v.key))]})]})}function Qh({children:t,label:s}){return e.jsx(Kt,{label:s,sideOffset:0,children:t})}const cn=Ve({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Zh=i.memo(Xh),Go=De(()=>Be(()=>import("./jg63sxiyqeyvfv9f.js").then(t=>t.r4),__vite__mapDeps([4,1,2,3,5])).then(t=>t.MemoryActionResult));function Wo(t,s,o){Q.updateTree(t,a=>{a.updateNodeMetadata(s,{inlineComparisonRating:o})})}function Vo(t){return{is_dark_mode:t,time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const qo=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:o}=s??{};if(o)return o}};function eg(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),o=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(jr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o,...t}):e.jsx(tg,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o})}function tg(t){const{clientThreadId:s,variantIds:o,variantsInStreamInfo:a,turnIndex:n,firstVisibleTokenTimestampsRef:r}=t;if(o.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const l=oo(),c=ng(),d=Pn(),h=Ni(),[u,m]=i.useMemo(()=>nr(o.join(""))()<.5?[0,1]:[1,0],[o[0],o[1]]),g=u<m?"left":"right",b=g==="left"?"right":"left",f=o[u],x=o[m],S=St(Re(s,N=>N?.tree.getLeafFromNode(f))).id,v=St(Re(s,N=>N?.tree.getLeafFromNode(x))).id,j=St(gn(s,n,S)),C=St(gn(s,n,v)),w=g==="left"?j:C,y=g==="left"?C:j,A=a.display_treatment==="unskippable",z=l?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(bn.setState({displayingSideBySideFeedback:!0,unskippable:A}),()=>{bn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[A]),Bd();const R=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>Ei(Ri,{requestCompletion:()=>{const N=Ke(w.messages)?.completionSampleFinishTime,I=Ke(y.messages)?.completionSampleFinishTime,E=Q.getServerThreadId(s);if(c){const _=Q.getTree(s).getParentPromptNode(S),F=[j,C].map((T,B)=>({messageId:T.messages[T.messages.length-1].message.id,loadFirstTokenTime:B===0?r.current.left:r.current.right,loadEndTime:Ke(T.messages)?.completionSampleFinishTime})),L={},U=_.metadata?.variantsInStreamInfo==null&&_.message.metadata?.paragen_variants_info!=null;for(const T of F)L[T.messageId]=U?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:T.loadFirstTokenTime,load_end_time:T.loadEndTime};Cs({shouldUseNewParagenEndpoint:c,params:{conversation_id:E,displayed_message_ids:F.map(T=>T.messageId),message_metadatas:L,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:_.message.id}})}else Cs({shouldUseNewParagenEndpoint:c,params:{feedback_version:z,original_message_id:w.messages[w.messages.length-1]?.message.id,new_message_id:y.messages[y.messages.length-1]?.message.id,conversation_id:E,completion_comparison_rating:"skip",new_completion_placement:b,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:N??0,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:I??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Vo(h),...R.current}})}}),[j,C,S,s,t.conversationTurnMountTime,z,b,w?.messages,y?.messages,h,c,l,r]);const H=N=>{const E=Q.getTree(s).getLeafFromNode(N);Q.setThreadCurrentLeafId(s,E.id);const p=N===f,_=p===(g==="left"),F=Ke(w.messages)?.completionSampleFinishTime,L=Ke(y.messages)?.completionSampleFinishTime;w.messages.length>0&&Wo(s,w.messages[w.messages.length-1].nodeId,_?"original":"new"),y.messages.length>0&&Wo(s,y.messages[y.messages.length-1].nodeId,_?"original":"new");let U;F==null||L==null?U=_?"partial_load_comparison_original":"partial_load_comparison_new":U=_?"original":"new";const T=Q.getServerThreadId(s);if(c){const B=[j,C].map((se,we)=>({messageId:se.messages[se.messages.length-1].message.id,loadFirstTokenTime:we===0?r.current.left:r.current.right,loadEndTime:Ke(se.messages)?.completionSampleFinishTime})),q=p?B[0].messageId:B[1].messageId,X=Q.getTree(s).getParentPromptNode(S),re={},ie=X.metadata?.variantsInStreamInfo==null&&X.message.metadata?.paragen_variants_info!=null;for(const se of B)re[se.messageId]=ie?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:se.loadFirstTokenTime,load_end_time:se.loadEndTime};Cs({shouldUseNewParagenEndpoint:c,params:{conversation_id:T,displayed_message_ids:B.map(se=>se.messageId),message_metadatas:re,rating:"selected",selected_message_id:q,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:X.message.id}})}else Cs({shouldUseNewParagenEndpoint:c,params:{feedback_version:z,original_message_id:w.messages[w.messages.length-1]?.message.id,new_message_id:y.messages[y.messages.length-1]?.message.id,conversation_id:T,completion_comparison_rating:U,new_completion_placement:b,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:F??null,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:L??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Vo(h),...R.current}})};return e.jsx(jr,{...t,setPreferredFeedback:H,leftVariantId:f,rightVariantId:x,leftTurn:j,rightTurn:C,hasActiveRequest:d,originalTurn:w,visibilityStateRef:R})}function sg(t){if(!t.length)return!1;const s=t.filter(o=>o.type===Io.Text||o.type===Io.MultiText).filter(o=>o.message.message.status!=="finished_successfully"&&o.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(o=>{const a=o.message.message.content;return a?.content_type===va.Text&&a.parts.join("")===""})}function jr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:o,leftTurn:a,rightTurn:n,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:h,shouldShowParagenLabels:u=!1}=Da(),m=a&&qo(a)||h,g=n&&qo(n)||h,b=i.useMemo(()=>a?.messages??[],[a?.messages]),f=i.useMemo(()=>n?.messages??[],[n?.messages]),{avatarClassName:x,firstVisibleTokenTimestampsRef:S}=d,v=i.useMemo(()=>Ds(b),[b]),j=i.useMemo(()=>Ds(f),[f]),C=Ra(),[w,y]=i.useMemo(()=>[v,j].map(B=>sg(B)),[v,j]),A=rt(a?Ns.getRequestIdFromConversationTurn(a):"")||w,z=rt(n?Ns.getRequestIdFromConversationTurn(n):"")||y,R=a?.role===Ie.User,H=n?.role===Ie.User,N=i.useRef(null),I=i.useRef(null),E=i.useRef(null),p=d.stubSideBySideFeedback||w,_=d.stubSideBySideFeedback||y;!p&&S.current.left==null&&(S.current.left=Date.now()),!_&&S.current.right==null&&(S.current.right=Date.now()),i.useEffect(()=>{if(N.current&&I.current&&E.current){const B=Array(11).fill(0).map((ee,X)=>X/10),q=new IntersectionObserver(ee=>ee.forEach(X=>{X.target===I.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=X.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,X.intersectionRatio)):X.target===E.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=X.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,X.intersectionRatio))}),{root:N.current,threshold:B});return q.observe(I.current),q.observe(E.current),()=>q.disconnect()}},[c]);const{data:F}=Ia(void 0,!1,C),L=oo(),U=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(P,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),T=Pe();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:D("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",T&&"top-[var(--thread-leading-height)] pt-3",!T&&"top-[-1px]",L&&!T?"md:top-header-height":T?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(P,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),L?U:null]}),L?null:U,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:N,children:e.jsx("div",{className:D(!T&&"min-w-fit"),children:e.jsxs("div",{className:D("mx-auto flex max-w-6xl items-start",L&&!T&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!L&&!T&&"gap-4 sm:gap-6",L&&T&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",T&&!L&&"gap-4 sm:gap-6"),children:[e.jsxs($o,{horizontalScrollContainerRef:N,rootElementRef:I,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:p,children:[e.jsxs(Xo,{children:[e.jsx(jn,{messages:b,isUserTurn:R,avatarClassName:x}),e.jsx(Ko,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:m}):e.jsx(P,{...Qo.responseNumber,values:{responseIndex:1}})})]}),L&&p?e.jsx(Yo,{}):e.jsxs(e.Fragment,{children:[F!=null&&!R&&e.jsx(Go,{clientThreadId:d.clientThreadId,messages:b,isParagen:!0}),e.jsx(wn,{...d,groupedMessagesToRender:v,allGroupedMessages:v,isEditing:!1,isUserTurn:R,isCompletionRequestInProgress:A,hasActiveRequest:r,handleEnterEdit:fs,handleExitEdit:fs,shouldGrowContainer:!1}),e.jsx(Jo,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:a,originalTurn:l})]})]}),e.jsxs($o,{horizontalScrollContainerRef:N,rootElementRef:E,onClick:()=>{t(o)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:_,children:[e.jsxs(Xo,{children:[e.jsx(jn,{messages:f,isUserTurn:H,avatarClassName:x}),e.jsx(Ko,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(P,{...Qo.responseNumber,values:{responseIndex:2}})})]}),L&&_?e.jsx(Yo,{}):e.jsxs(e.Fragment,{children:[F!=null&&!H&&e.jsx(Go,{clientThreadId:d.clientThreadId,messages:f,isParagen:!0}),e.jsx(wn,{...d,groupedMessagesToRender:j,allGroupedMessages:j,isEditing:!1,isUserTurn:H,isCompletionRequestInProgress:z,hasActiveRequest:r,handleEnterEdit:fs,handleExitEdit:fs,shouldGrowContainer:!1}),e.jsx(Jo,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:n,originalTurn:l})]})]})]})})})]})}function $o({horizontalScrollContainerRef:t,rootElementRef:s,onClick:o,children:a,hasActiveRequest:n,isWaitingOnFirstUserVisibleToken:r}){const l=oo(),c=Pe(),{scrollX:d}=Ki({layoutEffect:!1,container:t,target:s}),h=Fd(),u=Ld(),m=i.useRef(null),g=i.useRef(null),b=i.useRef(null),[f,x]=i.useState(!1),[S,v]=i.useState(!1),[j,C]=i.useState(!1),[w,y]=i.useState(0);i.useEffect(()=>{if(!l)return;const E=new IntersectionObserver(p=>{for(const _ of p)_.target===m.current?x(_.isIntersecting):_.target===b.current?C(_.isIntersecting):_.target===g.current&&v(_.isIntersecting)},{root:h?.current,rootMargin:c?`0px 0px -${w}px 0px`:void 0});return m.current&&g.current&&b.current&&(E.observe(m.current),E.observe(g.current),E.observe(b.current)),()=>{E.disconnect()}},[w,l,c,h]);const A=!j&&(S||f),z=Xi(d,E=>A?-1*E:0),R=Mo(0);i.useEffect(()=>{if(!l)return;const E=new ResizeObserver(p=>{bs(p.length===1,"entryList.length === 1");const _=p[0];bs(_.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),R.set(_.contentBoxSize[0].inlineSize)});return s.current&&E.observe(s.current),()=>{E.disconnect()}},[l,R,s]);const H=Mo(0);i.useEffect(()=>{if(!l)return;const E=new ResizeObserver(p=>{bs(p.length===1,"entryList.length === 1");const _=p[0];bs(_.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),H.set(_.contentBoxSize[0].blockSize+16),y(_.contentBoxSize[0].blockSize)});return u.current&&E.observe(u.current),()=>{E.disconnect()}},[l,H,u]);const N=e.jsx(Tt,{className:l?"px-5":"mt-4 self-start",onClick:o,"data-testid":"paragen-prefer-response-button",children:e.jsx(P,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),I=r;return e.jsxs("div",{"data-paragen-root":!0,className:D("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",c&&l&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!c&&l&&"px-10",l?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:D("absolute left-0 right-0 top-48 h-px","invisible"),ref:m}),e.jsx("div",{className:D("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),e.jsx("div",{className:D("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:b}),a,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:I?null:e.jsx(ne.div,{style:{translateX:z,width:R,bottom:H},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:D({fixed:A,"z-20 flex w-full justify-center":!0}),children:N})}):n?null:N]})}function Yo(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(ot,{className:"h-4 w-[75%]"}),e.jsx(ot,{className:"h-4 w-[50%]"}),e.jsx(ot,{className:"h-4 w-[80%]"}),e.jsx(ot,{className:"h-4 w-[55%]"}),e.jsx(ot,{className:"h-4 w-[66%]"}),e.jsx(ot,{className:"h-4 w-[64%]"}),e.jsx(ot,{className:"h-4 w-[48%]"})]})}function oo(){const{layer:t}=Ls("3119715334");return t.get("should-enable-hojicha",!1)}const Ko=he.div`text-sm text-token-text-secondary font-semibold`,Xo=he.div`flex gap-4 items-center mb-1`,ot=he.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function Jo({clientThreadId:t,conversationTurnMountTime:s,turn:o,originalTurn:a}){const n=Vn();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||o==null)return null;let r=o===a?"ORIGINAL":"NEW";const l=o.messages[o.messages.length-1],c=l?.message?.metadata?.__internal;if(c){const{model_id:m,model_definition_slug:g,model_definition_virtual_model_id:b,alternative_model_selection_rule:f,augmented_paragen_prompt_group_id:x,augmented_paragen_prompt_id:S,augmented_paragen_prompt:v}=c;m&&(r+=`
Model ID: ${m}`),g&&(r+=`
Model Slug: ${g}`),b&&(r+=`
Virtual Model ID: ${b}`),f&&(r+=`
Alternative Model Rule: ${f}`),x&&(r+=`
Prompt Group ID: ${x}`),S&&(r+=`
Prompt ID: ${S}`),v&&(r+=`
Prompt: ${v}`)}r+=`
Message ID: ${l.message.id}`;const h=Q.getTree(t).getParentPromptNode(o.variantIds[0]),u=h.metadata?.variantsInStreamInfo==null&&h.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${h.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${s} (persisted)`:Ke(o.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function Cs({shouldUseNewParagenEndpoint:t,params:s}){t?await wt.submitParagenSelectionV2(s):await wt.submitMessageComparisonFeedback(s)}function ng(){const{value:t}=Me("3894844102");return t}const Qo=Ve({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}});function og({handleShowRetrievalResults:t,clientThreadId:s,turnIndex:o,responseComplete:a=!1}){const n=Re(s,u=>Dn.getTurnContentReferences(u,o)),r=i.useMemo(()=>({turnIndex:o,clientThreadId:s,responseComplete:a}),[s,a,o]),l=i.useRef(!1);i.useEffect(()=>{l.current||(l.current=!0,Y.logEvent(K.fileSourcesFooterShown,r))},[r]);const c=i.useCallback(()=>{Y.logEvent(K.fileSourcesFooterClicked,r),t()},[t,r]),d=Re(s,u=>u?.conversationTurns[o]?.messages??[]),h=i.useMemo(()=>{const u=new Set,m=[];function g(f){!f||u.has(f)||(u.add(f),m.push(f))}if(n.forEach(f=>{f.type==="file"?g(f.cloud_doc_url??f.extra?.cloud_doc_url):f.type==="file_navlist"&&f.items.forEach(x=>{g(x.cloud_doc_url)})}),a){for(const f of d)if(Hd(f.message)){const x=Od(f.message.content.result),S=f.message.metadata?.cloud_doc_urls??[],v=x.chunks;for(let j=0;j<v.length;j++){const C=v[j];if(!C.documentId)continue;if(j<S.length){g(S[j]);continue}const w=C.documentId.endsWith("--google")?C.documentId.split("--")[1]:void 0,y=C.metadata.cloud_doc_url??(w?`https://drive.google.com/file/d/${w}`:void 0);g(y?.toString())}break}}const b=[];for(let f=0;f<m.length;f++){const x=m[f],S=Ud(x);if(S&&b.push(S.Icon),b.length>=3)break}return b},[d,n,a]);return e.jsxs(e.Fragment,{children:[e.jsx(ne.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:D("not-prose group/footnote mb-2 mt-3 flex w-fit items-center gap-1.5 rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 hover:bg-token-main-surface-secondary","pl-3 pr-2.5"),onClick:c,children:[e.jsx("div",{className:"flex items-center gap-0.5 text-sm font-medium",children:e.jsx(P,{id:"/48IOP",defaultMessage:"Sources"})}),h.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:h.reverse().map((u,m)=>e.jsx(ne.div,{className:D("flex items-center overflow-hidden rounded-full border-token-main-surface-primary bg-token-main-surface-primary","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-md"})},m))})]})}),e.jsx("div",{className:"h-[60px]"})]})}const Zo=[1,2,3,4,10,20,30],ag=.5;function rg({clientThreadId:t,conversationLeafId:s}){const o=or(ar.isBusinessWorkspace),a=i.useRef(!1),n=Jt(t),r=Xt(t),{isUnauthenticated:l}=Ue(),c=i.useMemo(()=>{if(!n)return-1;const H=nr(n);return H()>ag?-1:Zo[Math.floor(H()*Zo.length)]},[n]),d=Ii(t,s),h=d[d.length-1],u=i.useMemo(()=>Ns.getRequestIdFromConversationTurn(h),[h]),m=rt(u),[g,b]=i.useState(null),[f,x]=i.useState(!1),[S,v]=i.useState(!1),[j,C]=i.useState(!1),w=H=>{const N=Ke(d)?.messages[0]?.message.id;b(H),z(N,H)},y=d.filter(H=>H.role===Ie.Assistant).length,A=h?.role===Ie.Assistant,z=i.useMemo(()=>er((H,N)=>{n&&H&&wt.submitConversationRating({conversation_id:n,message_id:H,rating:N,shown_at_assistant_turn:c}),Y.logEvent(K.conversationRatingSubmitted,{rating:N,showAtAssistantTurn:c,conversationId:n}),x(!0),setTimeout(()=>{v(!0)},1500)},2e3),[n,c]),R=y!==c||m||!A||!!o||r?.kind!==Oe.PrimaryAssistant||j||l;return i.useEffect(()=>{!R&&!a.current&&(Y.logEvent(K.conversationRatingShown,{showAtAssistantTurn:c,conversationId:n}),a.current=!0)},[R]),j||R?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(Qt,{children:f&&!S&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(ea,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(P,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!f&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(ea,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(P,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(dn,{$selected:g==="thumbsUp",onClick:()=>w("thumbsUp"),children:e.jsx(rr,{className:"icon-md"})}),e.jsx(dn,{$selected:g==="thumbsDown",onClick:()=>w("thumbsDown"),children:e.jsx(ir,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(dn,{className:"p-3",$selected:!1,onClick:()=>C(!0),children:e.jsx(Pi,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const dn=he.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,ea=he.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,ig=De(()=>Be(()=>import("./i08snqhpy1q5wgpn.js"),__vite__mapDeps([41,2,1,3,4,5,42])));function lg({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:o,messageForRating:a,allGroupedMessages:n,currentModelId:r}){let l=null;const c=Us(g=>{const b=Dn.getCacheAwareConversationTurns(Sa(t,g),s);let f=0;for(let x=b.length-1;x>=0;x--){const S=b[x];if(S.messages.some(v=>v.message.metadata?.is_indepth_feedback))return!0;if(S.messages.some(v=>v.message.author.role===Ie.Assistant)&&f++,f>=3)break}return!1}),d=Jt(t),h=On(g=>g.voiceFeedbackThread),u=d===h,{voiceName:m}=zd();return c?null:(u&&d?(Di.feedbackShown.success({voice:m}),l=e.jsx("div",{className:"text-center",children:e.jsx(Gd,{serverThreadId:d})})):a.rating&&o?l=e.jsx(ig,{clientThreadId:t,conversationMessage:a,allGroupedMessages:n,currentModelId:r}):l=e.jsx("div",{className:"text-center",children:e.jsx(rg,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const cg=De(()=>Be(()=>import("./e0nx23jhoddiye0f.js"),__vite__mapDeps([43,2,1,3,44,45,4,5,46,47])).then(t=>t.VoicePlayButton)),dg=De(()=>Be(()=>import("./cugsqf18bce1nyqa.js"),__vite__mapDeps([48,2,4,1,3,5,49])).then(t=>t.AutomationSourceHeader)),ta=80,ug=16,sa={minHeight:"calc(100cqh - var(--thread-leading-height) - var(--thread-trailing-height) - var(--previous-turn-min-height))"};function mg(t){const{turnIndex:s,conversationLeafId:o,isFinalTurn:a,clientThreadId:n,onChangeItemInView:r,onChangeRating:l,currentModelId:c,avatarClassName:d,showAvatar:h=!0,scrollToMessageId:u,dateHeaderType:m}=t,g=ve(),b=Wn(),f=!!b&&Bi(b),x=Nn(),S=or(ar.isBusinessWorkspace),v=da(),{value:j}=Me("2848981774"),C=Q.getServerThreadId(n),w=St(gn(n,s,o)),{messages:y,variantIds:A,variantsInStreamInfo:z}=w,R=Ds(y),H=Wd();let N=y[y.length-1];for(const W of R){const me=im(W);if(me.some($e=>H.has($e.message.id))){N=me[me.length-1];break}}const I=y.slice(0,y.indexOf(N)+1),E=As(),[p,_]=i.useState(!1),[F,L]=i.useState(!1),U=A.findIndex(W=>I.some(me=>me.nodeId===W)),T=w.role===Ie.User,B=it(),q=Ce(n),ee=lt(w.gizmoId??q)?.data,X=Fn(c),re=Vd(c),ie=Pe(),se=Xt(n,ee?.gizmo.id),be=ha(n)===ga.STREAMING,Te=!1,Fe=I.some(W=>W.message.content.content_type===va.MultimodalText),{layer:le}=Ls("1547743984"),O=C&&E&&le.get("show_share_button_inline",!1),{isUnauthenticated:k}=Ue(),[te,oe]=i.useState(!1),[ce,ae]=i.useState(!1),ge=w.messages.map(W=>W.message.id),J=i.useRef(null),V=y[y.length-1],de=V.rating,ye=(u?.length??0)>2&&u!=="finalAgentTurn"&&a&&j&&ie,ze=()=>{I.length===1&&(Y.logEvent(K.editPrompt,{id:I[0].message.id,threadId:Q.getServerThreadId(n)}),xe.logEvent("chatgpt_edit_prompt"),_(!0))},Ne=i.useCallback(()=>{_(!1)},[]),Le=i.useCallback(W=>{qd(n,s,v,W)},[n,s,v]),ct=W=>{l({nodeId:V.nodeId,messageId:V.message.id,rating:W}),Y.logEvent(W==="thumbsDown"?K.messageFeedbackThumbsDownClicked:K.messageFeedbackThumbsUpClicked,{id:V.message.id,threadId:Q.getServerThreadId(n),model:c,rating:W}),L(!0)},[Je]=i.useState(()=>Date.now()),pe=i.useMemo(()=>Ns.getRequestIdFromConversationTurn(w),[w]),At=pa({clientThreadId:n,conversationLeafId:o}),G=rt(pe)&&!At,Ge=Pn(),dt=Ds(I),Nt=i.useRef(!1);$d(n),i.useEffect(()=>{if(Nt.current||u===void 0||!j||!ie||!J.current){u==="finalAgentTurn"&&a&&Nt.current&&Q.updateScrollToMessageId(n,void 0);return}(ge.includes(u)||u==="finalAgentTurn"&&a)&&(Nt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(J.current)if(u==="finalAgentTurn"&&a)J.current.scrollIntoView({behavior:"instant",block:"end"}),Q.updateScrollToMessageId(n,void 0);else{const W=J.current.offsetHeight;let me;W>ta?me=ta-W:me=0,J.current.style.scrollMarginTop=`calc(${me}px + ${ug}px + var(--thread-leading-height))`,J.current.scrollIntoView({behavior:"smooth"})}})}))},[u,J.current]);const Et=Dn.getCanvasToOpenId(Sa(n));i.useEffect(()=>{Et&&(Yd(Et),Q.setCanvasToOpenId(n,void 0))},[Et,n]);const{showDebugConversationTurns:Rt}=Vn(),fe=fa(n),ut=Kd(n),Qe=Xd({clientThreadId:n,conversationMode:se}),ts=i.useCallback(({requestedModelId:W,systemMessage:me,juice:$e,extraStreamParams:st})=>{const xt=new Gs;Qe({id:V.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:xt,requestedModelId:W,systemMessage:me,juice:$e,extraStreamParams:st})},[V,Qe]),qs=Te,ss=!x&&!fe&&!B&&!T,Ze=Jd(),ns=N.message.author.role===Ie.Assistant?N.message:null;Qd({isCompletionRequestInProgress:G,isUserTurn:T,message:ns});const _e=Re(n,W=>W?.tree!=null&&A.some(me=>{const $e=W.tree.getLeafFromNode(me);return W.tree.getHasErrorFromNode($e.id)})),{isOpen:It}=Zd(),os=Ba(),We=eu(se),mt=!Ze&&!We&&ss&&a&&z?.num_variants_in_stream===2&&!V.inlineComparisonRating&&!_e,Pt=tu(w),qe=mt,ht=mt&&!Pt,et=!T&&!x&&!fe&&!We&&!be&&!G&&!It,gt=et&&(!S||qs||re||f)&&!We&&!k&&!B,Ee=!x&&!((G||be)&&a)&&A.length>1&&!p&&!qe;let pt=!1;if(T&&I.length===1){const{shouldHideContent:W}=su(I[0]);W&&(pt=!0)}const $s=T&&!We&&!x&&!Fe&&I.length===1&&!pt&&!p&&!k,as=W=>{r(A[W]),Y.logEvent(K.changeNode,{intent:"toggle_between"})},Dt=nu(w,I,Rt),{toggleThreadSidebar:rs}=Fi(),Bt=i.useMemo(()=>w.messages.length?w.messages[w.messages.length-1].nodeId:void 0,[w.messages]),is=i.useCallback(()=>{Bt&&rs({type:"retrievalResults",clientThreadId:n,turnIndex:s,messageId:Bt})},[Bt,rs,n,s]),{value:tt}=Me("2912660649"),ls=i.useMemo(()=>tt&&ou(w,X,!!q),[tt,X,q,w]);if(!Dt&&!qe)return ye?e.jsx("div",{style:sa}):null;const cs=I.some(({message:W})=>Li.getAssetPointers(W).length>0)?null:e.jsx(Zh,{className:"h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",clientThreadId:n,message:V,onModelSelect:ts,onDropdownChange:oe,canRegenerateResponse:ut}),Lt=!T&&!pt&&(!a||!G)?e.jsx(fu,{onClick:Le}):null,Ys=!T&&(!a||!G)&&(V.disclaimers??[]).length===0&&V.nodeId?e.jsx(cg,{conversationId:n,message:V,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Ks=!T&&V&&(!a||!G)?e.jsx(xu,{message:V,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,Xs=!1,ds=gt&&!G?e.jsxs("div",{className:"flex",children:[de!=="thumbsDown"&&e.jsx(an,{onClick:()=>ct("thumbsUp"),disabled:de==="thumbsUp",icon:de==="thumbsUp"?au:rr,label:g.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${V.nodeId}`),de!=="thumbsUp"&&e.jsx(an,{onClick:()=>ct("thumbsDown"),disabled:de==="thumbsDown",icon:de==="thumbsDown"?ru:ir,label:g.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${V.nodeId}`)]}):null,us=O&&e.jsx(an,{onClick:()=>{Is.openSharingModal(C)},label:g.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:iu});function ft(W){return ie?W:e.jsx(qn,{clientThreadId:n,isStaticSharedThread:x,withVerticalPadding:!0,withHorizontalPadding:!qe,children:W})}function Js(W){return ie?W:e.jsx(Ps,{children:W})}return e.jsxs(e.Fragment,{children:[e.jsx(lu,{dateHeaderType:m,turn:w}),e.jsxs("article",{className:D("w-full scroll-mb-[var(--thread-trailing-height,150px)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",u==="finalAgentTurn"&&j&&ie?"opacity-0":""),style:ye?sa:void 0,ref:J,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":a,onMouseEnter:()=>ae(!0),onMouseLeave:()=>ae(!1),children:[e.jsx(cu,{role:w.role}),ft(e.jsx(e.Fragment,{children:qe?e.jsx(eg,{isFeedbackEnabled:gt,variantIds:A,variantsInStreamInfo:z,conversationTurnMountTime:Je,stubSideBySideFeedback:ht,...t}):Js(e.jsxs(e.Fragment,{children:[!T&&h&&e.jsx(gg,{children:e.jsx(jn,{messages:I,isUserTurn:T,avatarClassName:d,gizmo:ee})}),e.jsx("div",{className:D("group/conversation-turn relative flex w-full min-w-0 flex-col",!T&&du),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!T&&!x&&e.jsx(uu,{messages:I,clientThreadId:n,gizmoId:ee?.gizmo.id}),os&&!T&&e.jsx(dg,{clientThreadId:n,messages:I}),e.jsx(wn,{groupedMessagesToRender:dt,allGroupedMessages:R,...t,isEditing:p,isUserTurn:T,isCompletionRequestInProgress:G,isFeedbackEnabled:gt,isFinalTurn:a,hasActiveRequest:Ge,showEditButton:$s,handleEnterEdit:ze,handleExitEdit:Ne}),X&&!tt&&e.jsx("div",{className:"mb-4",children:e.jsx(mu,{messages:I})}),ls&&e.jsx(og,{handleShowRetrievalResults:is,clientThreadId:n,turnIndex:s,responseComplete:!(G||be)}),(et||Ee)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:D("mb-2 flex gap-3 empty:hidden",T?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(hu,{alwaysShow:a,showInline:a||Ee,isHovered:ce||te,pagination:Ee&&e.jsx(gu,{showInline:a||Ee,currentPage:U,onChangeIndex:as,length:A.length,className:D("self-center",A.length>1?"visible":"!invisible")}),actions:et&&e.jsxs(e.Fragment,{children:[Ys,Lt,ds,Xs,Ks,us,cs]})})}),et&&!G?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(pu,{message:V,isFinalTurn:a})}):null,a&&!G&&e.jsx(lg,{canShowInlineMessageFeedback:F,clientThreadId:n,conversationLeafId:o,messageForRating:V,allGroupedMessages:R,currentModelId:c})]})]})})})]}))}))]})]})}const hg=ja.memo(mg),gg=he.div`flex-shrink-0 flex flex-col relative items-end`;function pg({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:o,onRequestCompletion:a,clientThreadId:n,conversationLeafId:r,hideHeader:l}){const c=Se(),d=In(),h=vu(),[u]=Su(),m=bu(),[g]=yu(),b=Xt(n),f=An(),x=kt(n),v=Q.getConversationOrigin(n)===Hi.APPLE,j=c.store.useContentAreaDimensions(Mt.Header,B=>B?.height?B.height:void 0),C=c.store.useIsHeaderContentAreaPopulated(),w=ba(n),{isArchived:y}=w,A=ju(x.id),z=b?.kind===Oe.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":A,R=ya(n,r),H=wu(),[N,I]=i.useState(0),[E,p]=i.useState(!1);i.useEffect(()=>{d&&(N===0?I(R):!E&&R>N&&(p(!0),xe.logEvent("chatgpt_continue_conversation_first_message_sent"),Y.logEvent(K.continueConversationFirstMessageSent)))},[R,N,E,d]),i.useEffect(()=>{d&&(xe.logEvent("chatgpt_continue_conversation_page_loaded"),Y.logEvent(K.continueConversationPageLoaded),xe.logEvent("chatgpt_conversation_share_page_loaded"),Y.logEvent(K.sharedConversationPageLoaded))},[d]);const _=i.useCallback(()=>{h({behavior:"smooth"})},[h]),F=Mu(n),L=H&&!y,U=Cu(n,r),T=(B,q,ee)=>[...new Array(q-B).keys()].map(X=>{const re=X+B;return e.jsx(hg,{isFinalTurn:ee(re),turnIndex:re,clientThreadId:n,conversationLeafId:r,onChangeItemInView:t,onChangeRating:o,onRequestMoreCompletions:s,onRequestCompletion:a,currentModelId:x.id,avatarClassName:z,scrollToBottom:_,dateHeaderType:U(re)},re)});return e.jsxs("div",{onCopy:F,className:D("flex flex-col text-sm",L&&"pb-[120px]",j||L?null:"md:pb-9"),style:{paddingBottom:L?void 0:j},children:[!l&&f?.data&&e.jsx(dr,{clientThreadId:n}),d&&e.jsxs(e.Fragment,{children:[e.jsx(Ps,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(P,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),R-N===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{Is.openModal(Tu.ReportConversation),xe.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),Y.logEvent(K.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(P,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),T(0,N,B=>B===N-1),e.jsx(Ps,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(_u,{className:"icon-xs mr-2"}),e.jsx(P,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),T(N,R,B=>B===R-1)]}),!d&&T(0,R,B=>B===R-1),v&&u&&!g&&e.jsx(na,{className:D("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{xe.logEvent("chatgpt_thread_scroll_to_top"),m({behavior:"smooth"})},children:e.jsx(ku,{className:"icon-md text-token-text-primary"})}),!u&&e.jsx(na,{className:D(j?null:"bottom-5",L?C?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:H?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":j},onClick:()=>{xe.logEvent("chatgpt_thread_scroll_to_bottom"),h({behavior:"smooth"})},children:e.jsx(Au,{className:"icon-md text-token-text-primary"})})]})}const na=he.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,fg=60,xg=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:o=0})=>{const a=i.useRef(null);return e.jsx("div",{className:"h-full",ref:a,children:e.jsx(Oi,{children:e.jsx(rm,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>vg(a,o)?0:1/0,children:t})})})},vg=(t,s)=>{const o=Sg(t.current);if(o==null)return!1;const a=o>s,n=o<s-fg;return!a&&!n};function Sg(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const o=s.getBoundingClientRect().top,a=t.getBoundingClientRect().top;return o-a}const bg=De(()=>Be(()=>import("./b9s9od8ovvq4l0ah.js"),__vite__mapDeps([50,1,2,3,4,5,51,52,53,54,55,46,56])).then(t=>t.OpenDebugSidebarButton)),yg=De(()=>Be(()=>import("./ksnwm75was8ro53u.js"),__vite__mapDeps([57,2,4,1,3,5]))),oa=Ve({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function jg({clientThreadId:t}){const s=Ma(),o=Jt(t),a=async()=>{o&&(await wt.patchConversation(o,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),Us.setState(n=>{const r=n.threads[o];r!=null&&(r.initialThreadData.isArchived=!1)}),Yu(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(P,{...oa.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(Tt,{disabled:!o,onClick:a,icon:qu,children:e.jsx(P,{...oa.unarchiveButton})})})]})}const Dg=function({clientThreadId:t,onCreate:s,preRequestCompletion:o,hideHeader:a,hideMessages:n,hideFooter:r,hideToolsOverlay:l,messagesVerticalAlign:c="top",prependThreadChildren:d,renderEmptyState:h,prefetchSearch:u}){const m=ua(),{data:g}=Fs(),{data:b}=Xe(),f=zs(t),x=Bs(t),S=_t(t),j=ba(t).isArchived;Ui(t),i.useEffect(()=>{x||(bt(t)?hn.addTiming("chatgpt.web.chatPage.renderNewConversation"):hn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,x]);const C=aa(t,S),w=ya(t,S),{setTargetedContent:y}=Ja(),A=m?.includes(zi),z=Nu(),R=w>=2;Ka(R);const H=bt(t)&&!R&&_s(f),N=bt(t)&&!C&&(_s(f)||f?.kind===Oe.GizmoTest),E=Xa(g,b).id,p=Gi(t),_=p??E,F=!!p,L=Fn(_),U=Es(b?.models,_),T=Eu(t,f),B=Ya();Ru(w,t,S),i.useEffect(()=>{B||y(void 0)},[t,y,B,S]);const{caModal:q,onRequestCompletion:ee,onChangeItemInView:X,onChangeRating:re,onRequestMoreCompletions:ie}=Iu({clientThreadId:t,currentModelId:_,defaultModelId:E,onThreadCreated:s,preRequestCompletion:o}),se=Pu({clientThreadId:t,currentLeafId:S,handleRequestCompletion:ee,prefetchSearchPromise:u}),we=V=>e.jsx(xg,{scrollAnchorTopOffset:a?0:$u,children:c==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),V]}):V});i.useEffect(()=>{document.title=T??"ChatGPT"},[T]);const be=Ce(t),Te=it(),Fe=Wi(),le=N&&!Fe&&!h&&!be&&!L&&!Te,O=In(),k=Du(),{reset:te,streamingContext:oe,StreamingProvider:ce}=Bu();i.useEffect(()=>{k&&(oe.setOnResetContext=()=>{te()})},[k,te,oe]);const ae=i.useRef(null),ge=i.useRef(null),J=i.useMemo(()=>({threadContentScrollContainerElementRef:ae,footerRootContainerElementRef:ge}),[]);return e.jsx(Fu,{clientThreadId:t,currentLeafId:S,children:e.jsxs(ce,{value:oe,children:[A&&e.jsx(yg,{}),e.jsx(Lu,{children:T!=null&&e.jsx("title",{children:T})}),e.jsx(Vi.Provider,{value:ee,children:e.jsxs(Hu,{children:[e.jsxs(Ou,{clientThreadId:t,currentModelConfig:U,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!n&&e.jsx(Uu,{value:J,children:e.jsx(wg,{ref:ae,children:!x&&!se?N?h??e.jsx(Yh,{clientThreadId:t,currentModelId:_,isModelLoaded:F,onRequestCompletion:ee,showChatgptHomepage:le,chatgptHomepageDisclaimer:le&&e.jsx(Po,{clientThreadId:t})}):R?we(e.jsxs(e.Fragment,{children:[d,e.jsx(pg,{onChangeItemInView:X,onRequestMoreCompletions:ie,onChangeRating:re,onRequestCompletion:ee,clientThreadId:t,conversationLeafId:S,hideHeader:a},t)]})):null:null})}),e.jsx(Mg,{ref:ge,children:j?e.jsx(jg,{clientThreadId:t}):e.jsxs("div",{children:[!le&&e.jsx(Nh,{clientThreadId:t,isNewThread:H,showPromptStarters:H||!C,currentModelId:_,onRequestCompletion:ee}),!r&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:_s(f)&&!le&&e.jsx("div",{className:"min-h-4",children:e.jsx(Po,{clientThreadId:t})})})]})})]}),!l&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[z?e.jsxs(e.Fragment,{children:[e.jsx(bg,{}),!1]}):null,e.jsx(zu,{})]}),q,e.jsx(Gu,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:O}),e.jsx(Wu,{}),e.jsx(Vu,{conversationId:t,currentModelId:_,isActiveWindow:!Fe})]})})]})})},wg=he.div`grow flex-1 overflow-hidden @container/thread`,Mg=he.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{hg as C,Yh as E,Mn as G,vr as P,Dh as S,vm as T,xg as W,Dg as a,dr as b,Nh as c,bm as d,Pg as e,cr as u};
//# sourceMappingURL=ctlsvvj6folqh10x.js.map
