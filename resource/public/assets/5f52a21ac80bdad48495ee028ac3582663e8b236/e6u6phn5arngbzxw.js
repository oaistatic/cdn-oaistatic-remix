import{r as h,ao as q,j as o,ac as x,ad as K}from"./lklglvrzltpv3f05.js";import{ge as X,C as f,gf as Y,gg as Q,gh as J,gi as $,gj as Z,gk as ee,dD as te,bW as N,gl as se,gm as ae,gn as k,dB as oe,fX as R,go as ne,gp as ie,gq as re,u as ce,gr as de,gs as W,U as j,gt as M}from"./cp734xu9t8fnlezn.js";import{gc as I,bF as D,au as le,av as ue,as as he,eQ as pe,dQ as me,n as ge,fK as fe,l as xe,T as F,ew as ve,dW as L,fJ as Ce,aw as be,gd as we}from"./muemwvh3ybsggbb1.js";import{L as Te}from"./mvzr12kyv6trp09q.js";import{u as ye}from"./k3hicc8rbwef28my.js";import{T as Se}from"./j8ywpfcjmq1mweip.js";import{g as Ie}from"./btagl6w1gub4aw61.js";import"./hd9epd94ws110vxy.js";import"./c1eij8y6uricwssg.js";import"./cyqh5pewhk34cwzb.js";import"./ijwsqx5b9y4rlvqu.js";import"./d197qvlrpr6mqktk.js";import"./gt9bqxxv5tm4mxgb.js";import"./dbl63n4yi7gabe5l.js";import"./fzrn137102spawew.js";import"./j9pn3dpqp3dnyeg5.js";import"./k5u3zqwwbhrcvwt6.js";import"./hrqebt1cy2m73e7b.js";import"./lr2wtvbk3k0uolp8.js";import"./dvvege5f8or8rz89.js";const O="oai/apps/canmoreSidebarWidth",Ee=.25,Ae=400,U=400;function H(e){return e-Ae}function y(e,s){return q(U,H(e),s??Ee*e)}function _e(){const e=I.useState(I.selectWindowWidth),s=y(e,X(D.DANGER_SECRET_FOLDERS_ONLY_getItem(O))),a=V(),[t,d]=h.useState(s);h.useEffect(()=>{(t<U||t>H(e))&&d(y(e,t))},[e]);function r(c){d(g=>y(e,g+=c.delta.x))}function n(c){d(c),D.DANGER_SECRET_FOLDERS_ONLY_setItem(O,c)}function i(){const c=y(e,void 0);n(c)}const l=`calc(100vw - ${t}px)`;return a?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:l,viewportWidth:e,handleDrag:r,handleDoubleClick:i,persist:n}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function V(e){const s=I.useState(I.selectWindowWidth);return(e??s)>1e3}function Ne(e,s){let a;return s?.type===f.Textdoc&&(s.textdocId.startsWith(Y)||(a={type:"canvas_textdoc",id:s.textdocId})),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:a}}}const z=({isFullScreen:e=!1,clientThreadId:s,focusedObject:a,onClose:t,isAnimating:d=!1,width:r})=>{const{setTargetedContent:n}=Q(),i=h.useRef(!1);if(h.useEffect(()=>(i.current&&n(void 0),i.current=!0,()=>{i.current=!1}),[a]),a==null)return null;switch(a.type){case f.Textdoc:return o.jsx(Se,{isFullScreen:e,onClose:t,clientThreadId:s,focusedTextdoc:a,isAnimating:d,width:r});case f.ADAVisualization:return null;case f.Sonic:return!1}},Re=300,We=e=>{switch(e?.type){case f.Textdoc:return e.textdocId;case f.Sonic:return e.messageId;default:return null}};function je(e,s){const a=le(e),t=ue(a),d=he(e),r=pe(e,d),n=me({clientThreadId:e,conversationLeafId:d}),i=J(),[l,c]=h.useMemo(()=>{if(r&&$(r))return[void 0,null];if(s===!0)return[void 0,null];let p;return!n&&r&&(p=ge(Z(r.messages))),Me({clientThreadId:e,isRequestActive:t,latestTextdocId:i,groupedMessage:p})},[n,r,t,i,s,e]),g=c!=null,w=We(c);h.useEffect(()=>{if(c&&l&&!fe()&&(ee(c,l),c.type===f.Textdoc)){const{textdocId:p}=c,v=Ie(p);te(document.getElementById(v))}},[g,w])}function Me({clientThreadId:e,isRequestActive:s,latestTextdocId:a,groupedMessage:t}){switch(t?.type){case N.Canmore:{const[d,r]=t.messages;if(!se(d?.message))break;const n=ae(s,d.message,r?.message??null),i=n.textdocId??a;if(i&&(n.function===xe.CreateTextdoc?(n.content??"").length>Re||n.status===F.WAITING:n.status===F.STREAMING))return[n.messageId,{type:f.Textdoc,textdocId:i}];break}case N.SonicCanvas:break}return[void 0,null]}const De=260,S={type:"spring",bounce:.12,duration:.64},Fe={type:"spring",bounce:0,duration:.58},Oe=({clientThreadId:e,focusedObject:s,onClose:a})=>{const{chatWidth:t,canvasWidthCalc:d,handleDrag:r,handleDoubleClick:n,persist:i}=_e(),l=L(),[c,g]=h.useState(!0),[w,p]=h.useState(!1),v=R(u=>u.activeSidebar),E=ne(({rect:u})=>u),{windowHeight:C,windowWidth:b}=Ce(u=>u,{windowWidth:0,windowHeight:0});let m=E??{top:0,left:t,width:b-t,height:C},_=!1;if(E&&(m.top<0||m.top+m.height>C)){_=!0;const u={width:(b-t)*.75,height:C*.75};m={top:C/2-u.height/2,left:(b-t-u.width)/2+t,width:u.width,height:u.height}}if(l){const u=b-m.width-m.left;m={...m,left:-u}}const T=E?.borderRadius,A=ie(),G=A?.history!=null||A?.showChangesAtVersion!=null,B=R(u=>u.isDesktopNavCollapsed);return o.jsxs(o.Fragment,{children:[G&&o.jsx(Te,{onClick:()=>re(A.textdocId),zIndexKey:"chatOverlay"}),o.jsxs(x.div,{initial:!l&&{marginRight:B?0:-De},animate:!l&&{marginRight:0},transition:Fe,children:[o.jsx(x.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...S,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!l&&o.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),o.jsx(x.div,{className:"relative z-20 h-full",style:{width:d},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),o.jsx(x.div,{className:be("absolute z-20 h-full transition-shadow",l&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!l&&"overflow-hidden",!l&&(v==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:_?0:1,x:m.left,y:m.top,height:m.height,width:m.width},animate:{opacity:1,x:l?0:t,y:0,width:d,height:C,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:w?{duration:0}:S,onAnimationComplete:()=>g(!1),children:o.jsx(x.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:T},animate:{borderRadius:0},exit:{borderRadius:T},transition:S,children:o.jsxs("div",{className:"h-full",children:[o.jsx(x.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(u,P)=>{p(!0),r(P)},onDragEnd:()=>{p(!1),i(t)},onDoubleClick:()=>n()}),o.jsx(z,{onClose:a,clientThreadId:e,isAnimating:c,focusedObject:s,width:b-t})]})})})]})},ke=h.memo(Oe),Le=({clientThreadId:e,focusedObject:s,onClose:a})=>o.jsx(we,{children:o.jsx(x.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:S,children:o.jsx(z,{isFullScreen:!0,clientThreadId:e,focusedObject:s,onClose:a})})}),Ue=({clientThreadId:e,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{let t=V(s);const d=ye(e);je(e,a);const r=ce(),n=de(),i=h.useMemo(()=>{let p=r;if(r?.type===f.Textdoc){const v=n?.[r.textdocId];v&&(p={...r,textdocId:v})}return p},[r,n]);h.useEffect(()=>{k()},[e]);const l=i&&(t?o.jsx(ke,{clientThreadId:e,onClose:M,focusedObject:i},"canvas-sidebar"):o.jsx(Le,{clientThreadId:e,onClose:M,focusedObject:i},"canvas-modal"));h.useEffect(()=>{if(i)return W(p=>Ne(p,i)),()=>W(null)},[i,n]);const c=L(),g=l!=null;return h.useEffect(()=>{if(!c)return j.setActiveStageSidebar(g),()=>{g&&j.setActiveStageSidebar(!1)}},[g,c]),d!==e?null:o.jsx(K,{children:l})},it=e=>{const s=h.useRef(null);return o.jsx(ve,{ref:s,onError:(a,t)=>{k(),setTimeout(()=>{s.current?.resetErrorBoundary()}),oe.logError("Error boundary hit",a,{componentStack:t})},name:"canmore-focused-view",children:o.jsx(Ue,{...e})})};export{it as CanvasFocusedViewManager};
//# sourceMappingURL=e6u6phn5arngbzxw.js.map
